System.register(["./vendor-legacy-083c8412.js"],(function(e,t){"use strict";var a,s,i,r,n,o,l,c,d,m,h,p,u,x,f,b,g,v,w,y,j,N,k,S,Z,G,C,W,X,V,R,L,z,T,K,I,Y,F,H,M,U,D,B,J,P,E,O,Q,A,_,q,$,ee,te,ae,se,ie,re,ne,oe,le,ce,de,me,he,pe,ue,xe,fe,be,ge,ve,we,ye,je,Ne,ke,Se,Ze,Ge,Ce,We,Xe,Ve,Re,Le,ze,Te,Ke,Ie,Ye,Fe,He,Me,Ue,De,Be,Je,Pe,Ee,Oe,Qe,Ae,_e,qe,$e,et,tt,at,st,it,rt,nt,ot,lt,ct,dt,mt,ht,pt,ut,xt,ft,bt,gt,vt,wt,yt,jt,Nt,kt,St,Zt,Gt,Ct,Wt,Xt,Vt,Rt,Lt,zt,Tt,Kt,It,Yt,Ft,Ht,Mt,Ut,Dt,Bt,Jt,Pt,Et,Ot,Qt,At,_t,qt,$t,ea,ta,aa,sa,ia,ra,na,oa,la,ca,da,ma,ha,pa,ua,xa,fa,ba,ga,va,wa,ya,ja,Na,ka,Sa,Za,Ga,Ca,Wa,Xa,Va,Ra,La,za,Ta,Ka,Ia,Ya,Fa,Ha,Ma,Ua,Da,Ba,Ja,Pa,Ea,Oa,Qa,Aa,_a,qa,$a,es,ts,as,ss,is,rs,ns,os,ls,cs,ds,ms,hs,ps,us,xs,fs,bs,gs,vs,ws,ys,js,Ns,ks,Ss,Zs,Gs,Cs,Ws,Xs,Vs,Rs,Ls,zs,Ts,Ks,Is,Ys,Fs,Hs,Ms,Us,Ds,Bs,Js,Ps,Es,Os,Qs,As,_s,qs,$s,ei,ti,ai,si,ii,ri,ni,oi,li,ci,di,mi;return{setters:[e=>{a=e.t,s=e.c,i=e.r,r=e.j,n=e.n,o=e.l,l=e.C,c=e.B,d=e.N,m=e.a,h=e.T,p=e.G,u=e.b,x=e.R,f=e.F,b=e.L,g=e.d,v=e.E,w=e.e,y=e.f,j=e.g,N=e.S,k=e.A,S=e.h,Z=e.i,G=e.k,C=e.m,W=e.P,X=e.o,V=e.p,R=e.q,L=e.s,z=e.u,T=e.v,K=e.w,I=e.x,Y=e.V,F=e.y,H=e.z,M=e.D,U=e.H,D=e.I,B=e.J,J=e.K,P=e.M,E=e.O,O=e.Q,Q=e.U,A=e.W,_=e.X,q=e.Y,$=e.Z,ee=e._,te=e.$,ae=e.a0,se=e.a1,ie=e.a2,re=e.a3,ne=e.a4,oe=e.a5,le=e.a6,ce=e.a7,de=e.a8,me=e.a9,he=e.aa,pe=e.ab,ue=e.ac,xe=e.ad,fe=e.ae,be=e.af,ge=e.ag,ve=e.ah,we=e.ai,ye=e.aj,je=e.ak,Ne=e.al,ke=e.am,Se=e.an,Ze=e.ao,Ge=e.ap,Ce=e.aq,We=e.ar,Xe=e.as,Ve=e.at,Re=e.au,Le=e.av,ze=e.aw,Te=e.ax,Ke=e.ay,Ie=e.az,Ye=e.aA,Fe=e.aB,He=e.aC,Me=e.aD,Ue=e.aE,De=e.aF,Be=e.aG,Je=e.aH,Pe=e.aI,Ee=e.aJ,Oe=e.aK,Qe=e.aL,Ae=e.aM,_e=e.aN,qe=e.aO,$e=e.aP,et=e.aQ,tt=e.aR,at=e.aS,st=e.aT,it=e.aU,rt=e.aV,nt=e.aW,ot=e.aX,lt=e.aY,ct=e.aZ,dt=e.a_,mt=e.a$,ht=e.b0,pt=e.b1,ut=e.b2,xt=e.b3,ft=e.b4,bt=e.b5,gt=e.b6,vt=e.b7,wt=e.b8,yt=e.b9,jt=e.ba,Nt=e.bb,kt=e.bc,St=e.bd,Zt=e.be,Gt=e.bf,Ct=e.bg,Wt=e.bh,Xt=e.bi,Vt=e.bj,Rt=e.bk,Lt=e.bl,zt=e.bm,Tt=e.bn,Kt=e.bo,It=e.bp,Yt=e.bq,Ft=e.br,Ht=e.bs,Mt=e.bt,Ut=e.bu,Dt=e.bv,Bt=e.bw,Jt=e.bx,Pt=e.by,Et=e.bz,Ot=e.bA,Qt=e.bB,At=e.bC,_t=e.bD,qt=e.bE,$t=e.bF,ea=e.bG,ta=e.bH,aa=e.bI,sa=e.bJ,ia=e.bK,ra=e.bL,na=e.bM,oa=e.bN,la=e.bO,ca=e.bP,da=e.bQ,ma=e.bR,ha=e.bS,pa=e.bT,ua=e.bU,xa=e.bV,fa=e.bW,ba=e.bX,ga=e.bY,va=e.bZ,wa=e.b_,ya=e.b$,ja=e.c0,Na=e.c1,ka=e.c2,Sa=e.c3,Za=e.c4,Ga=e.c5,Ca=e.c6,Wa=e.c7,Xa=e.c8,Va=e.c9,Ra=e.ca,La=e.cb,za=e.cc,Ta=e.cd,Ka=e.ce,Ia=e.cf,Ya=e.cg,Fa=e.ch,Ha=e.ci,Ma=e.cj,Ua=e.ck,Da=e.cl,Ba=e.cm,Ja=e.cn,Pa=e.co,Ea=e.cp,Oa=e.cq,Qa=e.cr,Aa=e.cs,_a=e.ct,qa=e.cu,$a=e.cv,es=e.cw,ts=e.cx,as=e.cy,ss=e.cz,is=e.cA,rs=e.cB,ns=e.cC,os=e.cD,ls=e.cE,cs=e.cF,ds=e.cG,ms=e.cH,hs=e.cI,ps=e.cJ,us=e.cK,xs=e.cL,fs=e.cM,bs=e.cN,gs=e.cO,vs=e.cP,ws=e.cQ,ys=e.cR,js=e.cS,Ns=e.cT,ks=e.cU,Ss=e.cV,Zs=e.cW,Gs=e.cX,Cs=e.cY,Ws=e.cZ,Xs=e.c_,Vs=e.c$,Rs=e.d0,Ls=e.d1,zs=e.d2,Ts=e.d3,Ks=e.d4,Is=e.d5,Ys=e.d6,Fs=e.d7,Hs=e.d8,Ms=e.d9,Us=e.da,Ds=e.db,Bs=e.dc,Js=e.dd,Ps=e.de,Es=e.df,Os=e.dg,Qs=e.dh,As=e.di,_s=e.dj,qs=e.dk,$s=e.dl,ei=e.dm,ti=e.dn,ai=e.dp,si=e.dq,ii=e.dr,ri=e.ds,ni=e.dt,oi=e.du,li=e.dv,ci=e.dw,di=e.dx,mi=e.dy}],execute:function(){var e=document.createElement("style");function t(...e){return a(s(e))}function hi(e){const t=e.name.split(".").pop()||"";return{name:e.name.substring(0,e.name.lastIndexOf(".")),ext:t}}e.textContent='*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}:root{--background: 0 0% 100%;--foreground: 222.2 84% 4.9%;--card: 0 0% 100%;--card-foreground: 222.2 84% 4.9%;--popover: 0 0% 100%;--popover-foreground: 222.2 84% 4.9%;--primary: 222.2 47.4% 11.2%;--primary-foreground: 210 40% 98%;--secondary: 210 40% 96.1%;--secondary-foreground: 222.2 47.4% 11.2%;--muted: 210 40% 96.1%;--muted-foreground: 215.4 16.3% 46.9%;--accent: 210 40% 96.1%;--accent-foreground: 222.2 47.4% 11.2%;--destructive: 0 84.2% 60.2%;--destructive-foreground: 210 40% 98%;--border: 214.3 31.8% 91.4%;--input: 214.3 31.8% 91.4%;--ring: 222.2 84% 4.9%;--radius: .5rem;--chart-1: 12 76% 61%;--chart-2: 173 58% 39%;--chart-3: 197 37% 24%;--chart-4: 43 74% 66%;--chart-5: 27 87% 67%}*{border-color:hsl(var(--border))}body{background-color:hsl(var(--background));color:hsl(var(--foreground))}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%;margin-right:auto;margin-left:auto;padding-right:2rem;padding-left:2rem}@media (min-width: 1400px){.container{max-width:1400px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\\!visible{visibility:visible!important}.visible{visibility:visible}.invisible{visibility:hidden}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}.inset-x-0{left:0;right:0}.inset-y-0{top:0;bottom:0}.-bottom-px{bottom:-1px}.-top-px{top:-1px}.bottom-0{bottom:0}.left-0{left:0}.left-2{left:.5rem}.left-\\[50\\%\\]{left:50%}.right-0{right:0}.right-1{right:.25rem}.right-2{right:.5rem}.right-4{right:1rem}.top-0{top:0}.top-1{top:.25rem}.top-4{top:1rem}.top-\\[50\\%\\]{top:50%}.z-10{z-index:10}.z-20{z-index:20}.z-40{z-index:40}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.z-\\[500\\]{z-index:500}.m-0{margin:0}.m-1{margin:.25rem}.-mx-1{margin-left:-.25rem;margin-right:-.25rem}.mx-0\\.5{margin-left:.125rem;margin-right:.125rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-1\\.5{margin-top:.375rem;margin-bottom:.375rem}.\\!mb-4{margin-bottom:1rem!important}.\\!mt-auto{margin-top:auto!important}.-ml-1{margin-left:-.25rem}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.ml-0\\.5{margin-left:.125rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-auto{margin-left:auto}.mr-0{margin-right:0}.mr-0\\.5{margin-right:.125rem}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-auto{margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-24{margin-top:6rem}.mt-4{margin-top:1rem}.mt-auto{margin-top:auto}.box-content{box-sizing:content-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.aspect-\\[1\\/1\\]{aspect-ratio:1/1}.aspect-\\[16\\/3\\]{aspect-ratio:16/3}.aspect-\\[16\\/9\\]{aspect-ratio:16/9}.aspect-\\[9\\/16\\]{aspect-ratio:9/16}.\\!size-4{width:1rem!important;height:1rem!important}.size-10{width:2.5rem;height:2.5rem}.size-3\\.5{width:.875rem;height:.875rem}.size-4{width:1rem;height:1rem}.size-5{width:1.25rem;height:1.25rem}.size-6{width:1.5rem;height:1.5rem}.size-9{width:2.25rem;height:2.25rem}.size-full{width:100%;height:100%}.h-0\\.5{height:.125rem}.h-1\\.5{height:.375rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-2{height:.5rem}.h-2\\.5{height:.625rem}.h-3\\.5{height:.875rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\\[1\\.3em\\]{height:1.3em}.h-\\[1\\.5em\\]{height:1.5em}.h-\\[120px\\]{height:120px}.h-\\[400px\\]{height:400px}.h-\\[50vh\\]{height:50vh}.h-\\[53px\\]{height:53px}.h-\\[90vh\\]{height:90vh}.h-\\[calc\\(100\\%-2\\.5rem\\)\\]{height:calc(100% - 2.5rem)}.h-\\[calc\\(100vh-2rem\\)\\]{height:calc(100vh - 2rem)}.h-\\[calc\\(100vh-53px-1rem\\)\\]{height:calc(100vh - 53px - 1rem)}.h-\\[var\\(--radix-select-trigger-height\\)\\]{height:var(--radix-select-trigger-height)}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-96{max-height:24rem}.max-h-\\[288px\\]{max-height:288px}.max-h-\\[50\\%\\]{max-height:50%}.max-h-\\[500px\\]{max-height:500px}.max-h-\\[80vh\\]{max-height:80vh}.max-h-screen{max-height:100vh}.min-h-\\[1lh\\]{min-height:1lh}.min-h-\\[60px\\]{min-height:60px}.min-h-\\[80px\\]{min-height:80px}.w-12{width:3rem}.w-2\\.5{width:.625rem}.w-3\\.5{width:.875rem}.w-3\\/4{width:75%}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-72{width:18rem}.w-9{width:2.25rem}.w-\\[100px\\]{width:100px}.w-\\[120px\\]{width:120px}.w-\\[200px\\]{width:200px}.w-\\[300px\\]{width:300px}.w-\\[330px\\]{width:330px}.w-\\[3rem\\]{width:3rem}.w-\\[4rem\\]{width:4rem}.w-\\[80px\\]{width:80px}.w-\\[8rem\\]{width:8rem}.w-auto{width:auto}.w-full{width:100%}.w-px{width:1px}.min-w-0{min-width:0px}.min-w-32{min-width:8rem}.min-w-\\[12rem\\]{min-width:12rem}.min-w-\\[180px\\]{min-width:180px}.min-w-\\[80vw\\]{min-width:80vw}.min-w-\\[8rem\\]{min-width:8rem}.min-w-\\[90vw\\]{min-width:90vw}.min-w-\\[auto\\]{min-width:auto}.min-w-\\[var\\(--radix-select-trigger-width\\)\\]{min-width:var(--radix-select-trigger-width)}.max-w-\\[100px\\]{max-width:100px}.max-w-\\[150px\\]{max-width:150px}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.flex-grow,.grow{flex-grow:1}.caption-bottom{caption-side:bottom}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-\\[-50\\%\\]{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\\[-50\\%\\]{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-default{cursor:default}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-text{cursor:text}.touch-none{touch-action:none}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.space-x-1>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.25rem * var(--tw-space-x-reverse));margin-left:calc(.25rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-0>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.self-center{align-self:center}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.text-ellipsis{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.text-nowrap{text-wrap:nowrap}.break-words{overflow-wrap:break-word}.rounded{border-radius:.25rem}.rounded-\\[inherit\\]{border-radius:inherit}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-sm{border-radius:calc(var(--radius) - 4px)}.rounded-xl{border-radius:.75rem}.rounded-t-\\[10px\\]{border-top-left-radius:10px;border-top-right-radius:10px}.rounded-t-lg{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.border{border-width:1px}.border-0{border-width:0px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-border{border-color:hsl(var(--border))}.border-destructive{border-color:hsl(var(--destructive))}.border-destructive\\/50{border-color:hsl(var(--destructive) / .5)}.border-input{border-color:hsl(var(--input))}.border-primary\\/50{border-color:hsl(var(--primary) / .5)}.border-transparent{border-color:transparent}.border-b-border{border-bottom-color:hsl(var(--border))}.border-l-transparent{border-left-color:transparent}.border-t-border{border-top-color:hsl(var(--border))}.border-t-transparent{border-top-color:transparent}.bg-background{background-color:hsl(var(--background))}.bg-background\\/95{background-color:hsl(var(--background) / .95)}.bg-black\\/80{background-color:rgba(0,0,0,.8)}.bg-border{background-color:hsl(var(--border))}.bg-card{background-color:hsl(var(--card))}.bg-destructive{background-color:hsl(var(--destructive))}.bg-muted{background-color:hsl(var(--muted))}.bg-muted\\/50{background-color:hsl(var(--muted) / .5)}.bg-muted\\/80{background-color:hsl(var(--muted) / .8)}.bg-popover{background-color:hsl(var(--popover))}.bg-primary{background-color:hsl(var(--primary))}.bg-primary\\/20{background-color:hsl(var(--primary) / .2)}.bg-ring{background-color:hsl(var(--ring))}.bg-secondary{background-color:hsl(var(--secondary))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.fill-current{fill:currentColor}.object-contain{-o-object-fit:contain;object-fit:contain}.p-0{padding:0}.p-1{padding:.25rem}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-\\[1px\\]{padding:1px}.px-0{padding-left:0;padding-right:0}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.pb-0{padding-bottom:0}.pb-1{padding-bottom:.25rem}.pl-2{padding-left:.5rem}.pl-3{padding-left:.75rem}.pl-8{padding-left:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pr-6{padding-right:1.5rem}.pr-8{padding-right:2rem}.pt-0{padding-top:0}.pt-2{padding-top:.5rem}.pt-\\[2px\\]{padding-top:2px}.pt-\\[3px\\]{padding-top:3px}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-baseline{vertical-align:baseline}.align-middle{vertical-align:middle}.text-\\[0\\.8rem\\]{font-size:.8rem}.text-\\[1\\.1em\\]{font-size:1.1em}.text-\\[1\\.25em\\]{font-size:1.25em}.text-\\[1\\.5em\\]{font-size:1.5em}.text-\\[1\\.875em\\]{font-size:1.875em}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.italic{font-style:italic}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.tracking-widest{letter-spacing:.1em}.text-card-foreground{color:hsl(var(--card-foreground))}.text-destructive{color:hsl(var(--destructive))}.text-destructive-foreground{color:hsl(var(--destructive-foreground))}.text-foreground{color:hsl(var(--foreground))}.text-foreground\\/50{color:hsl(var(--foreground) / .5)}.text-muted-foreground{color:hsl(var(--muted-foreground))}.text-muted-foreground\\/50{color:hsl(var(--muted-foreground) / .5)}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity))}.text-popover-foreground{color:hsl(var(--popover-foreground))}.text-primary{color:hsl(var(--primary))}.text-primary-foreground{color:hsl(var(--primary-foreground))}.text-primary\\/60{color:hsl(var(--primary) / .6)}.text-secondary-foreground{color:hsl(var(--secondary-foreground))}.underline{text-decoration-line:underline}.decoration-primary{text-decoration-color:hsl(var(--primary))}.underline-offset-4{text-underline-offset:4px}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-70{opacity:.7}.opacity-90{opacity:.9}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-none{--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.ring-0{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-ring{--tw-ring-color: hsl(var(--ring))}.ring-offset-background{--tw-ring-offset-color: hsl(var(--background))}.\\!filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)!important}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}@keyframes enter{0%{opacity:var(--tw-enter-opacity, 1);transform:translate3d(var(--tw-enter-translate-x, 0),var(--tw-enter-translate-y, 0),0) scale3d(var(--tw-enter-scale, 1),var(--tw-enter-scale, 1),var(--tw-enter-scale, 1)) rotate(var(--tw-enter-rotate, 0))}}@keyframes exit{to{opacity:var(--tw-exit-opacity, 1);transform:translate3d(var(--tw-exit-translate-x, 0),var(--tw-exit-translate-y, 0),0) scale3d(var(--tw-exit-scale, 1),var(--tw-exit-scale, 1),var(--tw-exit-scale, 1)) rotate(var(--tw-exit-rotate, 0))}}.animate-in{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.fade-in-0{--tw-enter-opacity: 0}.zoom-in-95{--tw-enter-scale: .95}.duration-200{animation-duration:.2s}.ease-in-out{animation-timing-function:cubic-bezier(.4,0,.2,1)}.file\\:border-0::file-selector-button{border-width:0px}.file\\:bg-background::file-selector-button{background-color:hsl(var(--background))}.file\\:bg-transparent::file-selector-button{background-color:transparent}.file\\:text-sm::file-selector-button{font-size:.875rem;line-height:1.25rem}.file\\:font-medium::file-selector-button{font-weight:500}.file\\:text-foreground::file-selector-button{color:hsl(var(--foreground))}.placeholder\\:text-muted-foreground::-moz-placeholder{color:hsl(var(--muted-foreground))}.placeholder\\:text-muted-foreground::placeholder{color:hsl(var(--muted-foreground))}.before\\:absolute:before{content:var(--tw-content);position:absolute}.before\\:cursor-text:before{content:var(--tw-content);cursor:text}.before\\:opacity-30:before{content:var(--tw-content);opacity:.3}.before\\:content-\\[attr\\(placeholder\\)\\]:before{--tw-content: attr(placeholder);content:var(--tw-content)}.focus-within\\:ring-2:focus-within{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.hover\\:bg-accent:hover{background-color:hsl(var(--accent))}.hover\\:bg-destructive\\/90:hover{background-color:hsl(var(--destructive) / .9)}.hover\\:bg-muted:hover{background-color:hsl(var(--muted))}.hover\\:bg-muted\\/50:hover{background-color:hsl(var(--muted) / .5)}.hover\\:bg-primary\\/90:hover{background-color:hsl(var(--primary) / .9)}.hover\\:bg-secondary:hover{background-color:hsl(var(--secondary))}.hover\\:bg-secondary\\/80:hover{background-color:hsl(var(--secondary) / .8)}.hover\\:bg-slate-100:hover{--tw-bg-opacity: 1;background-color:rgb(241 245 249 / var(--tw-bg-opacity))}.hover\\:text-accent-foreground:hover{color:hsl(var(--accent-foreground))}.hover\\:text-destructive:hover{color:hsl(var(--destructive))}.hover\\:text-foreground:hover{color:hsl(var(--foreground))}.hover\\:text-muted-foreground:hover{color:hsl(var(--muted-foreground))}.hover\\:underline:hover{text-decoration-line:underline}.hover\\:opacity-100:hover{opacity:1}.focus\\:bg-accent:focus{background-color:hsl(var(--accent))}.focus\\:text-accent-foreground:focus{color:hsl(var(--accent-foreground))}.focus\\:opacity-100:focus{opacity:1}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-1:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-ring:focus{--tw-ring-color: hsl(var(--ring))}.focus\\:ring-offset-2:focus{--tw-ring-offset-width: 2px}.focus-visible\\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\\:ring-1:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-2:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-ring:focus-visible{--tw-ring-color: hsl(var(--ring))}.focus-visible\\:ring-transparent:focus-visible{--tw-ring-color: transparent}.focus-visible\\:ring-offset-2:focus-visible{--tw-ring-offset-width: 2px}.focus-visible\\:ring-offset-background:focus-visible{--tw-ring-offset-color: hsl(var(--background))}.disabled\\:pointer-events-none:disabled{pointer-events:none}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}.group:hover .group-hover\\:visible{visibility:visible}.group:hover .group-hover\\:opacity-100{opacity:1}.group.destructive .group-\\[\\.destructive\\]\\:border-muted\\/40{border-color:hsl(var(--muted) / .4)}.group.destructive .group-\\[\\.destructive\\]\\:text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:border-destructive\\/30:hover{border-color:hsl(var(--destructive) / .3)}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:bg-destructive:hover{background-color:hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-destructive-foreground:hover{color:hsl(var(--destructive-foreground))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-red-50:hover{--tw-text-opacity: 1;color:rgb(254 242 242 / var(--tw-text-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-destructive:focus{--tw-ring-color: hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-red-400:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(248 113 113 / var(--tw-ring-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-offset-red-600:focus{--tw-ring-offset-color: #dc2626}.peer:disabled~.peer-disabled\\:cursor-not-allowed{cursor:not-allowed}.peer:disabled~.peer-disabled\\:opacity-70{opacity:.7}.aria-checked\\:bg-accent[aria-checked=true]{background-color:hsl(var(--accent))}.aria-checked\\:text-accent-foreground[aria-checked=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:pointer-events-none[data-disabled]{pointer-events:none}.data-\\[side\\=bottom\\]\\:translate-y-1[data-side=bottom]{--tw-translate-y: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=left\\]\\:-translate-x-1[data-side=left]{--tw-translate-x: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=right\\]\\:translate-x-1[data-side=right]{--tw-translate-x: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=top\\]\\:-translate-y-1[data-side=top]{--tw-translate-y: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=checked\\]\\:translate-x-4[data-state=checked]{--tw-translate-x: 1rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=unchecked\\]\\:translate-x-0[data-state=unchecked],.data-\\[swipe\\=cancel\\]\\:translate-x-0[data-swipe=cancel]{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=end\\]\\:translate-x-\\[var\\(--radix-toast-swipe-end-x\\)\\][data-swipe=end]{--tw-translate-x: var(--radix-toast-swipe-end-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=move\\]\\:translate-x-\\[var\\(--radix-toast-swipe-move-x\\)\\][data-swipe=move]{--tw-translate-x: var(--radix-toast-swipe-move-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[active-item\\=true\\]\\:bg-accent[data-active-item=true]{background-color:hsl(var(--accent))}.data-\\[state\\=active\\]\\:bg-background[data-state=active]{background-color:hsl(var(--background))}.data-\\[state\\=checked\\]\\:bg-accent[data-state=checked]{background-color:hsl(var(--accent))}.data-\\[state\\=checked\\]\\:bg-primary[data-state=checked]{background-color:hsl(var(--primary))}.data-\\[state\\=on\\]\\:bg-accent[data-state=on],.data-\\[state\\=open\\]\\:bg-accent[data-state=open]{background-color:hsl(var(--accent))}.data-\\[state\\=open\\]\\:bg-secondary[data-state=open]{background-color:hsl(var(--secondary))}.data-\\[state\\=selected\\]\\:bg-muted[data-state=selected]{background-color:hsl(var(--muted))}.data-\\[state\\=unchecked\\]\\:bg-input[data-state=unchecked]{background-color:hsl(var(--input))}.data-\\[active-item\\=true\\]\\:text-accent-foreground[data-active-item=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:text-gray-400[data-disabled]{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity))}.data-\\[state\\=active\\]\\:text-foreground[data-state=active]{color:hsl(var(--foreground))}.data-\\[state\\=checked\\]\\:text-accent-foreground[data-state=checked],.data-\\[state\\=on\\]\\:text-accent-foreground[data-state=on],.data-\\[state\\=open\\]\\:text-accent-foreground[data-state=open]{color:hsl(var(--accent-foreground))}.data-\\[state\\=open\\]\\:text-muted-foreground[data-state=open]{color:hsl(var(--muted-foreground))}.data-\\[disabled\\]\\:opacity-50[data-disabled]{opacity:.5}.data-\\[state\\=active\\]\\:shadow[data-state=active]{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.data-\\[swipe\\=move\\]\\:transition-none[data-swipe=move]{transition-property:none}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{transition-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{transition-duration:.5s}.data-\\[state\\=open\\]\\:animate-in[data-state=open]{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.data-\\[state\\=closed\\]\\:animate-out[data-state=closed],.data-\\[swipe\\=end\\]\\:animate-out[data-swipe=end]{animation-name:exit;animation-duration:.15s;--tw-exit-opacity: initial;--tw-exit-scale: initial;--tw-exit-rotate: initial;--tw-exit-translate-x: initial;--tw-exit-translate-y: initial}.data-\\[state\\=closed\\]\\:fade-out-0[data-state=closed]{--tw-exit-opacity: 0}.data-\\[state\\=closed\\]\\:fade-out-80[data-state=closed]{--tw-exit-opacity: .8}.data-\\[state\\=open\\]\\:fade-in-0[data-state=open]{--tw-enter-opacity: 0}.data-\\[state\\=closed\\]\\:zoom-out-95[data-state=closed]{--tw-exit-scale: .95}.data-\\[state\\=open\\]\\:zoom-in-95[data-state=open]{--tw-enter-scale: .95}.data-\\[side\\=bottom\\]\\:slide-in-from-top-2[data-side=bottom]{--tw-enter-translate-y: -.5rem}.data-\\[side\\=left\\]\\:slide-in-from-right-2[data-side=left]{--tw-enter-translate-x: .5rem}.data-\\[side\\=right\\]\\:slide-in-from-left-2[data-side=right]{--tw-enter-translate-x: -.5rem}.data-\\[side\\=top\\]\\:slide-in-from-bottom-2[data-side=top]{--tw-enter-translate-y: .5rem}.data-\\[state\\=closed\\]\\:slide-out-to-bottom[data-state=closed]{--tw-exit-translate-y: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-left[data-state=closed]{--tw-exit-translate-x: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-left-1\\/2[data-state=closed]{--tw-exit-translate-x: -50%}.data-\\[state\\=closed\\]\\:slide-out-to-right[data-state=closed],.data-\\[state\\=closed\\]\\:slide-out-to-right-full[data-state=closed]{--tw-exit-translate-x: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-top[data-state=closed]{--tw-exit-translate-y: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-top-\\[48\\%\\][data-state=closed]{--tw-exit-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-bottom[data-state=open]{--tw-enter-translate-y: 100%}.data-\\[state\\=open\\]\\:slide-in-from-left[data-state=open]{--tw-enter-translate-x: -100%}.data-\\[state\\=open\\]\\:slide-in-from-left-1\\/2[data-state=open]{--tw-enter-translate-x: -50%}.data-\\[state\\=open\\]\\:slide-in-from-right[data-state=open]{--tw-enter-translate-x: 100%}.data-\\[state\\=open\\]\\:slide-in-from-top[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=open\\]\\:slide-in-from-top-\\[48\\%\\][data-state=open]{--tw-enter-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-top-full[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{animation-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{animation-duration:.5s}.dark\\:border-destructive:is(.dark *){border-color:hsl(var(--destructive))}@media (min-width: 640px){.sm\\:bottom-0{bottom:0}.sm\\:right-0{right:0}.sm\\:top-auto{top:auto}.sm\\:mt-0{margin-top:0}.sm\\:max-h-full{max-height:100%}.sm\\:max-w-sm{max-width:24rem}.sm\\:flex-row{flex-direction:row}.sm\\:flex-col{flex-direction:column}.sm\\:justify-end{justify-content:flex-end}.sm\\:space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.sm\\:rounded-lg{border-radius:var(--radius)}.sm\\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\\:text-left{text-align:left}.data-\\[state\\=open\\]\\:sm\\:slide-in-from-bottom-full[data-state=open]{--tw-enter-translate-y: 100%}}@media (min-width: 768px){.md\\:mr-0\\.5{margin-right:.125rem}.md\\:flex{display:flex}.md\\:hidden{display:none}.md\\:h-\\[30vh\\]{height:30vh}.md\\:w-\\[130px\\]{width:130px}.md\\:max-w-\\[420px\\]{max-width:420px}.md\\:grid-cols-\\[minmax\\(450px\\,1fr\\)_2fr\\]{grid-template-columns:minmax(450px,1fr) 2fr}.md\\:border{border-width:1px}.md\\:p-2{padding:.5rem}.md\\:shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}}@media (min-width: 1024px){.lg\\:inline{display:inline}.lg\\:min-w-\\[130px\\]{min-width:130px}}@media print{.print\\:hidden{display:none}}.\\[\\&\\+div\\]\\:text-xs+div{font-size:.75rem;line-height:1rem}.\\[\\&\\:has\\(\\[role\\=checkbox\\]\\)\\]\\:pr-0:has([role=checkbox]){padding-right:0}.\\[\\&\\>\\[role\\=checkbox\\]\\]\\:translate-y-\\[2px\\]>[role=checkbox]{--tw-translate-y: 2px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>span\\]\\:line-clamp-1>span{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.\\[\\&\\>svg\\+div\\]\\:translate-y-\\[-3px\\]>svg+div{--tw-translate-y: -3px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>svg\\]\\:absolute>svg{position:absolute}.\\[\\&\\>svg\\]\\:left-4>svg{left:1rem}.\\[\\&\\>svg\\]\\:top-4>svg{top:1rem}.\\[\\&\\>svg\\]\\:text-destructive>svg{color:hsl(var(--destructive))}.\\[\\&\\>svg\\]\\:text-foreground>svg{color:hsl(var(--foreground))}.\\[\\&\\>svg\\~\\*\\]\\:pl-7>svg~*{padding-left:1.75rem}.\\[\\&\\>tr\\]\\:last\\:border-b-0:last-child>tr{border-bottom-width:0px}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:top-\\[auto_\\!important\\] [data-slate-placeholder]{top:auto!important}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:text-muted-foreground [data-slate-placeholder]{color:hsl(var(--muted-foreground))}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:\\!opacity-100 [data-slate-placeholder]{opacity:1!important}.\\[\\&_p\\]\\:leading-relaxed p{line-height:1.625}.\\[\\&_strong\\]\\:font-bold strong{font-weight:700}.\\[\\&_svg\\:not\\(\\[data-icon\\]\\)\\]\\:size-5 svg:not([data-icon]){width:1.25rem;height:1.25rem}.\\[\\&_svg\\]\\:pointer-events-none svg{pointer-events:none}.\\[\\&_svg\\]\\:size-4 svg{width:1rem;height:1rem}.\\[\\&_svg\\]\\:shrink-0 svg{flex-shrink:0}.\\[\\&_tr\\:last-child\\]\\:border-0 tr:last-child{border-width:0px}.\\[\\&_tr\\]\\:border-b tr{border-bottom-width:1px}\n',document.head.appendChild(e);const pi=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:s,className:t("w-full caption-bottom text-sm",e),...a})})));pi.displayName="Table";const ui=i.forwardRef((({className:e,...a},s)=>r.jsx("thead",{ref:s,className:t("[&_tr]:border-b",e),...a})));ui.displayName="TableHeader";const xi=i.forwardRef((({className:e,...a},s)=>r.jsx("tbody",{ref:s,className:t("[&_tr:last-child]:border-0",e),...a})));xi.displayName="TableBody",i.forwardRef((({className:e,...a},s)=>r.jsx("tfoot",{ref:s,className:t("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}))).displayName="TableFooter";const fi=i.forwardRef((({className:e,...a},s)=>r.jsx("tr",{ref:s,className:t("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a})));fi.displayName="TableRow";const bi=i.forwardRef((({className:e,...a},s)=>r.jsx("th",{ref:s,className:t("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));bi.displayName="TableHead";const gi=i.forwardRef((({className:e,...a},s)=>r.jsx("td",{ref:s,className:t("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));async function vi(e,t,a,s){const i=e.sampleRate,r=e.numberOfChannels,n=Math.floor(t*i),o=i*a,l=new OfflineAudioContext(r,o,i);let c=l.createBuffer(r,o,i);const d=new Float32Array(o);for(let m=0;m<e.numberOfChannels;m++)e.copyFromChannel(d,m,n),c.copyToChannel(d,m);if(void 0!==s){const e=l.createBufferSource();e.buffer=c;const t=l.createGain();t.gain.value=s,e.connect(t),t.connect(l.destination),e.start(),c=await l.startRendering()}return c}async function wi(e){const t=await(await fetch(e)).arrayBuffer(),a=await async function(e,t=44100){return new Promise(((a,s)=>{const i=new AudioContext({sampleRate:t});i.decodeAudioData(e,a,s).finally((()=>{i.close()}))}))}(t);return a}gi.displayName="TableCell",i.forwardRef((({className:e,...a},s)=>r.jsx("caption",{ref:s,className:t("mt-4 text-sm text-muted-foreground",e),...a}))).displayName="TableCaption";const yi={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},ji={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};function Ni(){return n(8)}async function ki(e,t){if(!t)return[];const a=[];for(const s of t){const t=await Si(e,s);a.push(t)}return a}async function Si(e,t){const a=e[t.__type];return await a.fromJSON(t)}function Zi(e,t,a=!1){a&&(t.name=e.name),t.label=e.label}function Gi(e){return{__type:e.constructor.name,label:e.label,name:e.name}}function Ci(e,t){t.label=e.label,t.name=e.name}o.setLevel("ERROR");class Wi extends l{label="";name=Ni();constructor(){super(),this.blackAndWhite(!0),this.brightness(0,!0)}clone(e=!1){const t=new Wi;return Zi(this,t,e),t}toJSON(){return Gi(this)}static fromJSON(e){const t=new Wi;return Ci(e,t),t}}class Xi extends c{label="";name=Ni();clone(e=!1){const t=new Xi;return Zi(this,t,e),t}toJSON(){return Gi(this)}static fromJSON(e){const t=new Xi;return Ci(e,t),t}}class Vi extends d{label="";name=Ni();clone(e=!1){const t=new Vi;return Zi(this,t,e),t}toJSON(){return Gi(this)}static fromJSON(e){const t=new Vi;return Ci(e,t),t}}class Ri extends m{label="";name=Ni();clone(e=!1){const t=new Ri;return Zi(this,t,e),t}toJSON(){return Gi(this)}static fromJSON(e){const t=new Ri;return Ci(e,t),t}}class Li extends m{label="";name=Ni();constructor(){super(),this.sepia=0,this.noise=0,this.vignetting=.5}clone(e=!1){const t=new Li;return Zi(this,t,e),t}toJSON(){return Gi(this)}static fromJSON(e){const t=new Li;return Ci(e,t),t}}const zi={BlackMaskFilter:Wi,BlurFilter:Xi,NoiseFilter:Vi,OldFilmFilter:Ri,VignetteFilter:Li};function Ti(e){return ki(zi,e)}function Ki(e,t,a=!1,s=!1){a&&(t.name=e.name),t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,s||(t.width=e.width,t.height=e.height),t.setTransform(...Fi(e)),t.filters=e.filters?.map((e=>e.clone(a)))||null}function Ii(e,t=!1){let a={__type:e.constructor.name,name:e.name,label:e.label,type:e.type,visible:e.visible,alpha:e.alpha,zIndex:e.zIndex,transform:Fi(e),filters:e.filters?.map((e=>e.toJSON()))||null};return t||(a={...a,width:e.width,height:e.height}),a}async function Yi(e,t,a=!1){t.name=e.name,t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,a||("number"==typeof e.width&&(t.width=e.width),"number"==typeof e.height&&(t.height=e.height)),t.setTransform(...e.transform),t.filters=await Ti(e.filters)}function Fi(e){return[e.x,e.y,e.scale.x,e.scale.y,e.rotation,e.skew.x,e.skew.y,e.pivot.x,e.pivot.y]}class Hi extends h{name=Ni();label="";type="Text";disableTextEdit=!1;async load(){}clone(e=!1){const t=new Hi(this.text,this.style.clone());return Ki(this,t,e,!0),t.disableTextEdit=this.disableTextEdit,t}toJSON(){return{...Ii(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(e){const t=new Hi(e.text,e.style);return await Yi(e,t,!0),t.disableTextEdit=e.disableTextEdit,t}}class Mi extends p{name=Ni();label="";type="Graphics";fillColor="";async load(){}clone(e=!1){const t=new Mi(super.clone().geometry);return Ki(this,t,e),t.fillColor=this.fillColor,t}toJSON(){return{...Ii(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map((e=>[e.shape,{...e.fillStyle,texture:void 0},{...e.lineStyle,texture:void 0}]))}}static async fromJSON(e){const t=new u;t.graphicsData=e.graphicsData.map((e=>{const t=new x;t.x=e[0].x,t.y=e[0].y,t.width=e[0].width,t.height=e[0].height;const a=new f;a.alpha=e[1].alpha,a.color=e[1].color,a.visible=e[1].visible;const s=new b;return s.color=e[2].color,s.alpha=e[2].alpha,s.visible=e[2].visible,s.width=e[2].width,s.alignment=e[2].alignment,s.native=e[2].native,s.cap=e[2].cap,s.join=e[2].join,s.miterLimit=e[2].miterLimit,new g(t,a,s)}));const a=new Mi(t);return await Yi(e,a),a.fillColor=e.fillColor,a}}const Ui={extension:v.Asset,detection:{test:async()=>!0,add:async e=>[...e],remove:async e=>e.filter((t=>e.includes(t)))},loader:{extension:{type:[v.LoadParser],priority:w.High},test:e=>e.startsWith("blob:"),load:async e=>y.from(e)}};j.add(Ui);class Di extends N{name;label;type;source;assetID;assetType;constructor(e){super(),this.name=Ni(),this.label="",this.type="Sprite",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}shouldUseCustomDimensions(){return this.texture.width===this.width&&this.texture.height===this.height}async load(){this.source&&(this.texture=await k.load(this.source))}clone(e=!1){const t=new Di({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,Ki(this,t,e,this.shouldUseCustomDimensions()),t}toJSON(){return{...Ii(this,this.shouldUseCustomDimensions()),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new Di({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await Yi(e,t),t}}const Bi={Text:Hi,Graphics:Mi,Sprite:Di};class Ji{name;label;source;assetID;assetType;buffer;constructor(e){this.name=Ni(),this.label="",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}async load(){this.buffer=await wi(this.source)}clone(e=!1){const t=new Ji({source:this.source});return Pi(this,t,e),t}toJSON(){const e={};return Pi(this,e,!0),{__type:"Sound",...e,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new Ji({source:e.source});return Pi(e,t,!0),t}destroy(){this.buffer=void 0}}function Pi(e,t,a=!1){a&&(t.name=e.name),t.label=e.label,t.assetID=e.assetID,t.assetType=e.assetType}class Ei extends S{name;label;config;dialogues;sounds;constructor(e){super(),this.name=Ni(),this.label=e?.label||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.children=[],this.sortableChildren=!0}getSoundByName(e){return this.sounds.find((t=>t.name===e))}addSound(e){this.sounds.push(e)}removeSound(e){this.sounds=this.sounds.filter((t=>t.name!==e.name||(e.destroy(),!1)))}addFilter(e){this.filters?this.filters.push(e):this.filters=[e]}removeFilter(e){this.filters&&(this.filters=this.filters.filter((t=>t!==e)))}addDialogue(e,t){void 0!==t?this.dialogues.splice(t,0,e):this.dialogues.push(e)}updateDialogue(e,t){this.dialogues[e]=t}removeDialogue(e){this.dialogues=this.dialogues.filter((t=>t!==e))}swapDialogue(e,t){[this.dialogues[e],this.dialogues[t]]=[this.dialogues[t],this.dialogues[e]]}clone(){const e=new Ei;e.label=this.label,e.config=Z(this.config),e.dialogues=Z(this.dialogues);const t=this.children.map((e=>e.clone(!0)));return t.length>0&&e.addChild(...t),e.sounds=this.sounds.map((e=>e.clone(!0))),e.filters=this.filters?.map((e=>e.clone(!0)))||null,e}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(e,t=!0){const a=new Ei;t&&(a.name=e.name),a.label=e.label,a.config=e.config,a.dialogues=e.dialogues;const s=await function(e){return ki(Bi,e)}(e.children);var i;return s.length>0&&a.addChild(...s),a.sounds=await(i=e.sounds,ki({Sound:Ji},i)),a.filters=await Ti(e.filters),a}async load(){const e=async t=>{if("function"==typeof t.load&&await t.load(),t.children&&t.children.length>0)for(const a of t.children)await e(a)};for(const t of this.children)await e(t);for(const t of this.sounds)await t.load()}}const Oi={version:"3.12.2",name:"text",init(e,t,a){"object"!=typeof t&&(t={value:t});let s=t.value;this.startText=a.vars?.startAt?.text?.value||"",this.target=e,this.startText&&(s=s.replace(this.startText,"")),s=s.split(""),this.from=a._from,this.text=s,this._props.push("text")},render(e,t){e>1?e=1:e<0&&(e=0),t.from&&(e=1-e);const{text:a,target:s,startText:i}=t,r=e*a.length+.5|0;s.text=i+a.slice(0,r).join("")}};class Qi{options;stage;executeTime;currentTime;constructor(e,t){this.options=e,this.stage=t,this.executeTime=0,this.currentTime=0}}class Ai extends Qi{target;constructor(e,t){super(e,t),this.options=e,this.target=this.stage.getChildByName(e.targetName,!0)}execute(){if(!this.target)return;const{fromVars:e,toVars:t}=this.options;this.target.visible=!0,e&&t?G.fromTo(this.target,e,t):t&&G.to(this.target,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class _i extends Qi{target;constructor(e,t){super(e,t),this.stage=t,this.target=this.stage.getSoundByName(e.targetName)}getDuration(){return 0}}class qi extends Qi{constructor(e,t){super(e,t),this.options=e}execute(){const{fromVars:e,toVars:t}=this.options;e&&t?G.fromTo(this.stage,e,t):t&&G.to(this.stage,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class $i extends Qi{target;constructor(e,t){super(e,t),this.options=e,this.stage=t,e.targetName&&(this.target=this.stage.getChildByName(e.targetName))}getDuration(){return 0}}class er extends Ai{constructor(e,t){super(e,t),this.options=C({toVars:{pixi:{visible:!0},ease:"none",duration:0}},e)}}class tr extends Ai{constructor(e,t){super(e,t),this.options=C({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:this.target.alpha??1},ease:"power1.in",duration:.5}},e)}}const ar="AutoMaskFilter",sr={Show:er,FadeIn:tr};class ir extends Ai{speakerTarget;constructor(e,t){super(e,t),this.options=C({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},e);const{speakerTargetName:a}=this.options;a&&(this.speakerTarget=this.stage.getChildByName(a))}execute(){const{name:e,autoShowSpeaker:t,autoMaskOtherSpeakers:a}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=e),t&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:e="Show"}=t;new(0,sr[e])({...t,targetName:this.speakerTarget.name},this.stage).execute()}if(a){const{alpha:e=.5}=a;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach((t=>{t!==this.speakerTarget&&"Character"===t.assetType&&(this.checkMaskFilter(t)||this.addMaskFilter(t,e))}))}}checkMaskFilter(e){return e.filters?.some((e=>e.name===ar))}removeMaskFilter(e){e.filters=e.filters?.filter((e=>e.name!==ar))||[]}addMaskFilter(e,t){const a=new Wi;a.name=ar,a.alpha=t,e.filters?e.filters.push(a):e.filters=[a]}}const rr=new class{sliceTaskList=[];soundRecordMap=new Map;play(e,t){const a=this.soundRecordMap.get(e.name);if(a)Object.assign(a,{...t,paused:!1});else{const{start:a,volume:s,loop:i,untilEnd:r}=t;this.soundRecordMap.set(e.name,{sound:e,paused:!1,elapsedTime:0,start:a??0,volume:s??1,loop:i??!1,untilEnd:r??!1})}}pause(e){const t=this.soundRecordMap.get(e.name);t&&(t.paused=!0)}stop(e){this.soundRecordMap.delete(e.name)}update(e,t){for(const a of this.soundRecordMap.values()){const{sound:s,paused:i,elapsedTime:r,start:n,loop:o,volume:l}=a;if(!i){if(s.buffer){let e=r;const a=s.buffer.duration;o&&e>a-n&&(e%=a-n);const i=vi(s.buffer,e+n,1/t,l);this.sliceTaskList.push(i)}a.elapsedTime=e}}}async getAudioBuffers(){const e=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],e}resetExceptUtilEnd(){for(const[e,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(e)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}};class nr extends _i{constructor(e,t){super(e,t),this.options=e}execute(){rr.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}}function or(e,t){return t.some((([t,a])=>t<=e&&e<=a))}function lr(e){return or(e.charCodeAt(0),[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function cr(e){return" \n\r\t".includes(e)}function dr(e,t={}){const{wordsPerMin:a=500}=t,s=e.total/a;return{seconds:parseFloat((60*s).toFixed(1))}}function mr(e,t={}){const a=function(e,t){let a=0,s=0,i=e.length-1;const{wordBound:r=cr}=t;for(;r(e[s]);)s++;for(;r(e[i]);)i--;const n=`${e}\n`;for(let o=s;o<=i;o++)if((lr(n[o])||!r(n[o])&&(r(n[o+1])||lr(n[o+1])))&&a++,lr(n[o]))for(;o<=i&&(or(n[o+1].charCodeAt(0),[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])||r(n[o+1]));)o++;return{total:a}}(e,t);return{...dr(a,t),words:a}}const hr=Object.freeze(Object.defineProperty({__proto__:null,AddFilter:class extends $i{constructor(e,t){super(e,t),this.options=e}execute(){const{targetName:e,filterName:t}=this.options;e?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(e,t){const a=new zi[t];e.filters?e.filters.push(a):e.filters=[a]}},AnimationDirective:Ai,ChangeSource:class extends Ai{constructor(e,t){super(e,t),this.options={...e,immediate:!0}}async execute(){const{source:e,immediate:t}=this.options;this.target.changeSource(e),t?await this.target.load():G.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then((()=>{G.to(this.target,{pixi:{alpha:1},duration:.3})}))}})}},Directive:Qi,EnterFromLeft:class extends Ai{constructor(e,t){super(e,t);const a=this.target;this.options=C({fromVars:{pixi:{x:a.x-a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e)}},EnterFromRight:class extends Ai{constructor(e,t){super(e,t);const a=this.target;this.options=C({fromVars:{pixi:{x:a.x+a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e)}},FadeIn:tr,FadeInTransition:class extends qi{constructor(e,t){super(e,t),this.options=C({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},e)}},FadeOut:class extends Ai{constructor(e,t){super(e,t),this.options=C({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},e)}},FilterDirective:$i,Hide:class extends Ai{constructor(e,t){super(e,t),this.options=C({toVars:{pixi:{visible:!1},ease:"none",duration:0}},e)}},LeaveFromLeft:class extends Ai{constructor(e,t){super(e,t);const a=this.target;this.options=C({toVars:{pixi:{x:a.x-a.width,alpha:0},ease:"power1.in",duration:.5}},e)}},LeaveFromRight:class extends Ai{constructor(e,t){super(e,t);const a=this.target;this.options=C({toVars:{pixi:{x:a.x+a.width,alpha:0},ease:"power1.in",duration:.5}},e)}},Pause:class extends _i{execute(){rr.pause(this.target)}},Play:class extends _i{constructor(e,t){super(e,t),this.options=e}execute(){rr.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}},RemoveFilter:class extends $i{execute(){const{targetName:e}=this.options;e?this.target&&(this.target.filters=[]):this.stage.filters=[]}},ShakeX:class extends Ai{constructor(e,t){super(e,t);const a=this.target,s=a.width?.05*a.width:0,i=a.x,r=i-s,n=i+s;this.options=C({toVars:{keyframes:{"0%":{x:i},"15%":{x:r},"30%":{x:n},"45%":{x:r},"60%":{x:n},"75%":{x:r},"90%":{x:n},"100%":{x:i}},duration:.5,ease:"none"}},e)}},ShakeY:class extends Ai{constructor(e,t){super(e,t);const a=this.target,s=a.height?.05*a.height:0,i=a.y,r=i-s,n=i+s;this.options=C({toVars:{keyframes:{"0%":{y:i},"15%":{y:r},"30%":{y:n},"45%":{y:r},"60%":{y:n},"75%":{y:r},"90%":{y:n},"100%":{y:i}},duration:.5,ease:"none"}},e)}},Show:er,SoundDirective:_i,Speak:class extends Ai{speakerDirective;voiceDirective;constructor(e,t){super(e,t),this.options=C({interval:.2,sequential:!0,effect:"typewriter",alignWithVoice:!0},e);const{speaker:a,voice:s}=this.options;a?.targetName&&(this.speakerDirective=new ir(a,t)),s?.targetName&&(this.voiceDirective=new nr({...s,sequential:!0},this.stage))}execute(){if(!this.target)return;const{text:e,append:t,effect:a}=this.options;let s="",i=e;switch(this.target.visible=!0,t&&(s=this.target.text,i=this.target.text+e),a){case"typewriter":this.typewriter(s,i);break;case"fadeIn":this.fadeIn(s,i);break;case"none":this.none(s,i)}this.speakerDirective?.execute(),this.voiceDirective?.execute()}typewriter(e,t){const{text:a,wordsPerMin:s}=this.options;G.fromTo(this.target,{text:{value:e}},{text:{value:t},duration:this.readingTime(a,s),ease:"none"})}fadeIn(e,t){G.fromTo(this.target,{pixi:{alpha:0},text:{value:e}},{pixi:{alpha:1},text:{value:t},duration:.5,ease:"none"})}none(e,t){this.target.text=t}getDuration(){const{sequential:e,text:t,wordsPerMin:a,interval:s}=this.options,i=this.readingTime(t,a)+(s??0);return e?i:0}readingTime(e,t=500){const{customReadingTime:a}=this.options;return"number"==typeof a?a:e?mr(e,{wordsPerMin:t}).seconds:0}},Speaker:ir,Stop:class extends _i{execute(){rr.stop(this.target)}},TransitionDirective:qi,Voice:nr,Wait:class extends Qi{constructor(e,t){super(e,t),this.options=C({sequential:!0},e)}execute(){}getDuration(){return this.options.duration}},ZoomIn:class extends Ai{constructor(e,t){super(e,t);const a=this.target,s=a.x,i=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=i+a.height*a.anchor.y,this.options=C({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},e)}},ZoomOut:class extends Ai{constructor(e,t){super(e,t);const a=this.target,s=a.x,i=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=i+a.height*a.anchor.y,this.options=C({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},e)}}},Symbol.toStringTag,{value:"Module"}));G.registerPlugin(W),G.registerPlugin(Oi),W.registerPIXI(X),G.ticker.remove(G.updateRoot);var pr=(e=>(e.ChangeSource="ChangeSource",e.Speak="Speak",e.Speaker="Speaker",e.Show="Show",e.Hide="Hide",e.FadeIn="FadeIn",e.FadeOut="FadeOut",e.ShakeX="ShakeX",e.ShakeY="ShakeY",e.ZoomIn="ZoomIn",e.ZoomOut="ZoomOut",e.EnterFromLeft="EnterFromLeft",e.LeaveFromLeft="LeaveFromLeft",e.EnterFromRight="EnterFromRight",e.LeaveFromRight="LeaveFromRight",e.Wait="Wait",e.Play="Play",e.Pause="Pause",e.Stop="Stop",e.FadeInTransition="FadeInTransition",e.AddFilter="AddFilter",e.RemoveFilter="RemoveFilter",e))(pr||{});class ur{static defaultRendererOptions={fps:30,width:1920,height:1080,background:0};ticker;renderer;rendererOptions;started;connecter;cutResolver;constructor(e){this.ticker=V.shared,this.ticker.ctx={},this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},ur.defaultRendererOptions,e),this.started=!1;const{width:t,height:a,background:s}=this.rendererOptions;this.renderer=this.rendererOptions.renderer??R({view:new OffscreenCanvas(t,a),width:t,height:a,background:s})}connect(e){this.connecter=e,this.connecter.connect()}disconnect(){this.connecter?.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(e){if(this.started)return;const t=performance.now();G.updateRoot(0);try{const t=this.parseScreenplay(e);return this.registerUpdater(),await this.run(t)}finally{this.reset(),o.info("action cost:",performance.now()-t),this.cutResolver&&this.cutResolver(!0)}}cut(){return new Promise((e=>{this.started=!1,this.cutResolver=e}))}reset(){this.started=!1,rr.reset();let e=this.ticker._head.next;for(;e;)e=e.destroy(!0);this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}parseScreenplay(e){let t=0;const{scenes:a}=e;for(const s of a)t=this.parseSceneScript(s,t);return t}parseSceneScript(e,t){const{scene:a}=e,{directives:s}=e;let i=t;a.children.forEach((e=>{e.visible=!1}));for(const r of s){const{directive:e,params:t}=r,s=hr[e];if(!s){o.error(`Directive ${e} not found`);continue}const n=new s(t,a);n.executeTime=i,this.ticker.add((()=>{const e=this.ticker.time;var t,a,s;n.currentTime=e,t=e,a=n.executeTime,s=1/(2*this.rendererOptions.fps),Math.abs(t-a)<s&&(o.debug("execute directive:",n,e,n.executeTime),this.ticker.asyncHandlers.push(n.execute()))})),i+=n.getDuration()}return this.ticker.add((()=>{const e=this.ticker.time;e>=t&&e<=i&&this.ticker.ctx.scene!==a&&(this.ticker.ctx.scene&&rr.resetExceptUtilEnd(),this.ticker.ctx.scene=a)})),i}registerUpdater(){this.ticker.add((()=>{const e=this.ticker.time;rr.update(e,this.rendererOptions.fps),this.ticker.asyncHandlers.push((async()=>{this.ticker.ctx.audioBuffers=await rr.getAudioBuffers()})()),G.updateRoot(e),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)}))}async run(e){const{fps:t}=this.rendererOptions,a=Math.ceil(e*t);this.started=!0;for(let i=0;i<=a;i++){const s=i/t*1e3;if(!this.started)break;this.ticker.time=s/1e3,this.ticker.update(s),await Promise.all(this.ticker.asyncHandlers),this.connecter?.connection&&await this.connecter.handle({timestamp:s,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress(i/a*100,s/1e3,e)}let s;return this.started&&this.connecter?.connection&&(s=await this.connecter.finish()),this.started=!1,s}}class xr{connection;options;constructor(e){this.connection=!1,this.options=e}connect(){this.connection=!0}disconnect(){this.connection=!1}}const fr="dmFyIGhpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgdWk9KE4sVSx4KT0+VSBpbiBOP2hpKE4sVSx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6eH0pOk5bVV09eDt2YXIgRj0oTixVLHgpPT4odWkoTix0eXBlb2YgVSE9InN5bWJvbCI/VSsiIjpVLHgpLHgpOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgTj1PYmplY3QuZGVmaW5lUHJvcGVydHksVT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLHg9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxqZT1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHo9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP04oZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGV0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSl4LmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKFUpZm9yKHZhciBpIG9mIFUodCkpamUuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHZlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4odmUoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxvPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxFPShlLHQsaSxzKT0+KHZlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSx3PShlLHQsaSk9Pih2ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLGw9bmV3IFVpbnQ4QXJyYXkoOCksQj1uZXcgRGF0YVZpZXcobC5idWZmZXIpLEE9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sdT1lPT4oQi5zZXRVaW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksdHQ9ZT0+KEIuc2V0SW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksQmU9ZT0+KEIuc2V0VWludDMyKDAsZSwhMSksW2xbMV0sbFsyXSxsWzNdXSksYT1lPT4oQi5zZXRVaW50MzIoMCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXV0pLGl0PWU9PihCLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS96KDIsMzIpKSwhMSksQi5zZXRVaW50MzIoNCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXSxsWzRdLGxbNV0sbFs2XSxsWzddXSksd2U9ZT0+KEIuc2V0SW50MTYoMCx6KDIsOCkqZSwhMSksW2xbMF0sbFsxXV0pLEQ9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMTYpKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksZ2U9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMzApKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksUD0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LEg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxKPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0sbnQ9a2UoMCksRmU9ZT0+W0QoZVswXSksRChlWzFdKSxnZShlWzJdKSxEKGVbM10pLEQoZVs0XSksZ2UoZVs1XSksRChlWzZdKSxEKGVbN10pLGdlKGVbOF0pXSxDPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSxfPShlLHQsaSxzLHIpPT5DKGUsW0EodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxzdD1lPT5lP0MoImZ0eXAiLFtQKCJpc29tIiksYSgwKSxQKCJpc280IiksUCgiaHZjMSIpXSk6QygiZnR5cCIsW1AoImlzb20iKSxhKDApLFAoImlzb20iKSxQKCJhdmMxIiksUCgibXA0MSIpXSkscnQ9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksYXQ9KGUsdCk9PkMoIm1vb3YiLG51bGwsW290KHQsZSksLi4uZS5tYXAoaT0+bHQoaSx0KSldKSxvdD0oZSx0KT0+e2xldCBpPUooTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT5IKHIuc2FtcGxlcykudGltZXN0YW1wK0goci5zYW1wbGVzKS5kdXJhdGlvbikpLFNlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiBfKCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKFNlKSxhKGkpLEQoMSksd2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUobnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sbHQ9KGUsdCk9PkMoInRyYWsiLG51bGwsW2h0KGUsdCksdXQoZSx0KV0pLGh0PShlLHQpPT57bGV0IGk9SChlLnNhbXBsZXMpLHM9SihpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxTZSk7cmV0dXJuIF8oInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksdSgwKSx1KDApLHdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLHUoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksRChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLEQoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sdXQ9KGUsdCk9PkMoIm1kaWEiLG51bGwsW2R0KGUsdCksZnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLGN0KGUpXSksZHQ9KGUsdCk9PntsZXQgaT1IKGUuc2FtcGxlcykscz1KKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4gXygibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSx1KDIxOTU2KSx1KDApXSl9LGZ0PWU9Pl8oImhkbHIiLDAsMCxbUCgibWhsciIpLFAoZSksYSgwKSxhKDApLGEoMCksUCgibXA0LW11eGVyLWhkbHIiKV0pLGN0PWU9PkMoIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj9wdCgpOnZ0KCksd3QoKSx5dChlKV0pLHB0PSgpPT5fKCJ2bWhkIiwwLDEsW3UoMCksdSgwKSx1KDApLHUoMCldKSx2dD0oKT0+Xygic21oZCIsMCwwLFt1KDApLHUoMCldKSx3dD0oKT0+QygiZGluZiIsbnVsbCxbZ3QoKV0pLGd0PSgpPT5fKCJkcmVmIiwwLDAsW2EoMSldLFttdCgpXSksbXQ9KCk9Pl8oInVybCAiLDAsMSkseXQ9ZT0+Qygic3RibCIsbnVsbCxbQ3QoZSksT3QoZSksTHQoZSksVXQoZSksRHQoZSksUHQoZSldKSxDdD1lPT5fKCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/X3QoV3RbZS5pbmZvLmNvZGVjXSxlKTpJdChCdFtlLmluZm8uY29kZWNdLGUpXSksX3Q9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxBcnJheSgxMikuZmlsbCgwKSx1KHQuaW5mby53aWR0aCksdSh0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSx1KDEpLEFycmF5KDMyKS5maWxsKDApLHUoMjQpLHR0KDY1NTM1KV0sW3p0W3QuaW5mby5jb2RlY10odCldKSxUdD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksU3Q9ZT0+ZS5jb2RlY1ByaXZhdGUmJkMoImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEV0PWU9PmUuY29kZWNQcml2YXRlJiZDKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxidD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksSXQ9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxhKDApLHUodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLHUoMTYpLHUoMCksdSgwKSxEKHQuaW5mby5zYW1wbGVSYXRlKV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxBdD1lPT5fKCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEEoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksdSgxKSxBKDApLGEoNzU1MzAzNjgpLEEoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksQSg2NCksQSgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxBKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxBKDEpLEEoMildKSxNdD1lPT5DKCJkT3BzIixbQSgwKSxBKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSx1KDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLHdlKDApLEEoMCldKSxPdD1lPT5fKCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLEx0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIF8oInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sVXQ9ZT0+Xygic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksRHQ9ZT0+Xygic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksUHQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZIKGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj16KDIsMzIpP18oImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9Pml0KHQub2Zmc2V0KSldKTpfKCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxXdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LHp0PXthdmM6VHQsaGV2YzpTdCx2cDk6RXQsYXYxOmJ0fSxCdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sa3Q9e2FhYzpBdCxvcHVzOk10fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sRnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sVixZLG1lPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxvKHRoaXMsVixuZXcgVWludDhBcnJheSg4KSksbyh0aGlzLFksbmV3IERhdGFWaWV3KG4odGhpcyxWKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxZKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsWSkuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL3ooMiwzMikpLCExKSxuKHRoaXMsWSkuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsVikuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsWSkuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsVikpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBmIG9mIGUuY2hpbGRyZW4pZiYmdGhpcy53cml0ZUJveChmKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O1Y9bmV3IFdlYWtNYXAsWT1uZXcgV2Vha01hcDt2YXIgc2UsJCxaLHJlLHllLFJ0PWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxvKHRoaXMscmUpLG8odGhpcyxzZSx2b2lkIDApLG8odGhpcywkLG5ldyBBcnJheUJ1ZmZlcih6KDIsMTYpKSksbyh0aGlzLFosbmV3IFVpbnQ4QXJyYXkobih0aGlzLCQpKSksRSh0aGlzLHNlLGUpfXdyaXRlKGUpe3codGhpcyxyZSx5ZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLFopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dyh0aGlzLHJlLHllKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcywkKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLCQ9bmV3IFdlYWtNYXAsWj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCx5ZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsJCkuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLCQpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxaKSwwKSxFKHRoaXMsJCxpKSxFKHRoaXMsWixzKX07dmFyIGosRyx4ZT1jbGFzcyBleHRlbmRzIG1le2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksbyh0aGlzLGosdm9pZCAwKSxvKHRoaXMsRyxbXSksRSh0aGlzLGosZSl9d3JpdGUoZSl7bih0aGlzLEcpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcyxHKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsRyldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsRykpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsaikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsRykubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxqKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07aj1uZXcgV2Vha01hcCxHPW5ldyBXZWFrTWFwO3ZhciBOdD16KDIsMjQpLHh0PTIsZWUsTyxJLGFlLENlLF9lLEhlLFRlLFZlLHRlLG9lLCRlPWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7dmFyIHQsaTtpZihzdXBlcigpLG8odGhpcyxhZSksbyh0aGlzLF9lKSxvKHRoaXMsVGUpLG8odGhpcyx0ZSksbyh0aGlzLGVlLHZvaWQgMCksbyh0aGlzLE8sdm9pZCAwKSxvKHRoaXMsSSxbXSksRSh0aGlzLGVlLGUpLEUodGhpcyxPLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOk50KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTykpfHxuKHRoaXMsTyk8eigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3codGhpcyxhZSxDZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHcodGhpcyx0ZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGVlKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07ZWU9bmV3IFdlYWtNYXAsTz1uZXcgV2Vha01hcCxJPW5ldyBXZWFrTWFwLGFlPW5ldyBXZWFrU2V0LENlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9bih0aGlzLEkpLmZpbmRJbmRleChwPT5wLnN0YXJ0PD10JiZ0PHAuc3RhcnQrbih0aGlzLE8pKTtpPT09LTEmJihpPXcodGhpcyxUZSxWZSkuY2FsbCh0aGlzLHQpKTtsZXQgcz1uKHRoaXMsSSlbaV0scj10LXMuc3RhcnQsZD1lLnN1YmFycmF5KDAsTWF0aC5taW4obih0aGlzLE8pLXIsZS5ieXRlTGVuZ3RoKSk7cy5kYXRhLnNldChkLHIpO2xldCBmPXtzdGFydDpyLGVuZDpyK2QuYnl0ZUxlbmd0aH07aWYodyh0aGlzLF9lLEhlKS5jYWxsKHRoaXMscyxmKSxzLndyaXR0ZW5bMF0uc3RhcnQ9PT0wJiZzLndyaXR0ZW5bMF0uZW5kPT09bih0aGlzLE8pJiYocy5zaG91bGRGbHVzaD0hMCksbih0aGlzLEkpLmxlbmd0aD54dCl7Zm9yKGxldCBwPTA7cDxuKHRoaXMsSSkubGVuZ3RoLTE7cCsrKW4odGhpcyxJKVtwXS5zaG91bGRGbHVzaD0hMDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcyl9ZC5ieXRlTGVuZ3RoPGUuYnl0ZUxlbmd0aCYmdyh0aGlzLGFlLENlKS5jYWxsKHRoaXMsZS5zdWJhcnJheShkLmJ5dGVMZW5ndGgpLHQrZC5ieXRlTGVuZ3RoKX0sX2U9bmV3IFdlYWtTZXQsSGU9ZnVuY3Rpb24oZSx0KXtsZXQgaT0wLHM9ZS53cml0dGVuLmxlbmd0aC0xLHI9LTE7Zm9yKDtpPD1zOyl7bGV0IGQ9TWF0aC5mbG9vcihpKyhzLWkrMSkvMik7ZS53cml0dGVuW2RdLnN0YXJ0PD10LnN0YXJ0PyhpPWQrMSxyPWQpOnM9ZC0xfWZvcihlLndyaXR0ZW4uc3BsaWNlKHIrMSwwLHQpLChyPT09LTF8fGUud3JpdHRlbltyXS5lbmQ8dC5zdGFydCkmJnIrKztyPGUud3JpdHRlbi5sZW5ndGgtMSYmZS53cml0dGVuW3JdLmVuZD49ZS53cml0dGVuW3IrMV0uc3RhcnQ7KWUud3JpdHRlbltyXS5lbmQ9TWF0aC5tYXgoZS53cml0dGVuW3JdLmVuZCxlLndyaXR0ZW5bcisxXS5lbmQpLGUud3JpdHRlbi5zcGxpY2UocisxLDEpfSxUZT1uZXcgV2Vha1NldCxWZT1mdW5jdGlvbihlKXtsZXQgaT17c3RhcnQ6TWF0aC5mbG9vcihlL24odGhpcyxPKSkqbih0aGlzLE8pLGRhdGE6bmV3IFVpbnQ4QXJyYXkobih0aGlzLE8pKSx3cml0dGVuOltdLHNob3VsZEZsdXNoOiExfTtyZXR1cm4gbih0aGlzLEkpLnB1c2goaSksbih0aGlzLEkpLnNvcnQoKHMscik9PnMuc3RhcnQtci5zdGFydCksbih0aGlzLEkpLmluZGV4T2YoaSl9LHRlPW5ldyBXZWFrU2V0LG9lPWZ1bmN0aW9uKGU9ITEpe2ZvcihsZXQgdD0wO3Q8bih0aGlzLEkpLmxlbmd0aDt0Kyspe2xldCBpPW4odGhpcyxJKVt0XTtpZighKCFpLnNob3VsZEZsdXNoJiYhZSkpe2ZvcihsZXQgcyBvZiBpLndyaXR0ZW4pbih0aGlzLGVlKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyIEh0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxTZT0xZTMsVnQ9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sJHQ9WyJhYWMiLCJvcHVzIl0sR3Q9MjA4Mjg0NDgwMCxYdD0uNSxxdD1bInN0cmljdCIsIm9mZnNldCJdLGcsVCxYLHEsSyxFZSxsZSxiZSxHZSxJZSxYZSxBZSxxZSxNZSxLZSxoZSxPZSxMZSxRZSxpZSx1ZSxuZSxkZSxmZSxVZSxLdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtvKHRoaXMsYmUpLG8odGhpcyxJZSksbyh0aGlzLEFlKSxvKHRoaXMsTWUpLG8odGhpcyxoZSksbyh0aGlzLExlKSxvKHRoaXMsaWUpLG8odGhpcyxuZSksbyh0aGlzLGZlKSxvKHRoaXMsZyx2b2lkIDApLG8odGhpcyxULHZvaWQgMCksbyh0aGlzLFgsdm9pZCAwKSxvKHRoaXMscSxudWxsKSxvKHRoaXMsSyxudWxsKSxvKHRoaXMsRWUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrR3QpLG8odGhpcyxsZSwhMSk7dmFyIHQ7aWYodyh0aGlzLGJlLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsRSh0aGlzLGcsZXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKUUodGhpcyxULG5ldyBSdChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSlFKHRoaXMsVCwodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIEZ0KUUodGhpcyxULG5ldyBIdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTt3KHRoaXMsSWUsWGUpLmNhbGwodGhpcyksdyh0aGlzLEFlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxLKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLHEpJiZ3KHRoaXMsaWUsdWUpLmNhbGwodGhpcyxuKHRoaXMscSkpLG4odGhpcyxLKSYmdyh0aGlzLGllLHVlKS5jYWxsKHRoaXMsbih0aGlzLEspKTtsZXQgZT1uKHRoaXMsVCkub2Zmc2V0cy5nZXQobih0aGlzLFgpKSx0PW4odGhpcyxUKS5wb3MtZTtuKHRoaXMsWCkuc2l6ZT10LG4odGhpcyxUKS5wYXRjaEJveChuKHRoaXMsWCkpO2xldCBpPWF0KFtuKHRoaXMscSksbih0aGlzLEspXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLEVlKSk7bih0aGlzLFQpLndyaXRlQm94KGkpLHcodGhpcyxuZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsVCkuZmluYWxpemUoKSxFKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxUPW5ldyBXZWFrTWFwLFg9bmV3IFdlYWtNYXAscT1uZXcgV2Vha01hcCxLPW5ldyBXZWFrTWFwLEVlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFWdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiEkdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhcXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sSWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLFQpLndyaXRlQm94KHN0KHQpKSxFKHRoaXMsWCxydCgpKSxuKHRoaXMsVCkud3JpdGVCb3gobih0aGlzLFgpKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9LEFlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZFKHRoaXMscSx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9dyh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7RSh0aGlzLEsse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLGY9IiI7Zis9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksZis9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYoZis9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxmKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgcD1NYXRoLmNlaWwoZi5sZW5ndGgvOCkqODtmPWYucGFkRW5kKHAsIjAiKTtsZXQgYj1uZXcgVWludDhBcnJheShmLmxlbmd0aC84KTtmb3IobGV0IFM9MDtTPGYubGVuZ3RoO1MrPTgpYltTLzhdPXBhcnNlSW50KGYuc2xpY2UoUyxTKzgpLDIpO3JldHVybiBifSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIGY7bGV0IHA9cy8xZTYsYj1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1wKSxwPXcodGhpcyxMZSxRZSkuY2FsbCh0aGlzLHAsZSksZS5sYXN0VGltZXN0YW1wPXAsKCFlLmN1cnJlbnRDaHVua3x8cC1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49WHQpJiYoZS5jdXJyZW50Q2h1bmsmJncodGhpcyxpZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpwLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChmPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJmYuZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOnAsZHVyYXRpb246YixzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBTPUoocCxlLnRpbWVzY2FsZSwhMSksaz1NYXRoLnJvdW5kKFMtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1rO2xldCBNPUgoZS50aW1lVG9TYW1wbGVUYWJsZSk7TS5zYW1wbGVDb3VudD09PTE/KE0uc2FtcGxlRGVsdGE9ayxNLnNhbXBsZUNvdW50KyspOk0uc2FtcGxlRGVsdGE9PT1rP00uc2FtcGxlQ291bnQrKzooTS5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTprfSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6SihiLGUudGltZXNjYWxlKX0pfSxMZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LGllPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLFQpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsVCkud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHxIKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9fSxuZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxUKWluc3RhbmNlb2YgeGUmJm4odGhpcyxUKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxVZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgUXQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBZdChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKFF0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXTtmdW5jdGlvbiBkKHYsbSl7dmFyIHk9dlttXTtpZih0eXBlb2YgeS5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiB5LmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKHksdil9Y2F0Y2goYyl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseSh5LFt2LGFyZ3VtZW50c10pfX19ZnVuY3Rpb24gZigpe2NvbnNvbGUubG9nJiYoY29uc29sZS5sb2cuYXBwbHk/Y29uc29sZS5sb2cuYXBwbHkoY29uc29sZSxhcmd1bWVudHMpOkZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseShjb25zb2xlLmxvZyxbY29uc29sZSxhcmd1bWVudHNdKSksY29uc29sZS50cmFjZSYmY29uc29sZS50cmFjZSgpfWZ1bmN0aW9uIHAodil7cmV0dXJuIHY9PT0iZGVidWciJiYodj0ibG9nIiksdHlwZW9mIGNvbnNvbGU9PT1pPyExOnY9PT0idHJhY2UiJiZzP2Y6Y29uc29sZVt2XSE9PXZvaWQgMD9kKGNvbnNvbGUsdik6Y29uc29sZS5sb2chPT12b2lkIDA/ZChjb25zb2xlLCJsb2ciKTp0fWZ1bmN0aW9uIGIodixtKXtmb3IodmFyIHk9MDt5PHIubGVuZ3RoO3krKyl7dmFyIGM9clt5XTt0aGlzW2NdPXk8dj90OnRoaXMubWV0aG9kRmFjdG9yeShjLHYsbSl9dGhpcy5sb2c9dGhpcy5kZWJ1Z31mdW5jdGlvbiBTKHYsbSx5KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihiLmNhbGwodGhpcyxtLHkpLHRoaXNbdl0uYXBwbHkodGhpcyxhcmd1bWVudHMpKX19ZnVuY3Rpb24gayh2LG0seSl7cmV0dXJuIHAodil8fFMuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIE0odixtLHkpe3ZhciBjPXRoaXMsSmU7bT1tPT1udWxsPyJXQVJOIjptO3ZhciBMPSJsb2dsZXZlbCI7dHlwZW9mIHY9PSJzdHJpbmciP0wrPSI6Iit2OnR5cGVvZiB2PT0ic3ltYm9sIiYmKEw9dm9pZCAwKTtmdW5jdGlvbiBhaShoKXt2YXIgUT0ocltoXXx8InNpbGVudCIpLnRvVXBwZXJDYXNlKCk7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IUwpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZVtMXT1RO3JldHVybn1jYXRjaChwZSl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChMKSsiPSIrUSsiOyJ9Y2F0Y2gocGUpe319fWZ1bmN0aW9uIFplKCl7dmFyIGg7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IUwpKXt0cnl7aD13aW5kb3cubG9jYWxTdG9yYWdlW0xdfWNhdGNoKGxpKXt9aWYodHlwZW9mIGg9PT1pKXRyeXt2YXIgUT13aW5kb3cuZG9jdW1lbnQuY29va2llLHBlPVEuaW5kZXhPZihlbmNvZGVVUklDb21wb25lbnQoTCkrIj0iKTtwZSE9PS0xJiYoaD0vXihbXjtdKykvLmV4ZWMoUS5zbGljZShwZSkpWzFdKX1jYXRjaChsaSl7fXJldHVybiBjLmxldmVsc1toXT09PXZvaWQgMCYmKGg9dm9pZCAwKSxofX1mdW5jdGlvbiBvaSgpe2lmKCEodHlwZW9mIHdpbmRvdz09PWl8fCFMKSl7dHJ5e3dpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMKTtyZXR1cm59Y2F0Y2goaCl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChMKSsiPTsgZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQyJ9Y2F0Y2goaCl7fX19Yy5uYW1lPXYsYy5sZXZlbHM9e1RSQUNFOjAsREVCVUc6MSxJTkZPOjIsV0FSTjozLEVSUk9SOjQsU0lMRU5UOjV9LGMubWV0aG9kRmFjdG9yeT15fHxrLGMuZ2V0TGV2ZWw9ZnVuY3Rpb24oKXtyZXR1cm4gSmV9LGMuc2V0TGV2ZWw9ZnVuY3Rpb24oaCxRKXtpZih0eXBlb2YgaD09InN0cmluZyImJmMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0hPT12b2lkIDAmJihoPWMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0pLHR5cGVvZiBoPT0ibnVtYmVyIiYmaD49MCYmaDw9Yy5sZXZlbHMuU0lMRU5UKXtpZihKZT1oLFEhPT0hMSYmYWkoaCksYi5jYWxsKGMsaCx2KSx0eXBlb2YgY29uc29sZT09PWkmJmg8Yy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZWxzZSB0aHJvdyJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK2h9LGMuc2V0RGVmYXVsdExldmVsPWZ1bmN0aW9uKGgpe209aCxaZSgpfHxjLnNldExldmVsKGgsITEpfSxjLnJlc2V0TGV2ZWw9ZnVuY3Rpb24oKXtjLnNldExldmVsKG0sITEpLG9pKCl9LGMuZW5hYmxlQWxsPWZ1bmN0aW9uKGgpe2Muc2V0TGV2ZWwoYy5sZXZlbHMuVFJBQ0UsaCl9LGMuZGlzYWJsZUFsbD1mdW5jdGlvbihoKXtjLnNldExldmVsKGMubGV2ZWxzLlNJTEVOVCxoKX07dmFyIFdlPVplKCk7V2U9PW51bGwmJihXZT1tKSxjLnNldExldmVsKFdlLCExKX12YXIgVz1uZXcgTSxQZT17fTtXLmdldExvZ2dlcj1mdW5jdGlvbihtKXtpZih0eXBlb2YgbSE9InN5bWJvbCImJnR5cGVvZiBtIT0ic3RyaW5nInx8bT09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgeT1QZVttXTtyZXR1cm4geXx8KHk9UGVbbV09bmV3IE0obSxXLmdldExldmVsKCksVy5tZXRob2RGYWN0b3J5KSkseX07dmFyIHJpPXR5cGVvZiB3aW5kb3chPT1pP3dpbmRvdy5sb2c6dm9pZCAwO3JldHVybiBXLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdHlwZW9mIHdpbmRvdyE9PWkmJndpbmRvdy5sb2c9PT1XJiYod2luZG93LmxvZz1yaSksV30sVy5nZXRMb2dnZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIFBlfSxXLmRlZmF1bHQ9VyxXfSl9KShZZSk7dmFyIEp0PVllLmV4cG9ydHMsY2U9WXQoSnQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIFp0KGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyBqdHtjb25zdHJ1Y3Rvcih0KXtGKHRoaXMsImNvbm5lY3Rpb24iKTtGKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgUj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoUnx8e30pO2Z1bmN0aW9uIGVpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyB0aSBleHRlbmRzIGp0e2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO0YodGhpcywidmlkZW9Db25maWciKTtGKHRoaXMsImF1ZGlvQ29uZmlnIik7Rih0aGlzLCJtdXhlciIpO0YodGhpcywidmlkZW9FbmNvZGVyIik7Rih0aGlzLCJhdWRpb0VuY29kZXIiKTtGKHRoaXMsImVycm9yUmVqZWN0IixlaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgZixwLGIsUztjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9EYXRhOnIsdGltZXN0YW1wOmR9PWk7cyYmKChmPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmZi5lbmNvZGVRdWV1ZVNpemUmJigocD10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnAuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgWnQoKCk9Pnt2YXIgayxNO3JldHVybihrPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmay5lbmNvZGVRdWV1ZVNpemU/KChNPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6TS5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKGI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxiLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSksciYmKChTPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8Uy5lbmNvZGUociksci5jbG9zZSgpKX1jcmVhdGVNdXhlckFuZEVuY29kZXIoKXt0aGlzLm11eGVyPW5ldyBLdCh7dGFyZ2V0Om5ldyBSZSx2aWRlbzp7Y29kZWM6ImF2YyIsd2lkdGg6dGhpcy52aWRlb0NvbmZpZy53aWR0aCxoZWlnaHQ6dGhpcy52aWRlb0NvbmZpZy5oZWlnaHR9LGF1ZGlvOntjb2RlYzoiYWFjIixudW1iZXJPZkNoYW5uZWxzOnRoaXMuYXVkaW9Db25maWcubnVtYmVyT2ZDaGFubmVscyxzYW1wbGVSYXRlOnRoaXMuYXVkaW9Db25maWcuc2FtcGxlUmF0ZX19KSx0aGlzLnZpZGVvRW5jb2Rlcj1uZXcgVmlkZW9FbmNvZGVyKHtvdXRwdXQ6KGkscyk9Pnt2YXIgcjtyZXR1cm4ocj10aGlzLm11eGVyKT09bnVsbD92b2lkIDA6ci5hZGRWaWRlb0NodW5rKGkscyl9LGVycm9yOmk9PntjZS5lcnJvcigidmlkZW8gZW5jb2RlciBlcnJvciIsaSksdGhpcy5lcnJvclJlamVjdChpKX19KSx0aGlzLnZpZGVvRW5jb2Rlci5jb25maWd1cmUodGhpcy52aWRlb0NvbmZpZyksdGhpcy5vcHRpb25zLmRpc2FibGVBdWRpb3x8KHRoaXMuYXVkaW9FbmNvZGVyPW5ldyBBdWRpb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZEF1ZGlvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJhdWRpbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMuYXVkaW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLmF1ZGlvQ29uZmlnKSl9YXN5bmMgZW5kRW5jb2RpbmcoKXt2YXIgcyxyLGQsZixwLGIsUztyZXR1cm4gYXdhaXQoKHM9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpzLmZsdXNoKCkpLChyPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbHx8ci5jbG9zZSgpLGF3YWl0KChkPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbD92b2lkIDA6ZC5mbHVzaCgpKSwoZj10aGlzLmF1ZGlvRW5jb2Rlcik9PW51bGx8fGYuY2xvc2UoKSwocD10aGlzLm11eGVyKT09bnVsbHx8cC5maW5hbGl6ZSgpLChTPShiPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpiLnRhcmdldCk9PW51bGw/dm9pZCAwOlMuYnVmZmVyfWFzeW5jIGZpbmlzaCgpe3JldHVybiBhd2FpdCB0aGlzLmVuZEVuY29kaW5nKCl9fWxldCBEZTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGFzeW5jIGU9Pntjb25zdHt0eXBlOnQsZGF0YTppfT1lLmRhdGE7dHJ5e3N3aXRjaCh0KXtjYXNlIFIuSU5JVDpyZXR1cm4gaWkoaSk7Y2FzZSBSLlNFTkQ6cmV0dXJuIGF3YWl0IG5pKGkpO2Nhc2UgUi5GSU5JU0g6cmV0dXJuIGF3YWl0IHNpKCk7ZGVmYXVsdDpyZXR1cm59fWNhdGNoKHMpe3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6dCxlcnJNc2c6cyBpbnN0YW5jZW9mIEVycm9yP3MubWVzc2FnZToiVW5rbm93biBFcnJvciJ9KX19KSxzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOlIuTE9BREVEfSk7ZnVuY3Rpb24gaWkoZSl7RGU9bmV3IHRpKGUpLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5JTklUfSl9YXN5bmMgZnVuY3Rpb24gbmkoZSl7YXdhaXQgRGUuaGFuZGxlKGUpLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5TRU5EfSl9YXN5bmMgZnVuY3Rpb24gc2koKXtjb25zdCBlPWF3YWl0IERlLmZpbmlzaCgpO3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5GSU5JU0gscmVzdWx0OmV9LGU/W2VdOltdKX19KSgpOwo=",br="undefined"!=typeof window&&window.Blob&&new Blob([atob(fr)],{type:"text/javascript;charset=utf-8"});function gr(){let e;try{if(e=br&&(window.URL||window.webkitURL).createObjectURL(br),!e)throw"";return new Worker(e)}catch(t){return new Worker("data:application/javascript;base64,"+fr)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var vr=(e=>(e.LOADED="loaded",e.INIT="init",e.SEND="send",e.FINISH="finish",e))(vr||{});class wr extends xr{compositorWorker;initialized;videoConfig;audioConfig;constructor(e){super(e),this.videoConfig=e.videoConfig??yi,this.audioConfig=e.audioConfig??ji,this.compositorWorker=new gr,this.initialized=new Promise(((t,a)=>{this.compositorWorker.addEventListener("message",(s=>{const{type:i}=s.data;i===vr.LOADED&&this.getFromWorker(vr.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...e}).then((()=>{t()})).catch((e=>{a(e)}))}))}))}getFromWorker(e,t,a){return new Promise(((s,i)=>{const r=({data:t})=>{t.type===e&&(t.errMsg?i(t.errMsg):s(t.result),this.compositorWorker.removeEventListener("message",r))};this.compositorWorker.addEventListener("message",r),this.compositorWorker.postMessage({type:e,data:t},a||[])}))}async genAudioData(e,t){const a=this.audioConfig.sampleRate,s=this.audioConfig.numberOfChannels,i=this.audioConfig.sampleRate*(1/this.options.fps),r=new OfflineAudioContext(s,i,a).createBuffer(s,i,a);let n;if(t){t.forEach(((e,t)=>{for(let a=0;a<s;a++){const s=a<e.numberOfChannels?e.getChannelData(a):new Float32Array(i).fill(0),n=r.getChannelData(a);if(0===t)n.set(s);else for(let e=0;e<n.length;e++)n[e]+=s[e]}})),n=new Float32Array(i*s);for(let e=0;e<r.numberOfChannels;e++)n.set(r.getChannelData(e),e*r.length)}else n=new Float32Array(i*s).fill(0);return new AudioData({timestamp:e,sampleRate:a,numberOfChannels:s,numberOfFrames:i,data:n,format:"f32-planar"})}async handle(e){await this.initialized;const{timestamp:t,imageSource:a,audioBuffers:s}=e,i=new VideoFrame(a,{timestamp:1e3*t}),r=[i];let n;return this.options.disableAudio||(n=await this.genAudioData(t,s),r.push(n)),this.getFromWorker(vr.SEND,{timestamp:t,videoFrame:i,audioData:n},r)}async finish(){await this.initialized;const e=await this.getFromWorker(vr.FINISH);if(e)return new Blob([e],{type:"video/mp4"})}}class yr extends xr{context;audioContext;audioPlayTime;lastHandleTime;constructor(e){super(e),this.options=e,this.audioContext=e.disableAudio?null:new AudioContext,this.audioPlayTime=0,this.lastHandleTime=0;const{canvas:t,width:a,height:s}=this.options;t.width=a,t.height=s,this.context=t.getContext("2d")}async handle(e){const{imageSource:t,audioBuffers:a}=e,s=performance.now(),i=this.lastHandleTime>0?s-this.lastHandleTime:0;var r;this.options.disableAudio||this.playAudioBuffers(a),this.context&&t&&this.playVideoFrame(t),await(r=1e3/this.options.fps-i-4,new Promise((e=>setTimeout(e,r)))),this.lastHandleTime=performance.now()}playVideoFrame(e){const{width:t,height:a}=this.options;this.context.drawImage(e,0,0,t,a)}playAudioBuffers(e){if(0===e.length)return;if(!this.audioContext)return;let t=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const a of e){const e=this.audioContext.createBufferSource();e.buffer=a,e.connect(this.audioContext.destination),e.onended=()=>{e.disconnect()},e.start(this.audioPlayTime),t=Math.max(t,a.duration)}this.audioPlayTime+=t}async finish(){this.audioContext?.close()}}var jr=(e=>(e[e.Background=0]="Background",e[e.Character=10]="Character",e[e.Dialog=20]="Dialog",e[e.Text=30]="Text",e))(jr||{});let Nr=class e{static defaultEditorOptions={width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}};options;app;scenes;activeScene;activeChild;activeTransformer;constructor(t){this.options=Object.assign({},e.defaultEditorOptions,t);const{view:a,width:s,height:i,background:r}=this.options;this.app=new L({view:a,width:s,height:i,background:r}),this.scenes=[]}addTransformer(){this.activeTransformer=new z({wireframeStyle:{thickness:4,color:3394764}}).on("pointertap",(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout((()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)}),600)))})),this.activeScene?.addChild(this.activeTransformer)}removeTransformer(){this.activeTransformer&&(this.activeScene?.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(e){e.interactive=!0,e.on("pointerdown",(()=>{this.setActiveChild(e)}))}setActiveChild(e){this.activeChild=e,e&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[e],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(e)}setActiveChildByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&this.setActiveChild(a)}}updateActiveChild(e){this.activeChild&&(e(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(e){e.removeAllListeners("pointerdown")}addScene(e,t){void 0===t?this.scenes.push(e):this.scenes.splice(t,0,e);const a=e=>{if(e.children&&e.children.length>0)for(const t of e.children)a(t);else this.addChildTransformListener(e)};for(const s of e.children)a(s);this.options.onChangeScenes(this.scenes)}loadScenes(e){e.forEach((e=>{this.addScene(e)})),this.options.onChangeScenes(this.scenes)}removeScene(e){this.scenes.splice(this.scenes.indexOf(e),1),this.activeScene===e&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(e){this.removeScene(this.scenes[e])}removeSceneByName(e){const t=this.getSceneByName(e);t&&this.removeScene(t)}getSceneByName(e){return this.scenes.find((t=>t.name===e))}cloneScene(e){this.removeTransformer();const t=e??this.activeScene;if(t)return t.clone()}cloneSceneByIndex(e){return this.cloneScene(this.scenes[e])}cloneSceneByName(e){const t=this.getSceneByName(e);if(t)return this.cloneScene(t)}swapScene(e,t){[this.scenes[e],this.scenes[t]]=[this.scenes[t],this.scenes[e]],this.options.onChangeScenes(this.scenes)}setActiveScene(e){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=e,e&&(this.activeScene.load(),this.addTransformer(),this.stageAddChild(e)),this.options.onChangeActiveScene(e)}setActiveSceneByName(e){const t=this.scenes.find((t=>t.name===e));t&&this.setActiveScene(t)}setActiveSceneByIndex(e){this.setActiveScene(this.scenes[e])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(e){this.activeScene&&(e(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(e){const t=this.activeScene;t&&(this.addChildTransformListener(e),t.addChild(e),this.options.onChangeActiveScene(t))}removeChild(e){const t=this.activeScene;t&&(this.activeChild?.name===e.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(e),t.removeChild(e),e.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&this.removeChild(a)}}toggleChildVisibleByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&(a.visible=!a.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&(a.interactive=!a.interactive),this.options.onChangeActiveScene(t)}}cloneChild(e){const t=e??this.activeChild;if(t)return t.clone()}addSound(e){const t=this.activeScene;t&&(t.addSound(e),this.options.onChangeActiveScene(t))}removeSound(e){const t=this.activeScene;t&&(t.removeSound(e),this.options.onChangeActiveScene(t))}removeSoundByName(e){const t=this.activeScene;if(t){const a=t.sounds.find((t=>t.name===e));a&&this.removeSound(a)}}cloneDialogue(e){return Z(e)}cloneDialogueSpeak(e){return Z(e)}addDialogue(e,t){const a=this.activeScene;a&&(a.addDialogue(e,t),this.options.onChangeActiveScene(a))}updateDialogue(e,t){const a=this.activeScene;a&&(a.updateDialogue(e,t),this.options.onChangeActiveScene(a))}removeDialogue(e){const t=this.activeScene;t&&(t.removeDialogue(e),this.options.onChangeActiveScene(t))}swapDialogue(e,t){const a=this.activeScene;a&&(a.swapDialogue(e,t),this.options.onChangeActiveScene(a))}swapChildren(e,t){this.activeScene?.swapChildren(e,t)}moveChildTo(e,t){const a=t??this.activeChild;a&&(a.zIndex=e)}moveChildToTop(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=jr.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=jr.Background,this.activeScene?.setChildIndex(t,0))}moveUpChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e<this.activeScene.children.length-1){const a=this.activeScene.children[e+1];a.zIndex>t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}moveDownChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e>0){const a=this.activeScene.children[e-1];a.zIndex<t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}stageAddChild(e){this.app.stage.addChild(e)}stageRemoveChild(e){const t=this.app.stage.children.find((t=>t.name===e.name));t&&this.app.stage.removeChild(t)}setChildPosition(e,t){const a=t??this.activeChild,{width:s,height:i}=this.options;if(a)switch(e){case"top":a.y=0;break;case"middle":a.y=i/2-a.height/2;break;case"bottom":a.y=i-a.height;break;case"left":a.x=0;break;case"near-left":a.x=s/3-a.width/2;break;case"center":a.x=s/2-a.width/2;break;case"near-right":a.x=s/3*2-a.width/2;break;case"right":a.x=s-a.width}}genSceneScript(e){const{dialogues:t,config:a}=e,s=a.speak,i=[],r=e.children.find((e=>"Background"===e.assetType));r&&a.autoShowBackground&&i.push({directive:pr.Show,params:{targetName:r.name}});for(const n of t){const{speak:t,lines:a}=n;s?.dialogTargetName&&i.push({directive:pr.Show,params:{targetName:s.dialogTargetName}});const r=[];a.forEach((e=>{if("p"===e.type)for(let t=0;t<e.children.length;t++){const a=e.children[t];if("directive"===a.type)r.push({type:"directive",value:a.value});else if(a.text&&s?.targetName){let s=a.text;t===e.children.length-1&&(s+="\n"),r.push({type:"speak",value:s})}}}));let o,l=!1,c="";t.voice?.targetName&&(c=r.filter((e=>"speak"===e.type)).map((e=>e.value)).join(""),o=e.sounds.find((e=>e.name===t.voice?.targetName))?.buffer?.duration);const d=e=>{const a=e.join("");let r;c&&o&&(r=a.length/c.length*o),i.push({directive:pr.Speak,params:{targetName:s.targetName,text:a,append:l,customReadingTime:r,wordsPerMin:t.wordsPerMin,interval:t.interval,effect:t.effect,speaker:s.speaker.targetName?{targetName:s.speaker.targetName,name:t.speaker?.name||"",speakerTargetName:t.speaker?.speakerTargetName,autoShowSpeaker:t.speaker?.autoShowSpeaker,autoMaskOtherSpeakers:t.speaker?.autoMaskOtherSpeakers}:void 0,voice:l?void 0:t.voice?.targetName?t.voice:void 0}}),l=!0};r.forEach((e=>{if("directive"===e.type){const t=e.value;i.push(t)}else d([e.value])}))}return{scene:e,config:a,directives:i}}async exportScreenplay(e=0,t){const a=this.exportScenes(e,t);for(const s of a)await s.load();return{config:{},scenes:a.map(this.genSceneScript)}}exportScenes(e=0,t){this.removeTransformer();const a=performance.now(),s=this.scenes.slice(e,t).map((e=>e.clone()));return o.info("editor export cost:",performance.now()-a,s),s}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(e){const t=JSON.parse(e),a=[];for(const s of t.scenes){const e=await Ei.fromJSON(s);a.push(e)}this.loadScenes(a)}clear(){this.scenes.forEach((e=>{this.removeScene(e)})),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}};const kr=T()(K((e=>{let t;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){e((e=>{e.project={id:t.id,name:t.name}}))},initEditor(a){t=new Nr({view:a,onChangeActiveChild(t){e((e=>{if(!t)return void(e.activeChild=null);let a={...t,width:t.width,height:t.height,x:t.x,y:t.y};if("Text"===t.type){const e=t;a={...a,text:e.text,style:e.style&&{...e.style,fontFamily:e.style.fontFamily,fontWeight:e.style.fontWeight,fontStyle:e.style.fontStyle,fontSize:e.style.fontSize,fill:e.style.fill}}}e.activeChild=a}))},onChangeActiveScene(t){e((e=>{e.activeScene=t?{...t}:null}))},onChangeScenes(t){e((e=>{e.scenes=[...t]}))}}),e((e=>{e.editor=t}))}}}))),Sr=T()(K((e=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(t){e((e=>{e.confirm=t}))},setCancel(t){e((e=>{e.cancel=t}))},setOpen(t){e((e=>{e.isOpen=t}))},setType(t){e((e=>{e.type=t}))},setDisableSelect(t){e((e=>{e.disableSelect=t}))}})))),Zr=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("rounded-xl border bg-card text-card-foreground shadow",e),...a})));Zr.displayName="Card",i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("flex flex-col space-y-1.5 p-6",e),...a}))).displayName="CardHeader",i.forwardRef((({className:e,...a},s)=>r.jsx("h3",{ref:s,className:t("font-semibold leading-none tracking-tight",e),...a}))).displayName="CardTitle",i.forwardRef((({className:e,...a},s)=>r.jsx("p",{ref:s,className:t("text-sm text-muted-foreground",e),...a}))).displayName="CardDescription";const Gr=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("p-6 pt-0",e),...a})));Gr.displayName="CardContent";const Cr=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("flex items-center p-6 pt-0",e),...a})));Cr.displayName="CardFooter";const Wr=i.forwardRef((({className:e,children:a,...s},n)=>{const o=i.useRef(null);return i.useImperativeHandle(n,(()=>({scrollToBottom:()=>{o.current&&o.current.scrollTo({top:o.current.scrollHeight,behavior:"smooth"})}}))),r.jsxs(I,{className:t("relative overflow-hidden",e),...s,children:[r.jsx(Y,{ref:o,className:"h-full w-full rounded-[inherit]",children:a}),r.jsx(Xr,{}),r.jsx(F,{})]})}));Wr.displayName=I.displayName;const Xr=i.forwardRef((({className:e,orientation:a="vertical",...s},i)=>r.jsx(H,{ref:i,orientation:a,className:t("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:r.jsx(M,{className:"relative flex-1 rounded-full bg-border"})})));Xr.displayName=H.displayName;const Vr={add:U,alignCenter:D,alignJustify:B,alignLeft:J,alignRight:P,arrowDown:E,bg:O,blockquote:Q,bold:A,borderAll:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),borderBottom:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),borderLeft:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),borderNone:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),borderRight:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),borderTop:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),check:_,chevronRight:q,chevronsUpDown:$,clear:ee,close:ee,code:te,codeblock:ae,color:se,column:ie,combine:re,ungroup:ne,comment:oe,commentAdd:le,delete:ce,dragHandle:de,editing:me,emoji:he,externalLink:pe,h1:ue,h2:xe,h3:fe,h4:be,h5:ge,h6:ve,image:we,indent:ye,italic:je,kbd:Ne,lineHeight:ke,link:Se,minus:Ze,more:Ge,ol:Ce,outdent:We,paragraph:Xe,refresh:Ve,row:Re,search:Le,settings:ze,strikethrough:Te,subscript:Ke,superscript:Ie,table:Ye,text:Fe,trash:ce,trash2:He,ul:Me,underline:Ue,unlink:De,viewing:Be,viewingOff:Je,lock:Pe,lockOpen:Ee,type:Oe,fontSize:Qe,bookOpenText:Ae,copy:_e,moveUp:qe,moveDown:$e,squarePlus:et,folder:tt,bookmark:at,mic:st,download:it,edit:rt,library:nt,scene:ot,images:lt,preview:ct,tip:dt,gitHub:e=>r.jsx("svg",{viewBox:"0 0 438.549 438.549",...e,children:r.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...e,children:r.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:mt,sun:ht},Rr=Zt,Lr=Gt,zr=ft,Tr=Ct,Kr=i.forwardRef((({className:e,inset:a,children:s,...i},n)=>r.jsxs(pt,{ref:n,className:t("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",e),...i,children:[s,r.jsx(ut,{className:"ml-auto h-4 w-4"})]})));Kr.displayName=pt.displayName;const Ir=i.forwardRef((({className:e,...a},s)=>r.jsx(xt,{ref:s,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})));Ir.displayName=xt.displayName;const Yr=i.forwardRef((({className:e,sideOffset:a=4,...s},i)=>r.jsx(ft,{children:r.jsx(bt,{ref:i,sideOffset:a,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})})));Yr.displayName=bt.displayName;const Fr=i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(gt,{ref:i,className:t("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",e),...s})));Fr.displayName=gt.displayName,i.forwardRef((({className:e,children:a,checked:s,...i},n)=>r.jsxs(vt,{ref:n,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...i,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(wt,{children:r.jsx(yt,{className:"h-4 w-4"})})}),a]}))).displayName=vt.displayName,i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(jt,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(wt,{children:r.jsx(Nt,{className:"h-4 w-4 fill-current"})})}),a]}))).displayName=jt.displayName,i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(kt,{ref:i,className:t("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",e),...s}))).displayName=kt.displayName;const Hr=i.forwardRef((({className:e,...a},s)=>r.jsx(St,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),...a})));Hr.displayName=St.displayName;const Mr=[{ch:"宋体",en:"SimSun"},{ch:"黑体",en:"SimHei"},{ch:"微软雅黑",en:"Microsoft Yahei"},{ch:"微软正黑体",en:"Microsoft JhengHei"},{ch:"楷体",en:"KaiTi"},{ch:"新宋体",en:"NSimSun"},{ch:"仿宋",en:"FangSong"}],Ur=[{ch:"苹方",en:"PingFang SC"},{ch:"冬青黑体简",en:"Hiragino Sans GB"},{ch:"兰亭黑-简",en:"Lantinghei SC"},{ch:"翩翩体-简",en:"Hanzipen SC"},{ch:"手札体-简",en:"Hannotate SC"},{ch:"宋体-简",en:"Songti SC"},{ch:"娃娃体-简",en:"Wawati SC"},{ch:"魏碑-简",en:"Weibei SC"},{ch:"行楷-简",en:"Xingkai SC"},{ch:"雅痞-简",en:"Yapi SC"},{ch:"圆体-简",en:"Yuanti SC"}],Dr=[{ch:"幼圆",en:"YouYuan"},{ch:"隶书",en:"LiSu"},{ch:"华文细黑",en:"STXihei"},{ch:"华文黑体",en:"STHeiti"},{ch:"华文楷体",en:"STKaiti"},{ch:"华文宋体",en:"STSong"},{ch:"华文仿宋",en:"STFangsong"},{ch:"华文中宋",en:"STZhongsong"},{ch:"华文彩云",en:"STCaiyun"},{ch:"华文琥珀",en:"STHupo"},{ch:"华文新魏",en:"STXinwei"},{ch:"华文隶书",en:"STLiti"},{ch:"华文行楷",en:"STXingkai"},{ch:"方正舒体",en:"FZShuTi"},{ch:"方正姚体",en:"FZYaoti"}],Br=[{ch:"思源黑体",en:"Source Han Sans CN"},{ch:"思源宋体",en:"Source Han Serif SC"},{ch:"文泉驿微米黑",en:"WenQuanYi Micro Hei"},{ch:"霞鹜文楷",en:"LXGW WenKai"},{ch:"方舟像素",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}],Jr=new function(){const e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],a=document.createElement("span");a.style.fontSize="72px",a.innerHTML="mmmmmmmmmmlli";const s={},i={};for(const r in e)a.style.fontFamily=e[r],t.appendChild(a),s[e[r]]=a.offsetWidth,i[e[r]]=a.offsetHeight,t.removeChild(a);this.detect=function(r){let n=!1;for(const o in e){a.style.fontFamily=r+","+e[o],t.appendChild(a);const l=a.offsetWidth!=s[e[o]]||a.offsetHeight!=i[e[o]];t.removeChild(a),n=n||l}return n}},Pr=[{ch:"Arial",en:"Arial"}].concat([...Ur,...Mr,...Br,...Dr].filter((e=>Jr.detect(e.en))));var Er=(e=>(e.NORMAL="normal",e.BOLD="bold",e))(Er||{}),Or=(e=>(e.NORMAL="normal",e.ITALIC="italic",e))(Or||{});async function Qr(e,t){const a=new FontFace(e,"string"==typeof t?`url(${t})`:t);document.fonts.add(a),await a.load()}var Ar=(e=>(e.Character="Character",e.Background="Background",e.Thing="Thing",e.Dialog="Dialog",e.Audio="Audio",e.Font="Font",e))(Ar||{});const _r=[{name:"角色",value:"Character"},{name:"背景",value:"Background"},{name:"物品",value:"Thing"},{name:"对话框",value:"Dialog"},{name:"音频",value:"Audio"},{name:"字体",value:"Font"}],qr=_r.reduce(((e,{name:t,value:a})=>(e[a]=t,e)),{}),$r=new class extends Wt{asset;assetSource;template;project;constructor(){super("vnve2"),this.version(2).stores({asset:"++id, name, type, states",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",draft:"++id, name, time, content",project:"++id, name, time, content"})}},en=$r.asset,tn=$r.assetSource,an=$r.template,sn=$r.project;function rn(e){return`https://s/${e.id}.${e.ext}`}const nn=[{type:Ar.Background,assets:[{name:"school",states:[{name:"day",url:"/assets/day-c525641b.webp"}]}]}],on=[{name:"对话",content:function(){const e=new Ei,t=new Mi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,400),t.endFill(),t.x=0,t.y=680,t.zIndex=jr.Dialog,t.label="对话框",t.fillColor="#000000";const a=new Hi("角色名",{fill:16777215,fontSize:44,fontWeight:"bold"});a.x=160,a.y=700,a.zIndex=jr.Text,a.label="角色名",a.disableTextEdit=!0;const s=new Hi("角色台词",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return s.x=160,s.y=770,s.zIndex=jr.Text,s.label="角色台词",s.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.addChild(s),e.config.speak.targetName=s.name,e.config.speak.dialogTargetName=t.name,e.config.speak.speaker.targetName=a.name,e.config.speak.speaker.name=a.text,e}},{name:"独白",content:function(){const e=new Ei,t=new Mi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,1080),t.endFill(),t.x=0,t.y=0,t.zIndex=jr.Dialog,t.label="独白遮罩";const a=new Hi("独白台词",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return a.x=160,a.y=160,a.zIndex=jr.Text,a.label="独白台词",a.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.config.speak.targetName=a.name,e.config.speak.dialogTargetName=t.name,e}},{name:"标题",content:function(){const e=new Ei,t=new Hi("主标题",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});t.x=960-t.width/2,t.y=340,t.zIndex=jr.Text,t.label="主标题";const a=new Hi("副标题",{fill:16777215,breakWords:!0,fontSize:60});return a.x=960-a.width/2,a.y=500,a.zIndex=jr.Text,a.label="副标题",e.addChild(t),e.addChild(a),e}},{name:"空白",content:()=>new Ei}];function ln(){const e=kr((e=>e.editor)),t=Xt((()=>an.reverse().toArray()));return{defaultTemplates:on,customTemplates:t||[],handleAddDefaultTemplate:(t,a)=>()=>{const s=t();e.addScene(s,a),e.setActiveSceneByName(s.name)},handleAddCustomTemplate:async(t,a)=>{const s=await Ei.fromJSON(JSON.parse(t),!1);e.addScene(s,a),e.setActiveSceneByName(s.name)}}}function cn({onOpenSceneDetailDialog:e}){const t=kr((e=>e.editor)),a=kr((e=>e.activeScene)),s=kr((e=>e.scenes)),{defaultTemplates:n,customTemplates:o,handleAddDefaultTemplate:l,handleAddCustomTemplate:c}=ln(),d=i.useRef(null);i.useEffect((()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})}),[s.length]);const m=(e,a)=>{t.swapScene(e,a)};return r.jsx(Zr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:r.jsx(Gr,{className:"h-full p-1",children:r.jsx(Wr,{className:"h-full p-2",children:r.jsxs(pi,{children:[r.jsx(ui,{children:r.jsxs(fi,{children:[r.jsx(bi,{children:"场景"}),r.jsx(bi,{className:"w-[3rem] text-right",children:"操作"})]})}),r.jsx(xi,{children:s.map(((i,h)=>r.jsxs(fi,{ref:a?.name===i.name?d:null,className:(a?.name===i.name?"bg-muted":"")+" cursor-pointer",children:[r.jsxs(gi,{onClick:()=>{t.setActiveSceneByName(i.name)},children:[r.jsxs("span",{className:"font-medium mr-1",children:[h+1,"."]}),i.label]}),r.jsxs(gi,{className:"flex gap-1 justify-end",children:[h>0&&r.jsx(Vr.moveUp,{className:"size-4 cursor-pointer",onClick:()=>m(h,h-1)}),h<s.length-1&&r.jsx(Vr.moveDown,{className:"size-4 cursor-pointer",onClick:()=>m(h,h+1),children:"下移"}),r.jsxs(Rr,{children:[r.jsx(Lr,{children:r.jsx(Vr.more,{className:"size-4 cursor-pointer"})}),r.jsxs(Yr,{children:[r.jsx(Fr,{className:"flex md:hidden",onClick:e,children:"编辑"}),r.jsxs(Tr,{children:[r.jsx(Kr,{children:"插入"}),r.jsx(zr,{children:r.jsxs(Ir,{children:[n.map((e=>r.jsx(Fr,{onClick:l(e.content,h+1),children:e.name},e.name))),o.length>0&&r.jsx(Hr,{}),o.map((e=>r.jsx(Fr,{onClick:()=>c(e.content,h+1),children:e.name},e.id)))]})})]}),r.jsx(Fr,{onClick:()=>((e,a)=>{const s=t.cloneSceneByName(e.name);t.addScene(s,a),t.setActiveSceneByName(s.name)})(i,h+1),children:"复制"}),r.jsx(Fr,{className:"text-destructive",onClick:()=>(e=>{e.name===a?.name&&t.setActiveScene(void 0),t.removeSceneByName(e.name)})(i),children:"删除"})]})]})]})]},i.name)))})]})})})})}function dn(){const e=Sr((e=>e.setConfirm)),t=Sr((e=>e.setCancel)),a=Sr((e=>e.setOpen)),s=Sr((e=>e.setType)),i=Sr((e=>e.setDisableSelect));return{selectAsset:(r,n)=>new Promise((o=>{e((e=>{o(e),a(!1)})),t((()=>{o(void 0),a(!1)})),a(!0),s(r),i(n)}))}}async function mn(e,t){const a=e.states,s=a.find((t=>t.id===e.stateId))??a[0],i=new Di({source:rn(s)});return i.label=e.name,i.assetID=e.id,i.assetType=e.type,await i.load(),e.type===Ar.Character?(i.zIndex=jr.Character,i.x=t.options.width/2-i.width/2,i.y=t.options.height-i.height):e.type===Ar.Background?(i.zIndex=jr.Background,i.width=t.options.width,i.height=t.options.height):e.type===Ar.Dialog&&(i.zIndex=jr.Dialog,i.x=t.options.width/2-i.width/2,i.y=t.options.height-i.height),i}function hn(e){const t=e.states,a=t.find((t=>t.id===e.stateId))??t[0],s=new Ji({source:rn(a)});return s.label=a.name,s.assetID=e.id,s.assetType=e.type,s}const pn=Dt,un=i.forwardRef((({className:e,...a},s)=>r.jsx(Vt,{ref:s,className:t("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",e),...a})));un.displayName=Vt.displayName;const xn=i.forwardRef((({className:e,...a},s)=>r.jsx(Rt,{ref:s,className:t("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...a})));xn.displayName=Rt.displayName,i.forwardRef((({className:e,inset:a,children:s,...i},n)=>r.jsxs(Lt,{ref:n,className:t("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a&&"pl-8",e),...i,children:[s,r.jsx(ut,{className:"ml-auto h-4 w-4"})]}))).displayName=Lt.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(zt,{ref:s,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}))).displayName=zt.displayName;const fn=i.forwardRef((({className:e,align:a="start",alignOffset:s=-4,sideOffset:i=8,...n},o)=>r.jsx(Tt,{children:r.jsx(Kt,{ref:o,align:a,alignOffset:s,sideOffset:i,className:t("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})})));fn.displayName=Kt.displayName;const bn=i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(It,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",e),...s})));bn.displayName=It.displayName,i.forwardRef((({className:e,children:a,checked:s,...i},n)=>r.jsxs(Yt,{ref:n,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...i,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Ft,{children:r.jsx(yt,{className:"h-4 w-4"})})}),a]}))).displayName=Yt.displayName,i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(Ht,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Ft,{children:r.jsx(Nt,{className:"h-4 w-4 fill-current"})})}),a]}))).displayName=Ht.displayName,i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(Mt,{ref:i,className:t("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",e),...s}))).displayName=Mt.displayName;const gn=i.forwardRef((({className:e,...a},s)=>r.jsx(Ut,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),...a})));gn.displayName=Ut.displayName;const vn=At,wn=_t,yn=i.forwardRef((({className:e,...a},s)=>r.jsx(Bt,{ref:s,className:t("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a})));yn.displayName=Bt.displayName;const jn=i.forwardRef((({className:e,children:a,disableClose:s,...i},n)=>r.jsxs(wn,{children:[r.jsx(yn,{}),r.jsxs(Jt,{ref:n,className:t("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[a,!s&&r.jsxs(Pt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(Et,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));jn.displayName=Jt.displayName;const Nn=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});Nn.displayName="DialogHeader";const kn=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});kn.displayName="DialogFooter";const Sn=i.forwardRef((({className:e,...a},s)=>r.jsx(Ot,{ref:s,className:t("text-lg font-semibold leading-none tracking-tight",e),...a})));Sn.displayName=Ot.displayName;const Zn=i.forwardRef((({className:e,...a},s)=>r.jsx(Qt,{ref:s,className:t("text-sm text-muted-foreground",e),...a})));Zn.displayName=Qt.displayName;const Gn=$t("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Cn=i.forwardRef((({className:e,...a},s)=>r.jsx(qt,{ref:s,className:t(Gn(),e),...a})));Cn.displayName=qt.displayName;const Wn=sa,Xn=i.createContext({}),Vn=({...e})=>r.jsx(Xn.Provider,{value:{name:e.name},children:r.jsx(ta,{...e})}),Rn=()=>{const e=i.useContext(Xn),t=i.useContext(Ln),{getFieldState:a,formState:s}=aa(),r=a(e.name,s);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:n}=t;return{id:n,name:e.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...r}},Ln=i.createContext({}),zn=i.forwardRef((({className:e,...a},s)=>{const n=i.useId();return r.jsx(Ln.Provider,{value:{id:n},children:r.jsx("div",{ref:s,className:t("space-y-2",e),...a})})}));zn.displayName="FormItem";const Tn=i.forwardRef((({className:e,...a},s)=>{const{error:i,formItemId:n}=Rn();return r.jsx(Cn,{ref:s,className:t(i&&"text-destructive",e),htmlFor:n,...a})}));Tn.displayName="FormLabel";const Kn=i.forwardRef((({...e},t)=>{const{error:a,formItemId:s,formDescriptionId:i,formMessageId:n}=Rn();return r.jsx(ea,{ref:t,id:s,"aria-describedby":a?`${i} ${n}`:`${i}`,"aria-invalid":!!a,...e})}));Kn.displayName="FormControl";const In=i.forwardRef((({className:e,...a},s)=>{const{formDescriptionId:i}=Rn();return r.jsx("p",{ref:s,id:i,className:t("text-[0.8rem] text-muted-foreground",e),...a})}));In.displayName="FormDescription";const Yn=i.forwardRef((({className:e,children:a,...s},i)=>{const{error:n,formMessageId:o}=Rn(),l=n?String(n?.message):a;return l?r.jsx("p",{ref:i,id:o,className:t("text-[0.8rem] font-medium text-destructive",e),...s,children:l}):null}));Yn.displayName="FormMessage";const Fn=i.forwardRef((({className:e,type:a,...s},i)=>r.jsx("input",{type:a,className:t("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...s})));Fn.displayName="Input";const Hn=$t("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Mn=i.forwardRef((({className:e,variant:a,size:s,asChild:i=!1,...n},o)=>{const l=i?ea:"button";return r.jsx(l,{className:t(Hn({variant:a,size:s,className:e})),ref:o,...n})}));Mn.displayName="Button";const Un=ia({templateName:ra().min(1,"模板名称不能为空")});function Dn({isOpen:e,sceneName:t,onClose:a}){const s=kr((e=>e.editor)),i=na({resolver:oa(Un),defaultValues:{templateName:""}});return r.jsx(vn,{open:e,onOpenChange:e=>{e||a()},children:r.jsxs(jn,{children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"保存为模板"}),r.jsx(Zn,{})]}),r.jsx(Wn,{...i,children:r.jsxs("form",{onSubmit:i.handleSubmit((async e=>{await an.add({name:e.templateName,type:"",content:JSON.stringify(s.cloneSceneByName(t))}),a(),i.reset()})),className:"space-y-8",children:[r.jsx(Vn,{control:i.control,name:"templateName",render:({field:e})=>r.jsxs(zn,{children:[r.jsx(Tn,{children:"模板名称"}),r.jsx(Kn,{children:r.jsx(Fn,{placeholder:"输入模板名称",...e})}),r.jsx(Yn,{})]})}),r.jsxs("div",{className:"flex justify-end space-x-4",children:[r.jsx(Mn,{type:"button",variant:"outline",onClick:a,children:"取消"}),r.jsx(Mn,{type:"submit",children:"保存"})]})]})})]})})}function Bn({isOpen:e,onClose:t}){const a=Xt((()=>an.reverse().toArray()));return r.jsx(vn,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(jn,{className:"max-h-[80vh] overflow-auto",children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"模板列表"}),r.jsx(Zn,{})]}),r.jsxs(pi,{children:[r.jsx(ui,{children:r.jsxs(fi,{children:[r.jsx(bi,{children:"模板名称"}),r.jsx(bi,{className:"w-[100px]",children:"操作"})]})}),r.jsx(xi,{children:a?.map((e=>r.jsxs(fi,{children:[r.jsx(gi,{children:e.name}),r.jsx(gi,{children:r.jsxs(Mn,{variant:"ghost",size:"icon",onClick:()=>(async e=>{await an.delete(e)})(e.id),children:[r.jsx(Vr.delete,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"删除"})]})})]},e.id)))})]})]})})}const Jn=i.forwardRef((({className:e,value:a,...s},i)=>r.jsx(la,{ref:i,className:t("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...s,children:r.jsx(ca,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})));function Pn({progress:e,url:t,isOpen:a,onClose:s}){const i=kr((e=>e.project));return r.jsx(vn,{open:a,onOpenChange:e=>{e||s()},children:r.jsxs(jn,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"导出"}),r.jsx(Zn,{})]}),!t&&r.jsx(Jn,{value:e.value}),t&&r.jsx("video",{src:t,className:"w-full aspect-[16/9]",controls:!0}),r.jsx(kn,{children:t&&r.jsxs(Mn,{onClick:()=>{!function(e,t){const a=document.createElement("a");a.setAttribute("download",`${e}.mp4`),a.setAttribute("href",t),document.body.appendChild(a),a.click(),document.body.removeChild(a)}(i.name,t)},children:[r.jsx(Vr.download,{className:"size-4 mr-1"}),"保存视频"]})})]})})}Jn.displayName=la.displayName;const En=i.forwardRef((({progress:e,isOpen:t,onReplay:a,onClose:s,onExport:n},o)=>{const l=i.useRef(null);return i.useImperativeHandle(o,(()=>({getPreviewCanvas:()=>l.current}))),r.jsx(vn,{open:t,onOpenChange:e=>{e||s()},children:r.jsxs(jn,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"预览"}),r.jsx(Zn,{}),r.jsx("canvas",{ref:l,className:"w-full aspect-[16/9]"}),r.jsx(Jn,{value:e.value,className:"mt-2"})]}),r.jsxs(kn,{children:[r.jsx(Mn,{variant:"ghost",onClick:a,children:r.jsx(Vr.refresh,{className:"size-5"})}),r.jsxs(Mn,{onClick:n,children:[r.jsx(Vr.download,{className:"size-4 mr-1"}),"导出视频"]})]})]})})})),On=ia({projectName:ra().min(1,"作品名称不能为空")});function Qn({isOpen:e,onClose:t}){const a=kr((e=>e.editor)),s=kr((e=>e.setProject)),i=na({resolver:oa(On),defaultValues:{projectName:""}});return r.jsx(vn,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(jn,{children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"创建新作品"}),r.jsx(Zn,{})]}),r.jsx(Wn,{...i,children:r.jsxs("form",{onSubmit:i.handleSubmit((async e=>{const r={name:e.projectName,content:"",time:Date.now()},n=await sn.add(r);a.clear(),s({id:n,...r}),t(),i.reset()})),className:"space-y-8",children:[r.jsx(Vn,{control:i.control,name:"projectName",render:({field:e})=>r.jsxs(zn,{children:[r.jsx(Tn,{children:"作品名称"}),r.jsx(Kn,{children:r.jsx(Fn,{placeholder:"输入作品名称",...e})}),r.jsx(Yn,{})]})}),r.jsxs("div",{className:"flex justify-end space-x-4",children:[r.jsx(Mn,{type:"button",variant:"outline",onClick:t,children:"取消"}),r.jsx(Mn,{type:"submit",children:"创建"})]})]})})]})})}function An({isOpen:e,onClose:t}){const a=kr((e=>e.editor)),s=kr((e=>e.setProject)),n=Xt((()=>sn.reverse().toArray())),o=i.useRef(!1);return r.jsx(vn,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(jn,{className:"max-h-[80vh] overflow-auto",children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"作品列表"}),r.jsx(Zn,{})]}),r.jsxs(pi,{children:[r.jsx(ui,{children:r.jsxs(fi,{children:[r.jsx(bi,{children:"作品名称"}),r.jsx(bi,{className:"w-[80px]",children:"操作"})]})}),r.jsx(xi,{children:n?.map((e=>r.jsxs(fi,{children:[r.jsx(gi,{onClick:()=>(async e=>{if(o.current)return;o.current=!0;const i=await sn.get(e);a.clear(),i.content&&(await a.loadFromJSON(i.content),a.setActiveSceneByIndex(0)),s(i),t(),setTimeout((()=>{o.current=!1}),100)})(e.id),children:r.jsx("span",{className:"cursor-pointer",children:e.name})}),r.jsxs(gi,{className:"flex gap-2",children:[r.jsx(Vr.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>(async e=>{const t=await sn.get(e);await sn.add({name:`${t.name} - 副本`,content:t.content,time:Date.now()})})(e.id)}),r.jsx(Vr.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>(async e=>{await sn.delete(e)})(e.id)})]})]},e.id)))})]})]})})}let _n=0;const qn=new Map,$n=e=>{if(qn.has(e))return;const t=setTimeout((()=>{qn.delete(e),so({type:"REMOVE_TOAST",toastId:e})}),1e6);qn.set(e,t)},eo=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map((e=>e.id===t.toast.id?{...e,...t.toast}:e))};case"DISMISS_TOAST":{const{toastId:a}=t;return a?$n(a):e.toasts.forEach((e=>{$n(e.id)})),{...e,toasts:e.toasts.map((e=>e.id===a||void 0===a?{...e,open:!1}:e))}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==t.toastId))}}},to=[];let ao={toasts:[]};function so(e){ao=eo(ao,e),to.forEach((e=>{e(ao)}))}function io({...e}){const t=(_n=(_n+1)%Number.MAX_SAFE_INTEGER,_n.toString()),a=()=>so({type:"DISMISS_TOAST",toastId:t});return so({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>so({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function ro(){const[e,t]=i.useState(ao);return i.useEffect((()=>(to.push(t),()=>{const e=to.indexOf(t);e>-1&&to.splice(e,1)})),[e]),{...e,toast:io,dismiss:e=>so({type:"DISMISS_TOAST",toastId:e})}}const no=({className:e})=>r.jsx(da,{className:t("h-6 w-6 text-primary/60 animate-spin",e)});function oo({isOpen:e}){return r.jsx(vn,{open:e,onOpenChange:()=>{},children:r.jsxs(jn,{disableClose:!0,onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(Nn,{className:"hidden",children:[r.jsx(Sn,{}),r.jsx(Zn,{})]}),r.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[r.jsx("div",{className:"font-bold text-xl",children:"导入中"}),r.jsx(no,{})]})]})})}const lo=ga,co=ba,mo=i.forwardRef((({className:e,...a},s)=>r.jsx(ma,{className:t("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:s})));mo.displayName=ma.displayName;const ho=i.forwardRef((({className:e,...a},s)=>r.jsxs(co,{children:[r.jsx(mo,{}),r.jsx(ha,{ref:s,className:t("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a})]})));ho.displayName=ha.displayName;const po=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col space-y-2 text-center sm:text-left",e),...a});po.displayName="AlertDialogHeader";const uo=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});uo.displayName="AlertDialogFooter";const xo=i.forwardRef((({className:e,...a},s)=>r.jsx(pa,{ref:s,className:t("text-lg font-semibold",e),...a})));xo.displayName=pa.displayName;const fo=i.forwardRef((({className:e,...a},s)=>r.jsx(ua,{ref:s,className:t("text-sm text-muted-foreground",e),...a})));fo.displayName=ua.displayName;const bo=i.forwardRef((({className:e,...a},s)=>r.jsx(xa,{ref:s,className:t(Hn(),e),...a})));bo.displayName=xa.displayName;const go=i.forwardRef((({className:e,...a},s)=>r.jsx(fa,{ref:s,className:t(Hn({variant:"outline"}),"mt-2 sm:mt-0",e),...a})));function vo({isOpen:e,onConfirm:t,onClose:a}){return r.jsx(lo,{open:e,onOpenChange:e=>{e||a()},children:r.jsxs(ho,{children:[r.jsxs(po,{children:[r.jsx(xo,{children:"确认清空素材库？"}),r.jsx(fo,{})]}),r.jsxs(uo,{children:[r.jsx(go,{children:"取消"}),r.jsx(bo,{onClick:()=>{t(),a()},children:"确认"})]})]})})}function wo(){const e=kr((e=>e.initEditor)),t=kr((e=>e.project)),a=kr((e=>e.editor)),s=kr((e=>e.activeScene)),n=kr((e=>e.scenes)),{selectAsset:o}=dn(),l=i.useRef(null),c=i.useRef(null),{defaultTemplates:d,customTemplates:m,handleAddDefaultTemplate:h,handleAddCustomTemplate:p}=ln(),[u,x]=i.useState(!1),[f,b]=i.useState(!1),[g,v]=i.useState(!1),[w,y]=i.useState(!1),[j,N]=i.useState(!1),[k,S]=i.useState(!1),[Z,G]=i.useState(!1),C=i.useRef(null),[W,X]=i.useState([]),[V,R]=i.useState(null),L=i.useRef(null),[z,T]=i.useState({value:0,currentTime:0,duration:0}),[K,I]=i.useState(""),{toast:Y}=ro(),F=()=>{T({value:0,currentTime:0,duration:0})},H=()=>{const e=l.current,t=c.current;if(e&&t){const a=e.clientWidth,s=e.clientHeight,i=16/9;let r=a,n=a/i;n>s&&(n=s,r=s*i),t.style.width=`${r}px`,t.style.height=`${n}px`}},M=i.useCallback((async e=>{try{const s=new Date;await sn.update(t.id,{content:a.saveAsJSON(),time:s.getTime()}),I(s.toLocaleString()),e||Y({title:"保存成功！",duration:1500})}catch(s){Y({title:"保存失败！",description:s.message,variant:"destructive"})}}),[Y,a,t]),U=e=>async()=>{const t=await o(e);if(t){const e=await mn(t,a);a.addChild(e)}},D=async(e=0,t)=>{F(),X([e,t]),N(!0);const s=await a.exportScreenplay(e,t),i=new yr({canvas:C.current.getPreviewCanvas(),width:1920,height:1080,fps:30});L.current.connect(i),L.current.action(s).then((()=>{console.log("预览完成")})).catch((e=>{N(!1),Y({title:"预览失败！",description:e.message,variant:"destructive"})}))},B=async(e=0,t)=>{F(),y(!0),R(null);const s=await a.exportScreenplay(e,t),i=new wr({width:1920,height:1080,fps:30});L.current.connect(i),L.current.action(s).then((e=>{const t=URL.createObjectURL(e);R(t)})).catch((e=>{y(!1),Y({title:"导出失败！",description:e.message,variant:"destructive"})}))};return i.useEffect((()=>{if(t){const e=setInterval((async()=>{M(!0)}),6e4);return()=>{clearInterval(e)}}}),[t,M]),i.useEffect((()=>(window.addEventListener("resize",H),H(),e(c.current),L.current=new ur({onProgress(e,t,a){T({value:e,currentTime:t,duration:a})}}),c.current.onselectstart=function(){return!1},()=>{window.removeEventListener("resize",H)})),[e]),r.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[r.jsxs(un,{children:[r.jsxs(pn,{children:[r.jsxs(xn,{className:"data-[disabled]:text-gray-400",children:[r.jsx(Vr.library,{className:"size-4 mr-0.5"}),"作品"]}),r.jsxs(fn,{children:[r.jsx(bn,{onClick:()=>x(!0),children:"创建新作品"}),r.jsx(bn,{onClick:()=>b(!0),children:"打开..."}),r.jsx(bn,{disabled:!t,onClick:()=>M(),children:"保存"}),K&&r.jsxs(bn,{className:"text-muted-foreground",children:["自动保存于",K]})]})]}),r.jsxs(pn,{children:[r.jsxs(xn,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[r.jsx(Vr.scene,{className:"size-4 mr-0.5"}),"场景"]}),r.jsxs(fn,{children:[d.map((e=>r.jsxs(bn,{onClick:h(e.content),children:["新建",e.name]},e.name))),m.length>0&&r.jsx(gn,{}),m.map((e=>r.jsxs(bn,{onClick:()=>p(e.content),children:["新建",e.name]},e.id))),r.jsx(gn,{}),r.jsx(bn,{onClick:()=>v(!0),children:"管理模版..."})]})]}),r.jsxs(pn,{children:[r.jsxs(xn,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[r.jsx(Vr.images,{className:"size-4 mr-0.5"}),"素材"]}),r.jsxs(fn,{children:[r.jsx(bn,{disabled:!s,onClick:U(Ar.Character),children:"添加角色"}),r.jsx(bn,{disabled:!s,onClick:U(Ar.Background),children:"添加背景"}),r.jsx(bn,{disabled:!s,onClick:U(Ar.Thing),children:"添加物品"}),r.jsx(gn,{}),r.jsx(bn,{onClick:async()=>{S(!0);try{await async function(){const e=await window.showDirectoryPicker();for(const t of _r){const a=await e.getDirectoryHandle(t.name).catch((()=>{}));if(a)for await(const[e,s]of a.entries())if("directory"===s.kind){const a=await en.add({name:e,type:t.value,states:[]});for await(const[,e]of s.entries())if("file"===e.kind){const t=await e.getFile(),{name:s,ext:i}=hi(t),r=await tn.add({mime:t.type,blob:t,ext:i});await en.where("id").equals(a).modify((e=>{e.states.push({id:r,name:s,ext:i})}))}}}}()}catch(e){Y({title:"导入失败！",description:e.message,variant:"destructive"})}finally{S(!1)}},children:"导入素材库..."}),r.jsx(bn,{onClick:()=>o(void 0,!0),children:"管理素材库..."}),r.jsx(bn,{className:"text-destructive",onClick:()=>G(!0),children:"清空素材库"})]})]}),r.jsxs(pn,{children:[r.jsxs(xn,{disabled:0===n.length,className:"data-[disabled]:text-gray-400",children:[r.jsx(Vr.preview,{className:"size-4 mr-0.5"}),"预览"]}),r.jsxs(fn,{children:[r.jsx(bn,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();D(e,e+1)},children:"仅预览当前场景"}),r.jsx(bn,{disabled:!s,onClick:()=>D(a.getActiveSceneIndex()),children:"从当前场景开始预览"}),r.jsx(bn,{onClick:()=>D(),children:"预览全部场景"})]})]}),r.jsxs(pn,{children:[r.jsxs(xn,{disabled:0===n.length,className:"data-[disabled]:text-gray-400",children:[r.jsx(Vr.download,{className:"size-4 mr-0.5"}),"导出"]}),r.jsxs(fn,{children:[r.jsx(bn,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();B(e,e+1)},children:"仅导出当前场景"}),r.jsx(bn,{disabled:!s,onClick:()=>B(a.getActiveSceneIndex()),children:"从当前场景开始导出"}),r.jsx(bn,{onClick:()=>B(),children:"导出全部场景"})]})]})]}),r.jsx(Zr,{className:"flex-1 rounded-md relative",children:r.jsx(Gr,{className:"relative h-full p-2",children:r.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:l,children:r.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),r.jsx(An,{isOpen:f,onClose:()=>b(!1)}),r.jsx(Bn,{isOpen:g,onClose:()=>v(!1)}),r.jsx(Pn,{progress:z,url:V,isOpen:w,onClose:()=>{y(!1),L.current.hasStarted()&&L.current.cut(),V&&URL.revokeObjectURL(V),R(null)}}),r.jsx(En,{progress:z,ref:C,isOpen:j,onReplay:async()=>{L.current.hasStarted()&&await L.current.cut(),D(...W)},onClose:()=>{N(!1),L.current.hasStarted()&&L.current.cut()},onExport:()=>{N(!1),B(...W)}}),r.jsx(Qn,{isOpen:u,onClose:()=>x(!1)}),r.jsx(oo,{isOpen:k}),r.jsx(vo,{isOpen:Z,onConfirm:async()=>{await async function(){await tn.clear(),await en.clear()}(),Y({title:"清空成功！",duration:1500})},onClose:()=>G(!1)})]})}function yo(){const e=kr((e=>e.editor)),t=kr((e=>e.activeChild)),a=kr((e=>e.activeScene)),s=i.useMemo((()=>{if(!a)return[];const e=[],t=[],s=[],i=[],r=a.sounds;for(const n of a.children)n.assetType===Ar.Character?e.push(n):n.assetType===Ar.Background?s.push(n):n.assetType===Ar.Thing?t.push(n):n.name&&i.push(n);return[{label:"角色",children:e},{label:"物品",children:t},{label:"背景",children:s},{label:"其他",children:i},{label:"音频",children:r}]}),[a]),n=t=>{e.toggleChildVisibleByName(t.name)},o=t=>{e.toggleChildInteractiveByName(t.name)};return r.jsx(Wr,{className:"h-full pr-2",children:r.jsx("div",{className:"space-y-4",children:s.map((a=>a.children.length>0&&r.jsxs("fieldset",{className:"rounded-md border p-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:a.label}),r.jsx("div",{className:"flex flex-col gap-1",children:a.children.map((a=>r.jsx("div",{className:"text-sm p-1 px-2 border rounded "+(t?.name===a.name?"bg-muted":""),children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("div",{onClick:()=>(t=>{t.assetType!==Ar.Audio&&e.setActiveChildByName(t.name)})(a),className:"cursor-pointer flex-1",children:a.label}),r.jsxs("div",{className:"flex space-x-2 items-center",children:[a.assetType!==Ar.Audio&&r.jsxs(r.Fragment,{children:[a.visible?r.jsx(Vr.viewing,{onClick:()=>n(a),className:"size-4 cursor-pointer"}):r.jsx(Vr.viewingOff,{onClick:()=>n(a),className:"size-4 cursor-pointer"}),a.interactive?r.jsx(Vr.lockOpen,{onClick:()=>o(a),className:"size-4 cursor-pointer"}):r.jsx(Vr.lock,{onClick:()=>o(a),className:"size-4 cursor-pointer"})]}),r.jsx(Vr.trash2,{onClick:()=>(a=>{a.assetType!==Ar.Audio?(e.removeChildByName(a.name),t?.name===a.name&&e.setActiveChild(void 0)):e.removeSoundByName(a.name)})(a),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},a.name)))})]},a.label)))})})}go.displayName=fa.displayName;const jo=i.forwardRef((({className:e,...a},s)=>r.jsxs(va,{ref:s,className:t("relative flex w-full touch-none select-none items-center",e),...a,children:[r.jsx(wa,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:r.jsx(ya,{className:"absolute h-full bg-primary"})}),r.jsx(ja,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})));function No(){const e=kr((e=>e.editor)),t=kr((e=>e.activeChild)),a=(t,a)=>s=>{e.updateActiveChild((e=>{e[t]="number"===a?Number(s.target.value):s.target.value}))};return r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"w-5",children:"宽"}),r.jsx(Fn,{value:t.width,onChange:a("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"w-5",children:"高"}),r.jsx(Fn,{value:t.height,onChange:a("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"w-5",children:"X"}),r.jsx(Fn,{value:t.x.toFixed(0),onChange:a("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"w-5",children:"Y"}),r.jsx(Fn,{value:t.y.toFixed(0),onChange:a("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"flex-shrink-0 mr-2",children:"透明度"}),r.jsx(jo,{min:0,max:1,step:.1,value:[t.alpha],onValueChange:t=>{return(a="alpha",t=>{e.updateActiveChild((e=>{e[a]=t}))})(t[0]);var a}})]})]})}jo.displayName=va.displayName;const ko=Ya,So=Fa,Zo=Ha,Go=i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(Na,{ref:i,className:t("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),"data-disable-click-outside":!0,...s,children:[a,r.jsx(ka,{asChild:!0,children:r.jsx(Sa,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]})));Go.displayName=Na.displayName;const Co=i.forwardRef((({className:e,...a},s)=>r.jsx(Za,{ref:s,className:t("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...a,children:r.jsx(Ga,{})})));Co.displayName=Za.displayName;const Wo=i.forwardRef((({className:e,...a},s)=>r.jsx(Ca,{ref:s,className:t("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...a,children:r.jsx(Wa,{})})));Wo.displayName=Ca.displayName;const Xo=i.forwardRef((({className:e,children:a,position:s="popper",...i},n)=>r.jsx(Xa,{children:r.jsxs(Va,{ref:n,className:t("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,"data-disable-click-outside":!0,...i,children:[r.jsx(Co,{}),r.jsx(Ra,{className:t("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:a}),r.jsx(Wo,{})]})})));Xo.displayName=Va.displayName;const Vo=i.forwardRef((({className:e,...a},s)=>r.jsx(La,{ref:s,className:t("px-2 py-1.5 text-sm font-semibold",e),...a,"data-disable-click-outside":!0})));Vo.displayName=La.displayName;const Ro=i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(za,{ref:i,className:t("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),"data-disable-click-outside":!0,...s,children:[r.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:r.jsx(Ta,{children:r.jsx(yt,{className:"h-4 w-4"})})}),r.jsx(Ka,{"data-disable-click-outside":!0,children:a})]})));Ro.displayName=za.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(Ia,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),"data-disable-click-outside":!0,...a}))).displayName=Ia.displayName;const Lo=Da,zo=Ba,To=i.forwardRef((({className:e,align:a="center",sideOffset:s=4,...i},n)=>r.jsx(Ma,{children:r.jsx(Ua,{ref:n,align:a,sideOffset:s,className:t("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i})})));To.displayName=Ua.displayName;const Ko=i.forwardRef((({disabled:e,value:a,onChange:s,onBlur:n,name:o,className:l,...c},d)=>{const m=function(e){const t=i.useRef(null);return i.useEffect((()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)})),t}(d),[h,p]=i.useState(!1),u=i.useMemo((()=>a||"#FFFFFF"),[a]);return r.jsxs(Lo,{onOpenChange:p,open:h,children:[r.jsx(zo,{asChild:!0,disabled:e,onBlur:n,children:r.jsx(Mn,{...c,className:t("block",l),name:o,onClick:()=>{p(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:r.jsx("div",{})})}),r.jsxs(To,{className:"w-full",children:[r.jsx(Ja,{color:u,onChange:s}),r.jsx(Fn,{className:"mt-2",maxLength:7,onChange:e=>{s(e?.currentTarget?.value)},ref:m,value:u})]})]})}));Ko.displayName="ColorPicker";const Io=$t("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}});i.forwardRef((({className:e,variant:a,size:s,...i},n)=>r.jsx(Pa,{ref:n,className:t(Io({variant:a,size:s,className:e})),...i}))).displayName=Pa.displayName;const Yo=i.createContext({size:"default",variant:"default"}),Fo=i.forwardRef((({className:e,variant:a,size:s,children:i,...n},o)=>r.jsx(Ea,{ref:o,className:t("flex items-center justify-center gap-1",e),...n,children:r.jsx(Yo.Provider,{value:{variant:a,size:s},children:i})})));Fo.displayName=Ea.displayName;const Ho=i.forwardRef((({className:e,children:a,variant:s,size:n,...o},l)=>{const c=i.useContext(Yo);return r.jsx(Oa,{ref:l,className:t(Io({variant:c.variant||s,size:c.size||n}),e),...o,children:a})}));function Mo(){const e=kr((e=>e.editor)),t=kr((e=>e.activeChild)),a=Xt((()=>en.where("type").equals(Ar.Font).reverse().toArray())),s=i.useMemo((()=>{const e=[];if(!a)return e;for(const t of a)for(const a of t.states)e.push({ch:a.name,en:a.name});return e}),[a]),n=t=>a=>{e.updateActiveChild((e=>{e.style[t]=a}))};return r.jsxs("div",{className:"flex flex-col gap-3",children:[!t.disableTextEdit&&r.jsx("div",{className:"flex gap-2",children:r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Vr.bookOpenText,{className:"w-5 h-5"}),r.jsx(Fn,{value:t.text,onChange:(o="text",t=>{e.updateActiveChild((e=>{e[o]="number"===l?Number(t.target.value):t.target.value}))})})]})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Vr.color,{className:"w-5 h-5"}),r.jsx(Ko,{value:t.style.fill,onChange:n("fill"),className:"w-6 h-6"})]}),r.jsx("div",{className:"flex-1 flex gap-1 items-center",children:r.jsxs(Fo,{type:"multiple",value:[t.style.fontWeight,t.style.fontStyle],onValueChange:t=>{e.updateActiveChild((e=>{e.style.fontWeight=t.includes(Er.BOLD)?Er.BOLD:Er.NORMAL,e.style.fontStyle=t.includes(Or.ITALIC)?Or.ITALIC:Or.NORMAL}))},children:[r.jsx(Ho,{value:Er.BOLD,className:"p-2",children:r.jsx(Vr.bold,{className:"size-4"})}),r.jsx(Ho,{value:Or.ITALIC,className:"p-2",children:r.jsx(Vr.italic,{className:"size-4"})})]})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[r.jsx(Vr.type,{className:"w-5 h-5"}),r.jsxs(ko,{onValueChange:n("fontFamily"),value:t.style.fontFamily,children:[r.jsx(Go,{className:"h-6 max-w-[150px]",children:r.jsx(Zo,{placeholder:"---"})}),r.jsx(Xo,{children:[...s,...Pr].map((e=>r.jsx(Ro,{value:e.en,children:e.ch},e.en)))})]})]}),r.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[r.jsx(Vr.fontSize,{className:"w-5 h-5"}),r.jsx(Fn,{value:t.style.fontSize,onChange:((t,a)=>s=>{e.updateActiveChild((e=>{e.style[t]="number"===a?Number(s.target.value):s.target.value}))})("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]});var o,l}function Uo(){const e=kr((e=>e.editor));kr((e=>e.activeScene));const t=kr((e=>e.activeChild)),{selectAsset:a}=dn();return r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(Cn,{className:"flex-shrink-0 mr-2",children:"填充色"}),r.jsx(Ko,{value:t.fillColor,onChange:t=>{e.updateActiveChild((e=>{const a=e.width,s=e.height;e.fillColor=t,e.clear().beginFill(t).drawRect(0,0,a,s).endFill()}))},className:"w-6 h-6"})]}),r.jsx(Mn,{size:"sm",onClick:async()=>{const s=await a(Ar.Dialog),i=await mn(s,e);e.addChild(i),e.updateActiveScene((e=>{e.config.speak.dialogTargetName=i.name})),e.setActiveChildByName(i.name),e.removeChildByName(t.name)},children:"自定义对话框"})]})}function Do(){const e=kr((e=>e.activeChild));return r.jsx(Wr,{className:"h-full pr-2",children:e&&r.jsxs(r.Fragment,{children:[r.jsxs("fieldset",{className:"rounded-md border p-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"基础属性"}),r.jsx(No,{})]}),"Text"===e.type&&r.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"文字属性"}),r.jsx(Mo,{})]}),"Graphics"===e.type&&r.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"对话框属性"}),r.jsx(Uo,{})]})]})})}function Bo(){const e=kr((e=>e.editor)),t=kr((e=>e.activeChild)),a=t=>()=>{switch(t){case"top":e.moveChildToTop();break;case"bottom":e.moveChildToBottom();break;case"up":e.moveUpChild();break;case"down":e.moveDownChild()}},s=t=>()=>{e.setChildPosition(t)};return r.jsx(Wr,{className:"h-full pr-2",children:t&&r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs("fieldset",{className:"rounded-md border p-1",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"层级"}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx(Mn,{size:"sm",variant:"ghost",onClick:a("top"),children:"置顶"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:a("up"),children:"上移"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:a("down"),children:"下移"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:a("bottom"),children:"置底"})]}),r.jsxs("div",{children:[r.jsx(Mn,{size:"sm",variant:"ghost",onClick:async()=>{const t=e.cloneChild();if("Sprite"===t.type){const e=t;await e.load()}t.x+=.1*t.width,t.y+=.1*t.height,e.addChild(t),e.setActiveChildByName(t.name)},children:r.jsx(Vr.copy,{className:"size-4"})}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:()=>{e.activeChild&&e.removeChildByName(e.activeChild.name),e.setActiveChild(void 0)},children:r.jsx(Vr.delete,{className:"size-4"})})]})]})]}),r.jsxs("fieldset",{className:"rounded-md border p-1",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"水平位置"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("left"),children:"左"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("near-left"),children:"1/3"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("center"),children:"中"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("near-right"),children:"2/3"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("right"),children:"右"})]}),r.jsxs("fieldset",{className:"rounded-md border p-1",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"垂直位置"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("top"),children:"上"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("middle"),children:"中"}),r.jsx(Mn,{size:"sm",variant:"ghost",onClick:s("bottom"),children:"下"})]})]})})}Ho.displayName=Oa.displayName;const Jo=qa,Po=i.forwardRef((({className:e,...a},s)=>r.jsx(Qa,{ref:s,className:t("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...a})));Po.displayName=Qa.displayName;const Eo=i.forwardRef((({className:e,...a},s)=>r.jsx(Aa,{ref:s,className:t("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...a})));Eo.displayName=Aa.displayName;const Oo=i.forwardRef((({className:e,...a},s)=>r.jsx(_a,{ref:s,className:t("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a})));function Qo(){return r.jsx(Zr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:r.jsx(Gr,{className:"h-full p-2",children:r.jsxs(Jo,{defaultValue:"position",className:"h-full flex flex-col",children:[r.jsxs(Po,{className:"self-center",children:[r.jsx(Eo,{value:"position",children:"位置"}),r.jsx(Eo,{value:"style",children:"样式"}),r.jsx(Eo,{value:"list",children:"列表"})]}),r.jsx(Oo,{className:"h-[calc(100%-2.5rem)]",value:"position",children:r.jsx(Bo,{})}),r.jsx(Oo,{className:"h-[calc(100%-2.5rem)]",value:"style",children:r.jsx(Do,{})}),r.jsx(Oo,{className:"h-[calc(100%-2.5rem)]",value:"list",children:r.jsx(yo,{})})]})})})}Oo.displayName=_a.displayName;const Ao=$a(es,"m-0 px-0 py-1"),_o=$t(ts("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),qo=as.forwardRef((({className:e,disabled:t,focusRing:a,focused:s,readOnly:i,size:n,variant:o,...l},c)=>r.jsx("div",{className:"relative w-full",ref:c,children:r.jsx(ss,{"aria-disabled":t,className:ts(_o({disabled:t,focusRing:a,focused:s,size:n,variant:o}),e),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:t??i,...l})})));qo.displayName="Editor";const $o=$t("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),el=is(rs(ns,{decorative:!0,orientation:"horizontal"}),$o),tl=ls,al=cs,sl=ds,il=ms,rl=$a(rs(os,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md"),nl=$a(us,"relative flex select-none items-center gap-1 bg-background"),ol=$a(xs,"flex items-center");$a(fs,"font-medium underline underline-offset-4"),$a(bs,"my-1 w-px shrink-0 bg-border");const ll=$t(ts("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),cl=(dl=i.forwardRef((({children:e,className:t,isDropdown:a,pressed:s,size:i,variant:n,...o},l)=>"boolean"==typeof s?r.jsx(ol,{disabled:o.disabled,type:"single",value:"single",children:r.jsx(ml,{className:ts(ll({size:i,variant:n}),a&&"my-1 justify-between pr-1",t),ref:l,value:s?"single":"",...o,children:a?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex flex-1",children:e}),r.jsx("div",{children:r.jsx(Vr.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):e})}):r.jsx(hs,{className:ts(ll({size:i,variant:n}),a&&"pr-1",t),ref:l,...o,children:e}))),as.forwardRef((function({tooltip:e,tooltipContentProps:t,tooltipProps:a,...s},i){const[n,o]=as.useState(!1);as.useEffect((()=>{o(!0)}),[]);const l=r.jsx(dl,{ref:i,...s});return e&&n?r.jsx(tl,{children:r.jsxs(al,{...a,children:[r.jsx(sl,{asChild:!0,children:l}),r.jsx(il,{children:r.jsx(rl,{...t,children:e})})]})}):l})));var dl;cl.displayName="ToolbarButton";const ml=is(gs,ll,["variant","size"]),hl=ps((({children:e,className:t,noSeparator:a},s)=>{const n=i.Children.map(e,(e=>e));return n&&0!==n.length?r.jsxs("div",{className:ts("flex",t),ref:s,children:[!a&&r.jsx("div",{className:"h-full py-2",children:r.jsx(el,{orientation:"vertical"})}),r.jsx("div",{className:"mx-1 flex items-center gap-1",children:e})]}):null})),pl=$a(nl,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),ul=Zt,xl=Gt;ps((({children:e,className:t,inset:a,...s},i)=>r.jsxs(pt,{className:ts("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),ref:i,...s,children:[e,r.jsx(Vr.chevronRight,{className:"ml-auto size-4"})]}))),$a(xt,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const fl=rs(bt,{className:ts("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),bl=ps((({...e},t)=>r.jsx(ft,{children:r.jsx(fl,{ref:t,...e})}))),gl=$t(ts("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),vl=is(gt,gl,["inset"]);ps((({children:e,className:t,...a},s)=>r.jsxs(vt,{className:ts("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",t),ref:s,...a,children:[r.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:r.jsx(wt,{children:r.jsx(Vr.check,{className:"size-4"})})}),e]}))),ps((({children:e,className:t,hideIcon:a,...s},i)=>r.jsxs(jt,{className:ts("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",t),ref:i,...s,children:[!a&&r.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:r.jsx(wt,{children:r.jsx(Vr.check,{className:"size-4"})})}),e]})));const wl=$t(ts("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),yl=is(kt,wl,["inset"]),jl=$a(St,"-mx-1 my-1 h-px bg-muted");$a(vs("span"),"ml-auto text-xs tracking-widest opacity-60");const Nl=()=>{const[e,t]=i.useState(!1);return{onOpenChange:i.useCallback(((a=!e)=>{t(a)}),[e]),open:e}},kl=ws(ys({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions((({getOptions:e})=>({isOpen:t=>e().openEditorId===t}))).extendEditorApi((({setOptions:e})=>({floatingDirective:{hide:()=>{e({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(t,a,s,i)=>{e({mode:t,openEditorId:a,editingDirective:s,directiveType:i})}}}))).extendEditorTransforms((({editor:e,type:t})=>({insert:{directive:({value:a})=>{js(e,{children:[{text:""}],type:t,value:a})}},edit:{directive:({value:a,at:s})=>{Ns(e,{children:[{text:""}],type:t,value:a},{at:s})}}}))));var Sl=(e=>(e.Animation="Animation",e.Sound="Sound",e.Util="Util",e.Filter="Filter",e.Transition="Transition",e))(Sl||{});const Zl={[pr.Speak]:"发言",[pr.Speaker]:"发言角色",[pr.ChangeSource]:"变更",[pr.Show]:"显示",[pr.Hide]:"隐藏",[pr.FadeIn]:"渐入",[pr.FadeOut]:"渐出",[pr.ShakeX]:"左右晃动",[pr.ShakeY]:"上下晃动",[pr.ZoomIn]:"放大",[pr.ZoomOut]:"缩小",[pr.EnterFromLeft]:"从左进入",[pr.LeaveFromLeft]:"向左离开",[pr.EnterFromRight]:"从右进入",[pr.LeaveFromRight]:"向右离开",[pr.Play]:"播放",[pr.Pause]:"暂停",[pr.Stop]:"停止",[pr.Wait]:"停顿",[pr.FadeInTransition]:"渐入转场",[pr.AddFilter]:"添加滤镜",[pr.RemoveFilter]:"移除滤镜"},Gl=[pr.ChangeSource,pr.Show,pr.Hide,pr.FadeIn,pr.FadeOut,pr.ShakeX,pr.ShakeY,pr.ZoomIn,pr.ZoomOut,pr.EnterFromLeft,pr.LeaveFromLeft,pr.EnterFromRight,pr.LeaveFromRight],Cl=Gl.map((e=>({name:Zl[e],value:e}))),Wl=[pr.Play,pr.Pause,pr.Stop],Xl=Wl.map((e=>({name:Zl[e],value:e}))),Vl=[pr.Wait],Rl=[pr.AddFilter,pr.RemoveFilter],Ll=[pr.FadeInTransition],zl=[{name:"动画指令",type:"Animation",options:Cl},{name:"音频指令",type:"Sound",options:Xl},{name:"工具指令",type:"Util",options:Vl.map((e=>({name:Zl[e],value:e})))},{name:"滤镜指令",type:"Filter",options:Rl.map((e=>({name:Zl[e],value:e})))},{name:"转场指令",type:"Transition",options:Ll.map((e=>({name:Zl[e],value:e})))}],Tl=[{name:"纯黑",value:"BlackMaskFilter"},{name:"模糊",value:"BlurFilter"},{name:"噪点",value:"NoiseFilter"},{name:"老电影",value:"OldFilmFilter"},{name:"暗角",value:"VignetteFilter"}],Kl=(e,{directiveElement:t,directiveType:a}={})=>{const{api:s}=ks(e,kl);if(t){const a=t.value.directive,r=(i=a,Gl.includes(i)?"Animation":Wl.includes(i)?"Sound":Vl.includes(i)?"Util":Rl.includes(i)?"Filter":Ll.includes(i)?"Transition":void 0);s.floatingDirective.show("edit",e.id,t,r)}else s.floatingDirective.show("insert",e.id,null,a);var i};function Il({triggerFloatingLinkHotkeys:e,floatingOptions:t}){const{editor:a,api:s,tf:i,useOption:r,setOption:n,getOptions:o}=Ss(kl),l=r("mode"),c=r("isOpen",a.id),d=r("editingDirective"),m=Zs({onOpenChange:e=>n("openEditorId",e?a.id:null),getBoundingClientRect:Gs,open:c&&["insert","edit"].includes(l),...t});Cs();const h=Sr((e=>e.isOpen)),p=Ws((e=>{const t=e.target;t&&t.dataset.disableClickOutside||t!==document.documentElement&&(h||(console.log("outside click",t),["insert","edit"].includes(o().mode)&&(s.floatingDirective.hide(),Vs(a,a.selection))))}),{disabled:!c});return as.useEffect((()=>{c&&m.update()}),[c,m.update]),{props:{style:{...m.style,zIndex:50}},ref:Xs(m.refs.setFloating,p),onSubmit:e=>{d?(e=>{const t=a.selection,[,r]=Ls(a,{at:t,match:{type:a.getType(kl)}});i.edit.directive({value:e,at:r}),s.floatingDirective.hide()})(e):(e=>{i.insert.directive({value:e}),Rs(a,{unit:"offset"}),s.floatingDirective.hide(),setTimeout((()=>{Vs(a,a.selection)}),0)})(e)},onCancel:()=>{s.floatingDirective.hide(),setTimeout((()=>{Vs(a,a.selection)}),0)}}}const Yl=[{items:[{description:"工具指令",icon:Vr.squarePlus,label:"工具指令",value:Sl.Util},{description:"转场指令",icon:Vr.squarePlus,label:"转场指令",value:Sl.Transition},{description:"滤镜指令",icon:Vr.squarePlus,label:"滤镜指令",value:Sl.Filter}],label:"更多指令"}];function Fl(e){const t=zs(),a=Nl();return r.jsxs(ul,{modal:!1,...a,...e,children:[r.jsx(xl,{asChild:!0,children:r.jsx(cl,{isDropdown:!0,pressed:a.open,tooltip:"更多指令",children:r.jsx(Vr.add,{className:"size-4"})})}),r.jsx(bl,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:Yl.map((({items:e,label:a},s)=>r.jsxs(as.Fragment,{children:[0!==s&&r.jsx(jl,{}),r.jsx(yl,{children:a}),e.map((({icon:e,label:a,value:s})=>r.jsxs(vl,{className:"min-w-[180px]",onSelect:()=>function(e){Kl(t,{directiveType:e}),Vs(t)}(s),children:[r.jsx(e,{className:"mr-2 size-4"}),a]},s)))]},a)))})]})}const Hl=i.forwardRef((({className:e,...a},s)=>r.jsx(Ts,{className:t("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...a,ref:s,children:r.jsx(Ks,{className:t("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})));Hl.displayName=Ts.displayName;const Ml=Is.object({wordsPerMin:Is.number().optional(),interval:Is.number().optional(),effect:Is.string().optional(),speaker:Is.object({name:Is.string().optional(),autoShowSpeaker:Is.object({inEffect:Is.string()}).optional(),autoMaskOtherSpeakers:Is.object({alpha:Is.number()}).optional()})});function Ul({speak:e,onChangeSpeak:t,disableCustomName:a=!1}){const s=na({resolver:oa(Ml),defaultValues:e}),n=Ys({control:s.control});return i.useEffect((()=>{s.formState.isDirty&&t({...e,...n,speaker:{...e.speaker,...n.speaker}})}),[s.formState.isDirty,n]),r.jsx(Wn,{...s,children:r.jsxs("form",{className:"space-y-2",children:[!a&&r.jsx(Vn,{control:s.control,name:"speaker.name",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"自定义角色名"}),r.jsx(In,{children:"用于自定义对话中显示的角色名"}),r.jsx(Kn,{children:r.jsx(Fn,{className:"h-8",placeholder:"请输入自定义角色名",...e})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:s.control,name:"wordsPerMin",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"语速（字/分钟）"}),r.jsx(In,{children:"角色发言的速度，默认值参考平均阅读速度"}),r.jsx(Kn,{children:r.jsx(Fn,{className:"h-8",type:"number",min:0,step:100,placeholder:"请输入语速",value:e.value,onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:s.control,name:"interval",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"停顿时长（秒）"}),r.jsx(In,{children:"角色发言后的停顿时长"}),r.jsx(Kn,{children:r.jsx(Fn,{className:"h-8",type:"number",min:0,step:.1,placeholder:"请输入停顿时长",value:e.value,onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:s.control,name:"effect",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"台词效果"}),r.jsx(In,{children:"台词的输出效果"}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择台词效果"})}),r.jsxs(Xo,{children:[r.jsx(Ro,{value:"typewriter",children:"打字机"}),r.jsx(Ro,{value:"fadeIn",children:"渐入"}),r.jsx(Ro,{value:"none",children:"无"})]})]})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:s.control,name:"speaker.autoShowSpeaker",render:({field:e})=>r.jsxs(zn,{className:"flex flex-row items-center space-y-0",children:[r.jsx(Tn,{className:"w-[8rem]",children:"自动显示发言角色"}),r.jsx(Kn,{children:r.jsx(Hl,{checked:!!e.value,onCheckedChange:e.onChange})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:s.control,name:"speaker.autoMaskOtherSpeakers",render:({field:e})=>r.jsxs(zn,{className:"flex flex-row items-center space-y-0",children:[r.jsx(Tn,{className:"w-[8rem]",children:"自动阴影其他角色"}),r.jsx(Kn,{children:r.jsx(Hl,{checked:!!e.value,onCheckedChange:e.onChange})}),r.jsx(Yn,{})]})})]})})}const Dl=Is.object({voice:Is.object({label:Is.string(),targetName:Is.string(),volume:Is.number().optional()})});function Bl({speak:e,onChangeSpeak:t}){const{selectAsset:a}=dn(),s=kr((e=>e.editor)),n=na({resolver:oa(Dl),defaultValues:e}),o=Ys({control:n.control}),l=async e=>{const t=await a(Ar.Audio);if(t){const a=hn(t);s.addSound(a),n.setValue("voice.label",a.label),e(a.name)}};return i.useEffect((()=>{n.formState.isDirty&&t({...e,...o})}),[n.formState.isDirty,o]),r.jsx(Wn,{...n,children:r.jsxs("form",{className:"space-y-2",children:[r.jsx(Vn,{control:n.control,name:"voice.targetName",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"配音文件"}),r.jsx(Kn,{children:r.jsx("div",{className:"flex gap-1 items-center",children:e.value&&o.voice?.label?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:o.voice.label}),r.jsx(Mn,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:r.jsx(Vr.edit,{className:"size-4 cursor-pointer",onClick:()=>l(e.onChange)})}),r.jsx(Mn,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:r.jsx(Vr.delete,{className:"size-4 cursor-pointer",onClick:()=>{return t=e.onChange,s.removeSoundByName(o.voice.targetName),n.setValue("voice.label",""),void t("");var t}})})]}):r.jsx(Mn,{type:"button",size:"sm",onClick:()=>l(e.onChange),children:"选择素材"})})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:n.control,name:"voice.volume",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"音量"}),r.jsx(Kn,{children:r.jsx(jo,{min:0,max:1,step:.1,value:[e.value??1],onValueChange:t=>e.onChange(t[0])})}),r.jsx(Yn,{})]})})]})})}const Jl={name:"Narrator",label:"旁白"};function Pl({speak:e,onChangeSpeak:t,children:a}){const s=kr((e=>e.activeScene)),n=i.useMemo((()=>{const e=[Jl];return s?[...e,...s.children.filter((e=>e.assetType===Ar.Character))]:e}),[s]),o=zs(),l=e=>{Kl(o,{directiveType:e}),Vs(o)};return r.jsxs("div",{className:"w-full flex flex-wrap",children:[r.jsxs(hl,{noSeparator:!0,children:[r.jsxs(ko,{value:e.speaker.speakerTargetName||"",onValueChange:a=>{const s=n.find((e=>e.name===a));t({...e,speaker:{...e.speaker,speakerTargetName:s?.name,name:s?.name===Jl.name?"":s?.label||""}})},children:[r.jsx(Go,{className:"w-[100px] md:w-[130px] h-8",children:r.jsx(Zo,{placeholder:"选择发言角色"})}),r.jsxs(Xo,{children:[n.map((e=>r.jsx(Ro,{value:e.name,children:e.label},e.name))),1===n.length&&r.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:"请先在画布中添加角色"})]})]}),r.jsxs(Lo,{children:[r.jsx(zo,{asChild:!0,children:r.jsx(cl,{className:"px-1",tooltip:"发言设置",children:r.jsx(Vr.settings,{className:"!size-4 cursor-pointer mx-1"})})}),r.jsx(To,{children:r.jsx(Ul,{speak:e,onChangeSpeak:t})})]}),r.jsxs(Lo,{children:[r.jsx(zo,{asChild:!0,children:r.jsx(cl,{className:"px-1",tooltip:"配音设置",children:r.jsx(Vr.mic,{className:"!size-4 cursor-pointer mx-1"})})}),r.jsx(To,{onFocusOutside:e=>e.preventDefault(),children:r.jsx(Bl,{speak:e,onChangeSpeak:t})})]}),r.jsxs(cl,{className:"px-1 text-xs",onClick:()=>l(Sl.Animation),tooltip:"插入动画",children:[r.jsx(Vr.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"动画"]}),r.jsxs(cl,{className:"px-1 text-xs",onClick:()=>l(Sl.Sound),tooltip:"插入音频",children:[r.jsx(Vr.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"音频"]}),r.jsx(Fl,{})]}),r.jsx(hl,{className:"ml-auto",children:a})]})}const El=Fs((e=>{const{children:t,nodeProps:a,placeholder:s}=e,{enabled:i}=Hs(e);return as.Children.map(t,(e=>as.cloneElement(e,{className:e.props.className,nodeProps:{...a,className:ts(i&&"before:absolute before:cursor-text before:opacity-30 before:content-[attr(placeholder)]"),placeholder:s}})))})),Ol=e=>El(e,[{hideOnBlur:!0,key:Ms.key,placeholder:"请输入对白",query:{maxLevel:1}},{hideOnBlur:!1,key:Us.h1,placeholder:"Untitled"}]),Ql=ps((({children:e,className:t,prefix:a,...s},i)=>{const n=Ds(),o=Bs(),l=Cs(),{editor:c}=Ss(kl);return r.jsxs(es,{className:ts("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",o&&l&&"ring-2 ring-ring",!0===n.children[0].bold&&"font-bold",!0===n.children[0].italic&&"italic",!0===n.children[0].underline&&"underline",t),contentEditable:!1,onClick:()=>{Kl(c,{directiveElement:n})},ref:i,...s,children:[a,n.value.label||"",e]})})),Al=$t("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");ps((({align:e="center",className:t,sideOffset:a=4,style:s,...i},n)=>r.jsx(Ma,{children:r.jsx(Ua,{align:e,className:ts(Al(),t),ref:n,sideOffset:a,style:{zIndex:1e3,...s},...i})})));const _l=i.forwardRef((({form:e},t)=>{const a=kr((e=>e.activeScene)),[s,n]=i.useState([]),[o,l]=i.useState([]),c=Ys({control:e.control,name:"directive"}),d=Ys({control:e.control,name:"params.targetName"}),m=Ys({control:e.control,name:"params.source"});return i.useEffect((()=>{if(a){const e=[],t=[],s=[];let i=[];for(const r of a.children){const a={value:r.name,label:r.label};r.assetType===Ar.Character?e.push(a):r.assetType===Ar.Background?s.push(a):r.assetType===Ar.Thing?t.push(a):r.name&&i.push(a)}c===pr.ChangeSource&&(i=i.filter((e=>e.assetID))),n([{label:"角色",options:e},{label:"背景",options:s},{label:"物品",options:t},{label:"其他",options:i}])}}),[a,c]),i.useEffect((()=>{if(a&&c===pr.ChangeSource&&d){const e=a.children.find((e=>e.name===d));e?.assetID?en.get(e.assetID).then((e=>{const t=e.states.map((e=>({value:rn(e),label:e.name})));l(t)})):l([])}}),[a,c,d,e]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{if(a&&c&&d){const e=[Zl[c],a.children.find((e=>e.name===d))?.label||""];if(c===pr.ChangeSource&&m){const t=o.find((e=>e.value===m))?.label||"";e.push(t)}return e.join(":")}return""}})),[a,c,d,m,o]),r.jsxs(r.Fragment,{children:[r.jsx(Vn,{control:e.control,name:"params.targetName",render:({field:t})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"动画对象"}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:a=>{t.onChange(a),e.setValue("params.source","")},value:t.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择动画对象"})}),r.jsxs(Xo,{children:[s.map((e=>e.options.length>0&&r.jsxs(So,{children:[r.jsx(Vo,{children:e.label}),e.options.map((e=>r.jsx(Ro,{value:e.value,children:e.label},e.value)))]},e.label))),s.every((e=>0===e.options.length))&&r.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:"请先在画布中添加角色、背景等素材"})]})]})}),r.jsx(Yn,{})]})}),c===pr.ChangeSource&&o.length>0&&r.jsx(Vn,{control:e.control,name:"params.source",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"目标状态"}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择目标状态"})}),r.jsx(Xo,{children:o.map((e=>r.jsx(Ro,{value:e.value,children:e.label},e.value)))})]})}),r.jsx(Yn,{})]})}),c!==pr.ChangeSource&&r.jsx(Vn,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"动画时长(秒)"}),r.jsx(Kn,{children:r.jsx(Fn,{type:"number",min:0,step:.1,placeholder:"自定义动画时长",value:e.value??"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(Yn,{})]})})]})})),ql=i.forwardRef((({form:e},t)=>{const a=Ys({control:e.control,name:"directive"}),s=Ys({control:e.control,name:"params.duration"});return i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>`${Zl[a]}:${s??0}秒`})),[s,a]),r.jsx(Vn,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"停顿时间(秒)"}),r.jsx(Kn,{children:r.jsx(Fn,{type:"number",min:0,step:.1,placeholder:"请输入停顿时间",value:e.value??0,onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(Yn,{})]})})})),$l=i.forwardRef((({form:e},t)=>{const a=kr((e=>e.activeScene)),s=kr((e=>e.editor)),[n,o]=i.useState([]),l=Ys({control:e.control,name:"directive"}),c=Ys({control:e.control,name:"params.targetName"}),{selectAsset:d}=dn(),[m,h]=i.useState(!1);return i.useEffect((()=>{if(a){const e=a.sounds.map((e=>({label:e.label,value:e.name})));o([{label:"音频",options:e}])}}),[a]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>a&&l&&c?[Zl[l],a.sounds.find((e=>e.name===c))?.label||""].join(":"):""})),[a,l,c]),r.jsxs(r.Fragment,{children:[r.jsx(Vn,{control:e.control,name:"params.targetName",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"目标音频"}),r.jsx(Kn,{children:r.jsxs(ko,{open:m,onOpenChange:h,onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择目标音频"})}),r.jsxs(Xo,{children:[n.map((e=>e.options.length>0&&r.jsxs(So,{children:[r.jsx(Vo,{children:e.label}),e.options.map((e=>r.jsx(Ro,{value:e.value,children:e.label},e.value)))]},e.label))),r.jsx("div",{onClick:()=>(async e=>{h(!1);const t=await d(Ar.Audio);if(t){const a=hn(t);s.addSound(a),setTimeout((()=>{e(a.name)}),150)}})(e.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"+从素材库中选择并添加到当前场景"})]})]})}),r.jsx(Yn,{})]})}),l===pr.Play&&r.jsxs(r.Fragment,{children:[r.jsx(Vn,{control:e.control,name:"params.start",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"开始时间(秒)"}),r.jsx(Kn,{children:r.jsx(Fn,{type:"number",min:0,step:1,placeholder:"请输入开始时间",value:e.value??0,onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:e.control,name:"params.volume",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"音量"}),r.jsx(Kn,{children:r.jsx(jo,{min:0,max:1,step:.1,value:[e.value??1],onValueChange:t=>e.onChange(t[0])})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:e.control,name:"params.loop",render:({field:e})=>r.jsxs(zn,{className:"space-y-0 flex flex-row items-center",children:[r.jsx(Tn,{className:"flex flex-col w-[4rem]",children:"循环"}),r.jsx(Kn,{children:r.jsx(Hl,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(Yn,{})]})}),r.jsx(Vn,{control:e.control,name:"params.untilEnd",render:({field:e})=>r.jsxs(zn,{className:"space-y-0 flex flex-row items-center",children:[r.jsx(Tn,{className:"flex flex-col w-[4rem]",children:"跨场景"}),r.jsx(Kn,{children:r.jsx(Hl,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(Yn,{})]})})]})]})})),ec=i.forwardRef((({form:e},t)=>{const a=kr((e=>e.activeScene)),[s,n]=i.useState([]),o=Ys({control:e.control,name:"directive"});return i.useEffect((()=>{if(a){const e=[],t=[],s=[],i=[];for(const r of a.children){const a={value:r.name,label:r.label};r.assetType===Ar.Character?e.push(a):r.assetType===Ar.Background?s.push(a):r.assetType===Ar.Thing?t.push(a):r.name&&i.push(a)}n([{label:"角色",options:e},{label:"背景",options:s},{label:"物品",options:t},{label:"其他",options:i}])}}),[a]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{const t=[Zl[o]],a=e.getValues("params.targetName"),i=s.flatMap((e=>e.options)).find((e=>e.value===a)),r=i?i.label:"全场景";t.push(r);const n=e.getValues("params.filterName");if(n){const e=Tl.find((e=>e.value===n)),a=e?e.name:"";t.push(a)}return t.join(":")}})),[e,o,s]),r.jsxs(r.Fragment,{children:[r.jsx(Vn,{control:e.control,name:"params.targetName",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"滤镜对象"}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"为空则默认全场景滤镜"})}),r.jsx(Xo,{children:s.map((e=>e.options.length>0&&r.jsxs(So,{children:[r.jsx(Vo,{children:e.label}),e.options.map((e=>r.jsx(Ro,{value:e.value,children:e.label},e.value)))]},e.label)))})]})}),r.jsx(Yn,{})]})}),o===pr.AddFilter&&r.jsx(Vn,{control:e.control,name:"params.filterName",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"滤镜效果"}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择滤镜效果"})}),r.jsx(Xo,{children:Tl.map((e=>r.jsx(Ro,{value:e.value,children:e.name},e.value)))})]})}),r.jsx(Yn,{})]})})]})})),tc=i.forwardRef((({form:e},t)=>(i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{const t=e.getValues("directive");return Zl[t]}}))),r.jsx(r.Fragment,{children:r.jsx(Vn,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:"转场时长"}),r.jsx(Kn,{children:r.jsx(Fn,{type:"number",min:0,step:.1,placeholder:"自定义转场时长",value:e.value??"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(Yn,{})]})})})))),ac=Is.discriminatedUnion("directive",[Is.object({directive:Is.literal(Gl[0]),params:Is.object({targetName:Is.string({message:"请选择动画对象"}),source:Is.string().min(1,{message:"请输入目标状态"}),duration:Is.number().optional(),sequential:Is.boolean().optional()})}),...Gl.slice(1).map((e=>Is.object({directive:Is.literal(e),params:Is.object({targetName:Is.string({message:"请选择动画对象"}),duration:Is.number().optional(),sequential:Is.boolean().optional()})}))),Is.object({directive:Is.literal(pr.Wait),params:Is.object({duration:Is.number().optional(),sequential:Is.boolean().optional()})}),Is.object({directive:Is.literal(pr.Play),params:Is.object({targetName:Is.string({message:"请选择音频对象"}),start:Is.number().optional(),volume:Is.number().optional(),loop:Is.boolean().optional(),untilEnd:Is.boolean().optional(),sequential:Is.boolean().optional()})}),...[pr.Pause,pr.Stop].map((e=>Is.object({directive:Is.literal(e),params:Is.object({targetName:Is.string({message:"请选择音频对象"}),sequential:Is.boolean().optional()})}))),Is.object({directive:Is.literal(pr.AddFilter),params:Is.object({targetName:Is.string({message:"请选择滤镜对象"}),filterName:Is.string({message:"请选择滤镜"}),sequential:Is.boolean().optional()})}),Is.object({directive:Is.literal(pr.RemoveFilter),params:Is.object({targetName:Is.string({message:"请选择滤镜对象"}),sequential:Is.boolean().optional()})}),Is.object({directive:Is.literal(pr.FadeInTransition),params:Is.object({duration:Is.number().optional(),sequential:Is.boolean().optional()})})]);function sc({editingDirective:e,directiveType:t,onSubmitDirective:a,onCancel:s}){const n=na({resolver:oa(ac),defaultValues:{directive:void 0,params:{}}}),o=Ys({control:n.control,name:"directive"}),l=i.useRef(null),c=i.useRef(null),d=i.useRef(null),m=i.useRef(null),h=i.useRef(null),p=i.useMemo((()=>zl.find((e=>e.type===t))),[t]);return i.useEffect((()=>{e?n.reset(e.value,{keepDefaultValues:!0}):n.reset()}),[e,n.reset,n]),r.jsx(Wn,{...n,children:r.jsxs("form",{onSubmit:n.handleSubmit((function(e){let t="";l.current?t=l.current.getDirectiveLabel():c.current?t=c.current.getDirectiveLabel():d.current?t=d.current.getDirectiveLabel():m.current?t=m.current.getDirectiveLabel():h.current&&(t=h.current.getDirectiveLabel()),a({...e,label:t})})),className:"space-y-2 flex flex-col h-full",children:[r.jsx(Vn,{control:n.control,name:"directive",render:({field:e})=>r.jsxs(zn,{className:"space-y-1",children:[r.jsx(Tn,{children:p?.name}),r.jsx(Kn,{children:r.jsxs(ko,{onValueChange:e.onChange,value:e.value,children:[r.jsx(Go,{className:"h-8",children:r.jsx(Zo,{placeholder:"请选择指令"})}),r.jsx(Xo,{children:p?.options.map((e=>r.jsx(Ro,{value:e.value,children:e.name},e.value)))})]})})]})}),Gl.includes(o)&&r.jsx(_l,{form:n,ref:l}),Vl.includes(o)&&r.jsx(ql,{form:n,ref:c}),Wl.includes(o)&&r.jsx($l,{form:n,ref:d}),Rl.includes(o)&&r.jsx(ec,{form:n,ref:m}),o===pr.FadeInTransition&&r.jsx(tc,{form:n,ref:h}),o&&o!==pr.Wait&&r.jsx(Vn,{control:n.control,name:"params.sequential",render:({field:e})=>r.jsxs(zn,{className:"space-y-0 flex flex-row items-center !mb-4",children:[r.jsx(Tn,{className:"flex flex-col w-[4rem]",children:"串行执行"}),r.jsx(Kn,{children:r.jsx(Hl,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(Yn,{})]})}),r.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[r.jsx(Mn,{size:"sm",type:"submit",children:"确定"}),r.jsx(Mn,{size:"sm",type:"button",onClick:s,variant:"outline",children:"取消"})]})]})})}const ic={middleware:[Js(12),Ps({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function rc(){const e=Os({preventDefaultOnEnterKeydown:!0}),{useOption:t}=Ss(kl),a=t("editingDirective"),s=t("directiveType"),{ref:i,props:n,onSubmit:o,onCancel:l}=Il({floatingOptions:ic,triggerFloatingLinkHotkeys:"mod+k"});return r.jsx(Es,{children:r.jsx("div",{className:ts(Al(),"w-auto p-1"),...n,ref:i,children:r.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...e,children:s&&r.jsx(sc,{editingDirective:a,directiveType:s,onSubmitDirective:o,onCancel:l})})})})}function nc({value:e,onChange:t,onFocus:a,children:s}){const n=Qs({plugins:[Ms,kl.extend({render:{afterEditable:()=>r.jsx(rc,{})}}),As],override:{components:Ol({[kl.key]:Ql,[Ms.key]:Ao})},value:e.lines}),o=i.useRef(!1);return i.useEffect((()=>{n.children!==e.lines&&(o.current=!0,n.tf.setValue(e.lines))}),[e.lines,n]),r.jsx(_s,{editor:n,onValueChange:({value:a})=>{o.current?o.current=!1:t({...e,lines:a})},children:r.jsxs("div",{className:"relative rounded-md border bg-background border-border",onFocus:()=>{a(e)},children:[r.jsx(pl,{children:r.jsx(Pl,{speak:e.speak,onChangeSpeak:a=>{t({...e,speak:a})},children:s})}),r.jsx(qo,{focusRing:!1,variant:"ghost",size:"sm"})]})})}const oc=ls,lc=cs,cc=ds,dc=i.forwardRef((({className:e,sideOffset:a=4,...s},i)=>r.jsx(os,{ref:i,sideOffset:a,className:t("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})));function mc(){const e=kr((e=>e.editor)),t=kr((e=>e.project)),a=kr((e=>e.activeScene)),[s,n]=i.useState(!1),o=i.useRef(null),l=(t,a)=>{if(e.activeScene){const{speaker:t,targetName:s}=e.activeScene.config.speak||{};if(t){const s=e.activeScene.getChildByName(t.targetName);s&&(s.text=a.speak.speaker.name)}if(a.lines.length>0){const t=e.activeScene.getChildByName(s);let i="";a.lines.forEach((e=>{if("p"===e.type)for(let t=0;t<e.children.length;t++){const a=e.children[t];if(!a.type){let s=a.text;t===e.children.length-1&&(s+="\n"),i+=s}}})),i&&t&&(t.text=i)}}},c=(t,a)=>{e.swapDialogue(t,a)},d=()=>{setTimeout((()=>{o.current&&o.current.scrollToBottom()}),100)};return r.jsx(Zr,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:r.jsx(Gr,{className:"h-full p-1 md:p-2",children:a?r.jsxs(r.Fragment,{children:[r.jsx(Wr,{className:"w-full h-full pr-2",ref:o,children:r.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsxs(Cn,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[r.jsx("span",{children:"场景名称"}),r.jsxs("div",{className:"flex items-center",children:[r.jsxs(Lo,{children:[r.jsx(zo,{asChild:!0,children:r.jsx(Mn,{size:"sm",variant:"ghost",children:r.jsx(Vr.settings,{className:"size-4"})})}),r.jsx(To,{children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("h3",{className:"text-base font-bold",children:"场景设置"}),r.jsx(Ul,{speak:a.config.speak,onChangeSpeak:t=>{e.updateActiveScene((e=>{e.config.speak=t}))},disableCustomName:!0}),r.jsxs("div",{className:"flex mt-2",children:[r.jsx("span",{className:"text-sm font-medium w-[8rem]",children:"自动展示背景"}),r.jsx(Hl,{checked:a.config.autoShowBackground,onCheckedChange:t=>{e.updateActiveScene((e=>{e.config.autoShowBackground=t}))}})]})]})})]}),r.jsx(oc,{children:r.jsxs(lc,{children:[r.jsx(cc,{asChild:!0,children:r.jsx(Mn,{size:"sm",variant:"ghost",onClick:()=>n(!0),children:r.jsx(Vr.bookmark,{className:"size-4"})})}),r.jsx(dc,{children:r.jsx("p",{children:"保存为模版"})})]})})]})]}),r.jsx(Fn,{type:"text",id:"sceneName",placeholder:"请输入场景名称",value:a.label,onChange:t=>{return a=t.target.value,void e.updateActiveScene((e=>{e.label=a}));var a}})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[r.jsx(Cn,{children:"场景对白"}),a.dialogues.map(((t,s)=>r.jsx("div",{children:r.jsx(nc,{value:t,onChange:t=>((t,a)=>{e.updateDialogue(t,a),l(0,a)})(s,t),onFocus:e=>l(0,e),children:r.jsxs(Rr,{children:[r.jsx(Lr,{children:r.jsx(Vr.more,{className:"size-4 cursor-pointer mx-1"})}),r.jsxs(Yr,{children:[r.jsx(Fr,{onClick:()=>((t,a)=>{e.addDialogue({speak:e.cloneDialogueSpeak(a.speak),lines:[]},t)})(s+1,t),children:"插入"}),r.jsx(Fr,{onClick:()=>((t,a)=>{const s=e.cloneDialogue(t);e.addDialogue(s,a)})(t,s+1),children:"复制"}),r.jsx(Fr,{className:"text-destructive",onClick:()=>{e.removeDialogue(t)},children:"删除"}),r.jsx(Hr,{}),s>0&&r.jsx(Fr,{onClick:()=>c(s,s-1),children:"上移"}),s<a.dialogues.length-1&&r.jsx(Fr,{onClick:()=>c(s,s+1),children:"下移"})]})]})})},s)))]}),r.jsx(Mn,{className:"mt-2",onClick:()=>(t=>{const{config:s}=a;e.addDialogue({speak:e.cloneDialogueSpeak(s.speak),lines:[]},t),d()})(),children:"新增对白"})]})}),r.jsx(Dn,{isOpen:s,onClose:()=>n(!1),sceneName:a.name})]}):r.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:t?"请先创建场景":"请先创建或打开作品"})})})}function hc({url:e,className:a}){const[s,n]=i.useState(!1),o=i.useRef(null);return r.jsxs("div",{className:t("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",a),children:[r.jsx("audio",{ref:o,src:e,className:"hidden"}),r.jsx(Mn,{onClick:e=>{e.stopPropagation(),o.current&&(s?o.current.pause():o.current.play(),n(!s))},variant:"outline",size:"icon",className:"w-12 h-12",children:s?r.jsx(qs,{className:"h-6 w-6"}):r.jsx($s,{className:"h-6 w-6"})})]})}function pc({url:e,className:a}){return r.jsx("div",{className:t("w-full h-full cursor-pointer flex justify-center items-center relative",a),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:e&&r.jsx("img",{src:e,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function uc({fontName:e,fontUrl:a,className:s}){const n=i.useMemo((()=>e||(a?`font-${Date.now()}`:void 0)),[e,a]);return i.useEffect((()=>{if(e)return;const t=document.createElement("style");return t.innerHTML=`\n      @font-face {\n        font-family: '${n}';\n        src: url('${a}');\n      }\n    `,document.head.appendChild(t),()=>{e||document.head.removeChild(t)}}),[n,e,a]),r.jsxs("div",{className:t("w-full aspect-[1/1] flex flex-col justify-center items-center relative",s),style:{fontFamily:n},children:[r.jsx("span",{children:"示例文字"}),r.jsx("span",{children:"Sample Text"}),r.jsx("span",{children:"0123456789"})]})}dc.displayName=os.displayName;const xc={[Ar.Background]:"240px",[Ar.Character]:"135px",[Ar.Thing]:"200px",[Ar.Dialog]:"240px",[Ar.Audio]:"150px",[Ar.Font]:"150px"},fc={[Ar.Background]:"aspect-[16/9]",[Ar.Character]:"aspect-[9/16]",[Ar.Thing]:"aspect-[1/1]",[Ar.Dialog]:"aspect-[16/3]"};function bc({type:e,url:t,state:a}){const s=i.useMemo((()=>t||(a?rn(a):"")),[t,a]);return Object.keys(fc).includes(e)?r.jsx(pc,{url:s,className:fc[e]}):e===Ar.Audio?r.jsx(hc,{url:s}):e===Ar.Font?r.jsx(uc,{fontName:a?.name,fontUrl:s}):null}function gc({type:e,state:t,children:a,onSelect:s}){return r.jsx(Zr,{className:"rounded-md cursor-pointer",style:{width:xc[e]},onClick:s,children:a||r.jsxs(r.Fragment,{children:[r.jsx(Gr,{className:"p-2 flex justify-center",children:r.jsx(bc,{type:e,state:t})}),r.jsx(Cr,{className:"font-medium p-2 pt-0 flex justify-center text-sm",children:t.name})]})})}function vc({asset:e,onSelect:t,onEdit:a,onDelete:s}){return r.jsxs(Zr,{className:"rounded-md",children:[r.jsx(Gr,{className:"p-0 flex justify-center cursor-pointer",onClick:t,children:r.jsx(Vr.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),r.jsxs(Cr,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[r.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:t,children:e.name}),r.jsxs(Rr,{children:[r.jsx(Lr,{children:r.jsx(Vr.more,{className:"w-4 h-4 pointer"})}),r.jsxs(Yr,{children:[r.jsx(Fr,{onClick:a,children:"编辑"}),r.jsx(Fr,{className:"text-destructive",onClick:s,children:"删除"})]})]})]})]})}function wc({type:e,url:a,className:s,onChange:n}){const[o,l]=i.useState(null),c=i.useMemo((()=>o||a||""),[a,o]),d=i.useMemo((()=>{switch(e){case Ar.Background:case Ar.Character:case Ar.Thing:case Ar.Dialog:return".webp, .png, .jpg";case Ar.Audio:return".mp3, .wav, .m4a, .aac";default:return""}}),[e]),m=i.useRef(null);return i.useEffect((()=>()=>{o&&URL.revokeObjectURL(o)}),[o]),r.jsxs("div",{className:t("flex cursor-pointer group relative",s),onClick:()=>{m.current?.click()},children:[r.jsx("input",{type:"file",ref:m,onChange:e=>{o&&URL.revokeObjectURL(o);const t=e.target.files?.[0]||null;l(URL.createObjectURL(t)),n(t)},className:"hidden",accept:d}),r.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[r.jsx(ei,{className:"size-4"}),r.jsx("div",{children:"选择文件"})]}),r.jsx(bc,{url:c,type:e})]})}const yc=$t("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),jc=i.forwardRef((({className:e,variant:a,...s},i)=>r.jsx("div",{ref:i,role:"alert",className:t(yc({variant:a}),e),...s})));jc.displayName="Alert",i.forwardRef((({className:e,...a},s)=>r.jsx("h5",{ref:s,className:t("mb-1 font-medium leading-none tracking-tight",e),...a}))).displayName="AlertTitle";const Nc=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("text-sm [&_p]:leading-relaxed",e),...a})));Nc.displayName="AlertDescription";const kc=Is.object({id:Is.number().optional(),name:Is.string().min(1,{message:"名称必填"}),type:Is.string().min(1,{message:"类型必选"}),states:Is.array(Is.object({id:Is.number().optional(),name:Is.string().min(1,{message:"状态名称必填"}),ext:Is.string().optional(),file:Is.instanceof(File).optional()}).refine((e=>e.id||e.file),{message:"状态文件必选"})).min(1,{message:"至少需要一个状态"})});function Sc({asset:e,onSubmit:t,onCancel:a}){const s=i.useMemo((()=>qr[e.type]),[e.type]),n=na({resolver:oa(kc),defaultValues:{name:"",type:"",states:[]}}),{fields:o,append:l,remove:c}=ti({control:n.control,name:"states",keyName:"_id"});return i.useEffect((()=>{n.reset({id:e.id,name:e.name,type:e.type,states:e.states})}),[e,n]),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-base font-bold mb-2",children:[e.id?"编辑":"新增",s,r.jsx(jc,{className:"p-2 mt-1",children:r.jsxs(Nc,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[r.jsx(Vr.tip,{className:"size-4"}),[Ar.Background,Ar.Character,Ar.Thing,Ar.Dialog].includes(e.type)&&r.jsx("span",{children:"画布的尺寸为1920*1080"}),e.type===Ar.Audio&&r.jsx("span",{children:"音频采样率建议>=44100Hz"}),e.type===Ar.Font&&r.jsx("span",{children:"请使用woff/woff2/ttf字体格式"})]})})]}),r.jsx(Wn,{...n,children:r.jsxs("form",{onSubmit:n.handleSubmit((e=>{t(e)})),className:"space-y-4",children:[r.jsx(Vn,{control:n.control,name:"name",render:({field:e})=>r.jsxs(zn,{children:[r.jsxs(Tn,{children:[s,"名"]}),r.jsx(Kn,{children:r.jsx(Fn,{placeholder:`请输入${s}名`,...e})}),r.jsx(Yn,{})]})}),r.jsxs(zn,{children:[r.jsxs(Tn,{className:"flex items-center",children:[s,"状态",r.jsxs(Mn,{size:"sm",variant:"outline",onClick:()=>l({name:""}),className:"ml-2",children:[r.jsx(Vr.squarePlus,{className:"size-4 mr-1"}),"新增状态"]})]}),r.jsx(Kn,{children:r.jsx("div",{children:o.length>0&&r.jsxs(Wr,{className:"w-full whitespace-nowrap rounded-md border",children:[r.jsx("div",{className:"flex w-full gap-2 p-2",children:o.map(((t,a)=>r.jsx(gc,{type:e.type,state:t,children:r.jsxs(r.Fragment,{children:[r.jsx(Gr,{className:"p-2 flex justify-center",children:r.jsx(wc,{className:"w-full h-full",type:e.type,url:t.id&&rn(t),onChange:e=>((e,t)=>{n.setValue(`states.${t}.file`,e),n.getValues(`states.${t}.name`)||n.setValue(`states.${t}.name`,hi(e).name)})(e,a)})}),r.jsx(Cr,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:r.jsxs("div",{className:"flex w-full justify-between",children:[r.jsx(Vn,{control:n.control,name:`states.${a}.name`,render:({field:e})=>r.jsx(zn,{children:r.jsx(Kn,{children:r.jsx(Fn,{className:"h-6 text-sm",placeholder:"请输入状态名",...e})})})}),r.jsx(Vr.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>c(a)})]})})]})},a)))}),r.jsx(Xr,{orientation:"horizontal"})]})})}),r.jsx(Yn,{})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(Mn,{type:"submit",children:"确定"}),r.jsx(Mn,{type:"button",className:"mr-2",variant:"outline",onClick:a,children:"取消"})]})]})})]})}function Zc({asset:e,onEdit:t,onSelectState:a,onCancel:s}){return r.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[r.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["选择默认状态",r.jsx(Mn,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>t(e),children:r.jsx(Vr.edit,{className:"size-4"})}),r.jsx(Mn,{variant:"outline",size:"sm",onClick:s,children:"返回列表"})]}),r.jsx(Wr,{className:"flex-1",children:r.jsx("div",{className:"flex gap-2 flex-wrap",children:e.states?.map((t=>r.jsx(gc,{type:e.type,state:t,onSelect:()=>a(t)},t.id)))})})]})}function Gc(){const e=Sr((e=>e.isOpen)),t=Sr((e=>e.confirm)),a=Sr((e=>e.cancel)),s=Sr((e=>e.disableSelect)),n=Sr((e=>e.type)),[o,l]=i.useState(n),[c,d]=i.useState(null),[m,h]=i.useState(null),p=Xt((()=>o?en.where("type").equals(o).reverse().toArray():[]),[o]),u=e=>{l(e)},x=()=>{d({name:"",type:o,states:[]})},f=e=>{d(e)},b=async e=>{if(e.id){if(await(async e=>{for(const t of e.states){if(t.file){t.id&&await tn.delete(t.id);const a=hi(t.file).ext,s=await tn.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,e.type===Ar.Font&&Qr(t.name,rn(t))}delete t.file}await en.update(e.id,e)})(e),m){const t=await en.get(e.id);h(t)}}else await(async e=>{for(const t of e.states){const a=hi(t.file).ext,s=await tn.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,delete t.file,e.type===Ar.Font&&Qr(t.name,rn(t))}await en.add(e)})(e);d(null)},g=()=>{d(null)},v=e=>{s||(t({...m,stateId:e.id}),h(null))},w=()=>{h(null)};return i.useEffect((()=>{l(n||Ar.Character)}),[n]),r.jsx(vn,{open:e,onOpenChange:()=>{a(),d(null),h(null)},children:r.jsxs(jn,{className:"min-w-[90vw] h-[90vh] flex flex-col",children:[r.jsxs(Nn,{children:[r.jsx(Sn,{children:"素材库"}),r.jsx(Zn,{})]}),c?r.jsx(Sc,{asset:c,onSubmit:b,onCancel:g}):m?r.jsx(Zc,{asset:m,onEdit:e=>f(e),onSelectState:v,onCancel:w}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(Jo,{value:o,onValueChange:u,children:r.jsx(Po,{children:_r.map((e=>r.jsx(Eo,{value:e.value,disabled:n&&n!==e.value,children:e.name},e.value)))})}),r.jsxs(Mn,{size:"sm",onClick:x,children:[r.jsx(Vr.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),"新增"]})]}),r.jsx(Wr,{className:"flex-grow",children:r.jsx("div",{className:"flex gap-2 flex-wrap",children:p?.map((e=>r.jsx(vc,{asset:e,onSelect:()=>h(e),onEdit:()=>f(e),onDelete:()=>(e=>{e.states.forEach((e=>{tn.delete(e.id)})),en.delete(e.id)})(e)},e.id)))})})]})]})})}const Cc=li,Wc=i.forwardRef((({className:e,...a},s)=>r.jsx(ai,{ref:s,className:t("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...a})));Wc.displayName=ai.displayName;const Xc=$t("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Vc=i.forwardRef((({className:e,variant:a,...s},i)=>r.jsx(si,{ref:i,className:t(Xc({variant:a}),e),...s})));Vc.displayName=si.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(ii,{ref:s,className:t("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...a}))).displayName=ii.displayName;const Rc=i.forwardRef((({className:e,...a},s)=>r.jsx(ri,{ref:s,className:t("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...a,children:r.jsx(Et,{className:"h-4 w-4"})})));Rc.displayName=ri.displayName;const Lc=i.forwardRef((({className:e,...a},s)=>r.jsx(ni,{ref:s,className:t("text-sm font-semibold [&+div]:text-xs",e),...a})));Lc.displayName=ni.displayName;const zc=i.forwardRef((({className:e,...a},s)=>r.jsx(oi,{ref:s,className:t("text-sm opacity-90",e),...a})));function Tc(){const{toasts:e}=ro();return r.jsxs(Cc,{children:[e.map((function({id:e,title:t,description:a,action:s,...i}){return r.jsxs(Vc,{...i,children:[r.jsxs("div",{className:"grid gap-1",children:[t&&r.jsx(Lc,{children:t}),a&&r.jsx(zc,{children:a})]}),s,r.jsx(Rc,{})]},e)})),r.jsx(Wc,{})]})}function Kc(){const[e,t]=i.useState(!1),a=function(e){const[t,a]=i.useState(window.matchMedia(e).matches);return i.useEffect((()=>{const s=window.matchMedia(e);s.matches!==t&&a(s.matches);const i=()=>a(s.matches);return s.addEventListener("change",i),()=>s.removeEventListener("change",i)}),[t,e]),t}("(min-width: 768px)");return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"h-screen flex flex-col",children:[r.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center gap-1 border-b bg-background px-4",children:[r.jsx("h1",{className:"text-xl font-semibold",children:"V N V E"}),r.jsx(Vr.gitHub,{className:"ml-auto size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]}),r.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[r.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:a&&r.jsx(mc,{})}),r.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[r.jsx(wo,{}),r.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[r.jsx(Qo,{}),r.jsx(cn,{onOpenSceneDetailDialog:()=>{t(!0)}})]})]})]})]}),!a&&r.jsx(vn,{open:e,onOpenChange:e=>t(e),children:r.jsxs(jn,{className:"size-full p-0 flex flex-col",children:[r.jsxs(Nn,{className:"mb-2",children:[r.jsx(Sn,{}),r.jsx(Zn,{})]}),r.jsx("div",{className:"h-[calc(100vh-2rem)]",children:r.jsx(mc,{})})]})}),r.jsx(Gc,{}),r.jsx(Tc,{})]})}zc.displayName=oi.displayName;const Ic=ci([{path:"/",element:r.jsx(Kc,{})}]);function Yc(){return r.jsx(di,{router:Ic})}window.onbeforeunload=function(){return"确认离开？"},async function(){try{0===await tn.count()&&await async function(){for(const e of nn){const{type:t,assets:a}=e;for(const e of a){const{name:a,states:s}=e,i=await en.add({name:a,type:t,states:[]});for(const e of s){const{name:t,url:a}=e,s=a.split(".").pop(),r=await fetch(a),n=await r.blob(),o=r.headers.get("Content-Type")||"",l=await tn.add({mime:o,ext:s,blob:n});await en.where("id").equals(i).modify((e=>{e.states.push({id:l,name:t,ext:s})}))}}}}()}catch(e){console.error("导入预设资源失败",e)}}(),async function(){const e=await en.where("type").equals("Font").toArray();for(const t of e)for(const e of t.states)await Qr(e.name,rn(e))}();const Fc=document.getElementById("root");mi.createRoot(Fc).render(r.jsx(Yc,{}))}}}));
