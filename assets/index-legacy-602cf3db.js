System.register(["./vendor-legacy-7a686071.js"],(function(e,t){"use strict";var a,s,i,r,n,o,l,c,d,h,m,p,u,x,f,g,b,v,w,y,j,k,N,S,Z,C,G,W,X,V,T,R,L,z,I,F,K,Y,H,M,U,D,B,P,J,E,O,A,Q,_,$,q,ee,te,ae,se,ie,re,ne,oe,le,ce,de,he,me,pe,ue,xe,fe,ge,be,ve,we,ye,je,ke,Ne,Se,Ze,Ce,Ge,We,Xe,Ve,Te,Re,Le,ze,Ie,Fe,Ke,Ye,He,Me,Ue,De,Be,Pe,Je,Ee,Oe,Ae,Qe,_e,$e,qe,et,tt,at,st,it,rt,nt,ot,lt,ct,dt,ht,mt,pt,ut,xt,ft,gt,bt,vt,wt,yt,jt,kt,Nt,St,Zt,Ct,Gt,Wt,Xt,Vt,Tt,Rt,Lt,zt,It,Ft,Kt,Yt,Ht,Mt,Ut,Dt,Bt,Pt,Jt,Et,Ot,At,Qt,_t,$t,qt,ea,ta,aa,sa,ia,ra,na,oa,la,ca,da,ha,ma,pa,ua,xa,fa,ga,ba,va,wa,ya,ja,ka,Na,Sa,Za,Ca,Ga,Wa,Xa,Va,Ta,Ra,La,za,Ia,Fa,Ka,Ya,Ha,Ma,Ua,Da,Ba,Pa,Ja,Ea,Oa,Aa,Qa,_a,$a,qa,es,ts,as,ss,is,rs,ns,os,ls,cs,ds,hs,ms,ps,us,xs,fs,gs,bs,vs,ws,ys,js,ks,Ns,Ss,Zs,Cs,Gs,Ws,Xs,Vs,Ts,Rs,Ls,zs,Is,Fs,Ks,Ys,Hs,Ms,Us,Ds,Bs,Ps,Js,Es,Os,As,Qs,_s,$s,qs,ei,ti,ai,si,ii,ri,ni,oi,li,ci,di,hi,mi,pi,ui,xi,fi,gi;return{setters:[e=>{a=e.t,s=e.c,i=e.r,r=e.j,n=e.n,o=e.l,l=e.C,c=e.B,d=e.N,h=e.a,m=e.T,p=e.G,u=e.b,x=e.R,f=e.F,g=e.L,b=e.d,v=e.E,w=e.e,y=e.f,j=e.g,k=e.S,N=e.A,S=e.h,Z=e.p,C=e.i,G=e.k,W=e.U,X=e.M,V=e.m,T=e.o,R=e.q,L=e.s,z=e.P,I=e.u,F=e.v,K=e.w,Y=e.x,H=e.y,M=e.z,U=e.D,D=e.V,B=e.H,P=e.I,J=e.J,E=e.K,O=e.O,A=e.Q,Q=e.W,_=e.X,$=e.Y,q=e.Z,ee=e._,te=e.$,ae=e.a0,se=e.a1,ie=e.a2,re=e.a3,ne=e.a4,oe=e.a5,le=e.a6,ce=e.a7,de=e.a8,he=e.a9,me=e.aa,pe=e.ab,ue=e.ac,xe=e.ad,fe=e.ae,ge=e.af,be=e.ag,ve=e.ah,we=e.ai,ye=e.aj,je=e.ak,ke=e.al,Ne=e.am,Se=e.an,Ze=e.ao,Ce=e.ap,Ge=e.aq,We=e.ar,Xe=e.as,Ve=e.at,Te=e.au,Re=e.av,Le=e.aw,ze=e.ax,Ie=e.ay,Fe=e.az,Ke=e.aA,Ye=e.aB,He=e.aC,Me=e.aD,Ue=e.aE,De=e.aF,Be=e.aG,Pe=e.aH,Je=e.aI,Ee=e.aJ,Oe=e.aK,Ae=e.aL,Qe=e.aM,_e=e.aN,$e=e.aO,qe=e.aP,et=e.aQ,tt=e.aR,at=e.aS,st=e.aT,it=e.aU,rt=e.aV,nt=e.aW,ot=e.aX,lt=e.aY,ct=e.aZ,dt=e.a_,ht=e.a$,mt=e.b0,pt=e.b1,ut=e.b2,xt=e.b3,ft=e.b4,gt=e.b5,bt=e.b6,vt=e.b7,wt=e.b8,yt=e.b9,jt=e.ba,kt=e.bb,Nt=e.bc,St=e.bd,Zt=e.be,Ct=e.bf,Gt=e.bg,Wt=e.bh,Xt=e.bi,Vt=e.bj,Tt=e.bk,Rt=e.bl,Lt=e.bm,zt=e.bn,It=e.bo,Ft=e.bp,Kt=e.bq,Yt=e.br,Ht=e.bs,Mt=e.bt,Ut=e.bu,Dt=e.bv,Bt=e.bw,Pt=e.bx,Jt=e.by,Et=e.bz,Ot=e.bA,At=e.bB,Qt=e.bC,_t=e.bD,$t=e.bE,qt=e.bF,ea=e.bG,ta=e.bH,aa=e.bI,sa=e.bJ,ia=e.bK,ra=e.bL,na=e.bM,oa=e.bN,la=e.bO,ca=e.bP,da=e.bQ,ha=e.bR,ma=e.bS,pa=e.bT,ua=e.bU,xa=e.bV,fa=e.bW,ga=e.bX,ba=e.bY,va=e.bZ,wa=e.b_,ya=e.b$,ja=e.c0,ka=e.c1,Na=e.c2,Sa=e.c3,Za=e.c4,Ca=e.c5,Ga=e.c6,Wa=e.c7,Xa=e.c8,Va=e.c9,Ta=e.ca,Ra=e.cb,La=e.cc,za=e.cd,Ia=e.ce,Fa=e.cf,Ka=e.cg,Ya=e.ch,Ha=e.ci,Ma=e.cj,Ua=e.ck,Da=e.cl,Ba=e.cm,Pa=e.cn,Ja=e.co,Ea=e.cp,Oa=e.cq,Aa=e.cr,Qa=e.cs,_a=e.ct,$a=e.cu,qa=e.cv,es=e.cw,ts=e.cx,as=e.cy,ss=e.cz,is=e.cA,rs=e.cB,ns=e.cC,os=e.cD,ls=e.cE,cs=e.cF,ds=e.cG,hs=e.cH,ms=e.cI,ps=e.cJ,us=e.cK,xs=e.cL,fs=e.cM,gs=e.cN,bs=e.cO,vs=e.cP,ws=e.cQ,ys=e.cR,js=e.cS,ks=e.cT,Ns=e.cU,Ss=e.cV,Zs=e.cW,Cs=e.cX,Gs=e.cY,Ws=e.cZ,Xs=e.c_,Vs=e.c$,Ts=e.d0,Rs=e.d1,Ls=e.d2,zs=e.d3,Is=e.d4,Fs=e.d5,Ks=e.d6,Ys=e.d7,Hs=e.d8,Ms=e.d9,Us=e.da,Ds=e.db,Bs=e.dc,Ps=e.dd,Js=e.de,Es=e.df,Os=e.dg,As=e.dh,Qs=e.di,_s=e.dj,$s=e.dk,qs=e.dl,ei=e.dm,ti=e.dn,ai=e.dp,si=e.dq,ii=e.dr,ri=e.ds,ni=e.dt,oi=e.du,li=e.dv,ci=e.dw,di=e.dx,hi=e.dy,mi=e.dz,pi=e.dA,ui=e.dB,xi=e.dC,fi=e.dD,gi=e.dE}],execute:function(){var e=document.createElement("style");function t(...e){return a(s(e))}function bi(e,t,a="mp4"){const s=document.createElement("a");s.setAttribute("download",`${e}.${a}`),s.setAttribute("href",t),document.body.appendChild(s),s.click(),document.body.removeChild(s)}function vi(e){const t=e.name.split(".").pop()||"";return{name:e.name.substring(0,e.name.lastIndexOf(".")),ext:t}}function wi({accept:e="*",multiple:t=!1}={}){return new Promise(((a,s)=>{let i=document.createElement("input");i.type="file",i.accept=e,i.multiple=t,i.style.display="none",i.addEventListener("change",(e=>{const t=Array.from(e.target.files||[]);t.length>0?a(t):s(new Error("No files selected")),document.body.removeChild(i),i=null})),i.addEventListener("error",(()=>{s(new Error("Error selecting files")),document.body.removeChild(i)})),i.addEventListener("cancel",(()=>{s(new Error("File deselected!")),document.body.removeChild(i)})),document.body.appendChild(i),i.click()}))}e.textContent='*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}:root{--background: 0 0% 100%;--foreground: 222.2 84% 4.9%;--card: 0 0% 100%;--card-foreground: 222.2 84% 4.9%;--popover: 0 0% 100%;--popover-foreground: 222.2 84% 4.9%;--primary: 222.2 47.4% 11.2%;--primary-foreground: 210 40% 98%;--secondary: 210 40% 96.1%;--secondary-foreground: 222.2 47.4% 11.2%;--muted: 210 40% 96.1%;--muted-foreground: 215.4 16.3% 46.9%;--accent: 210 40% 96.1%;--accent-foreground: 222.2 47.4% 11.2%;--destructive: 0 84.2% 60.2%;--destructive-foreground: 210 40% 98%;--border: 214.3 31.8% 91.4%;--input: 214.3 31.8% 91.4%;--ring: 222.2 84% 4.9%;--radius: .5rem;--chart-1: 12 76% 61%;--chart-2: 173 58% 39%;--chart-3: 197 37% 24%;--chart-4: 43 74% 66%;--chart-5: 27 87% 67%}*{border-color:hsl(var(--border))}body{background-color:hsl(var(--background));color:hsl(var(--foreground))}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%;margin-right:auto;margin-left:auto;padding-right:2rem;padding-left:2rem}@media (min-width: 1400px){.container{max-width:1400px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\\!visible{visibility:visible!important}.visible{visibility:visible}.invisible{visibility:hidden}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}.inset-x-0{left:0;right:0}.inset-y-0{top:0;bottom:0}.-bottom-px{bottom:-1px}.-top-px{top:-1px}.bottom-0{bottom:0}.left-0{left:0}.left-2{left:.5rem}.left-\\[50\\%\\]{left:50%}.right-0{right:0}.right-1{right:.25rem}.right-2{right:.5rem}.right-4{right:1rem}.top-0{top:0}.top-1{top:.25rem}.top-4{top:1rem}.top-\\[50\\%\\]{top:50%}.z-10{z-index:10}.z-20{z-index:20}.z-40{z-index:40}.z-50{z-index:50}.z-\\[100\\]{z-index:100}.z-\\[500\\]{z-index:500}.m-0{margin:0}.m-1{margin:.25rem}.-mx-1{margin-left:-.25rem;margin-right:-.25rem}.mx-0\\.5{margin-left:.125rem;margin-right:.125rem}.mx-1{margin-left:.25rem;margin-right:.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.my-1\\.5{margin-top:.375rem;margin-bottom:.375rem}.\\!mb-4{margin-bottom:1rem!important}.\\!mt-auto{margin-top:auto!important}.-ml-1{margin-left:-.25rem}.-mr-3{margin-right:-.75rem}.mb-1{margin-bottom:.25rem}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.ml-0\\.5{margin-left:.125rem}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-auto{margin-left:auto}.mr-0{margin-right:0}.mr-0\\.5{margin-right:.125rem}.mr-1{margin-right:.25rem}.mr-2{margin-right:.5rem}.mr-auto{margin-right:auto}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-24{margin-top:6rem}.mt-4{margin-top:1rem}.mt-auto{margin-top:auto}.box-content{box-sizing:content-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.hidden{display:none}.aspect-\\[1\\/1\\]{aspect-ratio:1/1}.aspect-\\[16\\/3\\]{aspect-ratio:16/3}.aspect-\\[16\\/9\\]{aspect-ratio:16/9}.aspect-\\[9\\/16\\]{aspect-ratio:9/16}.\\!size-4{width:1rem!important;height:1rem!important}.size-10{width:2.5rem;height:2.5rem}.size-3\\.5{width:.875rem;height:.875rem}.size-4{width:1rem;height:1rem}.size-5{width:1.25rem;height:1.25rem}.size-6{width:1.5rem;height:1.5rem}.size-9{width:2.25rem;height:2.25rem}.size-full{width:100%;height:100%}.h-0\\.5{height:.125rem}.h-1\\.5{height:.375rem}.h-10{height:2.5rem}.h-11{height:2.75rem}.h-12{height:3rem}.h-2{height:.5rem}.h-2\\.5{height:.625rem}.h-3\\.5{height:.875rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-8{height:2rem}.h-9{height:2.25rem}.h-\\[1\\.3em\\]{height:1.3em}.h-\\[1\\.5em\\]{height:1.5em}.h-\\[120px\\]{height:120px}.h-\\[400px\\]{height:400px}.h-\\[50vh\\]{height:50vh}.h-\\[53px\\]{height:53px}.h-\\[90vh\\]{height:90vh}.h-\\[calc\\(100\\%-2\\.5rem\\)\\]{height:calc(100% - 2.5rem)}.h-\\[calc\\(100vh-53px-1rem\\)\\]{height:calc(100vh - 53px - 1rem)}.h-\\[var\\(--radix-select-trigger-height\\)\\]{height:var(--radix-select-trigger-height)}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-96{max-height:24rem}.max-h-\\[288px\\]{max-height:288px}.max-h-\\[50\\%\\]{max-height:50%}.max-h-\\[500px\\]{max-height:500px}.max-h-\\[80vh\\]{max-height:80vh}.max-h-screen{max-height:100vh}.min-h-\\[1lh\\]{min-height:1lh}.min-h-\\[60px\\]{min-height:60px}.min-h-\\[80px\\]{min-height:80px}.w-12{width:3rem}.w-2\\.5{width:.625rem}.w-3\\.5{width:.875rem}.w-3\\/4{width:75%}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-72{width:18rem}.w-9{width:2.25rem}.w-\\[100px\\]{width:100px}.w-\\[120px\\]{width:120px}.w-\\[200px\\]{width:200px}.w-\\[300px\\]{width:300px}.w-\\[330px\\]{width:330px}.w-\\[3rem\\]{width:3rem}.w-\\[4rem\\]{width:4rem}.w-\\[80px\\]{width:80px}.w-\\[8rem\\]{width:8rem}.w-auto{width:auto}.w-full{width:100%}.w-px{width:1px}.min-w-0{min-width:0px}.min-w-32{min-width:8rem}.min-w-\\[12rem\\]{min-width:12rem}.min-w-\\[180px\\]{min-width:180px}.min-w-\\[60vw\\]{min-width:60vw}.min-w-\\[80vw\\]{min-width:80vw}.min-w-\\[8rem\\]{min-width:8rem}.min-w-\\[90vw\\]{min-width:90vw}.min-w-\\[auto\\]{min-width:auto}.min-w-\\[var\\(--radix-select-trigger-width\\)\\]{min-width:var(--radix-select-trigger-width)}.max-w-\\[100px\\]{max-width:100px}.max-w-\\[150px\\]{max-width:150px}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.flex-grow,.grow{flex-grow:1}.caption-bottom{caption-side:bottom}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-\\[-50\\%\\]{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-\\[-50\\%\\]{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-default{cursor:default}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-text{cursor:text}.touch-none{touch-action:none}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-col-reverse{flex-direction:column-reverse}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0\\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.space-x-1>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.25rem * var(--tw-space-x-reverse));margin-left:calc(.25rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-4>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1rem * var(--tw-space-x-reverse));margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-0>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0px * var(--tw-space-y-reverse))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.self-center{align-self:center}.overflow-auto{overflow:auto}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.text-ellipsis{text-overflow:ellipsis}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.text-nowrap{text-wrap:nowrap}.break-words{overflow-wrap:break-word}.break-all{word-break:break-all}.rounded{border-radius:.25rem}.rounded-\\[inherit\\]{border-radius:inherit}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:var(--radius)}.rounded-md{border-radius:calc(var(--radius) - 2px)}.rounded-sm{border-radius:calc(var(--radius) - 4px)}.rounded-xl{border-radius:.75rem}.rounded-t-\\[10px\\]{border-top-left-radius:10px;border-top-right-radius:10px}.rounded-t-lg{border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}.border{border-width:1px}.border-0{border-width:0px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-none{border-style:none}.border-border{border-color:hsl(var(--border))}.border-destructive{border-color:hsl(var(--destructive))}.border-destructive\\/50{border-color:hsl(var(--destructive) / .5)}.border-input{border-color:hsl(var(--input))}.border-primary\\/50{border-color:hsl(var(--primary) / .5)}.border-transparent{border-color:transparent}.border-b-border{border-bottom-color:hsl(var(--border))}.border-l-transparent{border-left-color:transparent}.border-t-border{border-top-color:hsl(var(--border))}.border-t-transparent{border-top-color:transparent}.bg-background{background-color:hsl(var(--background))}.bg-background\\/95{background-color:hsl(var(--background) / .95)}.bg-black\\/80{background-color:rgba(0,0,0,.8)}.bg-border{background-color:hsl(var(--border))}.bg-card{background-color:hsl(var(--card))}.bg-destructive{background-color:hsl(var(--destructive))}.bg-muted{background-color:hsl(var(--muted))}.bg-muted\\/50{background-color:hsl(var(--muted) / .5)}.bg-muted\\/80{background-color:hsl(var(--muted) / .8)}.bg-popover{background-color:hsl(var(--popover))}.bg-primary{background-color:hsl(var(--primary))}.bg-primary\\/20{background-color:hsl(var(--primary) / .2)}.bg-ring{background-color:hsl(var(--ring))}.bg-secondary{background-color:hsl(var(--secondary))}.bg-transparent{background-color:transparent}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.fill-current{fill:currentColor}.object-contain{-o-object-fit:contain;object-fit:contain}.p-0{padding:0}.p-1{padding:.25rem}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-\\[1px\\]{padding:1px}.px-0{padding-left:0;padding-right:0}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-5{padding-left:1.25rem;padding-right:1.25rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.pb-0{padding-bottom:0}.pb-1{padding-bottom:.25rem}.pl-2{padding-left:.5rem}.pl-3{padding-left:.75rem}.pl-8{padding-left:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pr-6{padding-right:1.5rem}.pr-8{padding-right:2rem}.pt-0{padding-top:0}.pt-2{padding-top:.5rem}.pt-\\[2px\\]{padding-top:2px}.pt-\\[3px\\]{padding-top:3px}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.align-baseline{vertical-align:baseline}.align-middle{vertical-align:middle}.text-2xl{font-size:1.5rem;line-height:2rem}.text-\\[0\\.8rem\\]{font-size:.8rem}.text-\\[1\\.1em\\]{font-size:1.1em}.text-\\[1\\.25em\\]{font-size:1.25em}.text-\\[1\\.5em\\]{font-size:1.5em}.text-\\[1\\.875em\\]{font-size:1.875em}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.italic{font-style:italic}.leading-none{line-height:1}.tracking-tight{letter-spacing:-.025em}.tracking-widest{letter-spacing:.1em}.text-blue-500{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity))}.text-card-foreground{color:hsl(var(--card-foreground))}.text-destructive{color:hsl(var(--destructive))}.text-destructive-foreground{color:hsl(var(--destructive-foreground))}.text-foreground{color:hsl(var(--foreground))}.text-foreground\\/50{color:hsl(var(--foreground) / .5)}.text-muted-foreground{color:hsl(var(--muted-foreground))}.text-muted-foreground\\/50{color:hsl(var(--muted-foreground) / .5)}.text-neutral-600{--tw-text-opacity: 1;color:rgb(82 82 82 / var(--tw-text-opacity))}.text-popover-foreground{color:hsl(var(--popover-foreground))}.text-primary{color:hsl(var(--primary))}.text-primary-foreground{color:hsl(var(--primary-foreground))}.text-primary\\/60{color:hsl(var(--primary) / .6)}.text-secondary-foreground{color:hsl(var(--secondary-foreground))}.underline{text-decoration-line:underline}.decoration-primary{text-decoration-color:hsl(var(--primary))}.underline-offset-4{text-underline-offset:4px}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-70{opacity:.7}.opacity-90{opacity:.9}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-none{--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.ring-0{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-ring{--tw-ring-color: hsl(var(--ring))}.ring-offset-background{--tw-ring-offset-color: hsl(var(--background))}.\\!filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)!important}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur{--tw-backdrop-blur: blur(8px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-200{transition-duration:.2s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}@keyframes enter{0%{opacity:var(--tw-enter-opacity, 1);transform:translate3d(var(--tw-enter-translate-x, 0),var(--tw-enter-translate-y, 0),0) scale3d(var(--tw-enter-scale, 1),var(--tw-enter-scale, 1),var(--tw-enter-scale, 1)) rotate(var(--tw-enter-rotate, 0))}}@keyframes exit{to{opacity:var(--tw-exit-opacity, 1);transform:translate3d(var(--tw-exit-translate-x, 0),var(--tw-exit-translate-y, 0),0) scale3d(var(--tw-exit-scale, 1),var(--tw-exit-scale, 1),var(--tw-exit-scale, 1)) rotate(var(--tw-exit-rotate, 0))}}.animate-in{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.fade-in-0{--tw-enter-opacity: 0}.zoom-in-95{--tw-enter-scale: .95}.duration-200{animation-duration:.2s}.ease-in-out{animation-timing-function:cubic-bezier(.4,0,.2,1)}.file\\:border-0::file-selector-button{border-width:0px}.file\\:bg-background::file-selector-button{background-color:hsl(var(--background))}.file\\:bg-transparent::file-selector-button{background-color:transparent}.file\\:text-sm::file-selector-button{font-size:.875rem;line-height:1.25rem}.file\\:font-medium::file-selector-button{font-weight:500}.file\\:text-foreground::file-selector-button{color:hsl(var(--foreground))}.placeholder\\:text-muted-foreground::-moz-placeholder{color:hsl(var(--muted-foreground))}.placeholder\\:text-muted-foreground::placeholder{color:hsl(var(--muted-foreground))}.before\\:absolute:before{content:var(--tw-content);position:absolute}.before\\:cursor-text:before{content:var(--tw-content);cursor:text}.before\\:opacity-30:before{content:var(--tw-content);opacity:.3}.before\\:content-\\[attr\\(placeholder\\)\\]:before{--tw-content: attr(placeholder);content:var(--tw-content)}.focus-within\\:ring-2:focus-within{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.hover\\:bg-accent:hover{background-color:hsl(var(--accent))}.hover\\:bg-destructive\\/90:hover{background-color:hsl(var(--destructive) / .9)}.hover\\:bg-muted:hover{background-color:hsl(var(--muted))}.hover\\:bg-muted\\/50:hover{background-color:hsl(var(--muted) / .5)}.hover\\:bg-primary\\/90:hover{background-color:hsl(var(--primary) / .9)}.hover\\:bg-secondary:hover{background-color:hsl(var(--secondary))}.hover\\:bg-secondary\\/80:hover{background-color:hsl(var(--secondary) / .8)}.hover\\:bg-slate-100:hover{--tw-bg-opacity: 1;background-color:rgb(241 245 249 / var(--tw-bg-opacity))}.hover\\:text-accent-foreground:hover{color:hsl(var(--accent-foreground))}.hover\\:text-destructive:hover{color:hsl(var(--destructive))}.hover\\:text-foreground:hover{color:hsl(var(--foreground))}.hover\\:text-muted-foreground:hover{color:hsl(var(--muted-foreground))}.hover\\:underline:hover{text-decoration-line:underline}.hover\\:opacity-100:hover{opacity:1}.focus\\:bg-accent:focus{background-color:hsl(var(--accent))}.focus\\:text-accent-foreground:focus{color:hsl(var(--accent-foreground))}.focus\\:opacity-100:focus{opacity:1}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-1:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\\:ring-ring:focus{--tw-ring-color: hsl(var(--ring))}.focus\\:ring-offset-2:focus{--tw-ring-offset-width: 2px}.focus-visible\\:outline-none:focus-visible{outline:2px solid transparent;outline-offset:2px}.focus-visible\\:ring-1:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-2:focus-visible{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus-visible\\:ring-ring:focus-visible{--tw-ring-color: hsl(var(--ring))}.focus-visible\\:ring-transparent:focus-visible{--tw-ring-color: transparent}.focus-visible\\:ring-offset-2:focus-visible{--tw-ring-offset-width: 2px}.focus-visible\\:ring-offset-background:focus-visible{--tw-ring-offset-color: hsl(var(--background))}.disabled\\:pointer-events-none:disabled{pointer-events:none}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}.group:hover .group-hover\\:visible{visibility:visible}.group:hover .group-hover\\:opacity-100{opacity:1}.group.destructive .group-\\[\\.destructive\\]\\:border-muted\\/40{border-color:hsl(var(--muted) / .4)}.group.destructive .group-\\[\\.destructive\\]\\:text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:border-destructive\\/30:hover{border-color:hsl(var(--destructive) / .3)}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:bg-destructive:hover{background-color:hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-destructive-foreground:hover{color:hsl(var(--destructive-foreground))}.group.destructive .group-\\[\\.destructive\\]\\:hover\\:text-red-50:hover{--tw-text-opacity: 1;color:rgb(254 242 242 / var(--tw-text-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-destructive:focus{--tw-ring-color: hsl(var(--destructive))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-red-400:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(248 113 113 / var(--tw-ring-opacity))}.group.destructive .group-\\[\\.destructive\\]\\:focus\\:ring-offset-red-600:focus{--tw-ring-offset-color: #dc2626}.peer:disabled~.peer-disabled\\:cursor-not-allowed{cursor:not-allowed}.peer:disabled~.peer-disabled\\:opacity-70{opacity:.7}.aria-checked\\:bg-accent[aria-checked=true]{background-color:hsl(var(--accent))}.aria-checked\\:text-accent-foreground[aria-checked=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:pointer-events-none[data-disabled]{pointer-events:none}.data-\\[side\\=bottom\\]\\:translate-y-1[data-side=bottom]{--tw-translate-y: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=left\\]\\:-translate-x-1[data-side=left]{--tw-translate-x: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=right\\]\\:translate-x-1[data-side=right]{--tw-translate-x: .25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[side\\=top\\]\\:-translate-y-1[data-side=top]{--tw-translate-y: -.25rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=checked\\]\\:translate-x-4[data-state=checked]{--tw-translate-x: 1rem;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[state\\=unchecked\\]\\:translate-x-0[data-state=unchecked],.data-\\[swipe\\=cancel\\]\\:translate-x-0[data-swipe=cancel]{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=end\\]\\:translate-x-\\[var\\(--radix-toast-swipe-end-x\\)\\][data-swipe=end]{--tw-translate-x: var(--radix-toast-swipe-end-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[swipe\\=move\\]\\:translate-x-\\[var\\(--radix-toast-swipe-move-x\\)\\][data-swipe=move]{--tw-translate-x: var(--radix-toast-swipe-move-x);transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.data-\\[active-item\\=true\\]\\:bg-accent[data-active-item=true]{background-color:hsl(var(--accent))}.data-\\[state\\=active\\]\\:bg-background[data-state=active]{background-color:hsl(var(--background))}.data-\\[state\\=checked\\]\\:bg-accent[data-state=checked]{background-color:hsl(var(--accent))}.data-\\[state\\=checked\\]\\:bg-primary[data-state=checked]{background-color:hsl(var(--primary))}.data-\\[state\\=on\\]\\:bg-accent[data-state=on],.data-\\[state\\=open\\]\\:bg-accent[data-state=open]{background-color:hsl(var(--accent))}.data-\\[state\\=open\\]\\:bg-secondary[data-state=open]{background-color:hsl(var(--secondary))}.data-\\[state\\=selected\\]\\:bg-muted[data-state=selected]{background-color:hsl(var(--muted))}.data-\\[state\\=unchecked\\]\\:bg-input[data-state=unchecked]{background-color:hsl(var(--input))}.data-\\[active-item\\=true\\]\\:text-accent-foreground[data-active-item=true]{color:hsl(var(--accent-foreground))}.data-\\[disabled\\]\\:text-gray-400[data-disabled]{--tw-text-opacity: 1;color:rgb(156 163 175 / var(--tw-text-opacity))}.data-\\[state\\=active\\]\\:text-foreground[data-state=active]{color:hsl(var(--foreground))}.data-\\[state\\=checked\\]\\:text-accent-foreground[data-state=checked],.data-\\[state\\=on\\]\\:text-accent-foreground[data-state=on],.data-\\[state\\=open\\]\\:text-accent-foreground[data-state=open]{color:hsl(var(--accent-foreground))}.data-\\[state\\=open\\]\\:text-muted-foreground[data-state=open]{color:hsl(var(--muted-foreground))}.data-\\[disabled\\]\\:opacity-50[data-disabled]{opacity:.5}.data-\\[state\\=active\\]\\:shadow[data-state=active]{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.data-\\[swipe\\=move\\]\\:transition-none[data-swipe=move]{transition-property:none}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{transition-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{transition-duration:.5s}.data-\\[state\\=open\\]\\:animate-in[data-state=open]{animation-name:enter;animation-duration:.15s;--tw-enter-opacity: initial;--tw-enter-scale: initial;--tw-enter-rotate: initial;--tw-enter-translate-x: initial;--tw-enter-translate-y: initial}.data-\\[state\\=closed\\]\\:animate-out[data-state=closed],.data-\\[swipe\\=end\\]\\:animate-out[data-swipe=end]{animation-name:exit;animation-duration:.15s;--tw-exit-opacity: initial;--tw-exit-scale: initial;--tw-exit-rotate: initial;--tw-exit-translate-x: initial;--tw-exit-translate-y: initial}.data-\\[state\\=closed\\]\\:fade-out-0[data-state=closed]{--tw-exit-opacity: 0}.data-\\[state\\=closed\\]\\:fade-out-80[data-state=closed]{--tw-exit-opacity: .8}.data-\\[state\\=open\\]\\:fade-in-0[data-state=open]{--tw-enter-opacity: 0}.data-\\[state\\=closed\\]\\:zoom-out-95[data-state=closed]{--tw-exit-scale: .95}.data-\\[state\\=open\\]\\:zoom-in-95[data-state=open]{--tw-enter-scale: .95}.data-\\[side\\=bottom\\]\\:slide-in-from-top-2[data-side=bottom]{--tw-enter-translate-y: -.5rem}.data-\\[side\\=left\\]\\:slide-in-from-right-2[data-side=left]{--tw-enter-translate-x: .5rem}.data-\\[side\\=right\\]\\:slide-in-from-left-2[data-side=right]{--tw-enter-translate-x: -.5rem}.data-\\[side\\=top\\]\\:slide-in-from-bottom-2[data-side=top]{--tw-enter-translate-y: .5rem}.data-\\[state\\=closed\\]\\:slide-out-to-bottom[data-state=closed]{--tw-exit-translate-y: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-left[data-state=closed]{--tw-exit-translate-x: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-left-1\\/2[data-state=closed]{--tw-exit-translate-x: -50%}.data-\\[state\\=closed\\]\\:slide-out-to-right[data-state=closed],.data-\\[state\\=closed\\]\\:slide-out-to-right-full[data-state=closed]{--tw-exit-translate-x: 100%}.data-\\[state\\=closed\\]\\:slide-out-to-top[data-state=closed]{--tw-exit-translate-y: -100%}.data-\\[state\\=closed\\]\\:slide-out-to-top-\\[48\\%\\][data-state=closed]{--tw-exit-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-bottom[data-state=open]{--tw-enter-translate-y: 100%}.data-\\[state\\=open\\]\\:slide-in-from-left[data-state=open]{--tw-enter-translate-x: -100%}.data-\\[state\\=open\\]\\:slide-in-from-left-1\\/2[data-state=open]{--tw-enter-translate-x: -50%}.data-\\[state\\=open\\]\\:slide-in-from-right[data-state=open]{--tw-enter-translate-x: 100%}.data-\\[state\\=open\\]\\:slide-in-from-top[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=open\\]\\:slide-in-from-top-\\[48\\%\\][data-state=open]{--tw-enter-translate-y: -48%}.data-\\[state\\=open\\]\\:slide-in-from-top-full[data-state=open]{--tw-enter-translate-y: -100%}.data-\\[state\\=closed\\]\\:duration-300[data-state=closed]{animation-duration:.3s}.data-\\[state\\=open\\]\\:duration-500[data-state=open]{animation-duration:.5s}.dark\\:border-destructive:is(.dark *){border-color:hsl(var(--destructive))}@media (min-width: 640px){.sm\\:bottom-0{bottom:0}.sm\\:right-0{right:0}.sm\\:top-auto{top:auto}.sm\\:mt-0{margin-top:0}.sm\\:max-h-full{max-height:100%}.sm\\:max-w-sm{max-width:24rem}.sm\\:flex-row{flex-direction:row}.sm\\:flex-col{flex-direction:column}.sm\\:justify-end{justify-content:flex-end}.sm\\:space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.5rem * var(--tw-space-x-reverse));margin-left:calc(.5rem * calc(1 - var(--tw-space-x-reverse)))}.sm\\:rounded-lg{border-radius:var(--radius)}.sm\\:px-3{padding-left:.75rem;padding-right:.75rem}.sm\\:text-left{text-align:left}.data-\\[state\\=open\\]\\:sm\\:slide-in-from-bottom-full[data-state=open]{--tw-enter-translate-y: 100%}}@media (min-width: 768px){.md\\:mr-0\\.5{margin-right:.125rem}.md\\:flex{display:flex}.md\\:hidden{display:none}.md\\:h-\\[30vh\\]{height:30vh}.md\\:w-\\[130px\\]{width:130px}.md\\:max-w-\\[420px\\]{max-width:420px}.md\\:grid-cols-\\[minmax\\(450px\\,1fr\\)_2fr\\]{grid-template-columns:minmax(450px,1fr) 2fr}.md\\:border{border-width:1px}.md\\:p-2{padding:.5rem}.md\\:shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}}@media (min-width: 1024px){.lg\\:inline{display:inline}.lg\\:min-w-\\[130px\\]{min-width:130px}}@media print{.print\\:hidden{display:none}}.\\[\\&\\+div\\]\\:text-xs+div{font-size:.75rem;line-height:1rem}.\\[\\&\\:has\\(\\[role\\=checkbox\\]\\)\\]\\:pr-0:has([role=checkbox]){padding-right:0}.\\[\\&\\>\\[role\\=checkbox\\]\\]\\:translate-y-\\[2px\\]>[role=checkbox]{--tw-translate-y: 2px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>span\\]\\:line-clamp-1>span{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.\\[\\&\\>svg\\+div\\]\\:translate-y-\\[-3px\\]>svg+div{--tw-translate-y: -3px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.\\[\\&\\>svg\\]\\:absolute>svg{position:absolute}.\\[\\&\\>svg\\]\\:left-4>svg{left:1rem}.\\[\\&\\>svg\\]\\:top-4>svg{top:1rem}.\\[\\&\\>svg\\]\\:text-destructive>svg{color:hsl(var(--destructive))}.\\[\\&\\>svg\\]\\:text-foreground>svg{color:hsl(var(--foreground))}.\\[\\&\\>svg\\~\\*\\]\\:pl-7>svg~*{padding-left:1.75rem}.\\[\\&\\>tr\\]\\:last\\:border-b-0:last-child>tr{border-bottom-width:0px}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:top-\\[auto_\\!important\\] [data-slate-placeholder]{top:auto!important}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:text-muted-foreground [data-slate-placeholder]{color:hsl(var(--muted-foreground))}.\\[\\&_\\[data-slate-placeholder\\]\\]\\:\\!opacity-100 [data-slate-placeholder]{opacity:1!important}.\\[\\&_p\\]\\:leading-relaxed p{line-height:1.625}.\\[\\&_strong\\]\\:font-bold strong{font-weight:700}.\\[\\&_svg\\:not\\(\\[data-icon\\]\\)\\]\\:size-5 svg:not([data-icon]){width:1.25rem;height:1.25rem}.\\[\\&_svg\\]\\:pointer-events-none svg{pointer-events:none}.\\[\\&_svg\\]\\:size-4 svg{width:1rem;height:1rem}.\\[\\&_svg\\]\\:shrink-0 svg{flex-shrink:0}.\\[\\&_tr\\:last-child\\]\\:border-0 tr:last-child{border-width:0px}.\\[\\&_tr\\]\\:border-b tr{border-bottom-width:1px}\n',document.head.appendChild(e);const yi=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{className:"relative w-full overflow-auto",children:r.jsx("table",{ref:s,className:t("w-full caption-bottom text-sm",e),...a})})));yi.displayName="Table";const ji=i.forwardRef((({className:e,...a},s)=>r.jsx("thead",{ref:s,className:t("[&_tr]:border-b",e),...a})));ji.displayName="TableHeader";const ki=i.forwardRef((({className:e,...a},s)=>r.jsx("tbody",{ref:s,className:t("[&_tr:last-child]:border-0",e),...a})));ki.displayName="TableBody",i.forwardRef((({className:e,...a},s)=>r.jsx("tfoot",{ref:s,className:t("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...a}))).displayName="TableFooter";const Ni=i.forwardRef((({className:e,...a},s)=>r.jsx("tr",{ref:s,className:t("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...a})));Ni.displayName="TableRow";const Si=i.forwardRef((({className:e,...a},s)=>r.jsx("th",{ref:s,className:t("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));Si.displayName="TableHead";const Zi=i.forwardRef((({className:e,...a},s)=>r.jsx("td",{ref:s,className:t("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...a})));async function Ci(e,t,a,s){const i=e.sampleRate,r=e.numberOfChannels,n=Math.floor(t*i),o=i*a,l=new OfflineAudioContext(r,o,i);let c=l.createBuffer(r,o,i);const d=new Float32Array(o);for(let h=0;h<e.numberOfChannels;h++)e.copyFromChannel(d,h,n),c.copyToChannel(d,h);if(void 0!==s){const e=l.createBufferSource();e.buffer=c;const t=l.createGain();t.gain.value=s,e.connect(t),t.connect(l.destination),e.start(),c=await l.startRendering()}return c}async function Gi(e){const t=await(await fetch(e)).arrayBuffer(),a=await async function(e,t=44100){return new Promise(((a,s)=>{const i=new AudioContext({sampleRate:t});i.decodeAudioData(e,a,s).finally((()=>{i.close()}))}))}(t);return a}Zi.displayName="TableCell",i.forwardRef((({className:e,...a},s)=>r.jsx("caption",{ref:s,className:t("mt-4 text-sm text-muted-foreground",e),...a}))).displayName="TableCaption";const Wi={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},Xi={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};function Vi(){return n(8)}async function Ti(e,t){if(!t)return[];const a=[];for(const s of t){const t=await Ri(e,s);a.push(t)}return a}async function Ri(e,t){const a=e[t.__type];return await a.fromJSON(t)}function Li(e,t,a=!1){a&&(t.name=e.name),t.label=e.label}function zi(e){return{__type:e.type,label:e.label,name:e.name}}function Ii(e,t){t.label=e.label,t.name=e.name}o.setLevel("ERROR");class Fi extends l{label="";name=Vi();type="BlackMaskFilter";constructor(){super(),this.blackAndWhite(!0),this.brightness(0,!0)}clone(e=!1){const t=new Fi;return Li(this,t,e),t}toJSON(){return zi(this)}static fromJSON(e){const t=new Fi;return Ii(e,t),t}}class Ki extends c{label="";name=Vi();type="BlurFilter";clone(e=!1){const t=new Ki;return Li(this,t,e),t}toJSON(){return zi(this)}static fromJSON(e){const t=new Ki;return Ii(e,t),t}}class Yi extends d{label="";name=Vi();type="NoiseFilter";clone(e=!1){const t=new Yi;return Li(this,t,e),t}toJSON(){return zi(this)}static fromJSON(e){const t=new Yi;return Ii(e,t),t}}class Hi extends h{label="";name=Vi();type="OldFilmFilter";clone(e=!1){const t=new Hi;return Li(this,t,e),t}toJSON(){return zi(this)}static fromJSON(e){const t=new Hi;return Ii(e,t),t}}class Mi extends h{label="";name=Vi();type="VignetteFilter";constructor(){super(),this.sepia=0,this.noise=0,this.vignetting=.5}clone(e=!1){const t=new Mi;return Li(this,t,e),t}toJSON(){return zi(this)}static fromJSON(e){const t=new Mi;return Ii(e,t),t}}const Ui={BlackMaskFilter:Fi,BlurFilter:Ki,NoiseFilter:Yi,OldFilmFilter:Hi,VignetteFilter:Mi};function Di(e){return Ti(Ui,e)}function Bi(e,t,a=!1,s=!1){a&&(t.name=e.name),t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,t.setTransform(...Oi(e)),s||(t.width=e.width,t.height=e.height),t.filters=e.filters?.map((e=>e.clone(a)))||null}function Pi(e,t=!1){let a={__type:e.type,name:e.name,label:e.label,type:e.type,visible:e.visible,alpha:e.alpha,zIndex:e.zIndex,transform:Oi(e),filters:e.filters?.map((e=>e.toJSON()))||null};return t||(a={...a,width:e.width,height:e.height}),a}async function Ji(e,t,a=!1){t.name=e.name,t.label=e.label,t.type=e.type,t.visible=e.visible,t.alpha=e.alpha,t.zIndex=e.zIndex,t.setTransform(...e.transform),a||("number"==typeof e.width&&(t.width=e.width),"number"==typeof e.height&&(t.height=e.height)),t.filters=await Di(e.filters)}function Ei(e){return e.width===e.texture.width&&e.height===e.texture.height&&1===e.width&&1===e.height}function Oi(e){return[e.x,e.y,e.scale.x,e.scale.y,e.rotation,e.skew.x,e.skew.y,e.pivot.x,e.pivot.y]}class Ai extends m{name=Vi();label="";type="Text";disableTextEdit=!1;async load(){}clone(e=!1){const t=new Ai(this.text,this.style.clone());return Bi(this,t,e,!0),t.disableTextEdit=this.disableTextEdit,t}toJSON(){return{...Pi(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(e){const t=new Ai(e.text,e.style);return await Ji(e,t,!0),t.disableTextEdit=e.disableTextEdit,t}}class Qi extends p{name=Vi();label="";type="Graphics";fillColor="";async load(){}clone(e=!1){const t=new Qi(super.clone().geometry);return Bi(this,t,e),t.fillColor=this.fillColor,t}toJSON(){return{...Pi(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map((e=>[e.shape,{...e.fillStyle,texture:void 0},{...e.lineStyle,texture:void 0}]))}}static async fromJSON(e){const t=new u;t.graphicsData=e.graphicsData.map((e=>{const t=new x;t.x=e[0].x,t.y=e[0].y,t.width=e[0].width,t.height=e[0].height;const a=new f;a.alpha=e[1].alpha,a.color=e[1].color,a.visible=e[1].visible;const s=new g;return s.color=e[2].color,s.alpha=e[2].alpha,s.visible=e[2].visible,s.width=e[2].width,s.alignment=e[2].alignment,s.native=e[2].native,s.cap=e[2].cap,s.join=e[2].join,s.miterLimit=e[2].miterLimit,new b(t,a,s)}));const a=new Qi(t);return await Ji(e,a),a.fillColor=e.fillColor,a}}const _i={extension:v.Asset,detection:{test:async()=>!0,add:async e=>[...e],remove:async e=>e.filter((t=>e.includes(t)))},loader:{extension:{type:[v.LoadParser],priority:w.High},test:e=>e.startsWith("blob:"),load:async e=>y.from(e)}};j.add(_i);class $i extends k{name;label;type;source;assetID;assetType;constructor(e){super(),this.name=Vi(),this.label="",this.type="Sprite",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}async load(){this.source&&(this.texture=await N.load(this.source))}clone(e=!1){const t=new $i({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,Bi(this,t,e,Ei(this)),t}toJSON(){return{...Pi(this,Ei(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new $i({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await Ji(e,t),t}}class qi extends k{name;label;type;source;assetID;assetType;static defaultOptions={source:"",scaleMode:S.LINEAR,fps:30,loop:!0,animationSpeed:1,autoPlay:!0,autoUpdate:!0,onComplete:null,onFrameChange:null,onLoop:null};animationSpeed=1;loop=!0;onComplete;onFrameChange;onLoop;duration=0;autoPlay=!0;_frames;_context;dirty=!1;_currentFrame=0;_autoUpdate=!1;_isConnectedToTicker=!1;_playing=!1;_currentTime=0;static fromBuffer(e,t){if(!e||0===e.byteLength)throw new Error("Invalid buffer");const a=Z(e);(e=>{let t=null;for(const a of e.frames)t=a.gce??t,"image"in a&&!("gce"in a)&&(a.gce=t)})(a);const s=C(a,!0),i=[],r=document.createElement("canvas"),n=r.getContext("2d",{willReadFrequently:!0}),o=document.createElement("canvas"),l=o.getContext("2d");r.width=a.lsd.width,r.height=a.lsd.height;let c=0,d=null;const{fps:h}=Object.assign({},qi.defaultOptions,t),m=1e3/h;for(let x=0;x<s.length;x++){const{disposalType:e=2,delay:t=m,patch:a,dims:{width:h,height:p,left:u,top:f}}=s[x];o.width=h,o.height=p,l.clearRect(0,0,h,p);const g=l.createImageData(h,p);g.data.set(a),l.putImageData(g,0,0),3===e&&(d=n.getImageData(0,0,r.width,r.height)),n.drawImage(o,u,f);const b=n.getImageData(0,0,r.width,r.height);2===e?n.clearRect(0,0,r.width,r.height):3===e&&n.putImageData(d,0,0),i.push({start:c,end:c+t,imageData:b}),c+=t}r.width=r.height=0,o.width=o.height=0;const{width:p,height:u}=a.lsd;return{frames:i,width:p,height:u}}constructor(e){super(y.EMPTY),this.name=Vi(),this.label="",this.type="AnimatedGIF",this.source=e.source,this.assetID=0,this.assetType="",this._frames=[],this._context=null}async load(){const e=await fetch(this.source).then((e=>e.arrayBuffer())),{frames:t,width:a,height:s}=qi.fromBuffer(e),i=document.createElement("canvas"),r=i.getContext("2d");i.width=a,i.height=s;const{source:n,scaleMode:o,...l}=qi.defaultOptions;this.texture=y.from(i,{scaleMode:o}),this.duration=t[t.length-1].end,this._frames=t,this._context=r,this._playing=!1,this._currentTime=0,this._isConnectedToTicker=!1,Object.assign(this,l),this.dirty=!0,this.currentFrame=0}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(G.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(G.shared.add(this.update,this,W.HIGH),this._isConnectedToTicker=!0),this.loop||this.currentFrame!==this._frames.length-1||(this._currentTime=0))}get progress(){return this._currentTime/this.duration}get playing(){return this._playing}update(e){if(!this._playing)return;const t=1e3*G.shared.time,a=t%this.duration,s=this._frames.findIndex((e=>e.start<=a&&e.end>a));t>=this.duration?this.loop?(this._currentTime=a,this.updateFrameIndex(s),this.onLoop?.()):(this._currentTime=this.duration,this.updateFrameIndex(this._frames.length-1),this.onComplete?.(),this.stop()):(this._currentTime=a,this.updateFrameIndex(s))}updateFrame(){if(!this.dirty)return;const{imageData:e}=this._frames[this._currentFrame];this._context.putImageData(e,0,0),this._context.fillStyle="transparent",this._context.fillRect(0,0,0,1),this.texture.update(),this.dirty=!1}_render(e){this.updateFrame(),super._render(e)}_renderCanvas(e){this.updateFrame(),super._renderCanvas(e)}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(G.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(G.shared.add(this.update,this),this._isConnectedToTicker=!0))}get currentFrame(){return this._currentFrame}set currentFrame(e){this.updateFrameIndex(e),this._currentTime=this._frames[e].start}updateFrameIndex(e){if(e<0||e>=this._frames.length)throw new Error(`Frame index out of range, expecting 0 to ${this.totalFrames}, got ${e}`);this._currentFrame!==e&&(this._currentFrame=e,this.dirty=!0,this.onFrameChange?.(e))}get totalFrames(){return this._frames.length}destroy(){this.stop(),super.destroy(!0);const e=null;this._context=e,this._frames=e,this.onComplete=e,this.onFrameChange=e,this.onLoop=e}clone(e=!1){const t=new qi({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,Bi(this,t,e,Ei(this)),t}toJSON(){return{...Pi(this,Ei(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new qi({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await Ji(e,t),t}}var er=(e=>(e[e.AUDIO_STREAM_TYPE=0]="AUDIO_STREAM_TYPE",e[e.VIDEO_STREAM_TYPE=1]="VIDEO_STREAM_TYPE",e))(er||{});const{DataStream:tr}=X;function ar(...e){o.debug(...e)}class sr{fileUri;streamType;source;readySamples;_pending_read_resolver;audioTrack;videoTrack;constructor(e){this.fileUri=e}async initialize(e){this.source=new ir(this.fileUri),this.readySamples=[],this._pending_read_resolver=void 0,this.streamType=e;const t=await this._tracksReady();return 0==this.streamType?this._selectTrack(this.audioTrack):this._selectTrack(this.videoTrack),t}getDecoderConfig(){return 0==this.streamType?{codec:this.audioTrack.codec,sampleRate:this.audioTrack.audio.sample_rate,numberOfChannels:this.audioTrack.audio.channel_count,description:this.source.getAudioSpecificConfig()}:{codec:this.videoTrack.codec.startsWith("vp08")?"vp8":this.videoTrack.codec,displayWidth:this.videoTrack.track_width,displayHeight:this.videoTrack.track_height,description:this._getDescription(this.source.getDescriptionBox())}}async getNextChunk(){let e=await this._readSample();const t=e.is_sync?"key":"delta",a=1e6*e.cts/e.timescale,s=1e6*e.duration/e.timescale;return new(0==this.streamType?EncodedAudioChunk:EncodedVideoChunk)({type:t,timestamp:a,duration:s,data:e.data})}_getDescription(e){const t=new tr(void 0,0,tr.BIG_ENDIAN);return e.write(t),new Uint8Array(t.buffer,8)}async _tracksReady(){let e=await this.source.getInfo();return this.videoTrack=e.videoTracks[0],this.audioTrack=e.audioTracks[0],{video:this.videoTrack,audio:this.audioTrack}}_selectTrack(e){this.source.selectTrack(e)}async _readSample(){if(this.readySamples.length)return Promise.resolve(this.readySamples.shift());let e=new Promise((e=>{this._pending_read_resolver=e}));return this.source.start(this._onSamples.bind(this)),e}_onSamples(e){this.readySamples.push(...e),this.readySamples.length>=50&&this.source.stop();let t=1e6*e[0].cts/e[0].timescale;ar(`adding new ${e.length} samples (first = ${t}). total = ${this.readySamples.length}`),this._pending_read_resolver&&(this._pending_read_resolver(this.readySamples.shift()),this._pending_read_resolver=void 0)}destroy(){this.readySamples=[],this.source.close()}}class ir{file;_onSamples;info;_info_resolver;constructor(e){this.file=X.createFile(),this.file.onError=console.error.bind(console),this.file.onReady=this.onReady.bind(this),this.file.onSamples=this.onSamples.bind(this),ar("fetching file"),fetch(e).then((e=>{ar("fetch responded");const t=e.body.getReader();let a=0,s=this.file;return t.read().then((function e({done:i,value:r}){if(i)return void s.flush();let n=r.buffer;return n.fileStart=a,a+=n.byteLength,s.appendBuffer(n),t.read().then(e)}))})),this.info=void 0,this._info_resolver=void 0}onReady(e){this.info=e,this._info_resolver&&(this._info_resolver(e),this._info_resolver=void 0)}getInfo(){return this.info?Promise.resolve(this.info):new Promise((e=>{this._info_resolver=e}))}getDescriptionBox(){const e=this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0],t=e.avcC||e.hvcC||e.vpcC||e.av1C;if(!t)throw new Error("avcC, hvcC, vpcC, or av1C box not found!");return t}getAudioSpecificConfig(){try{return this.file.moov.traks[0].mdia.minf.stbl.stsd.entries[0].esds.esd.descs[0].descs[0].data}catch(e){return}}selectTrack(e){this.file.setExtractionOptions(e.id)}start(e){this._onSamples=e,this.file.start()}stop(){this.file.stop()}close(){this.file.flush()}onSamples(e,t,a){this._onSamples(a)}}function rr(...e){o.debug(...e)}class nr{width;height;duration;demuxer;frameBuffer;fillInProgress;canvasCtx;decoder;init_resolver;async initialize(e,t,{width:a,height:s}){this.frameBuffer=[],this.fillInProgress=!1,this.demuxer=new sr(e);const{video:i}=await this.demuxer.initialize(er.VIDEO_STREAM_TYPE),r=this.demuxer.getDecoderConfig();this.width=a>0?a:r.displayWidth,this.height=s>0?s:r.displayHeight,this.duration=i.duration/i.timescale,this.canvasCtx=t,this.canvasCtx.canvas.width=this.width,this.canvasCtx.canvas.height=this.height,this.decoder=new VideoDecoder({output:this.bufferFrame.bind(this),error:e=>console.error(e)});let n=await VideoDecoder.isConfigSupported(r);console.assert(n.supported),this.decoder.configure(r),this.init_resolver=void 0;let o=new Promise((e=>this.init_resolver=e));return this.fillFrameBuffer(),o}render(e){rr("render(%d)",e);let t=this.chooseFrame(e);if(this.fillFrameBuffer(),null!=t)return this.paint(t),t;console.warn("VideoRenderer.render(): no frame ")}chooseFrame(e){if(0==this.frameBuffer.length)return null;let t=Number.MAX_VALUE,a=-1;for(let i=0;i<this.frameBuffer.length;i++){let s=Math.abs(e-this.frameBuffer[i].timestamp);if(!(s<t))break;t=s,a=i}console.assert(-1!=a),a>0&&rr("dropping %d stale frames",a);for(let i=0;i<a;i++){let e=this.frameBuffer.shift();e&&e.close()}let s=this.frameBuffer[0];return rr("frame time delta = %dms (%d vs %d)",t/1e3,e,s.timestamp),s}async fillFrameBuffer(){if(this.frameBufferFull())return rr("frame buffer full"),void(this.init_resolver&&(this.init_resolver(!0),this.init_resolver=void 0));if(this.fillInProgress)return!1;for(this.fillInProgress=!0;this.frameBuffer.length<3&&this.decoder.decodeQueueSize<3;){let e=await this.demuxer.getNextChunk();this.decoder.decode(e)}this.fillInProgress=!1,setTimeout(this.fillFrameBuffer.bind(this),0)}frameBufferFull(){return this.frameBuffer.length>=3}bufferFrame(e){rr(`bufferFrame(${e.timestamp})`),this.frameBuffer.push(e)}paint(e){rr("paint(%d)",e.timestamp),this.canvasCtx.drawImage(e,0,0,this.width,this.height)}async destroy(){"closed"!=this.decoder.state&&(this.frameBuffer.forEach((e=>e.close())),await this.decoder.flush(),this.decoder.close()),this.demuxer.destroy()}}class or extends k{name;label;type;source;assetID;assetType;start;duration;offset;loop;volume;bufferDuration=0;options;videoRenderer;_isConnectedToTicker=!1;constructor(e){super(),this.options=e,this.name=Vi(),this.label="",this.type="Video",this.source=e.source,this.assetID=0,this.assetType="",this.width=this.options.width??0,this.height=this.options.height??0,this.start=e.start??0,this.duration=e.duration??0,this.offset=e.offset??0,this.loop=e.loop??!1,this.volume=e.volume??1}async load(){if(this.source){const e=this.source,t=document.createElement("canvas"),a=t.getContext("2d"),s=new nr;await s.initialize(e,a,{width:this.width,height:this.height}),this.width=s.width,this.height=s.height;const i=1e3*s.duration;this.duration=this.duration||i,this.bufferDuration=i,this.videoRenderer=s,this.texture=y.from(t),this.videoRenderer.render(0),this.texture.update()}}play(){this._isConnectedToTicker||(G.shared.add(this.update,this,W.HIGH),this._isConnectedToTicker=!0)}stop(){this._isConnectedToTicker&&(G.shared.remove(this.update,this),this._isConnectedToTicker=!1)}destroy(){this.stop(),super.destroy(!0),this.videoRenderer=void 0}async update(){const e=1e3*G.shared.time;this.videoRenderer?.render(1e3*e),this.texture.update()}clone(e=!1){const t=new or({source:this.source});return t.assetID=this.assetID,t.assetType=this.assetType,Bi(this,t,e,Ei(this)),t}toJSON(){return{...Pi(this,Ei(this)),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new or({source:e.source});return t.assetID=e.assetID,t.assetType=e.assetType,await Ji(e,t),t}}const lr={Text:Ai,Graphics:Qi,Sprite:$i,AnimatedGIF:qi,Video:or};class cr{name;label;type;source;assetID;assetType;buffer;constructor(e){this.name=Vi(),this.label="",this.type="Sound",this.source=e.source,this.assetID=0,this.assetType=""}changeSource(e){this.source=e}async load(){this.buffer=await Gi(this.source)}clone(e=!1){const t=new cr({source:this.source});return dr(this,t,e),t}toJSON(){const e={};return dr(this,e,!0),{__type:this.type,...e,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(e){const t=new cr({source:e.source});return dr(e,t,!0),t}destroy(){this.buffer=void 0}}function dr(e,t,a=!1){a&&(t.name=e.name),t.label=e.label,t.assetID=e.assetID,t.assetType=e.assetType}class hr extends V{name;label;config;dialogues;sounds;constructor(e){super(),this.name=Vi(),this.label=e?.label||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.sortableChildren=!0}getSoundByName(e){return this.sounds.find((t=>t.name===e))}addSound(e){this.sounds.push(e)}removeSound(e){this.sounds=this.sounds.filter((t=>t.name!==e.name||(e.destroy(),!1)))}addFilter(e){this.filters?this.filters.push(e):this.filters=[e]}removeFilter(e){this.filters&&(this.filters=this.filters.filter((t=>t!==e)))}addDialogue(e,t){void 0!==t?this.dialogues.splice(t,0,e):this.dialogues.push(e)}updateDialogue(e,t){this.dialogues[e]=t}removeDialogue(e){this.dialogues=this.dialogues.filter((t=>t!==e))}swapDialogue(e,t){[this.dialogues[e],this.dialogues[t]]=[this.dialogues[t],this.dialogues[e]]}getChildByLabel(e){return this.children.find((t=>t.label===e))}getChildrenByAssetType(e){return this.children.filter((t=>t.assetType===e))}clone(){const e=new hr;e.label=this.label,e.config=T(this.config),e.dialogues=T(this.dialogues);const t=this.children.map((e=>e.clone(!0)));return t.length>0&&e.addChild(...t),e.sounds=this.sounds.map((e=>e.clone(!0))),e.filters=this.filters?.map((e=>e.clone(!0)))||null,e}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(e,t=!0){const a=new hr;t&&(a.name=e.name),a.label=e.label,a.config=e.config,a.dialogues=e.dialogues;const s=await function(e){return Ti(lr,e)}(e.children);var i;return s.length>0&&a.addChild(...s),a.sounds=await(i=e.sounds,Ti({Sound:cr},i)),a.filters=await Di(e.filters),a}async load(){const e=async t=>{if("function"==typeof t.load&&await t.load(),t.children&&t.children.length>0)for(const a of t.children)await e(a)};for(const t of this.children)await e(t);for(const t of this.sounds)await t.load()}}const mr={version:"3.12.2",name:"text",init(e,t,a){"object"!=typeof t&&(t={value:t});let s=t.value;this.startText=a.vars?.startAt?.text?.value||"",this.target=e,this.startText&&(s=s.replace(this.startText,"")),s=s.split(""),this.from=a._from,this.text=s,this._props.push("text")},render(e,t){e>1?e=1:e<0&&(e=0),t.from&&(e=1-e);const{text:a,target:s,startText:i}=t,r=e*a.length+.5|0;s.text=i+a.slice(0,r).join("")}};class pr{options;stage;executeTime;currentTime;constructor(e,t){this.options=e,this.stage=t,this.executeTime=e.executeTime??0,this.currentTime=0}}class ur extends pr{target;constructor(e,t){super(e,t),this.options=e,this.target=this.stage.getChildByName(e.targetName,!0)}execute(){if(!this.target)return;const{fromVars:e,toVars:t}=this.options;this.target.visible=!0,"function"==typeof this.target.play&&this.target.play(),e&&t?R.fromTo(this.target,e,t):t&&R.to(this.target,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class xr extends pr{target;constructor(e,t){super(e,t),this.stage=t,this.target=this.stage.getSoundByName(e.targetName)}getDuration(){return 0}}class fr extends pr{constructor(e,t){super(e,t),this.options=e}execute(){const{fromVars:e,toVars:t}=this.options;e&&t?R.fromTo(this.stage,e,t):t&&R.to(this.stage,t)}getDuration(){return this.options.sequential?this.options.toVars?.duration??0:0}}class gr extends pr{target;constructor(e,t){super(e,t),this.options=e,this.stage=t,e.targetName&&(this.target=this.stage.getChildByName(e.targetName))}getDuration(){return 0}}class br extends ur{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{visible:!0},ease:"none",duration:0}},e)}}class vr extends ur{constructor(e,t){super(e,t),this.options=L({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:this.target.alpha??1},ease:"power1.in",duration:.5}},e)}}const wr="AutoMaskFilter",yr={Show:br,FadeIn:vr};class jr extends ur{speakerTarget;constructor(e,t){super(e,t),this.options=L({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},e);const{speakerTargetName:a}=this.options;a&&(this.speakerTarget=this.stage.getChildByName(a))}execute(){const{name:e,autoShowSpeaker:t,autoMaskOtherSpeakers:a,executeTime:s}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=e),t&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:e="Show"}=t;new(0,yr[e])({...t,executeTime:s,targetName:this.speakerTarget.name},this.stage).execute()}if(a){const{alpha:e=.5}=a;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach((t=>{t!==this.speakerTarget&&"Character"===t.assetType&&(this.checkMaskFilter(t)||this.addMaskFilter(t,e))}))}}checkMaskFilter(e){return e.filters?.some((e=>e.name===wr))}removeMaskFilter(e){e.filters=e.filters?.filter((e=>e.name!==wr))||[]}addMaskFilter(e,t){const a=new Fi;a.name=wr,a.alpha=t,e.filters?e.filters.push(a):e.filters=[a]}}const kr=new class{sliceTaskList=[];soundRecordMap=new Map;play(e,t){const a=this.soundRecordMap.get(e.name);if(a)L(a,{...t,paused:!1});else{const{start:a,volume:s,loop:i,untilEnd:r}=t;this.soundRecordMap.set(e.name,{sound:e,paused:!1,elapsedTime:0,start:a??0,volume:s??1,loop:i??!1,untilEnd:r??!1})}}pause(e){const t=this.soundRecordMap.get(e.name);t&&(t.paused=!0)}stop(e){this.soundRecordMap.delete(e.name)}update(e,t){for(const a of this.soundRecordMap.values()){const{sound:e,paused:s,elapsedTime:i,start:r,loop:n,volume:o}=a;if(!s&&e.buffer){let s=i;const l=e.buffer.duration;if(s>l-r){if(!n)continue;s%=l-r}const c=1/t,d=Ci(e.buffer,s+r,c,o);a.elapsedTime=i+c,this.sliceTaskList.push(d)}}}async getAudioBuffers(){const e=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],e}resetExceptUtilEnd(){for(const[e,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(e)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}};class Nr extends xr{constructor(e,t){super(e,t),this.options=e}execute(){kr.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}}function Sr(e,t){return t.some((([t,a])=>t<=e&&e<=a))}function Zr(e){return Sr(e.charCodeAt(0),[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function Cr(e){return" \n\r\t".includes(e)}function Gr(e,t={}){const{wordsPerMin:a=500}=t,s=e.total/a;return{seconds:parseFloat((60*s).toFixed(1))}}function Wr(e,t={}){const a=function(e,t){let a=0,s=0,i=e.length-1;const{wordBound:r=Cr}=t;for(;r(e[s]);)s++;for(;r(e[i]);)i--;const n=`${e}\n`;for(let o=s;o<=i;o++)if((Zr(n[o])||!r(n[o])&&(r(n[o+1])||Zr(n[o+1])))&&a++,Zr(n[o]))for(;o<=i&&(Sr(n[o+1].charCodeAt(0),[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])||r(n[o+1]));)o++;return{total:a}}(e,t);return{...Gr(a,t),words:a}}const Xr=Object.freeze(Object.defineProperty({__proto__:null,AddFilter:class extends gr{constructor(e,t){super(e,t),this.options=e}execute(){const{targetName:e,filterName:t}=this.options;e?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(e,t){const a=new Ui[t];e.filters?e.filters.push(a):e.filters=[a]}},AnimationDirective:ur,ChangeSource:class extends ur{constructor(e,t){super(e,t),this.options={...e,immediate:!0}}async execute(){const{source:e,immediate:t}=this.options;this.target.changeSource(e),t?await this.target.load():R.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then((()=>{R.to(this.target,{pixi:{alpha:1},duration:.3})}))}})}},Directive:pr,EnterFromLeft:class extends ur{constructor(e,t){super(e,t);const a=this.target;this.options=L({fromVars:{pixi:{x:a.x-a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e)}},EnterFromRight:class extends ur{constructor(e,t){super(e,t);const a=this.target;this.options=L({fromVars:{pixi:{x:a.x+a.width,alpha:0}},toVars:{pixi:{x:a.x??0,alpha:a.alpha??1},ease:"power1.in",duration:.5}},e)}},FadeIn:vr,FadeInTransition:class extends fr{constructor(e,t){super(e,t),this.options=L({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},e)}},FadeOut:class extends ur{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},e)}},FilterDirective:gr,Hide:class extends ur{constructor(e,t){super(e,t),this.options=L({toVars:{pixi:{visible:!1},ease:"none",duration:0}},e)}},LeaveFromLeft:class extends ur{constructor(e,t){super(e,t);const a=this.target;this.options=L({toVars:{pixi:{x:a.x-a.width,alpha:0},ease:"power1.in",duration:.5}},e)}},LeaveFromRight:class extends ur{constructor(e,t){super(e,t);const a=this.target;this.options=L({toVars:{pixi:{x:a.x+a.width,alpha:0},ease:"power1.in",duration:.5}},e)}},Pause:class extends xr{execute(){kr.pause(this.target)}},Play:class extends xr{constructor(e,t){super(e,t),this.options=e}execute(){kr.play(this.target,this.options)}getDuration(){return this.options.sequential?this.target.buffer?.duration??0:0}},RemoveFilter:class extends gr{execute(){const{targetName:e}=this.options;e?this.target&&(this.target.filters=[]):this.stage.filters=[]}},ShakeX:class extends ur{constructor(e,t){super(e,t);const a=this.target,s=a.width?.05*a.width:0,i=a.x,r=i-s,n=i+s;this.options=L({toVars:{keyframes:{"0%":{x:i},"15%":{x:r},"30%":{x:n},"45%":{x:r},"60%":{x:n},"75%":{x:r},"90%":{x:n},"100%":{x:i}},duration:.5,ease:"none"}},e)}},ShakeY:class extends ur{constructor(e,t){super(e,t);const a=this.target,s=a.height?.05*a.height:0,i=a.y,r=i-s,n=i+s;this.options=L({toVars:{keyframes:{"0%":{y:i},"15%":{y:r},"30%":{y:n},"45%":{y:r},"60%":{y:n},"75%":{y:r},"90%":{y:n},"100%":{y:i}},duration:.5,ease:"none"}},e)}},Show:br,SoundDirective:xr,Speak:class extends ur{speakerDirective;voiceDirective;constructor(e,t){super(e,t),this.options=L({interval:.2,sequential:!0,effect:"typewriter",alignWithVoice:!0},e);const{speaker:a,voice:s,executeTime:i}=this.options;a?.targetName&&(this.speakerDirective=new jr({...a,executeTime:i},t)),s?.targetName&&(this.voiceDirective=new Nr({...s,executeTime:i,sequential:!0},this.stage))}execute(){if(!this.target)return;const{text:e,append:t,effect:a}=this.options;let s="",i=e;switch(this.target.visible=!0,t&&(s=this.target.text,i=this.target.text+e),a){case"typewriter":this.typewriter(s,i);break;case"fadeIn":this.fadeIn(s,i);break;case"none":this.none(s,i)}this.speakerDirective?.execute(),this.voiceDirective?.execute()}typewriter(e,t){const{text:a,wordsPerMin:s}=this.options;R.fromTo(this.target,{text:{value:e}},{text:{value:t},duration:this.readingTime(a,s),ease:"none"})}fadeIn(e,t){R.fromTo(this.target,{pixi:{alpha:0},text:{value:e}},{pixi:{alpha:1},text:{value:t},duration:.5,ease:"none"})}none(e,t){this.target.text=t}getDuration(){const{sequential:e,text:t,wordsPerMin:a,interval:s,voiceDuration:i}=this.options;let r=this.readingTime(t,a);return i&&(r=Math.max(r,i)),e?r+(s??0):0}readingTime(e,t=500){return e?Wr(e,{wordsPerMin:t}).seconds:0}},Speaker:jr,Stop:class extends xr{execute(){kr.stop(this.target)}},TransitionDirective:fr,Voice:Nr,Wait:class extends pr{constructor(e,t){super(e,t),this.options=L({sequential:!0},e)}execute(){}getDuration(){return this.options.duration}},ZoomIn:class extends ur{constructor(e,t){super(e,t);const a=this.target,s=a.x,i=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=i+a.height*a.anchor.y,this.options=L({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},e)}},ZoomOut:class extends ur{constructor(e,t){super(e,t);const a=this.target,s=a.x,i=a.y;a.anchor.set(.5),a.x=s+a.width*a.anchor.x,a.y=i+a.height*a.anchor.y,this.options=L({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},e)}}},Symbol.toStringTag,{value:"Module"}));R.registerPlugin(z),R.registerPlugin(mr),z.registerPIXI(I),R.ticker.remove(R.updateRoot);var Vr=(e=>(e.ChangeSource="ChangeSource",e.Speak="Speak",e.Speaker="Speaker",e.Show="Show",e.Hide="Hide",e.FadeIn="FadeIn",e.FadeOut="FadeOut",e.ShakeX="ShakeX",e.ShakeY="ShakeY",e.ZoomIn="ZoomIn",e.ZoomOut="ZoomOut",e.EnterFromLeft="EnterFromLeft",e.LeaveFromLeft="LeaveFromLeft",e.EnterFromRight="EnterFromRight",e.LeaveFromRight="LeaveFromRight",e.Wait="Wait",e.Play="Play",e.Pause="Pause",e.Stop="Stop",e.FadeInTransition="FadeInTransition",e.AddFilter="AddFilter",e.RemoveFilter="RemoveFilter",e))(Vr||{});class Tr{static defaultRendererOptions={fps:30,width:1920,height:1080,background:0};ticker;renderer;rendererOptions;started;connecter;cutResolver;constructor(e){this.ticker=G.shared,this.ticker.ctx={},this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},Tr.defaultRendererOptions,e),this.started=!1;const{width:t,height:a,background:s}=this.rendererOptions;this.renderer=this.rendererOptions.renderer??F({view:new OffscreenCanvas(t,a),width:t,height:a,background:s})}connect(e){this.connecter=e,this.connecter.connect()}disconnect(){this.connecter?.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(e){if(this.started)return;const t=performance.now();R.updateRoot(0);try{const t=this.parseScreenplay(e);return this.registerUpdater(),await this.run(t)}finally{this.reset(),o.info("action cost:",performance.now()-t),this.cutResolver&&this.cutResolver(!0)}}cut(){return new Promise((e=>{this.started=!1,this.cutResolver=e}))}reset(){this.started=!1,kr.reset();let e=this.ticker._head.next;for(;e;)e=e.destroy(!0);this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}parseScreenplay(e){let t=0;const{scenes:a}=e;for(const s of a)t=this.parseSceneScript(s,t);return t}parseSceneScript(e,t){const{scene:a}=e,{directives:s}=e;let i=t;a.children.forEach((e=>{e.visible=!1})),this.ticker.add((()=>{const e=this.ticker.time;e>=t&&e<=i&&this.ticker.ctx.scene!==a&&(this.ticker.ctx.scene&&kr.resetExceptUtilEnd(),this.ticker.ctx.scene=a)}));for(const r of s){const{directive:e,params:t}=r,s=Xr[e];if(!s){o.error(`Directive ${e} not found`);continue}const n=new s({...t,executeTime:i},a);this.ticker.add((()=>{const e=this.ticker.time;var t,a,s;n.currentTime=e,t=e,a=n.executeTime,s=1/(2*this.rendererOptions.fps),Math.abs(t-a)<s&&(o.debug("execute directive:",n.constructor.name,e,n.executeTime),this.ticker.asyncHandlers.push(n.execute()))})),i+=n.getDuration()}return i}registerUpdater(){this.ticker.add((()=>{const e=this.ticker.time;kr.update(e,this.rendererOptions.fps),this.ticker.asyncHandlers.push((async()=>{this.ticker.ctx.audioBuffers=await kr.getAudioBuffers()})()),R.updateRoot(e),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)}))}async run(e){const{fps:t}=this.rendererOptions,a=Math.ceil(e*t);this.started=!0;for(let i=0;i<=a;i++){const s=i/t*1e3;if(!this.started)break;this.ticker.time=s/1e3,this.ticker.update(s),await Promise.all(this.ticker.asyncHandlers),this.connecter?.connection&&await this.connecter.handle({timestamp:s,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress(i/a*100,s/1e3,e)}let s;return this.started&&this.connecter?.connection&&(s=await this.connecter.finish()),this.started=!1,s}}class Rr{connection;options;constructor(e){this.connection=!1,this.options=e}connect(){this.connection=!0}disconnect(){this.connection=!1}}const Lr="dmFyIGhpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgdWk9KE4sRCx4KT0+RCBpbiBOP2hpKE4sRCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6eH0pOk5bRF09eDt2YXIgRj0oTixELHgpPT4odWkoTix0eXBlb2YgRCE9InN5bWJvbCI/RCsiIjpELHgpLHgpOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgTj1PYmplY3QuZGVmaW5lUHJvcGVydHksRD1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLHg9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxqZT1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLEI9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP04oZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGV0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSl4LmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKEQpZm9yKHZhciBpIG9mIEQodCkpamUuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHZlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4odmUoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxvPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxFPShlLHQsaSxzKT0+KHZlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSx3PShlLHQsaSk9Pih2ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLGw9bmV3IFVpbnQ4QXJyYXkoOCksaz1uZXcgRGF0YVZpZXcobC5idWZmZXIpLEE9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sdT1lPT4oay5zZXRVaW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksdHQ9ZT0+KGsuc2V0SW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksQmU9ZT0+KGsuc2V0VWludDMyKDAsZSwhMSksW2xbMV0sbFsyXSxsWzNdXSksYT1lPT4oay5zZXRVaW50MzIoMCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXV0pLGl0PWU9PihrLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS9CKDIsMzIpKSwhMSksay5zZXRVaW50MzIoNCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXSxsWzRdLGxbNV0sbFs2XSxsWzddXSksd2U9ZT0+KGsuc2V0SW50MTYoMCxCKDIsOCkqZSwhMSksW2xbMF0sbFsxXV0pLFA9ZT0+KGsuc2V0SW50MzIoMCxCKDIsMTYpKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksZ2U9ZT0+KGsuc2V0SW50MzIoMCxCKDIsMzApKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksVz0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LEg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxKPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0sbnQ9a2UoMCksRmU9ZT0+W1AoZVswXSksUChlWzFdKSxnZShlWzJdKSxQKGVbM10pLFAoZVs0XSksZ2UoZVs1XSksUChlWzZdKSxQKGVbN10pLGdlKGVbOF0pXSxDPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSxfPShlLHQsaSxzLHIpPT5DKGUsW0EodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxzdD1lPT5lP0MoImZ0eXAiLFtXKCJpc29tIiksYSgwKSxXKCJpc280IiksVygiaHZjMSIpXSk6QygiZnR5cCIsW1coImlzb20iKSxhKDApLFcoImlzb20iKSxXKCJhdmMxIiksVygibXA0MSIpXSkscnQ9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksYXQ9KGUsdCk9PkMoIm1vb3YiLG51bGwsW290KHQsZSksLi4uZS5tYXAoaT0+bHQoaSx0KSldKSxvdD0oZSx0KT0+e2xldCBpPUooTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT5IKHIuc2FtcGxlcykudGltZXN0YW1wK0goci5zYW1wbGVzKS5kdXJhdGlvbikpLFNlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiBfKCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKFNlKSxhKGkpLFAoMSksd2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUobnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sbHQ9KGUsdCk9PkMoInRyYWsiLG51bGwsW2h0KGUsdCksdXQoZSx0KV0pLGh0PShlLHQpPT57bGV0IGk9SChlLnNhbXBsZXMpLHM9SihpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxTZSk7cmV0dXJuIF8oInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksdSgwKSx1KDApLHdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLHUoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksUChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLFAoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sdXQ9KGUsdCk9PkMoIm1kaWEiLG51bGwsW2R0KGUsdCksZnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLGN0KGUpXSksZHQ9KGUsdCk9PntsZXQgaT1IKGUuc2FtcGxlcykscz1KKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4gXygibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSx1KDIxOTU2KSx1KDApXSl9LGZ0PWU9Pl8oImhkbHIiLDAsMCxbVygibWhsciIpLFcoZSksYSgwKSxhKDApLGEoMCksVygibXA0LW11eGVyLWhkbHIiKV0pLGN0PWU9PkMoIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj9wdCgpOnZ0KCksd3QoKSx5dChlKV0pLHB0PSgpPT5fKCJ2bWhkIiwwLDEsW3UoMCksdSgwKSx1KDApLHUoMCldKSx2dD0oKT0+Xygic21oZCIsMCwwLFt1KDApLHUoMCldKSx3dD0oKT0+QygiZGluZiIsbnVsbCxbZ3QoKV0pLGd0PSgpPT5fKCJkcmVmIiwwLDAsW2EoMSldLFttdCgpXSksbXQ9KCk9Pl8oInVybCAiLDAsMSkseXQ9ZT0+Qygic3RibCIsbnVsbCxbQ3QoZSksT3QoZSksTHQoZSksVXQoZSksRHQoZSksUHQoZSldKSxDdD1lPT5fKCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/X3QoV3RbZS5pbmZvLmNvZGVjXSxlKTpJdChCdFtlLmluZm8uY29kZWNdLGUpXSksX3Q9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxBcnJheSgxMikuZmlsbCgwKSx1KHQuaW5mby53aWR0aCksdSh0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSx1KDEpLEFycmF5KDMyKS5maWxsKDApLHUoMjQpLHR0KDY1NTM1KV0sW3p0W3QuaW5mby5jb2RlY10odCldKSxUdD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksU3Q9ZT0+ZS5jb2RlY1ByaXZhdGUmJkMoImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEV0PWU9PmUuY29kZWNQcml2YXRlJiZDKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxidD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksSXQ9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxhKDApLHUodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLHUoMTYpLHUoMCksdSgwKSxQKHQuaW5mby5zYW1wbGVSYXRlKV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxBdD1lPT5fKCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEEoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksdSgxKSxBKDApLGEoNzU1MzAzNjgpLEEoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksQSg2NCksQSgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxBKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxBKDEpLEEoMildKSxNdD1lPT5DKCJkT3BzIixbQSgwKSxBKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSx1KDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLHdlKDApLEEoMCldKSxPdD1lPT5fKCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLEx0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIF8oInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sVXQ9ZT0+Xygic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksRHQ9ZT0+Xygic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksUHQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZIKGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj1CKDIsMzIpP18oImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9Pml0KHQub2Zmc2V0KSldKTpfKCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxXdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LHp0PXthdmM6VHQsaGV2YzpTdCx2cDk6RXQsYXYxOmJ0fSxCdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sa3Q9e2FhYzpBdCxvcHVzOk10fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sRnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sVixZLG1lPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxvKHRoaXMsVixuZXcgVWludDhBcnJheSg4KSksbyh0aGlzLFksbmV3IERhdGFWaWV3KG4odGhpcyxWKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxZKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsWSkuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL0IoMiwzMikpLCExKSxuKHRoaXMsWSkuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsVikuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsWSkuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsVikpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBmIG9mIGUuY2hpbGRyZW4pZiYmdGhpcy53cml0ZUJveChmKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O1Y9bmV3IFdlYWtNYXAsWT1uZXcgV2Vha01hcDt2YXIgc2UsJCxaLHJlLHllLFJ0PWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxvKHRoaXMscmUpLG8odGhpcyxzZSx2b2lkIDApLG8odGhpcywkLG5ldyBBcnJheUJ1ZmZlcihCKDIsMTYpKSksbyh0aGlzLFosbmV3IFVpbnQ4QXJyYXkobih0aGlzLCQpKSksRSh0aGlzLHNlLGUpfXdyaXRlKGUpe3codGhpcyxyZSx5ZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLFopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dyh0aGlzLHJlLHllKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcywkKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLCQ9bmV3IFdlYWtNYXAsWj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCx5ZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsJCkuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLCQpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxaKSwwKSxFKHRoaXMsJCxpKSxFKHRoaXMsWixzKX07dmFyIGosRyx4ZT1jbGFzcyBleHRlbmRzIG1le2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksbyh0aGlzLGosdm9pZCAwKSxvKHRoaXMsRyxbXSksRSh0aGlzLGosZSl9d3JpdGUoZSl7bih0aGlzLEcpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcyxHKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsRyldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsRykpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsaikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsRykubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxqKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07aj1uZXcgV2Vha01hcCxHPW5ldyBXZWFrTWFwO3ZhciBOdD1CKDIsMjQpLHh0PTIsZWUsTCxJLGFlLENlLF9lLEhlLFRlLFZlLHRlLG9lLCRlPWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7dmFyIHQsaTtpZihzdXBlcigpLG8odGhpcyxhZSksbyh0aGlzLF9lKSxvKHRoaXMsVGUpLG8odGhpcyx0ZSksbyh0aGlzLGVlLHZvaWQgMCksbyh0aGlzLEwsdm9pZCAwKSxvKHRoaXMsSSxbXSksRSh0aGlzLGVlLGUpLEUodGhpcyxMLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOk50KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTCkpfHxuKHRoaXMsTCk8QigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3codGhpcyxhZSxDZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHcodGhpcyx0ZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGVlKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07ZWU9bmV3IFdlYWtNYXAsTD1uZXcgV2Vha01hcCxJPW5ldyBXZWFrTWFwLGFlPW5ldyBXZWFrU2V0LENlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9bih0aGlzLEkpLmZpbmRJbmRleChwPT5wLnN0YXJ0PD10JiZ0PHAuc3RhcnQrbih0aGlzLEwpKTtpPT09LTEmJihpPXcodGhpcyxUZSxWZSkuY2FsbCh0aGlzLHQpKTtsZXQgcz1uKHRoaXMsSSlbaV0scj10LXMuc3RhcnQsZD1lLnN1YmFycmF5KDAsTWF0aC5taW4obih0aGlzLEwpLXIsZS5ieXRlTGVuZ3RoKSk7cy5kYXRhLnNldChkLHIpO2xldCBmPXtzdGFydDpyLGVuZDpyK2QuYnl0ZUxlbmd0aH07aWYodyh0aGlzLF9lLEhlKS5jYWxsKHRoaXMscyxmKSxzLndyaXR0ZW5bMF0uc3RhcnQ9PT0wJiZzLndyaXR0ZW5bMF0uZW5kPT09bih0aGlzLEwpJiYocy5zaG91bGRGbHVzaD0hMCksbih0aGlzLEkpLmxlbmd0aD54dCl7Zm9yKGxldCBwPTA7cDxuKHRoaXMsSSkubGVuZ3RoLTE7cCsrKW4odGhpcyxJKVtwXS5zaG91bGRGbHVzaD0hMDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcyl9ZC5ieXRlTGVuZ3RoPGUuYnl0ZUxlbmd0aCYmdyh0aGlzLGFlLENlKS5jYWxsKHRoaXMsZS5zdWJhcnJheShkLmJ5dGVMZW5ndGgpLHQrZC5ieXRlTGVuZ3RoKX0sX2U9bmV3IFdlYWtTZXQsSGU9ZnVuY3Rpb24oZSx0KXtsZXQgaT0wLHM9ZS53cml0dGVuLmxlbmd0aC0xLHI9LTE7Zm9yKDtpPD1zOyl7bGV0IGQ9TWF0aC5mbG9vcihpKyhzLWkrMSkvMik7ZS53cml0dGVuW2RdLnN0YXJ0PD10LnN0YXJ0PyhpPWQrMSxyPWQpOnM9ZC0xfWZvcihlLndyaXR0ZW4uc3BsaWNlKHIrMSwwLHQpLChyPT09LTF8fGUud3JpdHRlbltyXS5lbmQ8dC5zdGFydCkmJnIrKztyPGUud3JpdHRlbi5sZW5ndGgtMSYmZS53cml0dGVuW3JdLmVuZD49ZS53cml0dGVuW3IrMV0uc3RhcnQ7KWUud3JpdHRlbltyXS5lbmQ9TWF0aC5tYXgoZS53cml0dGVuW3JdLmVuZCxlLndyaXR0ZW5bcisxXS5lbmQpLGUud3JpdHRlbi5zcGxpY2UocisxLDEpfSxUZT1uZXcgV2Vha1NldCxWZT1mdW5jdGlvbihlKXtsZXQgaT17c3RhcnQ6TWF0aC5mbG9vcihlL24odGhpcyxMKSkqbih0aGlzLEwpLGRhdGE6bmV3IFVpbnQ4QXJyYXkobih0aGlzLEwpKSx3cml0dGVuOltdLHNob3VsZEZsdXNoOiExfTtyZXR1cm4gbih0aGlzLEkpLnB1c2goaSksbih0aGlzLEkpLnNvcnQoKHMscik9PnMuc3RhcnQtci5zdGFydCksbih0aGlzLEkpLmluZGV4T2YoaSl9LHRlPW5ldyBXZWFrU2V0LG9lPWZ1bmN0aW9uKGU9ITEpe2ZvcihsZXQgdD0wO3Q8bih0aGlzLEkpLmxlbmd0aDt0Kyspe2xldCBpPW4odGhpcyxJKVt0XTtpZighKCFpLnNob3VsZEZsdXNoJiYhZSkpe2ZvcihsZXQgcyBvZiBpLndyaXR0ZW4pbih0aGlzLGVlKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyIEh0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxTZT0xZTMsVnQ9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sJHQ9WyJhYWMiLCJvcHVzIl0sR3Q9MjA4Mjg0NDgwMCxYdD0uNSxxdD1bInN0cmljdCIsIm9mZnNldCJdLGcsVCxYLHEsSyxFZSxsZSxiZSxHZSxJZSxYZSxBZSxxZSxNZSxLZSxoZSxPZSxMZSxRZSxpZSx1ZSxuZSxkZSxmZSxVZSxLdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtvKHRoaXMsYmUpLG8odGhpcyxJZSksbyh0aGlzLEFlKSxvKHRoaXMsTWUpLG8odGhpcyxoZSksbyh0aGlzLExlKSxvKHRoaXMsaWUpLG8odGhpcyxuZSksbyh0aGlzLGZlKSxvKHRoaXMsZyx2b2lkIDApLG8odGhpcyxULHZvaWQgMCksbyh0aGlzLFgsdm9pZCAwKSxvKHRoaXMscSxudWxsKSxvKHRoaXMsSyxudWxsKSxvKHRoaXMsRWUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrR3QpLG8odGhpcyxsZSwhMSk7dmFyIHQ7aWYodyh0aGlzLGJlLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsRSh0aGlzLGcsZXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKUUodGhpcyxULG5ldyBSdChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSlFKHRoaXMsVCwodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIEZ0KUUodGhpcyxULG5ldyBIdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTt3KHRoaXMsSWUsWGUpLmNhbGwodGhpcyksdyh0aGlzLEFlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxLKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLHEpJiZ3KHRoaXMsaWUsdWUpLmNhbGwodGhpcyxuKHRoaXMscSkpLG4odGhpcyxLKSYmdyh0aGlzLGllLHVlKS5jYWxsKHRoaXMsbih0aGlzLEspKTtsZXQgZT1uKHRoaXMsVCkub2Zmc2V0cy5nZXQobih0aGlzLFgpKSx0PW4odGhpcyxUKS5wb3MtZTtuKHRoaXMsWCkuc2l6ZT10LG4odGhpcyxUKS5wYXRjaEJveChuKHRoaXMsWCkpO2xldCBpPWF0KFtuKHRoaXMscSksbih0aGlzLEspXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLEVlKSk7bih0aGlzLFQpLndyaXRlQm94KGkpLHcodGhpcyxuZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsVCkuZmluYWxpemUoKSxFKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxUPW5ldyBXZWFrTWFwLFg9bmV3IFdlYWtNYXAscT1uZXcgV2Vha01hcCxLPW5ldyBXZWFrTWFwLEVlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFWdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiEkdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhcXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sSWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLFQpLndyaXRlQm94KHN0KHQpKSxFKHRoaXMsWCxydCgpKSxuKHRoaXMsVCkud3JpdGVCb3gobih0aGlzLFgpKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9LEFlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZFKHRoaXMscSx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9dyh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7RSh0aGlzLEsse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLGY9IiI7Zis9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksZis9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYoZis9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxmKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgcD1NYXRoLmNlaWwoZi5sZW5ndGgvOCkqODtmPWYucGFkRW5kKHAsIjAiKTtsZXQgYj1uZXcgVWludDhBcnJheShmLmxlbmd0aC84KTtmb3IobGV0IFM9MDtTPGYubGVuZ3RoO1MrPTgpYltTLzhdPXBhcnNlSW50KGYuc2xpY2UoUyxTKzgpLDIpO3JldHVybiBifSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIGY7bGV0IHA9cy8xZTYsYj1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1wKSxwPXcodGhpcyxMZSxRZSkuY2FsbCh0aGlzLHAsZSksZS5sYXN0VGltZXN0YW1wPXAsKCFlLmN1cnJlbnRDaHVua3x8cC1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49WHQpJiYoZS5jdXJyZW50Q2h1bmsmJncodGhpcyxpZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpwLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChmPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJmYuZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOnAsZHVyYXRpb246YixzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBTPUoocCxlLnRpbWVzY2FsZSwhMSksTT1NYXRoLnJvdW5kKFMtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1NO2xldCBPPUgoZS50aW1lVG9TYW1wbGVUYWJsZSk7Ty5zYW1wbGVDb3VudD09PTE/KE8uc2FtcGxlRGVsdGE9TSxPLnNhbXBsZUNvdW50KyspOk8uc2FtcGxlRGVsdGE9PT1NP08uc2FtcGxlQ291bnQrKzooTy5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTpNfSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6SihiLGUudGltZXNjYWxlKX0pfSxMZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LGllPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLFQpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsVCkud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHxIKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9fSxuZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxUKWluc3RhbmNlb2YgeGUmJm4odGhpcyxUKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxVZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgUXQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBZdChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKFF0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXTtmdW5jdGlvbiBkKHYsbSl7dmFyIHk9dlttXTtpZih0eXBlb2YgeS5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiB5LmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKHksdil9Y2F0Y2goYyl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseSh5LFt2LGFyZ3VtZW50c10pfX19ZnVuY3Rpb24gZigpe2NvbnNvbGUubG9nJiYoY29uc29sZS5sb2cuYXBwbHk/Y29uc29sZS5sb2cuYXBwbHkoY29uc29sZSxhcmd1bWVudHMpOkZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseShjb25zb2xlLmxvZyxbY29uc29sZSxhcmd1bWVudHNdKSksY29uc29sZS50cmFjZSYmY29uc29sZS50cmFjZSgpfWZ1bmN0aW9uIHAodil7cmV0dXJuIHY9PT0iZGVidWciJiYodj0ibG9nIiksdHlwZW9mIGNvbnNvbGU9PT1pPyExOnY9PT0idHJhY2UiJiZzP2Y6Y29uc29sZVt2XSE9PXZvaWQgMD9kKGNvbnNvbGUsdik6Y29uc29sZS5sb2chPT12b2lkIDA/ZChjb25zb2xlLCJsb2ciKTp0fWZ1bmN0aW9uIGIodixtKXtmb3IodmFyIHk9MDt5PHIubGVuZ3RoO3krKyl7dmFyIGM9clt5XTt0aGlzW2NdPXk8dj90OnRoaXMubWV0aG9kRmFjdG9yeShjLHYsbSl9dGhpcy5sb2c9dGhpcy5kZWJ1Z31mdW5jdGlvbiBTKHYsbSx5KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihiLmNhbGwodGhpcyxtLHkpLHRoaXNbdl0uYXBwbHkodGhpcyxhcmd1bWVudHMpKX19ZnVuY3Rpb24gTSh2LG0seSl7cmV0dXJuIHAodil8fFMuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIE8odixtLHkpe3ZhciBjPXRoaXMsSmU7bT1tPT1udWxsPyJXQVJOIjptO3ZhciBVPSJsb2dsZXZlbCI7dHlwZW9mIHY9PSJzdHJpbmciP1UrPSI6Iit2OnR5cGVvZiB2PT0ic3ltYm9sIiYmKFU9dm9pZCAwKTtmdW5jdGlvbiBhaShoKXt2YXIgUT0ocltoXXx8InNpbGVudCIpLnRvVXBwZXJDYXNlKCk7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IVUpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZVtVXT1RO3JldHVybn1jYXRjaChwZSl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChVKSsiPSIrUSsiOyJ9Y2F0Y2gocGUpe319fWZ1bmN0aW9uIFplKCl7dmFyIGg7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IVUpKXt0cnl7aD13aW5kb3cubG9jYWxTdG9yYWdlW1VdfWNhdGNoKGxpKXt9aWYodHlwZW9mIGg9PT1pKXRyeXt2YXIgUT13aW5kb3cuZG9jdW1lbnQuY29va2llLHBlPVEuaW5kZXhPZihlbmNvZGVVUklDb21wb25lbnQoVSkrIj0iKTtwZSE9PS0xJiYoaD0vXihbXjtdKykvLmV4ZWMoUS5zbGljZShwZSkpWzFdKX1jYXRjaChsaSl7fXJldHVybiBjLmxldmVsc1toXT09PXZvaWQgMCYmKGg9dm9pZCAwKSxofX1mdW5jdGlvbiBvaSgpe2lmKCEodHlwZW9mIHdpbmRvdz09PWl8fCFVKSl7dHJ5e3dpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShVKTtyZXR1cm59Y2F0Y2goaCl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChVKSsiPTsgZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQyJ9Y2F0Y2goaCl7fX19Yy5uYW1lPXYsYy5sZXZlbHM9e1RSQUNFOjAsREVCVUc6MSxJTkZPOjIsV0FSTjozLEVSUk9SOjQsU0lMRU5UOjV9LGMubWV0aG9kRmFjdG9yeT15fHxNLGMuZ2V0TGV2ZWw9ZnVuY3Rpb24oKXtyZXR1cm4gSmV9LGMuc2V0TGV2ZWw9ZnVuY3Rpb24oaCxRKXtpZih0eXBlb2YgaD09InN0cmluZyImJmMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0hPT12b2lkIDAmJihoPWMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0pLHR5cGVvZiBoPT0ibnVtYmVyIiYmaD49MCYmaDw9Yy5sZXZlbHMuU0lMRU5UKXtpZihKZT1oLFEhPT0hMSYmYWkoaCksYi5jYWxsKGMsaCx2KSx0eXBlb2YgY29uc29sZT09PWkmJmg8Yy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZWxzZSB0aHJvdyJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK2h9LGMuc2V0RGVmYXVsdExldmVsPWZ1bmN0aW9uKGgpe209aCxaZSgpfHxjLnNldExldmVsKGgsITEpfSxjLnJlc2V0TGV2ZWw9ZnVuY3Rpb24oKXtjLnNldExldmVsKG0sITEpLG9pKCl9LGMuZW5hYmxlQWxsPWZ1bmN0aW9uKGgpe2Muc2V0TGV2ZWwoYy5sZXZlbHMuVFJBQ0UsaCl9LGMuZGlzYWJsZUFsbD1mdW5jdGlvbihoKXtjLnNldExldmVsKGMubGV2ZWxzLlNJTEVOVCxoKX07dmFyIFdlPVplKCk7V2U9PW51bGwmJihXZT1tKSxjLnNldExldmVsKFdlLCExKX12YXIgej1uZXcgTyxQZT17fTt6LmdldExvZ2dlcj1mdW5jdGlvbihtKXtpZih0eXBlb2YgbSE9InN5bWJvbCImJnR5cGVvZiBtIT0ic3RyaW5nInx8bT09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgeT1QZVttXTtyZXR1cm4geXx8KHk9UGVbbV09bmV3IE8obSx6LmdldExldmVsKCksei5tZXRob2RGYWN0b3J5KSkseX07dmFyIHJpPXR5cGVvZiB3aW5kb3chPT1pP3dpbmRvdy5sb2c6dm9pZCAwO3JldHVybiB6Lm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdHlwZW9mIHdpbmRvdyE9PWkmJndpbmRvdy5sb2c9PT16JiYod2luZG93LmxvZz1yaSksen0sei5nZXRMb2dnZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIFBlfSx6LmRlZmF1bHQ9eix6fSl9KShZZSk7dmFyIEp0PVllLmV4cG9ydHMsY2U9WXQoSnQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIFp0KGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyBqdHtjb25zdHJ1Y3Rvcih0KXtGKHRoaXMsImNvbm5lY3Rpb24iKTtGKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgUj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoUnx8e30pO2Z1bmN0aW9uIGVpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyB0aSBleHRlbmRzIGp0e2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO0YodGhpcywidmlkZW9Db25maWciKTtGKHRoaXMsImF1ZGlvQ29uZmlnIik7Rih0aGlzLCJtdXhlciIpO0YodGhpcywidmlkZW9FbmNvZGVyIik7Rih0aGlzLCJhdWRpb0VuY29kZXIiKTtGKHRoaXMsImVycm9yUmVqZWN0IixlaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgZixwLGIsUztjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9JbmZvOnIsdGltZXN0YW1wOmR9PWk7aWYocyYmKChmPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmZi5lbmNvZGVRdWV1ZVNpemUmJigocD10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnAuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgWnQoKCk9Pnt2YXIgTSxPO3JldHVybihNPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmTS5lbmNvZGVRdWV1ZVNpemU/KChPPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6Ty5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKGI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxiLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSkscil7Y29uc3QgTT1uZXcgQXVkaW9EYXRhKHsuLi5yfSk7KFM9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsfHxTLmVuY29kZShNKSxNLmNsb3NlKCl9fWNyZWF0ZU11eGVyQW5kRW5jb2Rlcigpe3RoaXMubXV4ZXI9bmV3IEt0KHt0YXJnZXQ6bmV3IFJlLHZpZGVvOntjb2RlYzoiYXZjIix3aWR0aDp0aGlzLnZpZGVvQ29uZmlnLndpZHRoLGhlaWdodDp0aGlzLnZpZGVvQ29uZmlnLmhlaWdodH0sYXVkaW86e2NvZGVjOiJhYWMiLG51bWJlck9mQ2hhbm5lbHM6dGhpcy5hdWRpb0NvbmZpZy5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6dGhpcy5hdWRpb0NvbmZpZy5zYW1wbGVSYXRlfX0pLHRoaXMudmlkZW9FbmNvZGVyPW5ldyBWaWRlb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZFZpZGVvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJ2aWRlbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMudmlkZW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLnZpZGVvQ29uZmlnKSx0aGlzLm9wdGlvbnMuZGlzYWJsZUF1ZGlvfHwodGhpcy5hdWRpb0VuY29kZXI9bmV3IEF1ZGlvRW5jb2Rlcih7b3V0cHV0OihpLHMpPT57dmFyIHI7cmV0dXJuKHI9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOnIuYWRkQXVkaW9DaHVuayhpLHMpfSxlcnJvcjppPT57Y2UuZXJyb3IoImF1ZGlvIGVuY29kZXIgZXJyb3IiLGkpLHRoaXMuZXJyb3JSZWplY3QoaSl9fSksdGhpcy5hdWRpb0VuY29kZXIuY29uZmlndXJlKHRoaXMuYXVkaW9Db25maWcpKX1hc3luYyBlbmRFbmNvZGluZygpe3ZhciBzLHIsZCxmLHAsYixTO3JldHVybiBhd2FpdCgocz10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnMuZmx1c2goKSksKHI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxyLmNsb3NlKCksYXdhaXQoKGQ9dGhpcy5hdWRpb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpkLmZsdXNoKCkpLChmPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8Zi5jbG9zZSgpLChwPXRoaXMubXV4ZXIpPT1udWxsfHxwLmZpbmFsaXplKCksKFM9KGI9dGhpcy5tdXhlcik9PW51bGw/dm9pZCAwOmIudGFyZ2V0KT09bnVsbD92b2lkIDA6Uy5idWZmZXJ9YXN5bmMgZmluaXNoKCl7cmV0dXJuIGF3YWl0IHRoaXMuZW5kRW5jb2RpbmcoKX19bGV0IERlO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsYXN5bmMgZT0+e2NvbnN0e3R5cGU6dCxkYXRhOml9PWUuZGF0YTt0cnl7c3dpdGNoKHQpe2Nhc2UgUi5JTklUOnJldHVybiBpaShpKTtjYXNlIFIuU0VORDpyZXR1cm4gYXdhaXQgbmkoaSk7Y2FzZSBSLkZJTklTSDpyZXR1cm4gYXdhaXQgc2koKTtkZWZhdWx0OnJldHVybn19Y2F0Y2gocyl7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTp0LGVyck1zZzpzIGluc3RhbmNlb2YgRXJyb3I/cy5tZXNzYWdlOiJVbmtub3duIEVycm9yIn0pfX0pLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5MT0FERUR9KTtmdW5jdGlvbiBpaShlKXtEZT1uZXcgdGkoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpSLklOSVR9KX1hc3luYyBmdW5jdGlvbiBuaShlKXthd2FpdCBEZS5oYW5kbGUoZSksc2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpSLlNFTkR9KX1hc3luYyBmdW5jdGlvbiBzaSgpe2NvbnN0IGU9YXdhaXQgRGUuZmluaXNoKCk7c2VsZi5wb3N0TWVzc2FnZSh7dHlwZTpSLkZJTklTSCxyZXN1bHQ6ZX0sZT9bZV06W10pfX0pKCk7Cg==",zr="undefined"!=typeof window&&window.Blob&&new Blob([atob(Lr)],{type:"text/javascript;charset=utf-8"});function Ir(){let e;try{if(e=zr&&(window.URL||window.webkitURL).createObjectURL(zr),!e)throw"";return new Worker(e)}catch(t){return new Worker("data:application/javascript;base64,"+Lr)}finally{e&&(window.URL||window.webkitURL).revokeObjectURL(e)}}var Fr=(e=>(e.LOADED="loaded",e.INIT="init",e.SEND="send",e.FINISH="finish",e))(Fr||{});class Kr extends Rr{compositorWorker;initialized;videoConfig;audioConfig;constructor(e){super(e),this.videoConfig=e.videoConfig??Wi,this.audioConfig=e.audioConfig??Xi,this.compositorWorker=new Ir,this.initialized=new Promise(((t,a)=>{this.compositorWorker.addEventListener("message",(s=>{const{type:i}=s.data;i===Fr.LOADED&&this.getFromWorker(Fr.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...e}).then((()=>{t()})).catch((e=>{a(e)}))}))}))}getFromWorker(e,t,a){return new Promise(((s,i)=>{const r=({data:t})=>{t.type===e&&(t.errMsg?i(t.errMsg):s(t.result),this.compositorWorker.removeEventListener("message",r))};this.compositorWorker.addEventListener("message",r),this.compositorWorker.postMessage({type:e,data:t},a||[])}))}async genAudioInfo(e,t){const a=this.audioConfig.sampleRate,s=this.audioConfig.numberOfChannels,i=this.audioConfig.sampleRate*(1/this.options.fps),r=new OfflineAudioContext(s,i,a).createBuffer(s,i,a);let n;if(t){t.forEach(((e,t)=>{for(let a=0;a<s;a++){const s=a<e.numberOfChannels?e.getChannelData(a):new Float32Array(i).fill(0),n=r.getChannelData(a);if(0===t)n.set(s);else for(let e=0;e<n.length;e++)n[e]+=s[e]}})),n=new Float32Array(i*s);for(let e=0;e<r.numberOfChannels;e++)n.set(r.getChannelData(e),e*r.length)}else n=new Float32Array(i*s).fill(0);return{timestamp:e,sampleRate:a,numberOfChannels:s,numberOfFrames:i,data:n,format:"f32-planar"}}async handle(e){await this.initialized;const{timestamp:t,imageSource:a,audioBuffers:s}=e,i=new VideoFrame(a,{timestamp:1e3*t}),r=[i];let n;return this.options.disableAudio||(n=await this.genAudioInfo(t,s),r.push(n.data.buffer)),this.getFromWorker(Fr.SEND,{timestamp:t,videoFrame:i,audioInfo:n},r)}async finish(){await this.initialized;const e=await this.getFromWorker(Fr.FINISH);if(e)return new Blob([e],{type:"video/mp4"})}}class Yr extends Rr{context;audioContext;audioPlayTime;lastHandleTime;constructor(e){super(e),this.options=e,this.audioContext=e.disableAudio?null:new AudioContext,this.audioPlayTime=0,this.lastHandleTime=0;const{canvas:t,width:a,height:s}=this.options;t.width=a,t.height=s,this.context=t.getContext("2d")}async handle(e){const{imageSource:t,audioBuffers:a}=e,s=performance.now(),i=this.lastHandleTime>0?s-this.lastHandleTime:0;var r;this.options.disableAudio||this.playAudioBuffers(a),this.context&&t&&this.playVideoFrame(t),await(r=1e3/this.options.fps-i-4,new Promise((e=>setTimeout(e,r)))),this.lastHandleTime=performance.now()}playVideoFrame(e){const{width:t,height:a}=this.options;this.context.drawImage(e,0,0,t,a)}playAudioBuffers(e){if(0===e.length)return;if(!this.audioContext)return;let t=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const a of e){const e=this.audioContext.createBufferSource();e.buffer=a,e.connect(this.audioContext.destination),e.onended=()=>{e.disconnect()},e.start(this.audioPlayTime),t=Math.max(t,a.duration)}this.audioPlayTime+=t}async finish(){this.audioContext?.close()}}var Hr=(e=>(e[e.Background=0]="Background",e[e.Character=10]="Character",e[e.Dialog=20]="Dialog",e[e.Text=30]="Text",e))(Hr||{});let Mr=class e{static defaultEditorOptions={width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}};options;app;scenes;activeScene;activeChild;activeTransformer;constructor(t){this.options=Object.assign({},e.defaultEditorOptions,t);const{view:a,width:s,height:i,background:r}=this.options;this.app=new K({view:a,width:s,height:i,background:r}),this.scenes=[]}addTransformer(){this.activeTransformer=new Y({wireframeStyle:{thickness:4,color:41471}}).on("pointertap",(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout((()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)}),600)))})),this.activeScene?.addChild(this.activeTransformer)}removeTransformer(){this.activeTransformer&&(this.activeScene?.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(e){e.interactive=!0,e.on("pointerdown",(()=>{this.setActiveChild(e)}))}setActiveChild(e){this.activeChild=e,e&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[e],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(e)}setActiveChildByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&this.setActiveChild(a)}}updateActiveChild(e){this.activeChild&&(e(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(e){e.removeAllListeners("pointerdown")}addScene(e,t){void 0===t?this.scenes.push(e):this.scenes.splice(t,0,e);const a=e=>{if(e.children&&e.children.length>0)for(const t of e.children)a(t);else this.addChildTransformListener(e)};for(const s of e.children)a(s);this.options.onChangeScenes(this.scenes)}loadScenes(e){e.forEach((e=>{this.addScene(e)})),this.options.onChangeScenes(this.scenes)}removeScene(e){this.scenes=this.scenes.filter((t=>t!==e)),this.activeScene===e&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(e){this.removeScene(this.scenes[e])}removeSceneByName(e){const t=this.getSceneByName(e);t&&this.removeScene(t)}getSceneByName(e){return this.scenes.find((t=>t.name===e))}cloneScene(e){this.removeTransformer();const t=e??this.activeScene;if(t)return t.clone()}cloneSceneByIndex(e){return this.cloneScene(this.scenes[e])}cloneSceneByName(e){const t=this.getSceneByName(e);if(t)return this.cloneScene(t)}swapScene(e,t){[this.scenes[e],this.scenes[t]]=[this.scenes[t],this.scenes[e]],this.options.onChangeScenes(this.scenes)}setActiveScene(e){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=e,e&&(this.activeScene.load(),this.addTransformer(),this.stageAddChild(e)),this.options.onChangeActiveScene(e)}setActiveSceneByName(e){const t=this.scenes.find((t=>t.name===e));t&&this.setActiveScene(t)}setActiveSceneByIndex(e){this.setActiveScene(this.scenes[e])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(e){this.activeScene&&(e(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(e){const t=this.activeScene;t&&(this.addChildTransformListener(e),t.addChild(e),this.options.onChangeActiveScene(t))}removeChild(e){const t=this.activeScene;t&&(this.activeChild?.name===e.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(e),t.removeChild(e),e.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&this.removeChild(a)}}toggleChildVisibleByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&(a.visible=!a.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(e){const t=this.activeScene;if(t){const a=t.children.find((t=>t.name===e));a&&(a.interactive=!a.interactive),this.options.onChangeActiveScene(t)}}cloneChild(e){const t=e??this.activeChild;if(t)return t.clone()}addSound(e){const t=this.activeScene;t&&(t.addSound(e),this.options.onChangeActiveScene(t))}removeSound(e){const t=this.activeScene;t&&(t.removeSound(e),this.options.onChangeActiveScene(t))}removeSoundByName(e){const t=this.activeScene;if(t){const a=t.sounds.find((t=>t.name===e));a&&this.removeSound(a)}}cloneDialogue(e){return T(e)}cloneDialogueSpeak(e){return T(e)}addDialogue(e,t){const a=this.activeScene;a&&(a.addDialogue(e,t),this.options.onChangeActiveScene(a))}updateDialogue(e,t){const a=this.activeScene;a&&(a.updateDialogue(e,t),this.options.onChangeActiveScene(a))}removeDialogue(e){const t=this.activeScene;t&&(t.removeDialogue(e),this.options.onChangeActiveScene(t))}swapDialogue(e,t){const a=this.activeScene;a&&(a.swapDialogue(e,t),this.options.onChangeActiveScene(a))}swapChildren(e,t){this.activeScene?.swapChildren(e,t)}moveChildTo(e,t){const a=t??this.activeChild;a&&(a.zIndex=e)}moveChildToTop(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=Hr.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(e){const t=e??this.activeChild;this.activeScene&&t&&(t.zIndex=Hr.Background,this.activeScene?.setChildIndex(t,0))}moveUpChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e<this.activeScene.children.length-1){const a=this.activeScene.children[e+1];a.zIndex>t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}moveDownChild(e){const t=e??this.activeChild;if(this.activeScene&&t){const e=this.activeScene.children.indexOf(t);if(e>0){const a=this.activeScene.children[e-1];a.zIndex<t.zIndex&&(t.zIndex=a.zIndex),this.swapChildren(t,a)}}}stageAddChild(e){this.app.stage.addChild(e)}stageRemoveChild(e){const t=this.app.stage.children.find((t=>t.name===e.name));t&&this.app.stage.removeChild(t)}setChildPosition(e,t){const a=t??this.activeChild,{width:s,height:i}=this.options;if(a)switch(e){case"top":a.y=0;break;case"middle":a.y=i/2-a.height/2;break;case"bottom":a.y=i-a.height;break;case"left":a.x=0;break;case"near-left":a.x=s/3-a.width/2;break;case"center":a.x=s/2-a.width/2;break;case"near-right":a.x=s/3*2-a.width/2;break;case"right":a.x=s-a.width}}genSceneScript(e){const{dialogues:t,config:a}=e,s=a.speak,i=[],r=e.children.find((e=>"Background"===e.assetType));r&&a.autoShowBackground&&i.push({directive:Vr.Show,params:{targetName:r.name}});for(const n of t){const{speak:t,lines:a}=n;s?.dialogTargetName&&i.push({directive:Vr.Show,params:{targetName:s.dialogTargetName}});const r=[];a.forEach((e=>{if("p"===e.type)for(let t=0;t<e.children.length;t++){const a=e.children[t];if("directive"===a.type)r.push({type:"directive",value:a.value});else if(a.text&&s?.targetName){let s=a.text;t===e.children.length-1&&(s+="\n"),r.push({type:"speak",value:s})}}}));let o,l=!1,c="";t.voice?.targetName&&(c=r.filter((e=>"speak"===e.type)).map((e=>e.value)).join(""),o=e.sounds.find((e=>e.name===t.voice?.targetName))?.buffer?.duration);const d=e=>{const a=e.join("");let r;c&&o&&(r=a.length/c.length*o),i.push({directive:Vr.Speak,params:{targetName:s.targetName,text:a,append:l,voiceDuration:r,wordsPerMin:t.wordsPerMin,interval:t.interval,effect:t.effect,speaker:s.speaker.targetName?{targetName:s.speaker.targetName,name:t.speaker?.name||"",speakerTargetName:t.speaker?.speakerTargetName,autoShowSpeaker:t.speaker?.autoShowSpeaker,autoMaskOtherSpeakers:t.speaker?.autoMaskOtherSpeakers}:void 0,voice:l?void 0:t.voice?.targetName?t.voice:void 0}}),l=!0};r.forEach((e=>{if("directive"===e.type){const t=e.value;i.push(t)}else d([e.value])}))}return{scene:e,config:a,directives:i}}async exportScreenplay(e=0,t){const a=this.exportScenes(e,t);for(const s of a)await s.load();return{config:{},scenes:a.map(this.genSceneScript)}}exportScenes(e=0,t){this.removeTransformer();const a=performance.now(),s=this.scenes.slice(e,t).map((e=>e.clone()));return o.info("editor export cost:",performance.now()-a),s}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(e){const t=JSON.parse(e),a=[];for(const s of t.scenes){const e=await hr.fromJSON(s);a.push(e)}this.loadScenes(a)}clear(){this.scenes.forEach((e=>{this.removeScene(e)})),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}};function Ur(){const e=new hr,t=new Qi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,400),t.endFill(),t.x=0,t.y=680,t.zIndex=Hr.Dialog,t.label="对话框",t.fillColor="#000000";const a=new Ai("角色名",{fill:16777215,fontSize:44,fontWeight:"bold"});a.x=160,a.y=700,a.zIndex=Hr.Text,a.label="角色名",a.disableTextEdit=!0;const s=new Ai("角色台词",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return s.x=160,s.y=770,s.zIndex=Hr.Text,s.label="角色台词",s.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.addChild(s),e.config.speak.targetName=s.name,e.config.speak.dialogTargetName=t.name,e.config.speak.speaker.targetName=a.name,e.config.speak.speaker.name=a.text,e}const Dr=H()(M((e=>{let t;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){e((e=>{e.project={id:t.id,name:t.name}}))},initEditor(a){t=new Mr({view:a,onChangeActiveChild(t){e((e=>{if(!t)return void(e.activeChild=null);let a={...t,width:t.width,height:t.height,x:t.x,y:t.y};if("Text"===t.type){const e=t;a={...a,text:e.text,style:e.style&&{...e.style,fontFamily:e.style.fontFamily,fontWeight:e.style.fontWeight,fontStyle:e.style.fontStyle,fontSize:e.style.fontSize,fill:e.style.fill}}}e.activeChild=a}))},onChangeActiveScene(t){e((e=>{e.activeScene=t?{...t}:null}))},onChangeScenes(t){e((e=>{e.scenes=[...t]}))}}),e((e=>{e.editor=t}))}}}))),Br=H()(M((e=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(t){e((e=>{e.confirm=t}))},setCancel(t){e((e=>{e.cancel=t}))},setOpen(t){e((e=>{e.isOpen=t}))},setType(t){e((e=>{e.type=t}))},setDisableSelect(t){e((e=>{e.disableSelect=t}))}})))),Pr=H()(M((e=>({isOpen:!1,loadingText:"",setOpen(t){e((e=>{e.isOpen=t}))},setLoadingText(t){e((e=>{e.loadingText=t}))}})))),Jr=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("rounded-xl border bg-card text-card-foreground shadow",e),...a})));Jr.displayName="Card",i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("flex flex-col space-y-1.5 p-6",e),...a}))).displayName="CardHeader",i.forwardRef((({className:e,...a},s)=>r.jsx("h3",{ref:s,className:t("font-semibold leading-none tracking-tight",e),...a}))).displayName="CardTitle",i.forwardRef((({className:e,...a},s)=>r.jsx("p",{ref:s,className:t("text-sm text-muted-foreground",e),...a}))).displayName="CardDescription";const Er=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("p-6 pt-0",e),...a})));Er.displayName="CardContent";const Or=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("flex items-center p-6 pt-0",e),...a})));Or.displayName="CardFooter";const Ar=i.forwardRef((({className:e,children:a,...s},n)=>{const o=i.useRef(null);return i.useImperativeHandle(n,(()=>({scrollToBottom:()=>{o.current&&o.current.scrollTo({top:o.current.scrollHeight,behavior:"smooth"})}}))),r.jsxs(U,{className:t("relative overflow-hidden",e),...s,children:[r.jsx(D,{ref:o,className:"h-full w-full rounded-[inherit]",children:a}),r.jsx(Qr,{}),r.jsx(B,{})]})}));Ar.displayName=U.displayName;const Qr=i.forwardRef((({className:e,orientation:a="vertical",...s},i)=>r.jsx(P,{ref:i,orientation:a,className:t("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:r.jsx(J,{className:"relative flex-1 rounded-full bg-border"})})));Qr.displayName=P.displayName;const _r={add:E,alignCenter:O,alignJustify:A,alignLeft:Q,alignRight:_,arrowDown:$,bg:q,blockquote:ee,bold:te,borderAll:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),borderBottom:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),borderLeft:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),borderNone:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),borderRight:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),borderTop:e=>r.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...e,children:r.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),check:ae,chevronRight:se,chevronsUpDown:ie,clear:re,close:re,code:ne,codeblock:oe,color:le,column:ce,combine:de,ungroup:he,comment:me,commentAdd:pe,delete:ue,dragHandle:xe,editing:fe,emoji:ge,externalLink:be,h1:ve,h2:we,h3:ye,h4:je,h5:ke,h6:Ne,image:Se,indent:Ze,italic:Ce,kbd:Ge,lineHeight:We,link:Xe,minus:Ve,more:Te,ol:Re,outdent:Le,paragraph:ze,refresh:Ie,row:Fe,search:Ke,settings:Ye,strikethrough:He,subscript:Me,superscript:Ue,table:De,text:Be,trash:Pe,trash2:ue,ul:Je,underline:Ee,unlink:Oe,viewing:Ae,viewingOff:Qe,lock:_e,lockOpen:$e,type:qe,fontSize:et,bookOpenText:tt,copy:at,moveUp:st,moveDown:it,squarePlus:rt,folder:nt,bookmark:ot,mic:lt,download:ct,edit:dt,library:ht,scene:mt,images:pt,preview:ut,tip:xt,wandSparkles:ft,sparkles:gt,gitHub:e=>r.jsx("svg",{viewBox:"0 0 438.549 438.549",...e,children:r.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:e=>r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...e,children:r.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:bt,sun:vt},$r=Rt,qr=Lt,en=kt,tn=zt,an=i.forwardRef((({className:e,inset:a,children:s,...i},n)=>r.jsxs(wt,{ref:n,className:t("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",e),...i,children:[s,r.jsx(yt,{className:"ml-auto h-4 w-4"})]})));an.displayName=wt.displayName;const sn=i.forwardRef((({className:e,...a},s)=>r.jsx(jt,{ref:s,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})));sn.displayName=jt.displayName;const rn=i.forwardRef((({className:e,sideOffset:a=4,...s},i)=>r.jsx(kt,{children:r.jsx(Nt,{ref:i,sideOffset:a,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})})));rn.displayName=Nt.displayName;const nn=i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(St,{ref:i,className:t("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",e),...s})));nn.displayName=St.displayName,i.forwardRef((({className:e,children:a,checked:s,...i},n)=>r.jsxs(Zt,{ref:n,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...i,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Ct,{children:r.jsx(Gt,{className:"h-4 w-4"})})}),a]}))).displayName=Zt.displayName,i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(Wt,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Ct,{children:r.jsx(Xt,{className:"h-4 w-4 fill-current"})})}),a]}))).displayName=Wt.displayName,i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(Vt,{ref:i,className:t("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",e),...s}))).displayName=Vt.displayName;const on=i.forwardRef((({className:e,...a},s)=>r.jsx(Tt,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),...a})));on.displayName=Tt.displayName;const ln=[{ch:"宋体",en:"SimSun"},{ch:"黑体",en:"SimHei"},{ch:"微软雅黑",en:"Microsoft Yahei"},{ch:"微软正黑体",en:"Microsoft JhengHei"},{ch:"楷体",en:"KaiTi"},{ch:"新宋体",en:"NSimSun"},{ch:"仿宋",en:"FangSong"}],cn=[{ch:"苹方",en:"PingFang SC"},{ch:"冬青黑体简",en:"Hiragino Sans GB"},{ch:"兰亭黑-简",en:"Lantinghei SC"},{ch:"翩翩体-简",en:"Hanzipen SC"},{ch:"手札体-简",en:"Hannotate SC"},{ch:"宋体-简",en:"Songti SC"},{ch:"娃娃体-简",en:"Wawati SC"},{ch:"魏碑-简",en:"Weibei SC"},{ch:"行楷-简",en:"Xingkai SC"},{ch:"雅痞-简",en:"Yapi SC"},{ch:"圆体-简",en:"Yuanti SC"}],dn=[{ch:"幼圆",en:"YouYuan"},{ch:"隶书",en:"LiSu"},{ch:"华文细黑",en:"STXihei"},{ch:"华文黑体",en:"STHeiti"},{ch:"华文楷体",en:"STKaiti"},{ch:"华文宋体",en:"STSong"},{ch:"华文仿宋",en:"STFangsong"},{ch:"华文中宋",en:"STZhongsong"},{ch:"华文彩云",en:"STCaiyun"},{ch:"华文琥珀",en:"STHupo"},{ch:"华文新魏",en:"STXinwei"},{ch:"华文隶书",en:"STLiti"},{ch:"华文行楷",en:"STXingkai"},{ch:"方正舒体",en:"FZShuTi"},{ch:"方正姚体",en:"FZYaoti"}],hn=[{ch:"思源黑体",en:"Source Han Sans CN"},{ch:"思源宋体",en:"Source Han Serif SC"},{ch:"文泉驿微米黑",en:"WenQuanYi Micro Hei"},{ch:"霞鹜文楷",en:"LXGW WenKai"},{ch:"方舟像素",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}],mn=new function(){const e=["monospace","sans-serif","serif"],t=document.getElementsByTagName("body")[0],a=document.createElement("span");a.style.fontSize="72px",a.innerHTML="mmmmmmmmmmlli";const s={},i={};for(const r in e)a.style.fontFamily=e[r],t.appendChild(a),s[e[r]]=a.offsetWidth,i[e[r]]=a.offsetHeight,t.removeChild(a);this.detect=function(r){let n=!1;for(const o in e){a.style.fontFamily=r+","+e[o],t.appendChild(a);const l=a.offsetWidth!=s[e[o]]||a.offsetHeight!=i[e[o]];t.removeChild(a),n=n||l}return n}},pn=[{ch:"Arial",en:"Arial"}].concat([...cn,...ln,...hn,...dn].filter((e=>mn.detect(e.en))));var un=(e=>(e.NORMAL="normal",e.BOLD="bold",e))(un||{}),xn=(e=>(e.NORMAL="normal",e.ITALIC="italic",e))(xn||{});async function fn(e,t){const a=new FontFace(e,"string"==typeof t?`url(${t})`:t);document.fonts.add(a),await a.load()}var gn=(e=>(e.Character="Character",e.Background="Background",e.Thing="Thing",e.Dialog="Dialog",e.Audio="Audio",e.Font="Font",e))(gn||{});const bn=[{name:"角色",value:"Character"},{name:"背景",value:"Background"},{name:"物品",value:"Thing"},{name:"对话框",value:"Dialog"},{name:"音频",value:"Audio"},{name:"字体",value:"Font"}],vn=bn.reduce(((e,{name:t,value:a})=>(e[a]=t,e)),{}),wn=new class extends It{asset;assetSource;template;project;constructor(){super("vnve2"),this.version(3).stores({asset:"++id, name, type, states, [name+type]",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",project:"++id, name, time, content"})}},yn=wn.asset,jn=wn.assetSource,kn=wn.template,Nn=wn.project;function Sn(e){return e.url||`https://s/${e.id}.${e.ext}`}function Zn(e){switch(e){case"Background":case"Character":case"Thing":case"Dialog":return".webp, .png, .jpg, .jpeg, .gif, .mp4";case"Audio":return".mp3, .wav, .m4a, .aac";case"Font":return".ttf, .woff, .woff2";default:return""}}async function Cn(e,t,a){const s={name:e};a&&(s.type=a);const i=await yn.where(s).first();if(t){const e=i.states.find((e=>e.name===t));return e?{...i,stateId:e.id}:void 0}return i}async function Gn(e){return(await yn.where("type").equals(e).toArray()).map((e=>e.name))}const Wn=[{type:gn.Background,assets:[{name:"教室",states:[{name:"白天",url:"/assets/day-b6ef6b0c.webp"},{name:"夜晚",url:"/assets/night-da7c9955.webp"}]},{name:"学校",states:[{name:"白天",url:"/assets/day-c525641b.webp"},{name:"夜晚",url:"/assets/night-61088675.webp"}]}]},{type:gn.Character,assets:[{name:"男主",states:[{name:"默认",url:"/assets/default-9e36bbf3.webp"},{name:"开心",url:"/assets/happy-61fa7adf.webp"}]},{name:"女主",states:[{name:"默认",url:"/assets/default-6a415d65.webp"},{name:"开心",url:"/assets/happy-77097254.webp"}]}]},{type:gn.Thing,assets:[{name:"书",states:[{name:"红色",url:"/assets/red-628f973d.webp"}]}]},{type:gn.Audio,assets:[{name:"BGM",states:[{name:"bgm1",url:"/assets/bgm1-865a2e82.mp3"},{name:"bgm2",url:"/assets/bgm2-9df28d45.mp3"}]},{name:"日常声音",states:[{name:"开门声",url:"/assets/open-door-0aa9286c.mp3"},{name:"敲门声",url:"/assets/knock-door-25770f6b.mp3"},{name:"雨声",url:"/assets/rain-2ed4ca49.mp3"},{name:"雷声",url:"/assets/thunder-fcdc6cdf.mp3"}]}]},{type:gn.Font,assets:[{name:"缝合像素字体",states:[{name:"缝合像素简中",url:"/assets/zh-hans-17f9a740.woff2"},{name:"缝合像素繁中",url:"/assets/zh-hant-df9154bf.woff2"}]}]}],Xn="IS_PRESET_IMPORTED",Vn=[{name:"对话",content:Ur},{name:"独白",content:function(){const e=new hr,t=new Qi;t.alpha=.7,t.beginFill(0),t.drawRect(0,0,1920,1080),t.endFill(),t.x=0,t.y=0,t.zIndex=Hr.Dialog,t.label="独白遮罩";const a=new Ai("独白台词",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return a.x=160,a.y=160,a.zIndex=Hr.Text,a.label="独白台词",a.disableTextEdit=!0,e.addChild(t),e.addChild(a),e.config.speak.targetName=a.name,e.config.speak.dialogTargetName=t.name,e}},{name:"标题",content:function(){const e=new hr,t=new Ai("主标题",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});t.x=960-t.width/2,t.y=340,t.zIndex=Hr.Text,t.label="主标题";const a=new Ai("副标题",{fill:16777215,breakWords:!0,fontSize:60});return a.x=960-a.width/2,a.y=500,a.zIndex=Hr.Text,a.label="副标题",e.addChild(t),e.addChild(a),e.dialogues=[{speak:{wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5},speakerTargetName:"Narrator"}},lines:[{children:[{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:t.name},label:"渐入:主标题"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"FadeIn",params:{targetName:a.name},label:"渐入:副标题"}},{text:""},{children:[{text:""}],type:"directive",value:{directive:"Wait",params:{duration:3},label:"停顿:3秒"}},{text:""}],type:"p"}]}],e}},{name:"空白",content:()=>new hr}];function Tn(){const e=Dr((e=>e.editor)),t=Ft((()=>kn.reverse().toArray()));return{defaultTemplates:Vn,customTemplates:t||[],handleAddDefaultTemplate:(t,a)=>()=>{const s=t();e.addScene(s,a),e.setActiveSceneByName(s.name)},handleAddCustomTemplate:async(t,a)=>{const s=await hr.fromJSON(JSON.parse(t),!1);e.addScene(s,a),e.setActiveSceneByName(s.name)}}}function Rn({onOpenSceneDetailDialog:e}){const t=Dr((e=>e.editor)),a=Dr((e=>e.activeScene)),s=Dr((e=>e.scenes)),{defaultTemplates:n,customTemplates:o,handleAddDefaultTemplate:l,handleAddCustomTemplate:c}=Tn(),d=i.useRef(null);i.useEffect((()=>{d.current&&d.current.scrollIntoView({behavior:"smooth"})}),[s.length]);const h=(e,a)=>{t.swapScene(e,a)};return r.jsx(Jr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:r.jsx(Er,{className:"h-full p-1",children:r.jsx(Ar,{className:"h-full p-2",children:r.jsxs(yi,{children:[r.jsx(ji,{children:r.jsxs(Ni,{children:[r.jsx(Si,{children:"场景"}),r.jsx(Si,{className:"w-[3rem] text-right",children:"操作"})]})}),r.jsx(ki,{children:s.map(((i,m)=>r.jsxs(Ni,{ref:a?.name===i.name?d:null,className:(a?.name===i.name?"bg-muted":"")+" cursor-pointer",children:[r.jsxs(Zi,{onClick:()=>{t.setActiveSceneByName(i.name)},children:[r.jsxs("span",{className:"font-medium mr-1",children:[m+1,"."]}),i.label]}),r.jsxs(Zi,{className:"flex gap-1 justify-end",children:[m>0&&r.jsx(_r.moveUp,{className:"size-4 cursor-pointer",onClick:()=>h(m,m-1)}),m<s.length-1&&r.jsx(_r.moveDown,{className:"size-4 cursor-pointer",onClick:()=>h(m,m+1),children:"下移"}),r.jsxs($r,{modal:!1,children:[r.jsx(qr,{children:r.jsx(_r.more,{className:"size-4 cursor-pointer"})}),r.jsxs(rn,{children:[r.jsx(nn,{className:"flex md:hidden",onClick:e,children:"编辑"}),r.jsxs(tn,{children:[r.jsx(an,{children:"插入"}),r.jsx(en,{children:r.jsxs(sn,{children:[n.map((e=>r.jsx(nn,{onClick:l(e.content,m+1),children:e.name},e.name))),o.length>0&&r.jsx(on,{}),o.map((e=>r.jsx(nn,{onClick:()=>c(e.content,m+1),children:e.name},e.id)))]})})]}),r.jsx(nn,{onClick:()=>((e,a)=>{const s=t.cloneSceneByName(e.name);t.addScene(s,a),t.setActiveSceneByName(s.name)})(i,m+1),children:"复制"}),r.jsx(nn,{className:"text-destructive",onClick:()=>(e=>{e.name===a?.name&&t.setActiveScene(void 0),t.removeSceneByName(e.name)})(i),children:"删除"})]})]})]})]},i.name)))})]})})})})}function Ln(){const e=Br((e=>e.setConfirm)),t=Br((e=>e.setCancel)),a=Br((e=>e.setOpen)),s=Br((e=>e.setType)),i=Br((e=>e.setDisableSelect));return{selectAsset:(r,n)=>new Promise((o=>{e((e=>{o(e),a(!1)})),t((()=>{o(void 0),a(!1)})),a(!0),s(r),i(n)}))}}async function zn(e,t){const a=e.states,s=a.find((t=>t.id===e.stateId))??a[0];let i;return i="gif"===s.ext?new qi({source:Sn(s)}):"mp4"===s.ext?new or({source:Sn(s)}):new $i({source:Sn(s)}),i.label=e.name,i.assetID=e.id,i.assetType=e.type,await i.load(),e.type===gn.Character?(i.zIndex=Hr.Character,i.x=t.options.width/2-i.width/2,i.y=t.options.height-i.height):e.type===gn.Background?(i.zIndex=Hr.Background,i.width=t.options.width,i.height=t.options.height):e.type===gn.Dialog&&(i.zIndex=Hr.Dialog,i.x=t.options.width/2-i.width/2,i.y=t.options.height-i.height),i}function In(e){const t=e.states,a=t.find((t=>t.id===e.stateId))??t[0],s=new cr({source:Sn(a)});return s.label=a.name,s.assetID=e.id,s.assetType=e.type,s}let Fn=!1;function Kn(){return Fn}function Yn(e){let t,a=e;const s=e.match(/^(.+)\[(.+)\]$/);return s&&(a=s[1],t=s[2]),{name:a,stateName:t}}async function Hn(e,t,a=!1){const s=e.split(/\n\s*\n/).filter((e=>""!==e.trim())).map((e=>{const[t,...a]=e.split("\n");return{name:t,value:a.join("\n")}})),i=[];s.forEach((e=>{"标题"===e.name?i.push({name:e.value,background:"",dialogues:[]}):"场景"===e.name?(i[i.length-1]&&!i[i.length-1].background||i.push({name:"",background:"",dialogues:[]}),i[i.length-1].background=e.value):i[i.length-1].dialogues.push(e)})),console.log("screenplay",i);for(const n of i)try{const e=Ur();if(e.label=n.name,t.addScene(e),t.setActiveScene(e),n.background){const{name:e,stateName:s}=Yn(n.background),i=await Cn(e,s,gn.Background);if(i){const e=await zn(i,t);t.addChild(e)}else{const t=`素材库中没有找到名称为"${e}${s?`[${s}]`:""}"的背景素材`;if(!a)throw new Error(t);console.warn(t)}}let s=1;const i=new Set;n.dialogues.forEach((e=>{const{name:t}=Yn(e.name);"旁白"!==t&&i.add(t)}));const r=i.size;for(const o of n.dialogues){const i={targetName:"",speakerTargetName:"",name:""};let n;if("旁白"===o.name)i.speakerTargetName="Narrator";else{const{name:l,stateName:c}=Yn(o.name),d=await Cn(l,c,gn.Character),h=`素材库中没有找到名称为"${l}${c?`[${c}]`:""}"的角色素材`;if(d){const a=e.getChildByLabel(l);if(a){if(i.speakerTargetName=a.name,i.name=a.label,c){const e=d.states,t=e.find((e=>e.id===d.stateId))??e[0];n={type:"directive",value:{directive:"ChangeSource",params:{targetName:a.name,source:Sn(t)},label:`变更:${a.label}:${c}`},children:[{text:""}]}}}else{const e=await zn(d,t);e.x=t.options.width/(r+1)*s-e.width/2,s++,t.addChild(e),i.speakerTargetName=e.name,i.name=e.label}}else{if(i.name=l,!a)throw new Error(h);console.warn(h)}}let l=[];n&&(l=[{text:""},n,{text:""}]),t.addDialogue({speak:{speaker:i},lines:[{type:"p",children:[...l,{text:o.value}]}]})}}catch(r){throw new Error(`${n.name}中存在语法错误：${r.message}`)}}const Mn=Qt,Un=i.forwardRef((({className:e,...a},s)=>r.jsx(Kt,{ref:s,className:t("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",e),...a})));Un.displayName=Kt.displayName;const Dn=i.forwardRef((({className:e,...a},s)=>r.jsx(Yt,{ref:s,className:t("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e),...a})));Dn.displayName=Yt.displayName,i.forwardRef((({className:e,inset:a,children:s,...i},n)=>r.jsxs(Ht,{ref:n,className:t("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a&&"pl-8",e),...i,children:[s,r.jsx(yt,{className:"ml-auto h-4 w-4"})]}))).displayName=Ht.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(Mt,{ref:s,className:t("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}))).displayName=Mt.displayName;const Bn=i.forwardRef((({className:e,align:a="start",alignOffset:s=-4,sideOffset:i=8,...n},o)=>r.jsx(Ut,{children:r.jsx(Dt,{ref:o,align:a,alignOffset:s,sideOffset:i,className:t("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})})));Bn.displayName=Dt.displayName;const Pn=i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(Bt,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",e),...s})));Pn.displayName=Bt.displayName,i.forwardRef((({className:e,children:a,checked:s,...i},n)=>r.jsxs(Pt,{ref:n,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:s,...i,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Jt,{children:r.jsx(Gt,{className:"h-4 w-4"})})}),a]}))).displayName=Pt.displayName,i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(Et,{ref:i,className:t("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[r.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:r.jsx(Jt,{children:r.jsx(Xt,{className:"h-4 w-4 fill-current"})})}),a]}))).displayName=Et.displayName,i.forwardRef((({className:e,inset:a,...s},i)=>r.jsx(Ot,{ref:i,className:t("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",e),...s}))).displayName=Ot.displayName;const Jn=i.forwardRef((({className:e,...a},s)=>r.jsx(At,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),...a})));Jn.displayName=At.displayName;const En=sa,On=ia,An=i.forwardRef((({className:e,...a},s)=>r.jsx(_t,{ref:s,className:t("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a})));An.displayName=_t.displayName;const Qn=i.forwardRef((({className:e,children:a,disableClose:s,...i},n)=>r.jsxs(On,{children:[r.jsx(An,{}),r.jsxs($t,{ref:n,className:t("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...i,children:[a,!s&&r.jsxs(qt,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[r.jsx(ea,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Qn.displayName=$t.displayName;const _n=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});_n.displayName="DialogHeader";const $n=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});$n.displayName="DialogFooter";const qn=i.forwardRef((({className:e,...a},s)=>r.jsx(ta,{ref:s,className:t("text-lg font-semibold leading-none tracking-tight",e),...a})));qn.displayName=ta.displayName;const eo=i.forwardRef((({className:e,...a},s)=>r.jsx(aa,{ref:s,className:t("text-sm text-muted-foreground",e),...a})));eo.displayName=aa.displayName;const to=na("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ao=i.forwardRef((({className:e,...a},s)=>r.jsx(ra,{ref:s,className:t(to(),e),...a})));ao.displayName=ra.displayName;const so=da,io=i.createContext({}),ro=({...e})=>r.jsx(io.Provider,{value:{name:e.name},children:r.jsx(la,{...e})}),no=()=>{const e=i.useContext(io),t=i.useContext(oo),{getFieldState:a,formState:s}=ca(),r=a(e.name,s);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:n}=t;return{id:n,name:e.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...r}},oo=i.createContext({}),lo=i.forwardRef((({className:e,...a},s)=>{const n=i.useId();return r.jsx(oo.Provider,{value:{id:n},children:r.jsx("div",{ref:s,className:t("space-y-2",e),...a})})}));lo.displayName="FormItem";const co=i.forwardRef((({className:e,...a},s)=>{const{error:i,formItemId:n}=no();return r.jsx(ao,{ref:s,className:t(i&&"text-destructive",e),htmlFor:n,...a})}));co.displayName="FormLabel";const ho=i.forwardRef((({...e},t)=>{const{error:a,formItemId:s,formDescriptionId:i,formMessageId:n}=no();return r.jsx(oa,{ref:t,id:s,"aria-describedby":a?`${i} ${n}`:`${i}`,"aria-invalid":!!a,...e})}));ho.displayName="FormControl";const mo=i.forwardRef((({className:e,...a},s)=>{const{formDescriptionId:i}=no();return r.jsx("p",{ref:s,id:i,className:t("text-[0.8rem] text-muted-foreground",e),...a})}));mo.displayName="FormDescription";const po=i.forwardRef((({className:e,children:a,...s},i)=>{const{error:n,formMessageId:o}=no(),l=n?String(n?.message):a;return l?r.jsx("p",{ref:i,id:o,className:t("text-[0.8rem] font-medium text-destructive",e),...s,children:l}):null}));po.displayName="FormMessage";const uo=i.forwardRef((({className:e,type:a,...s},i)=>r.jsx("input",{type:a,className:t("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...s})));uo.displayName="Input";const xo=na("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),fo=i.forwardRef((({className:e,variant:a,size:s,asChild:i=!1,...n},o)=>{const l=i?oa:"button";return r.jsx(l,{className:t(xo({variant:a,size:s,className:e})),ref:o,...n})}));fo.displayName="Button";const go=ha({templateName:ma().min(1,"模板名称不能为空")});function bo({isOpen:e,sceneName:t,onClose:a}){const s=Dr((e=>e.editor)),i=pa({resolver:ua(go),defaultValues:{templateName:""}});return r.jsx(En,{open:e,onOpenChange:e=>{e||a()},children:r.jsxs(Qn,{children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"保存为模板"}),r.jsx(eo,{})]}),r.jsx(so,{...i,children:r.jsxs("form",{onSubmit:i.handleSubmit((async e=>{await kn.add({name:e.templateName,type:"",content:JSON.stringify(s.cloneSceneByName(t))}),a(),i.reset()})),className:"space-y-8",children:[r.jsx(ro,{control:i.control,name:"templateName",render:({field:e})=>r.jsxs(lo,{children:[r.jsx(co,{children:"模板名称"}),r.jsx(ho,{children:r.jsx(uo,{placeholder:"输入模板名称",...e})}),r.jsx(po,{})]})}),r.jsxs("div",{className:"flex justify-end space-x-4",children:[r.jsx(fo,{type:"button",variant:"outline",onClick:a,children:"取消"}),r.jsx(fo,{type:"submit",children:"保存"})]})]})})]})})}function vo({isOpen:e,onClose:t}){const a=Ft((()=>kn.reverse().toArray()));return r.jsx(En,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(Qn,{className:"max-h-[80vh] overflow-auto",children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"模板列表"}),r.jsx(eo,{})]}),r.jsxs(yi,{children:[r.jsx(ji,{children:r.jsxs(Ni,{children:[r.jsx(Si,{children:"模板名称"}),r.jsx(Si,{className:"w-[100px]",children:"操作"})]})}),r.jsx(ki,{children:a?.map((e=>r.jsxs(Ni,{children:[r.jsx(Zi,{children:e.name}),r.jsx(Zi,{children:r.jsxs(fo,{variant:"ghost",size:"icon",onClick:()=>(async e=>{await kn.delete(e)})(e.id),children:[r.jsx(_r.delete,{className:"h-4 w-4"}),r.jsx("span",{className:"sr-only",children:"删除"})]})})]},e.id)))})]})]})})}const wo=i.forwardRef((({className:e,value:a,...s},i)=>r.jsx(xa,{ref:i,className:t("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",e),...s,children:r.jsx(fa,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})));function yo({progress:e,url:t,isOpen:a,onClose:s}){const i=Dr((e=>e.project));return r.jsx(En,{open:a,onOpenChange:e=>{e||s()},children:r.jsxs(Qn,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"导出"}),r.jsx(eo,{})]}),!t&&r.jsx(wo,{value:e.value}),t&&r.jsx("video",{src:t,className:"w-full aspect-[16/9]",controls:!0}),r.jsx($n,{children:t&&r.jsxs(fo,{onClick:()=>{bi(i.name,t)},children:[r.jsx(_r.download,{className:"size-4 mr-1"}),"保存视频"]})})]})})}wo.displayName=xa.displayName;const jo=i.forwardRef((({progress:e,isOpen:t,onReplay:a,onClose:s,onExport:n},o)=>{const l=i.useRef(null);return i.useImperativeHandle(o,(()=>({getPreviewCanvas:()=>l.current}))),r.jsx(En,{open:t,onOpenChange:e=>{e||s()},children:r.jsxs(Qn,{className:"min-w-[80vw]",onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"预览"}),r.jsx(eo,{}),r.jsx("canvas",{ref:l,className:"w-full aspect-[16/9]"}),r.jsx(wo,{value:e.value,className:"mt-2"})]}),r.jsxs($n,{children:[r.jsx(fo,{variant:"ghost",onClick:a,children:r.jsx(_r.refresh,{className:"size-5"})}),r.jsxs(fo,{onClick:n,children:[r.jsx(_r.download,{className:"size-4 mr-1"}),"导出视频"]})]})]})})}));let ko=0;const No=new Map,So=e=>{if(No.has(e))return;const t=setTimeout((()=>{No.delete(e),Wo({type:"REMOVE_TOAST",toastId:e})}),1e6);No.set(e,t)},Zo=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map((e=>e.id===t.toast.id?{...e,...t.toast}:e))};case"DISMISS_TOAST":{const{toastId:a}=t;return a?So(a):e.toasts.forEach((e=>{So(e.id)})),{...e,toasts:e.toasts.map((e=>e.id===a||void 0===a?{...e,open:!1}:e))}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==t.toastId))}}},Co=[];let Go={toasts:[]};function Wo(e){Go=Zo(Go,e),Co.forEach((e=>{e(Go)}))}function Xo({...e}){const t=(ko=(ko+1)%Number.MAX_SAFE_INTEGER,ko.toString()),a=()=>Wo({type:"DISMISS_TOAST",toastId:t});return Wo({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a,update:e=>Wo({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Vo(){const[e,t]=i.useState(Go);return i.useEffect((()=>(Co.push(t),()=>{const e=Co.indexOf(t);e>-1&&Co.splice(e,1)})),[e]),{...e,toast:Xo,dismiss:e=>Wo({type:"DISMISS_TOAST",toastId:e})}}const To=ha({projectName:ma().min(1,"作品名称不能为空")});function Ro({isOpen:e,onClose:t}){const a=Dr((e=>e.editor)),s=Dr((e=>e.setProject)),{toast:i}=Vo(),n=pa({resolver:ua(To),defaultValues:{projectName:""}});return r.jsx(En,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(Qn,{children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"创建新作品"}),r.jsx(eo,{})]}),r.jsx(so,{...n,children:r.jsxs("form",{onSubmit:n.handleSubmit((async e=>{const r={name:e.projectName,content:"",time:Date.now()},o=await Nn.add(r);a.clear(),s({id:o,...r}),t(),n.reset(),i({title:"新作品创建成功!",description:"可以开始添加场景了～",duration:1e3})})),className:"space-y-8",children:[r.jsx(ro,{control:n.control,name:"projectName",render:({field:e})=>r.jsxs(lo,{children:[r.jsx(co,{children:"作品名称"}),r.jsx(ho,{children:r.jsx(uo,{placeholder:"输入作品名称",...e})}),r.jsx(po,{})]})}),r.jsxs("div",{className:"flex justify-end space-x-4",children:[r.jsx(fo,{type:"button",variant:"outline",onClick:t,children:"取消"}),r.jsx(fo,{type:"submit",children:"创建"})]})]})})]})})}function Lo({isOpen:e,onClose:t}){const a=Dr((e=>e.editor)),s=Dr((e=>e.setProject)),n=Ft((()=>Nn.reverse().toArray())),o=i.useRef(!1);return r.jsx(En,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(Qn,{className:"max-h-[80vh] overflow-auto",children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"作品列表"}),r.jsx(eo,{})]}),r.jsxs(yi,{children:[r.jsx(ji,{children:r.jsxs(Ni,{children:[r.jsx(Si,{children:"作品名称"}),r.jsx(Si,{className:"w-[80px]",children:"操作"})]})}),r.jsx(ki,{children:n?.map((e=>r.jsxs(Ni,{children:[r.jsx(Zi,{onClick:()=>(async e=>{if(o.current)return;o.current=!0;const i=await Nn.get(e);a.clear(),i.content&&(await a.loadFromJSON(i.content),a.setActiveSceneByIndex(0)),s(i),t(),setTimeout((()=>{o.current=!1}),100)})(e.id),children:r.jsx("span",{className:"cursor-pointer",children:e.name})}),r.jsxs(Zi,{className:"flex gap-2",children:[r.jsx(_r.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>(async e=>{const t=await Nn.get(e);await Nn.add({name:`${t.name} - 副本`,content:t.content,time:Date.now()})})(e.id)}),r.jsx(_r.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>(async e=>{await Nn.delete(e)})(e.id)})]})]},e.id)))})]})]})})}const zo=Na,Io=ka,Fo=i.forwardRef((({className:e,...a},s)=>r.jsx(ga,{className:t("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a,ref:s})));Fo.displayName=ga.displayName;const Ko=i.forwardRef((({className:e,...a},s)=>r.jsxs(Io,{children:[r.jsx(Fo,{}),r.jsx(ba,{ref:s,className:t("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a})]})));Ko.displayName=ba.displayName;const Yo=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col space-y-2 text-center sm:text-left",e),...a});Yo.displayName="AlertDialogHeader";const Ho=({className:e,...a})=>r.jsx("div",{className:t("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a});Ho.displayName="AlertDialogFooter";const Mo=i.forwardRef((({className:e,...a},s)=>r.jsx(va,{ref:s,className:t("text-lg font-semibold",e),...a})));Mo.displayName=va.displayName;const Uo=i.forwardRef((({className:e,...a},s)=>r.jsx(wa,{ref:s,className:t("text-sm text-muted-foreground",e),...a})));Uo.displayName=wa.displayName;const Do=i.forwardRef((({className:e,...a},s)=>r.jsx(ya,{ref:s,className:t(xo(),e),...a})));Do.displayName=ya.displayName;const Bo=i.forwardRef((({className:e,...a},s)=>r.jsx(ja,{ref:s,className:t(xo({variant:"outline"}),"mt-2 sm:mt-0",e),...a})));function Po({isOpen:e,onConfirm:t,onClose:a}){return r.jsx(zo,{open:e,onOpenChange:e=>{e||a()},children:r.jsxs(Ko,{children:[r.jsxs(Yo,{children:[r.jsx(Mo,{children:"确认清空素材库？"}),r.jsx(Uo,{})]}),r.jsxs(Ho,{children:[r.jsx(Bo,{children:"取消"}),r.jsx(Do,{onClick:()=>{t(),a()},children:"确认"})]})]})})}Bo.displayName=ja.displayName;const Jo=Ga,Eo=i.forwardRef((({className:e,...a},s)=>r.jsx(Sa,{ref:s,className:t("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",e),...a})));Eo.displayName=Sa.displayName;const Oo=i.forwardRef((({className:e,...a},s)=>r.jsx(Za,{ref:s,className:t("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",e),...a})));Oo.displayName=Za.displayName;const Ao=i.forwardRef((({className:e,...a},s)=>r.jsx(Ca,{ref:s,className:t("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...a})));Ao.displayName=Ca.displayName;const Qo=i.forwardRef((({className:e,...a},s)=>r.jsx("textarea",{className:t("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...a})));function _o({isOpen:e,onClose:t,onConfirm:a}){const[s,n]=i.useState("");return i.useEffect((()=>{e&&n("")}),[e]),r.jsx(En,{open:e,onOpenChange:e=>{e||t()},children:r.jsxs(Qn,{className:"min-w-[60vw]",onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(_n,{children:[r.jsxs(qn,{className:"flex items-center gap-2",children:[r.jsx(_r.sparkles,{className:"size-5"}),"智能剧本"]}),r.jsx(eo,{})]}),r.jsxs(Jo,{defaultValue:"convert",onValueChange:()=>n(""),children:[r.jsxs(Eo,{className:"grid w-full grid-cols-2",children:[r.jsx(Oo,{value:"convert",children:"转换剧本"}),r.jsx(Oo,{value:"generate",children:"生成剧本"})]}),r.jsx(Ao,{value:"convert",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx(Qo,{placeholder:"请在此处输入您的小说、故事内容",rows:12,value:s,onChange:e=>n(e.target.value)}),r.jsx("div",{className:"flex justify-center",children:r.jsxs(fo,{onClick:()=>a("convert",s),children:[r.jsx(_r.wandSparkles,{className:"size-4 mr-1"}),"一键转换"]})})]})}),r.jsx(Ao,{value:"generate",children:r.jsxs("div",{className:"space-y-2",children:[r.jsx(Qo,{placeholder:"请输入您的故事剧情大纲",rows:12,value:s,onChange:e=>n(e.target.value)}),r.jsx("div",{className:"flex justify-center",children:r.jsxs(fo,{onClick:()=>a("generate",s),children:[r.jsx(_r.wandSparkles,{className:"size-4 mr-1"}),"一键生成"]})})]})})]})]})})}async function $o(){return{characters:(await Gn(gn.Character)).join("、"),backgrounds:(await Gn(gn.Background)).join("、")}}async function qo(e,t){const a=new URLSearchParams(window.location.search),s=a.get("key"),i=a.get("model"),r=a.get("platform")??"ark",n=new Wa({apiKey:s,baseURL:`${location.origin}/api/${r}`,dangerouslyAllowBrowser:!0}),o=await n.chat.completions.create({messages:[{role:"system",content:e},{role:"user",content:t}],model:i});let l=o.choices[0]?.message?.content;return console.log(l),l&&(l=l.replace(/^```[\r\n]?|```[\r\n]?$/g,"")),l}function el(){const e=Dr((e=>e.initEditor)),t=Dr((e=>e.project)),a=Dr((e=>e.editor)),s=Dr((e=>e.activeScene)),n=Dr((e=>e.scenes)),{selectAsset:o}=Ln(),l=i.useRef(null),c=i.useRef(null),{defaultTemplates:d,customTemplates:h,handleAddDefaultTemplate:m,handleAddCustomTemplate:p}=Tn(),[u,x]=i.useState(!1),[f,g]=i.useState(!1),[b,v]=i.useState(!1),[w,y]=i.useState(!1),[j,k]=i.useState(!1),[N,S]=i.useState(!1),[Z,C]=i.useState(!1),G=i.useRef(null),[W,X]=i.useState([]),[V,T]=i.useState(null),R=i.useRef(null),[L,z]=i.useState({value:0,currentTime:0,duration:0}),I=i.useRef(0),[F,K]=i.useState(""),{toast:Y}=Vo(),{showLoading:H,hideLoading:M}=function(){const e=Pr((e=>e.setOpen)),t=Pr((e=>e.setLoadingText));return{showLoading:a=>{e(!0),t(a)},hideLoading:()=>{e(!1),t("")}}}(),U=()=>{z({value:0,currentTime:0,duration:0})},D=()=>{const e=l.current,t=c.current;if(e&&t){const a=e.clientWidth,s=e.clientHeight,i=16/9;let r=a,n=a/i;n>s&&(n=s,r=s*i),t.style.width=`${r}px`,t.style.height=`${n}px`}},B=i.useCallback((async e=>{try{const s=new Date;await Nn.update(t.id,{content:a.saveAsJSON(),time:s.getTime()}),K(s.toLocaleString()),e||Y({title:"保存成功！",duration:1500})}catch(s){Y({title:"保存失败！",description:s.message,variant:"destructive"})}}),[Y,a,t]),P=e=>async()=>{const t=await o(e);if(t){const e=await zn(t,a);a.addChild(e)}},J=async(e=0,t)=>{U(),X([e,t]),k(!0);const s=await a.exportScreenplay(e,t),i=new Yr({canvas:G.current.getPreviewCanvas(),width:1920,height:1080,fps:30,disableAudio:Kn()});R.current.connect(i),R.current.action(s).then((()=>{console.log("预览完成")})).catch((e=>{k(!1),Y({title:"预览失败！",description:e.message,variant:"destructive"})}))},E=async(e=0,t)=>{U(),y(!0),T(null);const s=await a.exportScreenplay(e,t),i=new Kr({width:1920,height:1080,fps:30,disableAudio:Kn()});R.current.connect(i),R.current.action(s).then((e=>{const t=URL.createObjectURL(e);T(t)})).catch((e=>{y(!1),Y({title:"导出失败！",description:e.message,variant:"destructive"})}))};return i.useEffect((()=>{if(t){const e=setInterval((async()=>{B(!0)}),6e4);return()=>{clearInterval(e)}}}),[t,B]),i.useEffect((()=>(window.addEventListener("resize",D),D(),e(c.current),R.current=new Tr({onProgress(e,t,a){((e,t,a)=>{if(e>=100)return z({value:e,currentTime:t,duration:a}),I.current&&clearTimeout(I.current),void(I.current=0);I.current||(I.current=setTimeout((()=>{z({value:e,currentTime:t,duration:a}),I.current=0}),1e3/30))})(e,t,a)}}),c.current.onselectstart=function(){return!1},()=>{window.removeEventListener("resize",D)})),[e]),r.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[r.jsxs(Un,{children:[r.jsxs(Mn,{children:[r.jsxs(Dn,{className:"data-[disabled]:text-gray-400",children:[r.jsx(_r.library,{className:"size-4 mr-0.5"}),"作品"]}),r.jsxs(Bn,{children:[r.jsx(Pn,{onClick:()=>x(!0),children:"创建新作品"}),r.jsx(Pn,{onClick:()=>g(!0),children:"打开..."}),r.jsx(Pn,{disabled:!t,onClick:()=>B(),children:"保存"}),F&&r.jsxs(Pn,{className:"text-muted-foreground",children:["自动保存于",F]}),r.jsx(Jn,{}),r.jsx(Pn,{onClick:async()=>{try{await async function(){const e=await wn.export();bi("book",URL.createObjectURL(e),"vnve")}()}catch(e){Y({title:"导出作品失败！",description:e.message,variant:"destructive"})}},children:"导出..."}),r.jsx(Pn,{onClick:async()=>{H("作品导入中");try{await async function(){const e=(await wi({accept:".vnve"}))[0];e&&await wn.import(e)}()}catch(e){Y({title:"导入作品失败！",description:e.message,variant:"destructive"})}finally{M()}},children:"导入..."})]})]}),r.jsxs(Mn,{children:[r.jsxs(Dn,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[r.jsx(_r.scene,{className:"size-4 mr-0.5"}),"场景"]}),r.jsxs(Bn,{children:[d.map((e=>r.jsxs(Pn,{onClick:m(e.content),children:["新建",e.name]},e.name))),h.length>0&&r.jsx(Jn,{}),h.map((e=>r.jsxs(Pn,{onClick:()=>p(e.content),children:["新建",e.name]},e.id))),r.jsx(Jn,{}),r.jsx(Pn,{onClick:async()=>{const e=(await wi({accept:".txt"}))[0];H("剧本导入中");try{const t=await function(e){return new Promise(((t,a)=>{const s=new FileReader;s.onload=e=>{e.target&&t(e.target.result)},s.onerror=a,s.readAsText(e)}))}(e);await Hn(t,a)}catch(t){Y({title:"导入失败！",description:t.message,variant:"destructive"})}finally{M()}},children:"导入剧本..."}),location.search.includes("key=")&&r.jsx(Pn,{onClick:()=>C(!0),children:"智能剧本..."}),r.jsx(Jn,{}),r.jsx(Pn,{onClick:()=>v(!0),children:"管理模版..."})]})]}),r.jsxs(Mn,{children:[r.jsxs(Dn,{className:"data-[disabled]:text-gray-400",disabled:!t,children:[r.jsx(_r.images,{className:"size-4 mr-0.5"}),"素材"]}),r.jsxs(Bn,{children:[r.jsx(Pn,{disabled:!s,onClick:P(gn.Character),children:"添加角色"}),r.jsx(Pn,{disabled:!s,onClick:P(gn.Background),children:"添加背景"}),r.jsx(Pn,{disabled:!s,onClick:P(gn.Thing),children:"添加物品"}),r.jsx(Pn,{disabled:!s,onClick:()=>{const e=function(e){const t=new Ai("自定义文案",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:60,leading:15});return t.x=e.options.width/2-t.width/2,t.y=e.options.height/2-t.height/2,t.zIndex=Hr.Text,t.label="自定义文案"+t.name,t}(a);a.addChild(e)},children:"添加文字"}),r.jsx(Jn,{}),r.jsx(Pn,{onClick:async()=>{H("素材导入中");try{await async function(){const e=await window.showDirectoryPicker();for(const t of bn){const a=await e.getDirectoryHandle(t.name).catch((()=>{}));if(a)for await(const[e,s]of a.entries())if("directory"===s.kind){const a=await yn.add({name:e,type:t.value,states:[]});for await(const[,e]of s.entries())if("file"===e.kind){const s=await e.getFile(),{name:i,ext:r}=vi(s);if(Zn(t.value).includes(r)){const e=await jn.add({mime:s.type,blob:s,ext:r});await yn.where("id").equals(a).modify((t=>{t.states.push({id:e,name:i,ext:r})}))}}}}}()}catch(e){Y({title:"导入失败！",description:e.message,variant:"destructive"})}finally{M()}},children:"导入素材库..."}),r.jsx(Pn,{onClick:()=>o(void 0,!0),children:"管理素材库..."}),r.jsx(Pn,{className:"text-destructive",onClick:()=>S(!0),children:"清空素材库"})]})]}),r.jsxs(Mn,{children:[r.jsxs(Dn,{disabled:0===n.length,className:"data-[disabled]:text-gray-400",children:[r.jsx(_r.preview,{className:"size-4 mr-0.5"}),"预览"]}),r.jsxs(Bn,{children:[r.jsx(Pn,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();J(e,e+1)},children:"仅预览当前场景"}),r.jsx(Pn,{disabled:!s,onClick:()=>J(a.getActiveSceneIndex()),children:"从当前场景开始预览"}),r.jsx(Pn,{onClick:()=>J(),children:"预览全部场景"})]})]}),r.jsxs(Mn,{children:[r.jsxs(Dn,{disabled:0===n.length,className:"data-[disabled]:text-gray-400",children:[r.jsx(_r.download,{className:"size-4 mr-0.5"}),"导出"]}),r.jsxs(Bn,{children:[r.jsx(Pn,{disabled:!s,onClick:()=>{const e=a.getActiveSceneIndex();E(e,e+1)},children:"仅导出当前场景"}),r.jsx(Pn,{disabled:!s,onClick:()=>E(a.getActiveSceneIndex()),children:"从当前场景开始导出"}),r.jsx(Pn,{onClick:()=>E(),children:"导出全部场景"})]})]})]}),r.jsx(Jr,{className:"flex-1 rounded-md relative",children:r.jsx(Er,{className:"relative h-full p-2",children:r.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:l,children:r.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),r.jsx(Lo,{isOpen:f,onClose:()=>g(!1)}),r.jsx(vo,{isOpen:b,onClose:()=>v(!1)}),r.jsx(yo,{progress:L,url:V,isOpen:w,onClose:()=>{y(!1),R.current.hasStarted()&&R.current.cut(),V&&URL.revokeObjectURL(V),T(null)}}),r.jsx(jo,{progress:L,ref:G,isOpen:j,onReplay:async()=>{R.current.hasStarted()&&await R.current.cut(),J(...W)},onClose:()=>{k(!1),R.current.hasStarted()&&R.current.cut()},onExport:()=>{k(!1),E(...W)}}),r.jsx(Ro,{isOpen:u,onClose:()=>x(!1)}),r.jsx(Po,{isOpen:N,onConfirm:async()=>{await async function(){await jn.clear(),await yn.clear()}(),Y({title:"清空成功！",duration:1500})},onClose:()=>S(!1)}),r.jsx(_o,{isOpen:Z,onClose:()=>C(!1),onConfirm:async(e,t)=>{C(!1),H("convert"===e?"智能转换中":"智能生成中");try{"convert"===e?await async function(e,t){const{characters:a,backgrounds:s}=await $o(),i=`请你扮演一位专业的视觉小说剧本作家，将我提供的故事原文改编为符合视觉小说格式的剧本。改编时请注意以下几点要求：\n\n1. 角色名：所有角色名必须使用中文，不得使用任何其他语言或符号。请确保所有角色名只能是以下列表中的名字：${a}。不要使用其他名字。\n2. 场景：请确保所有场景只能是在以下列表中的：${s}。不要使用其他场景。\n3. 内容结构：剧本内容必须包括详细的场景描述、旁白以及角色台词，且必须严格遵循以下的输出格式：\n\`\`\`\n场景\n{场景名称}\n\n旁白\n{详细的旁白内容，尽可能营造氛围并推动剧情发展。}\n\n{角色名}\n{角色的台词内容，需符合角色的性格与当前情景。}\n\n\`\`\`\n4. 格式规范：输出格式必须与示例完全一致，不得增加或减少任何多余的符号、空行或内容。\n5. 语言风格：剧本语言需具有叙事性和文学性，旁白需渲染场景氛围，台词需贴合角色个性。\n\n以下是输出格式示例：\n示例：\n\`\`\`\n场景\n密室\n\n旁白\n旁白内容\n\n男主\n男主的台词\n\n女主\n女主的台词\n\`\`\`\n请根据以上要求，将以下故事原文改编为视觉小说剧本：`,r=`故事原文：${e}`;return Hn(await qo(i,r),t,!0)}(t,a):await async function(e,t){const{characters:a,backgrounds:s}=await $o(),i=`请你扮演一位专业的视觉小说剧本作家，根据我提供的剧情大纲创作视觉小说剧本。创作时请注意以下几点要求：\n\n1. 角色名：所有角色名必须使用中文，不得使用任何其他语言或符号。请确保所有角色名只能是以下列表中的名字：${a}。不要使用其他名字。\n2. 场景：请确保所有场景只能是在以下列表中的：${s}。不要使用其他场景。\n3. 内容结构：剧本内容必须包括详细的场景描述、旁白以及角色台词，且必须严格遵循以下的输出格式：\n\`\`\`\n场景\n{场景名称}\n\n旁白\n{详细的旁白内容，尽可能营造氛围并推动剧情发展。}\n\n{角色名}\n{角色的台词内容，需符合角色的性格与当前情景。}\n\n\`\`\`\n4. 格式规范：输出格式必须与示例完全一致，不得增加或减少任何多余的符号、空行或内容。\n5. 语言风格：剧本语言需具有叙事性和文学性，旁白需渲染场景氛围，台词需贴合角色个性。\n\n以下是输出格式示例：\n示例：\n\`\`\`\n场景\n密室\n\n旁白\n旁白内容\n\n男主\n男主的台词\n\n女主\n女主的台词\n\`\`\`\n请根据以上要求，按照以下剧情大纲创作视觉小说剧本：`,r=`剧情大纲是：${e}`;return Hn(await qo(i,r),t,!0)}(t,a)}catch(s){Y({title:("convert"===e?"转换":"生成")+"失败！",description:s.message,variant:"destructive"})}finally{M()}}})]})}function tl(){const e=Dr((e=>e.editor)),t=Dr((e=>e.activeChild)),a=Dr((e=>e.activeScene)),s=i.useMemo((()=>{if(!a)return[];const e=[],t=[],s=[],i=[],r=a.sounds;for(const n of a.children)n.assetType===gn.Character?e.push(n):n.assetType===gn.Background?s.push(n):n.assetType===gn.Thing?t.push(n):n.name&&i.push(n);return[{label:"角色",children:e},{label:"物品",children:t},{label:"背景",children:s},{label:"其他",children:i},{label:"音频",children:r}]}),[a]),n=t=>{e.toggleChildVisibleByName(t.name)},o=t=>{e.toggleChildInteractiveByName(t.name)};return r.jsx(Ar,{className:"h-full pr-2",children:r.jsx("div",{className:"space-y-4",children:s.map((a=>a.children.length>0&&r.jsxs("fieldset",{className:"rounded-md border p-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:a.label}),r.jsx("div",{className:"flex flex-col gap-1",children:a.children.map((a=>r.jsx("div",{className:"text-sm p-1 px-2 border rounded "+(t?.name===a.name?"bg-muted":""),children:r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("div",{onClick:()=>(t=>{t.assetType!==gn.Audio&&e.setActiveChildByName(t.name)})(a),className:"cursor-pointer flex-1",children:a.label}),r.jsxs("div",{className:"flex space-x-2 items-center",children:[a.assetType!==gn.Audio&&r.jsxs(r.Fragment,{children:[a.visible?r.jsx(_r.viewing,{onClick:()=>n(a),className:"size-4 cursor-pointer"}):r.jsx(_r.viewingOff,{onClick:()=>n(a),className:"size-4 cursor-pointer"}),a.interactive?r.jsx(_r.lockOpen,{onClick:()=>o(a),className:"size-4 cursor-pointer"}):r.jsx(_r.lock,{onClick:()=>o(a),className:"size-4 cursor-pointer"})]}),r.jsx(_r.trash2,{onClick:()=>(a=>{a.assetType!==gn.Audio?(e.removeChildByName(a.name),t?.name===a.name&&e.setActiveChild(void 0)):e.removeSoundByName(a.name)})(a),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},a.name)))})]},a.label)))})})}Qo.displayName="Textarea";const al=i.forwardRef((({className:e,...a},s)=>r.jsxs(Xa,{ref:s,className:t("relative flex w-full touch-none select-none items-center",e),...a,children:[r.jsx(Va,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:r.jsx(Ta,{className:"absolute h-full bg-primary"})}),r.jsx(Ra,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})));function sl(){const e=Dr((e=>e.editor)),t=Dr((e=>e.activeChild)),a=(t,a)=>s=>{e.updateActiveChild((e=>{e[t]="number"===a?Number(s.target.value):s.target.value}))};return r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"w-5",children:"宽"}),r.jsx(uo,{value:t.width.toFixed(0),onChange:a("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"w-5",children:"高"}),r.jsx(uo,{value:t.height.toFixed(0),onChange:a("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"w-5",children:"X"}),r.jsx(uo,{value:t.x.toFixed(0),onChange:a("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"w-5",children:"Y"}),r.jsx(uo,{value:t.y.toFixed(0),onChange:a("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"flex-shrink-0 mr-2",children:"透明度"}),r.jsx(al,{min:0,max:1,step:.1,value:[t.alpha],onValueChange:t=>{return(a="alpha",t=>{e.updateActiveChild((e=>{e[a]=t}))})(t[0]);var a}})]})]})}al.displayName=Xa.displayName;const il=Aa,rl=Qa,nl=_a,ol=i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(La,{ref:i,className:t("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),"data-disable-click-outside":!0,...s,children:[a,r.jsx(za,{asChild:!0,children:r.jsx(Ia,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]})));ol.displayName=La.displayName;const ll=i.forwardRef((({className:e,...a},s)=>r.jsx(Fa,{ref:s,className:t("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...a,children:r.jsx(Ka,{})})));ll.displayName=Fa.displayName;const cl=i.forwardRef((({className:e,...a},s)=>r.jsx(Ya,{ref:s,className:t("flex cursor-default items-center justify-center py-1",e),"data-disable-click-outside":!0,...a,children:r.jsx(Ha,{})})));cl.displayName=Ya.displayName;const dl=i.forwardRef((({className:e,children:a,position:s="popper",...i},n)=>r.jsx(Ma,{children:r.jsxs(Ua,{ref:n,className:t("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,"data-disable-click-outside":!0,...i,children:[r.jsx(ll,{}),r.jsx(Da,{className:t("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:a}),r.jsx(cl,{})]})})));dl.displayName=Ua.displayName;const hl=i.forwardRef((({className:e,...a},s)=>r.jsx(Ba,{ref:s,className:t("px-2 py-1.5 text-sm font-semibold",e),...a,"data-disable-click-outside":!0})));hl.displayName=Ba.displayName;const ml=i.forwardRef((({className:e,children:a,...s},i)=>r.jsxs(Pa,{ref:i,className:t("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),"data-disable-click-outside":!0,...s,children:[r.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:r.jsx(Ja,{children:r.jsx(Gt,{className:"h-4 w-4"})})}),r.jsx(Ea,{"data-disable-click-outside":!0,children:a})]})));ml.displayName=Pa.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(Oa,{ref:s,className:t("-mx-1 my-1 h-px bg-muted",e),"data-disable-click-outside":!0,...a}))).displayName=Oa.displayName;const pl=es,ul=ts,xl=i.forwardRef((({className:e,align:a="center",sideOffset:s=4,...i},n)=>r.jsx($a,{children:r.jsx(qa,{ref:n,align:a,sideOffset:s,className:t("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i})})));xl.displayName=qa.displayName;const fl=i.forwardRef((({disabled:e,value:a,onChange:s,onBlur:n,name:o,className:l,...c},d)=>{const h=function(e){const t=i.useRef(null);return i.useEffect((()=>{e&&("function"==typeof e?e(t.current):e.current=t.current)})),t}(d),[m,p]=i.useState(!1),u=i.useMemo((()=>a||"#FFFFFF"),[a]);return r.jsxs(pl,{onOpenChange:p,open:m,children:[r.jsx(ul,{asChild:!0,disabled:e,onBlur:n,children:r.jsx(fo,{...c,className:t("block",l),name:o,onClick:()=>{p(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:r.jsx("div",{})})}),r.jsxs(xl,{className:"w-full",children:[r.jsx(as,{color:u,onChange:s}),r.jsx(uo,{className:"mt-2",maxLength:7,onChange:e=>{s(e?.currentTarget?.value)},ref:h,value:u})]})]})}));fl.displayName="ColorPicker";const gl=na("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}});i.forwardRef((({className:e,variant:a,size:s,...i},n)=>r.jsx(ss,{ref:n,className:t(gl({variant:a,size:s,className:e})),...i}))).displayName=ss.displayName;const bl=i.createContext({size:"default",variant:"default"}),vl=i.forwardRef((({className:e,variant:a,size:s,children:i,...n},o)=>r.jsx(is,{ref:o,className:t("flex items-center justify-center gap-1",e),...n,children:r.jsx(bl.Provider,{value:{variant:a,size:s},children:i})})));vl.displayName=is.displayName;const wl=i.forwardRef((({className:e,children:a,variant:s,size:n,...o},l)=>{const c=i.useContext(bl);return r.jsx(rs,{ref:l,className:t(gl({variant:c.variant||s,size:c.size||n}),e),...o,children:a})}));function yl(){const e=Dr((e=>e.editor)),t=Dr((e=>e.activeChild)),a=Ft((()=>yn.where("type").equals(gn.Font).reverse().toArray())),s=i.useMemo((()=>{const e=[];if(!a)return e;for(const t of a)for(const a of t.states)e.push({ch:a.name,en:a.name});return e}),[a]),n=t=>a=>{e.updateActiveChild((e=>{e.style[t]=a}))};return r.jsxs("div",{className:"flex flex-col gap-3",children:[!t.disableTextEdit&&r.jsx("div",{className:"flex gap-2",children:r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(_r.bookOpenText,{className:"w-5 h-5"}),r.jsx(uo,{value:t.text,onChange:(o="text",t=>{e.updateActiveChild((e=>{e[o]="number"===l?Number(t.target.value):t.target.value}))})})]})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(_r.color,{className:"w-5 h-5"}),r.jsx(fl,{value:t.style.fill,onChange:n("fill"),className:"w-6 h-6"})]}),r.jsx("div",{className:"flex-1 flex gap-1 items-center",children:r.jsxs(vl,{type:"multiple",value:[t.style.fontWeight,t.style.fontStyle],onValueChange:t=>{e.updateActiveChild((e=>{e.style.fontWeight=t.includes(un.BOLD)?un.BOLD:un.NORMAL,e.style.fontStyle=t.includes(xn.ITALIC)?xn.ITALIC:xn.NORMAL}))},children:[r.jsx(wl,{value:un.BOLD,className:"p-2",children:r.jsx(_r.bold,{className:"size-4"})}),r.jsx(wl,{value:xn.ITALIC,className:"p-2",children:r.jsx(_r.italic,{className:"size-4"})})]})})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[r.jsx(_r.type,{className:"w-5 h-5"}),r.jsxs(il,{onValueChange:n("fontFamily"),value:t.style.fontFamily,children:[r.jsx(ol,{className:"h-6 max-w-[150px]",children:r.jsx(nl,{placeholder:"---"})}),r.jsx(dl,{children:[...s,...pn].map((e=>r.jsx(ml,{value:e.en,children:e.ch},e.en)))})]})]}),r.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[r.jsx(_r.fontSize,{className:"w-5 h-5"}),r.jsx(uo,{value:String(t.style.fontSize),onChange:((t,a)=>s=>{e.updateActiveChild((e=>{e.style[t]="number"===a?Number(s.target.value):s.target.value}))})("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]});var o,l}function jl(){const e=Dr((e=>e.editor)),t=Dr((e=>e.activeChild)),{selectAsset:a}=Ln();return r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[r.jsx(ao,{className:"flex-shrink-0 mr-2",children:"填充色"}),r.jsx(fl,{value:t.fillColor,onChange:t=>{e.updateActiveChild((e=>{const a=e.width,s=e.height;e.fillColor=t,e.clear().beginFill(t).drawRect(0,0,a,s).endFill()}))},className:"w-6 h-6"})]}),r.jsx(fo,{size:"sm",onClick:async()=>{const s=await a(gn.Dialog),i=await zn(s,e);e.addChild(i),e.updateActiveScene((e=>{e.config.speak.dialogTargetName=i.name})),e.setActiveChildByName(i.name),e.removeChildByName(t.name)},children:"自定义对话框"})]})}function kl(){const e=Dr((e=>e.activeChild));return r.jsx(Ar,{className:"h-full pr-2",children:e&&r.jsxs(r.Fragment,{children:[r.jsxs("fieldset",{className:"rounded-md border p-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"基础属性"}),r.jsx(sl,{})]}),"Text"===e.type&&r.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"文字属性"}),r.jsx(yl,{})]}),"Graphics"===e.type&&r.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"对话框属性"}),r.jsx(jl,{})]})]})})}wl.displayName=rs.displayName;const Nl=os,Sl=ls,Zl=cs,Cl=i.forwardRef((({className:e,sideOffset:a=4,...s},i)=>r.jsx(ns,{ref:i,sideOffset:a,className:t("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})));function Gl(){const e=Dr((e=>e.editor)),t=Dr((e=>e.activeChild)),a=t=>()=>{switch(t){case"top":e.moveChildToTop();break;case"bottom":e.moveChildToBottom();break;case"up":e.moveUpChild();break;case"down":e.moveDownChild()}},s=t=>()=>{e.setChildPosition(t)};return r.jsx(Ar,{className:"h-full pr-2",children:t&&r.jsxs("div",{children:[r.jsxs("fieldset",{className:"rounded-md border p-1",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"层级"}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{children:[r.jsx(fo,{size:"sm",variant:"ghost",onClick:a("top"),children:"置顶"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:a("up"),children:"上移"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:a("down"),children:"下移"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:a("bottom"),children:"置底"})]}),r.jsxs("div",{children:[r.jsx(fo,{size:"sm",variant:"ghost",onClick:async()=>{const t=e.cloneChild();if("Sprite"===t.type){const e=t;await e.load()}t.x+=.1*t.width,t.y+=.1*t.height,e.addChild(t),e.setActiveChildByName(t.name)},children:r.jsx(_r.copy,{className:"size-4"})}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:()=>{e.activeChild&&e.removeChildByName(e.activeChild.name),e.setActiveChild(void 0)},children:r.jsx(_r.delete,{className:"size-4"})})]})]})]}),r.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"水平位置"}),r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("div",{children:[r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("left"),children:"左"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("near-left"),children:"1/3"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("center"),children:"中"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("near-right"),children:"2/3"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("right"),children:"右"})]}),t.assetType===gn.Character&&r.jsx(Nl,{children:r.jsxs(Sl,{children:[r.jsx(Zl,{asChild:!0,children:r.jsx(fo,{size:"sm",variant:"ghost",onClick:()=>{const t=e.activeScene.getChildrenByAssetType(gn.Character),a=t.length;let s=1;for(const i of t)i.x=e.options.width/(a+1)*s-i.width/2,i.y=e.options.height-i.height,s++},children:"自动"})}),r.jsx(Cl,{children:r.jsx("p",{children:"根据角色人数，自动排列全部角色"})})]})})]})]}),r.jsxs("fieldset",{className:"rounded-md border p-1 mt-2",children:[r.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"垂直位置"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("top"),children:"上"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("middle"),children:"中"}),r.jsx(fo,{size:"sm",variant:"ghost",onClick:s("bottom"),children:"下"})]})]})})}function Wl(){return r.jsx(Jr,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:r.jsx(Er,{className:"h-full p-2",children:r.jsxs(Jo,{defaultValue:"position",className:"h-full flex flex-col",children:[r.jsxs(Eo,{className:"self-center",children:[r.jsx(Oo,{value:"position",children:"位置"}),r.jsx(Oo,{value:"style",children:"样式"}),r.jsx(Oo,{value:"list",children:"列表"})]}),r.jsx(Ao,{className:"h-[calc(100%-2.5rem)]",value:"position",children:r.jsx(Gl,{})}),r.jsx(Ao,{className:"h-[calc(100%-2.5rem)]",value:"style",children:r.jsx(kl,{})}),r.jsx(Ao,{className:"h-[calc(100%-2.5rem)]",value:"list",children:r.jsx(tl,{})})]})})})}function Xl(){const e=Dr((e=>e.project));return r.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center justify-between gap-1 border-b bg-background px-4",children:[r.jsxs("h1",{className:"text-xl font-bold",children:["V N V E",e&&r.jsxs("span",{className:"text-xs text-muted-foreground",children:["【",e.name,"】"]})]}),r.jsx(_r.gitHub,{className:"size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]})}Cl.displayName=ns.displayName;const Vl=na(ds("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),Tl=hs.forwardRef((({className:e,disabled:t,focusRing:a,focused:s,readOnly:i,size:n,variant:o,...l},c)=>r.jsx("div",{className:"relative w-full",ref:c,children:r.jsx(ms,{"aria-disabled":t,className:ds(Vl({disabled:t,focusRing:a,focused:s,size:n,variant:o}),e),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:t??i,...l})})));Tl.displayName="Editor";const Rl=na("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),Ll=ps(us(xs,{decorative:!0,orientation:"horizontal"}),Rl),zl=os,Il=ls,Fl=cs,Kl=gs,Yl=fs(us(ns,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md"),Hl=fs(ws,"relative flex select-none items-center gap-1 bg-background"),Ml=fs(ys,"flex items-center");fs(js,"font-medium underline underline-offset-4"),fs(ks,"my-1 w-px shrink-0 bg-border");const Ul=na(ds("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),Dl=(Bl=i.forwardRef((({children:e,className:t,isDropdown:a,pressed:s,size:i,variant:n,...o},l)=>"boolean"==typeof s?r.jsx(Ml,{disabled:o.disabled,type:"single",value:"single",children:r.jsx(Pl,{className:ds(Ul({size:i,variant:n}),a&&"my-1 justify-between pr-1",t),ref:l,value:s?"single":"",...o,children:a?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"flex flex-1",children:e}),r.jsx("div",{children:r.jsx(_r.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):e})}):r.jsx(bs,{className:ds(Ul({size:i,variant:n}),a&&"pr-1",t),ref:l,...o,children:e}))),hs.forwardRef((function({tooltip:e,tooltipContentProps:t,tooltipProps:a,...s},i){const[n,o]=hs.useState(!1);hs.useEffect((()=>{o(!0)}),[]);const l=r.jsx(Bl,{ref:i,...s});return e&&n?r.jsx(zl,{children:r.jsxs(Il,{...a,children:[r.jsx(Fl,{asChild:!0,children:l}),r.jsx(Kl,{children:r.jsx(Yl,{...t,children:e})})]})}):l})));var Bl;Dl.displayName="ToolbarButton";const Pl=ps(Ns,Ul,["variant","size"]),Jl=vs((({children:e,className:t,noSeparator:a},s)=>{const n=i.Children.map(e,(e=>e));return n&&0!==n.length?r.jsxs("div",{className:ds("flex",t),ref:s,children:[!a&&r.jsx("div",{className:"h-full py-2",children:r.jsx(Ll,{orientation:"vertical"})}),r.jsx("div",{className:"mx-1 flex items-center gap-1",children:e})]}):null})),El=fs(Hl,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),Ol=Rt,Al=Lt;vs((({children:e,className:t,inset:a,...s},i)=>r.jsxs(wt,{className:ds("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),ref:i,...s,children:[e,r.jsx(_r.chevronRight,{className:"ml-auto size-4"})]}))),fs(jt,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const Ql=us(Nt,{className:ds("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),_l=vs((({...e},t)=>r.jsx(kt,{children:r.jsx(Ql,{ref:t,...e})}))),$l=na(ds("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),ql=ps(St,$l,["inset"]);vs((({children:e,className:t,...a},s)=>r.jsxs(Zt,{className:ds("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",t),ref:s,...a,children:[r.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:r.jsx(Ct,{children:r.jsx(_r.check,{className:"size-4"})})}),e]}))),vs((({children:e,className:t,hideIcon:a,...s},i)=>r.jsxs(Wt,{className:ds("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",t),ref:i,...s,children:[!a&&r.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:r.jsx(Ct,{children:r.jsx(_r.check,{className:"size-4"})})}),e]})));const ec=na(ds("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),tc=ps(Vt,ec,["inset"]),ac=fs(Tt,"-mx-1 my-1 h-px bg-muted");fs(Ss("span"),"ml-auto text-xs tracking-widest opacity-60");const sc=()=>{const[e,t]=i.useState(!1);return{onOpenChange:i.useCallback(((a=!e)=>{t(a)}),[e]),open:e}},ic=Zs(Cs({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions((({getOptions:e})=>({isOpen:t=>e().openEditorId===t}))).extendEditorApi((({setOptions:e})=>({floatingDirective:{hide:()=>{e({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(t,a,s,i)=>{e({mode:t,openEditorId:a,editingDirective:s,directiveType:i})}}}))).extendEditorTransforms((({editor:e,type:t})=>({insert:{directive:({value:a})=>{Gs(e,{children:[{text:""}],type:t,value:a})}},edit:{directive:({value:a,at:s})=>{Ws(e,{children:[{text:""}],type:t,value:a},{at:s})}}}))));var rc=(e=>(e.Animation="Animation",e.Sound="Sound",e.Util="Util",e.Filter="Filter",e.Transition="Transition",e))(rc||{});const nc={[Vr.Speak]:"发言",[Vr.Speaker]:"发言角色",[Vr.ChangeSource]:"变更",[Vr.Show]:"显示",[Vr.Hide]:"隐藏",[Vr.FadeIn]:"渐入",[Vr.FadeOut]:"渐出",[Vr.ShakeX]:"左右晃动",[Vr.ShakeY]:"上下晃动",[Vr.ZoomIn]:"放大",[Vr.ZoomOut]:"缩小",[Vr.EnterFromLeft]:"从左进入",[Vr.LeaveFromLeft]:"向左离开",[Vr.EnterFromRight]:"从右进入",[Vr.LeaveFromRight]:"向右离开",[Vr.Play]:"播放",[Vr.Pause]:"暂停",[Vr.Stop]:"停止",[Vr.Wait]:"停顿",[Vr.FadeInTransition]:"渐入转场",[Vr.AddFilter]:"添加滤镜",[Vr.RemoveFilter]:"移除滤镜"},oc=[Vr.ChangeSource,Vr.Show,Vr.Hide,Vr.FadeIn,Vr.FadeOut,Vr.ShakeX,Vr.ShakeY,Vr.ZoomIn,Vr.ZoomOut,Vr.EnterFromLeft,Vr.LeaveFromLeft,Vr.EnterFromRight,Vr.LeaveFromRight],lc=oc.map((e=>({name:nc[e],value:e}))),cc=[Vr.Play,Vr.Pause,Vr.Stop],dc=cc.map((e=>({name:nc[e],value:e}))),hc=[Vr.Wait],mc=[Vr.AddFilter,Vr.RemoveFilter],pc=[Vr.FadeInTransition],uc=[{name:"动画指令",type:"Animation",options:lc},{name:"音频指令",type:"Sound",options:dc},{name:"工具指令",type:"Util",options:hc.map((e=>({name:nc[e],value:e})))},{name:"滤镜指令",type:"Filter",options:mc.map((e=>({name:nc[e],value:e})))},{name:"转场指令",type:"Transition",options:pc.map((e=>({name:nc[e],value:e})))}],xc=[{name:"纯黑",value:"BlackMaskFilter"},{name:"模糊",value:"BlurFilter"},{name:"噪点",value:"NoiseFilter"},{name:"老电影",value:"OldFilmFilter"},{name:"暗角",value:"VignetteFilter"}],fc=(e,{directiveElement:t,directiveType:a}={})=>{const{api:s}=Xs(e,ic);if(t){const a=t.value.directive,r=(i=a,oc.includes(i)?"Animation":cc.includes(i)?"Sound":hc.includes(i)?"Util":mc.includes(i)?"Filter":pc.includes(i)?"Transition":void 0);s.floatingDirective.show("edit",e.id,t,r)}else s.floatingDirective.show("insert",e.id,null,a);var i};function gc(e){const[t,a]=i.useState(window.matchMedia(e).matches);return i.useEffect((()=>{const s=window.matchMedia(e);s.matches!==t&&a(s.matches);const i=()=>a(s.matches);return s.addEventListener("change",i),()=>s.removeEventListener("change",i)}),[t,e]),t}function bc({triggerFloatingLinkHotkeys:e,floatingOptions:t}){const a=gc("(min-width: 640px)"),{editor:s,api:i,tf:r,useOption:n,setOption:o,getOptions:l}=Vs(ic),c=n("mode"),d=n("isOpen",s.id),h=n("editingDirective"),m=Ts({onOpenChange:e=>o("openEditorId",e?s.id:null),getBoundingClientRect:Rs,open:d&&["insert","edit"].includes(c),...t}),p=Ls((e=>{const t=e.target;t!==document.documentElement&&(t.closest("[data-disable-click-outside]")||t.closest("#asset-library")||["insert","edit"].includes(l().mode)&&(i.floatingDirective.hide(),Is(s,s.selection)))}),{disabled:!d});return hs.useEffect((()=>{d&&m.update()}),[d,m.update]),{props:{style:a?{...m.style,zIndex:50}:{...m.style,position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:50}},ref:zs(m.refs.setFloating,p),onSubmit:e=>{h?(e=>{const t=s.selection,[,a]=Ks(s,{at:t,match:{type:s.getType(ic)}});r.edit.directive({value:e,at:a}),i.floatingDirective.hide()})(e):(e=>{r.insert.directive({value:e}),Fs(s,{unit:"offset"}),i.floatingDirective.hide(),setTimeout((()=>{Is(s,s.selection)}),0)})(e)},onCancel:()=>{i.floatingDirective.hide(),setTimeout((()=>{Is(s,s.selection)}),0)}}}const vc=[{items:[{description:"工具指令",icon:_r.squarePlus,label:"工具指令",value:rc.Util},{description:"转场指令",icon:_r.squarePlus,label:"转场指令",value:rc.Transition},{description:"滤镜指令",icon:_r.squarePlus,label:"滤镜指令",value:rc.Filter}],label:"更多指令"}];function wc(e){const t=gc("(min-width: 640px)"),a=Ys(),s=sc();return r.jsxs(Ol,{modal:!1,...s,...e,children:[r.jsx(Al,{asChild:!0,children:r.jsx(Dl,{isDropdown:!0,pressed:s.open,tooltip:"更多指令",children:r.jsx(_r.add,{className:"size-4"})})}),r.jsx(_l,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:vc.map((({items:e,label:s},i)=>r.jsxs(hs.Fragment,{children:[0!==i&&r.jsx(ac,{}),r.jsx(tc,{children:s}),e.map((({icon:e,label:s,value:i})=>r.jsxs(ql,{className:"min-w-[180px]",onSelect:()=>function(e){fc(a,{directiveType:e}),t&&Is(a)}(i),children:[r.jsx(e,{className:"mr-2 size-4"}),s]},i)))]},s)))})]})}const yc=i.forwardRef((({className:e,...a},s)=>r.jsx(Hs,{className:t("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...a,ref:s,children:r.jsx(Ms,{className:t("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})));yc.displayName=Hs.displayName;const jc=Us.object({wordsPerMin:Us.number().optional(),interval:Us.number().optional(),effect:Us.string().optional(),speaker:Us.object({name:Us.string().optional(),autoShowSpeaker:Us.object({inEffect:Us.string()}).optional(),autoMaskOtherSpeakers:Us.object({alpha:Us.number()}).optional()})});function kc({speak:e,onChangeSpeak:t,disableCustomName:a=!1}){const s=pa({resolver:ua(jc),defaultValues:e}),n=Ds({control:s.control});return i.useEffect((()=>{s.formState.isDirty&&t({...e,...n,speaker:{...e.speaker,...n.speaker}})}),[s.formState.isDirty,n]),r.jsx(so,{...s,children:r.jsxs("form",{className:"space-y-2",children:[!a&&r.jsx(ro,{control:s.control,name:"speaker.name",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"自定义角色名"}),r.jsx(mo,{children:"用于自定义对话中显示的角色名"}),r.jsx(ho,{children:r.jsx(uo,{className:"h-8",placeholder:"请输入自定义角色名",...e})}),r.jsx(po,{})]})}),r.jsx(ro,{control:s.control,name:"wordsPerMin",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"语速（字/分钟）"}),r.jsx(mo,{children:"角色发言的速度，默认值参考平均阅读速度"}),r.jsx(ho,{children:r.jsx(uo,{className:"h-8",type:"number",min:0,step:100,placeholder:"请输入语速",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),r.jsx(po,{})]})}),r.jsx(ro,{control:s.control,name:"interval",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"停顿时长（秒）"}),r.jsx(mo,{children:"角色发言后的停顿时长"}),r.jsx(ho,{children:r.jsx(uo,{className:"h-8",type:"number",min:0,step:.1,placeholder:"请输入停顿时长",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)}})}),r.jsx(po,{})]})}),r.jsx(ro,{control:s.control,name:"effect",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"台词效果"}),r.jsx(mo,{children:"台词的输出效果"}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择台词效果"})}),r.jsxs(dl,{children:[r.jsx(ml,{value:"typewriter",children:"打字机"}),r.jsx(ml,{value:"fadeIn",children:"渐入"}),r.jsx(ml,{value:"none",children:"无"})]})]})}),r.jsx(po,{})]})}),r.jsx(ro,{control:s.control,name:"speaker.autoShowSpeaker",render:({field:e})=>r.jsxs(lo,{className:"flex flex-row items-center space-y-0",children:[r.jsx(co,{className:"w-[8rem]",children:"自动显示发言角色"}),r.jsx(ho,{children:r.jsx(yc,{checked:!!e.value,onCheckedChange:e.onChange})}),r.jsx(po,{})]})}),r.jsx(ro,{control:s.control,name:"speaker.autoMaskOtherSpeakers",render:({field:e})=>r.jsxs(lo,{className:"flex flex-row items-center space-y-0",children:[r.jsx(co,{className:"w-[8rem]",children:"自动阴影其他角色"}),r.jsx(ho,{children:r.jsx(yc,{checked:!!e.value,onCheckedChange:e.onChange})}),r.jsx(po,{})]})})]})})}const Nc=Us.object({voice:Us.object({label:Us.string(),targetName:Us.string(),volume:Us.number().optional()})});function Sc({speak:e,onChangeSpeak:t}){const{selectAsset:a}=Ln(),s=Dr((e=>e.editor)),n=pa({resolver:ua(Nc),defaultValues:e}),o=Ds({control:n.control}),l=async e=>{const t=await a(gn.Audio);if(t){const a=In(t);s.addSound(a),n.setValue("voice.label",a.label),e(a.name)}};return i.useEffect((()=>{n.formState.isDirty&&t({...e,...o})}),[n.formState.isDirty,o]),r.jsx(so,{...n,children:r.jsxs("form",{className:"space-y-2",children:[r.jsx(ro,{control:n.control,name:"voice.targetName",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"配音文件"}),r.jsx(ho,{children:r.jsx("div",{className:"flex gap-1 items-center",children:e.value&&o.voice?.label?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:o.voice.label}),r.jsx(fo,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:r.jsx(_r.edit,{className:"size-4 cursor-pointer",onClick:()=>l(e.onChange)})}),r.jsx(fo,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:r.jsx(_r.delete,{className:"size-4 cursor-pointer",onClick:()=>{return t=e.onChange,s.removeSoundByName(o.voice.targetName),n.setValue("voice.label",""),void t("");var t}})})]}):r.jsx(fo,{type:"button",size:"sm",onClick:()=>l(e.onChange),children:"选择素材"})})}),r.jsx(po,{})]})}),r.jsx(ro,{control:n.control,name:"voice.volume",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"音量"}),r.jsx(ho,{children:r.jsx(al,{min:0,max:1,step:.1,value:[e.value??1],onValueChange:t=>e.onChange(t[0])})}),r.jsx(po,{})]})})]})})}const Zc={name:"Narrator",label:"旁白"};function Cc({speak:e,onChangeSpeak:a,children:s}){const n=gc("(min-width: 640px)"),o=Dr((e=>e.activeScene)),l=i.useMemo((()=>{const e=[Zc];return o?[...e,...o.children.filter((e=>e.assetType===gn.Character))]:e}),[o]),c=Ys(),{selectAsset:d}=Ln(),[h,m]=i.useState(!1),p=Dr((e=>e.editor)),u=e=>{fc(c,{directiveType:e}),n&&Is(c)};return r.jsxs("div",{className:"w-full flex flex-wrap",children:[r.jsxs(Jl,{noSeparator:!0,children:[r.jsxs(il,{open:h,onOpenChange:m,value:e.speaker.speakerTargetName||"",onValueChange:t=>{const s=l.find((e=>e.name===t));a({...e,speaker:{...e.speaker,speakerTargetName:s?.name,name:s?.name===Zc.name?"":s?.label||""}})},children:[r.jsx(ol,{className:"w-[100px] md:w-[130px] h-8",children:r.jsx(nl,{placeholder:"选择发言角色"})}),r.jsxs(dl,{children:[l.map((e=>r.jsx(ml,{value:e.name,children:e.label},e.name))),r.jsx("div",{onClick:async()=>{m(!1);const t=await d(gn.Character);if(t){const s=await zn(t,p);p.addChild(s),a({...e,speaker:{...e.speaker,speakerTargetName:s.name,name:s.label}})}},className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"添加并选择角色..."})]})]}),r.jsxs(pl,{children:[r.jsx(ul,{asChild:!0,children:r.jsx(Dl,{className:"px-1",tooltip:"发言设置",children:r.jsx(_r.settings,{className:"!size-4 cursor-pointer mx-1"})})}),r.jsx(xl,{children:r.jsx(kc,{speak:e,onChangeSpeak:a})})]}),r.jsxs(pl,{children:[r.jsx(ul,{asChild:!0,children:r.jsx(Dl,{className:"px-1",tooltip:"配音设置",children:r.jsx(_r.mic,{className:t("!size-4 cursor-pointer mx-1",e.voice?.targetName?"text-blue-500":"")})})}),r.jsx(xl,{onInteractOutside:e=>{e.target.closest("#asset-library")&&e.preventDefault()},children:r.jsx(Sc,{speak:e,onChangeSpeak:a})})]}),r.jsxs(Dl,{className:"px-1 text-xs",onClick:()=>u(rc.Animation),tooltip:"插入动画",children:[r.jsx(_r.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"动画"]}),r.jsxs(Dl,{className:"px-1 text-xs",onClick:()=>u(rc.Sound),tooltip:"插入音频",children:[r.jsx(_r.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"音频"]}),r.jsx(wc,{})]}),r.jsx(Jl,{className:"ml-auto",children:s})]})}const Gc=vs((({children:e,className:t,prefix:a,...s},n)=>{const o=Bs(),l=Ps(),c=Js(),d=function(){const[e,t]=i.useState(!1);return i.useEffect((()=>{t(!0)}),[]),e}(),{editor:h}=Vs(ic);return r.jsx(Es,{className:ds("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",l&&c&&"ring-2 ring-ring",!0===o.children[0].bold&&"font-bold",!0===o.children[0].italic&&"italic",!0===o.children[0].underline&&"underline",t),contentEditable:!1,onClick:()=>{fc(h,{directiveElement:o})},ref:n,...s,children:d&&Os?r.jsxs(hs.Fragment,{children:[e,a,o.value.label||""]}):r.jsxs(hs.Fragment,{children:[a,o.value.label||"",e]})})})),Wc=na("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");vs((({align:e="center",className:t,sideOffset:a=4,style:s,...i},n)=>r.jsx($a,{children:r.jsx(qa,{align:e,className:ds(Wc(),t),ref:n,sideOffset:a,style:{zIndex:1e3,...s},...i})})));const Xc=i.forwardRef((({form:e},t)=>{const a=Dr((e=>e.activeScene)),[s,n]=i.useState([]),[o,l]=i.useState([]),c=Ds({control:e.control,name:"directive"}),d=Ds({control:e.control,name:"params.targetName"}),h=Ds({control:e.control,name:"params.source"});return i.useEffect((()=>{if(a){const e=[],t=[],s=[];let i=[];for(const r of a.children){const a={value:r.name,label:r.label};r.assetType===gn.Character?e.push(a):r.assetType===gn.Background?s.push(a):r.assetType===gn.Thing?t.push(a):r.name&&i.push(a)}c===Vr.ChangeSource&&(i=i.filter((e=>e.assetID))),n([{label:"角色",options:e},{label:"背景",options:s},{label:"物品",options:t},{label:"其他",options:i}])}}),[a,c]),i.useEffect((()=>{if(a&&c===Vr.ChangeSource&&d){const e=a.children.find((e=>e.name===d));e?.assetID?yn.get(e.assetID).then((e=>{const t=e.states.map((e=>({value:Sn(e),label:e.name})));l(t)})):l([])}}),[a,c,d,e]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{if(a&&c&&d){const e=[nc[c],a.children.find((e=>e.name===d))?.label||""];if(c===Vr.ChangeSource&&h){const t=o.find((e=>e.value===h))?.label||"";e.push(t)}return e.join(":")}return""}})),[a,c,d,h,o]),r.jsxs(r.Fragment,{children:[r.jsx(ro,{control:e.control,name:"params.targetName",render:({field:t})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"动画对象"}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:a=>{t.onChange(a),e.setValue("params.source","")},value:t.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择动画对象"})}),r.jsxs(dl,{children:[s.map((e=>e.options.length>0&&r.jsxs(rl,{children:[r.jsx(hl,{children:e.label}),e.options.map((e=>r.jsx(ml,{value:e.value,children:e.label},e.value)))]},e.label))),s.every((e=>0===e.options.length))&&r.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:"请先在画布中添加角色、背景等素材"})]})]})}),r.jsx(po,{})]})}),c===Vr.ChangeSource&&o.length>0&&r.jsx(ro,{control:e.control,name:"params.source",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"目标状态"}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择目标状态"})}),r.jsx(dl,{children:o.map((e=>r.jsx(ml,{value:e.value,children:e.label},e.value)))})]})}),r.jsx(po,{})]})}),c!==Vr.ChangeSource&&r.jsx(ro,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"动画时长(秒)"}),r.jsx(ho,{children:r.jsx(uo,{type:"number",min:0,step:.1,placeholder:"不填则使用默认值",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(po,{})]})})]})})),Vc=i.forwardRef((({form:e},t)=>{const a=Ds({control:e.control,name:"directive"}),s=Ds({control:e.control,name:"params.duration"});return i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>`${nc[a]}:${s??0}秒`})),[s,a]),r.jsx(ro,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"停顿时间(秒)"}),r.jsx(ho,{children:r.jsx(uo,{type:"number",min:0,step:.1,placeholder:"请输入停顿时间",value:String(e.value),onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(po,{})]})})})),Tc=i.forwardRef((({form:e},t)=>{const a=Dr((e=>e.activeScene)),s=Dr((e=>e.editor)),[n,o]=i.useState([]),l=Ds({control:e.control,name:"directive"}),c=Ds({control:e.control,name:"params.targetName"}),{selectAsset:d}=Ln(),[h,m]=i.useState(!1);return i.useEffect((()=>{if(a){const e=a.sounds.map((e=>({label:e.label,value:e.name})));o([{label:"音频",options:e}])}}),[a]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>a&&l&&c?[nc[l],a.sounds.find((e=>e.name===c))?.label||""].join(":"):""})),[a,l,c]),r.jsxs(r.Fragment,{children:[r.jsx(ro,{control:e.control,name:"params.targetName",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"目标音频"}),r.jsx(ho,{children:r.jsxs(il,{open:h,onOpenChange:m,onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择目标音频"})}),r.jsxs(dl,{children:[n.map((e=>e.options.length>0&&r.jsxs(rl,{children:[r.jsx(hl,{children:e.label}),e.options.map((e=>r.jsx(ml,{value:e.value,children:e.label},e.value)))]},e.label))),r.jsx("div",{onClick:()=>(async e=>{m(!1);const t=await d(gn.Audio);if(t){const a=In(t);s.addSound(a),setTimeout((()=>{e(a.name)}),150)}})(e.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"添加并选择音频..."})]})]})}),r.jsx(po,{})]})}),l===Vr.Play&&r.jsxs(r.Fragment,{children:[r.jsx(ro,{control:e.control,name:"params.start",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"开始时间(秒)"}),r.jsx(ho,{children:r.jsx(uo,{type:"number",min:0,step:1,placeholder:"默认从0秒开始",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(po,{})]})}),r.jsx(ro,{control:e.control,name:"params.volume",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"音量"}),r.jsx(ho,{children:r.jsx(al,{min:0,max:1,step:.1,value:[e.value??1],onValueChange:t=>e.onChange(t[0])})}),r.jsx(po,{})]})}),r.jsx(ro,{control:e.control,name:"params.loop",render:({field:e})=>r.jsxs(lo,{className:"space-y-0 flex flex-row items-center",children:[r.jsx(co,{className:"flex flex-col w-[4rem]",children:"循环"}),r.jsx(ho,{children:r.jsx(yc,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(po,{})]})}),r.jsx(ro,{control:e.control,name:"params.untilEnd",render:({field:e})=>r.jsxs(lo,{className:"space-y-0 flex flex-row items-center",children:[r.jsx(co,{className:"flex flex-col w-[4rem]",children:"跨场景"}),r.jsx(ho,{children:r.jsx(yc,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(po,{})]})})]})]})})),Rc=i.forwardRef((({form:e},t)=>{const a=Dr((e=>e.activeScene)),[s,n]=i.useState([]),o=Ds({control:e.control,name:"directive"});return i.useEffect((()=>{if(a){const e=[],t=[],s=[],i=[];for(const r of a.children){const a={value:r.name,label:r.label};r.assetType===gn.Character?e.push(a):r.assetType===gn.Background?s.push(a):r.assetType===gn.Thing?t.push(a):r.name&&i.push(a)}n([{label:"角色",options:e},{label:"背景",options:s},{label:"物品",options:t},{label:"其他",options:i}])}}),[a]),i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{const t=[nc[o]],a=e.getValues("params.targetName"),i=s.flatMap((e=>e.options)).find((e=>e.value===a)),r=i?i.label:"全场景";t.push(r);const n=e.getValues("params.filterName");if(n){const e=xc.find((e=>e.value===n)),a=e?e.name:"";t.push(a)}return t.join(":")}})),[e,o,s]),r.jsxs(r.Fragment,{children:[r.jsx(ro,{control:e.control,name:"params.targetName",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"滤镜对象"}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"为空则默认全场景滤镜"})}),r.jsx(dl,{children:s.map((e=>e.options.length>0&&r.jsxs(rl,{children:[r.jsx(hl,{children:e.label}),e.options.map((e=>r.jsx(ml,{value:e.value,children:e.label},e.value)))]},e.label)))})]})}),r.jsx(po,{})]})}),o===Vr.AddFilter&&r.jsx(ro,{control:e.control,name:"params.filterName",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"滤镜效果"}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择滤镜效果"})}),r.jsx(dl,{children:xc.map((e=>r.jsx(ml,{value:e.value,children:e.name},e.value)))})]})}),r.jsx(po,{})]})})]})})),Lc=i.forwardRef((({form:e},t)=>(i.useImperativeHandle(t,(()=>({getDirectiveLabel:()=>{const t=e.getValues("directive");return nc[t]}}))),r.jsx(r.Fragment,{children:r.jsx(ro,{control:e.control,name:"params.duration",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:"转场时长"}),r.jsx(ho,{children:r.jsx(uo,{type:"number",min:0,step:.1,placeholder:"不填则使用默认值",value:e.value||"",onChange:t=>{const a=Number(t.target.value);e.onChange(a)},className:"h-8"})}),r.jsx(po,{})]})})})))),zc=Us.discriminatedUnion("directive",[Us.object({directive:Us.literal(oc[0]),params:Us.object({targetName:Us.string({message:"请选择动画对象"}),source:Us.string().min(1,{message:"请输入目标状态"}),duration:Us.number().optional(),sequential:Us.boolean().optional()})}),...oc.slice(1).map((e=>Us.object({directive:Us.literal(e),params:Us.object({targetName:Us.string({message:"请选择动画对象"}),duration:Us.number().optional(),sequential:Us.boolean().optional()})}))),Us.object({directive:Us.literal(Vr.Wait),params:Us.object({duration:Us.number().optional(),sequential:Us.boolean().optional()})}),Us.object({directive:Us.literal(Vr.Play),params:Us.object({targetName:Us.string({message:"请选择音频对象"}),start:Us.number().optional(),volume:Us.number().optional(),loop:Us.boolean().optional(),untilEnd:Us.boolean().optional(),sequential:Us.boolean().optional()})}),...[Vr.Pause,Vr.Stop].map((e=>Us.object({directive:Us.literal(e),params:Us.object({targetName:Us.string({message:"请选择音频对象"}),sequential:Us.boolean().optional()})}))),Us.object({directive:Us.literal(Vr.AddFilter),params:Us.object({targetName:Us.string({message:"请选择滤镜对象"}),filterName:Us.string({message:"请选择滤镜"}),sequential:Us.boolean().optional()})}),Us.object({directive:Us.literal(Vr.RemoveFilter),params:Us.object({targetName:Us.string({message:"请选择滤镜对象"}),sequential:Us.boolean().optional()})}),Us.object({directive:Us.literal(Vr.FadeInTransition),params:Us.object({duration:Us.number().optional(),sequential:Us.boolean().optional()})})]);function Ic({editingDirective:e,directiveType:t,onSubmitDirective:a,onCancel:s}){const n=pa({resolver:ua(zc),defaultValues:{directive:void 0,params:{}}}),o=Ds({control:n.control,name:"directive"}),l=i.useRef(null),c=i.useRef(null),d=i.useRef(null),h=i.useRef(null),m=i.useRef(null),p=i.useMemo((()=>uc.find((e=>e.type===t))),[t]);return i.useEffect((()=>{e?n.reset(e.value,{keepDefaultValues:!0}):n.reset()}),[e,n.reset,n]),r.jsx(so,{...n,children:r.jsxs("form",{onSubmit:n.handleSubmit((function(e){let t="";l.current?t=l.current.getDirectiveLabel():c.current?t=c.current.getDirectiveLabel():d.current?t=d.current.getDirectiveLabel():h.current?t=h.current.getDirectiveLabel():m.current&&(t=m.current.getDirectiveLabel()),a({...e,label:t})})),className:"space-y-2 flex flex-col h-full",children:[r.jsx(ro,{control:n.control,name:"directive",render:({field:e})=>r.jsxs(lo,{className:"space-y-1",children:[r.jsx(co,{children:p?.name}),r.jsx(ho,{children:r.jsxs(il,{onValueChange:e.onChange,value:e.value,children:[r.jsx(ol,{className:"h-8",children:r.jsx(nl,{placeholder:"请选择指令"})}),r.jsx(dl,{children:p?.options.map((e=>r.jsx(ml,{value:e.value,children:e.name},e.value)))})]})})]})}),oc.includes(o)&&r.jsx(Xc,{form:n,ref:l}),hc.includes(o)&&r.jsx(Vc,{form:n,ref:c}),cc.includes(o)&&r.jsx(Tc,{form:n,ref:d}),mc.includes(o)&&r.jsx(Rc,{form:n,ref:h}),o===Vr.FadeInTransition&&r.jsx(Lc,{form:n,ref:m}),o&&o!==Vr.Wait&&r.jsx(ro,{control:n.control,name:"params.sequential",render:({field:e})=>r.jsxs(lo,{className:"space-y-0 flex flex-row items-center !mb-4",children:[r.jsx(co,{className:"flex flex-col w-[4rem]",children:"串行执行"}),r.jsx(ho,{children:r.jsx(yc,{checked:e.value,onCheckedChange:e.onChange})}),r.jsx(po,{})]})}),r.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[r.jsx(fo,{size:"sm",type:"submit",children:"确定"}),r.jsx(fo,{size:"sm",type:"button",onClick:s,variant:"outline",children:"取消"})]})]})})}const Fc={middleware:[As(12),Qs({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function Kc(){const e=$s({preventDefaultOnEnterKeydown:!0}),{useOption:t}=Vs(ic),a=t("editingDirective"),s=t("directiveType"),{ref:i,props:n,onSubmit:o,onCancel:l}=bc({floatingOptions:Fc,triggerFloatingLinkHotkeys:"mod+k"});return r.jsx(_s,{children:r.jsx("div",{className:ds(Wc(),"w-auto p-1"),...n,ref:i,children:r.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...e,children:s&&r.jsx(Ic,{editingDirective:a,directiveType:s,onSubmitDirective:o,onCancel:l})})})})}function Yc({value:e,onChange:t,onFocus:a,children:s}){const n=qs({plugins:[ei,ic.extend({render:{afterEditable:()=>r.jsx(Kc,{})}}),ti],override:{components:{[ic.key]:Gc}},value:e.lines}),o=i.useRef(!1);return i.useEffect((()=>{n.children!==e.lines&&(o.current=!0,n.tf.setValue(e.lines))}),[e.lines,n]),r.jsx(ai,{editor:n,onValueChange:({value:a})=>{o.current?o.current=!1:t({...e,lines:a})},children:r.jsxs("div",{className:"relative rounded-md border bg-background border-border",onFocus:()=>{a(e)},children:[r.jsx(El,{children:r.jsx(Cc,{speak:e.speak,onChangeSpeak:a=>{t({...e,speak:a})},children:s})}),r.jsx(Tl,{focusRing:!1,variant:"ghost",size:"sm"})]})})}function Hc({onClose:e}){const t=Dr((e=>e.editor)),a=Dr((e=>e.project)),s=Dr((e=>e.activeScene)),[n,o]=i.useState(!1),l=i.useRef(null),c=(e,a)=>{if(t.activeScene){const{speaker:e,targetName:s}=t.activeScene.config.speak||{};if(e){const s=t.activeScene.getChildByName(e.targetName);s&&(s.text=a.speak.speaker.name)}if(a.lines.length>0){const e=t.activeScene.getChildByName(s);let i="";a.lines.forEach((e=>{if("p"===e.type)for(let t=0;t<e.children.length;t++){const a=e.children[t];if(!a.type){let s=a.text;t===e.children.length-1&&(s+="\n"),i+=s}}})),i&&e&&(e.text=i)}}},d=(e,a)=>{t.swapDialogue(e,a)},h=()=>{setTimeout((()=>{l.current&&l.current.scrollToBottom()}),100)};return r.jsx(Jr,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:r.jsx(Er,{className:"h-full p-1 md:p-2",children:s?r.jsxs(r.Fragment,{children:[r.jsx(Ar,{className:"w-full h-full pr-2",ref:l,children:r.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsxs(ao,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[r.jsx("span",{children:"场景标题"}),r.jsxs("div",{className:"flex items-center",children:[r.jsxs(pl,{children:[r.jsx(ul,{asChild:!0,children:r.jsx(fo,{size:"sm",variant:"ghost",children:r.jsx(_r.settings,{className:"size-4"})})}),r.jsx(xl,{children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("h3",{className:"text-base font-bold",children:"场景设置"}),r.jsx(kc,{speak:s.config.speak,onChangeSpeak:e=>{t.updateActiveScene((t=>{t.config.speak=e}))},disableCustomName:!0}),r.jsxs("div",{className:"flex mt-2",children:[r.jsx("span",{className:"text-sm font-medium w-[8rem]",children:"自动展示背景"}),r.jsx(yc,{checked:s.config.autoShowBackground,onCheckedChange:e=>{t.updateActiveScene((t=>{t.config.autoShowBackground=e}))}})]})]})})]}),r.jsx(Nl,{children:r.jsxs(Sl,{children:[r.jsx(Zl,{asChild:!0,children:r.jsx(fo,{size:"sm",variant:"ghost",onClick:()=>o(!0),children:r.jsx(_r.bookmark,{className:"size-4"})})}),r.jsx(Cl,{children:r.jsx("p",{children:"保存为模版"})})]})}),e&&r.jsx(fo,{className:"-mr-3",size:"sm",variant:"ghost",onClick:e,children:r.jsx(_r.close,{className:"size-4"})})]})]}),r.jsx(uo,{type:"text",id:"sceneName",placeholder:"请输入场景标题",value:s.label,onChange:e=>{return a=e.target.value,void t.updateActiveScene((e=>{e.label=a}));var a}})]}),r.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[r.jsx(ao,{children:"场景对白"}),s.dialogues.map(((e,a)=>r.jsx("div",{children:r.jsx(Yc,{value:e,onChange:e=>((e,a)=>{t.updateDialogue(e,a),c(0,a)})(a,e),onFocus:e=>c(0,e),children:r.jsxs($r,{children:[r.jsx(qr,{children:r.jsx(_r.more,{className:"size-4 cursor-pointer mx-1"})}),r.jsxs(rn,{children:[r.jsx(nn,{onClick:()=>((e,a)=>{t.addDialogue({speak:t.cloneDialogueSpeak(a.speak),lines:[]},e)})(a+1,e),children:"插入"}),r.jsx(nn,{onClick:()=>((e,a)=>{const s=t.cloneDialogue(e);t.addDialogue(s,a)})(e,a+1),children:"复制"}),r.jsx(nn,{className:"text-destructive",onClick:()=>{t.removeDialogue(e)},children:"删除"}),r.jsx(on,{}),a>0&&r.jsx(nn,{onClick:()=>d(a,a-1),children:"上移"}),a<s.dialogues.length-1&&r.jsx(nn,{onClick:()=>d(a,a+1),children:"下移"})]})]})})},a)))]}),r.jsx(fo,{className:"mt-2",onClick:()=>(e=>{const{config:a}=s;t.addDialogue({speak:t.cloneDialogueSpeak(a.speak),lines:[]},e),h()})(),children:"新增对白"})]})}),r.jsx(bo,{isOpen:n,onClose:()=>o(!1),sceneName:s.name})]}):r.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:a?"请先创建场景":"请先创建或打开作品"})})})}function Mc({url:e,className:a}){const[s,n]=i.useState(!1),o=i.useRef(null);return r.jsxs("div",{className:t("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",a),children:[r.jsx("audio",{ref:o,src:e,className:"hidden"}),r.jsx(fo,{onClick:e=>{e.stopPropagation(),o.current&&(s?o.current.pause():o.current.play(),n(!s))},variant:"outline",size:"icon",className:"w-12 h-12",children:s?r.jsx(si,{className:"h-6 w-6"}):r.jsx(ii,{className:"h-6 w-6"})})]})}function Uc({url:e,className:a}){return r.jsx("div",{className:t("w-full h-full cursor-pointer flex justify-center items-center relative",a),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:e&&r.jsx("img",{src:e,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function Dc({fontName:e,fontUrl:a,className:s}){const n=i.useMemo((()=>e||(a?`font-${Date.now()}`:void 0)),[e,a]);return i.useEffect((()=>{if(e)return;const t=document.createElement("style");return t.innerHTML=`\n      @font-face {\n        font-family: '${n}';\n        src: url('${a}');\n      }\n    `,document.head.appendChild(t),()=>{e||document.head.removeChild(t)}}),[n,e,a]),r.jsxs("div",{className:t("w-full aspect-[1/1] flex flex-col justify-center items-center relative",s),style:{fontFamily:n},children:[r.jsx("span",{children:"示例文字"}),r.jsx("span",{children:"Sample Text"}),r.jsx("span",{children:"0123456789"})]})}function Bc({url:e,className:a}){return r.jsx("video",{src:e,className:t("w-full h-full",a),controls:!0,muted:!0})}const Pc={[gn.Background]:"240px",[gn.Character]:"135px",[gn.Thing]:"200px",[gn.Dialog]:"240px",[gn.Audio]:"150px",[gn.Font]:"150px"},Jc={[gn.Background]:"aspect-[16/9]",[gn.Character]:"aspect-[9/16]",[gn.Thing]:"aspect-[1/1]",[gn.Dialog]:"aspect-[16/3]"};function Ec({type:e,url:t,ext:a,state:s}){const n=i.useMemo((()=>t||(s?Sn(s):"")),[t,s]),o=i.useMemo((()=>a||(s?s.ext:"")),[a,s]);return Object.keys(Jc).includes(e)?"mp4"===o?r.jsx(Bc,{url:n,className:Jc[e]}):r.jsx(Uc,{url:n,className:Jc[e]}):e===gn.Audio?r.jsx(Mc,{url:n}):e===gn.Font?r.jsx(Dc,{fontName:s?.name,fontUrl:n}):null}function Oc({type:e,state:t,children:a,onSelect:s}){return r.jsx(Jr,{className:"rounded-md cursor-pointer",style:{width:Pc[e]},onClick:s,children:a||r.jsxs(r.Fragment,{children:[r.jsx(Er,{className:"p-2 flex justify-center",children:r.jsx(Ec,{type:e,state:t})}),r.jsx(Or,{className:"font-medium p-2 pt-0 flex justify-center text-sm break-all",children:t.name})]})})}function Ac({asset:e,onSelect:t,onEdit:a,onDelete:s}){return r.jsxs(Jr,{className:"rounded-md",children:[r.jsx(Er,{className:"p-0 flex justify-center cursor-pointer",onClick:t,children:r.jsx(_r.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),r.jsxs(Or,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[r.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:t,children:e.name}),r.jsxs($r,{children:[r.jsx(qr,{children:r.jsx(_r.more,{className:"w-4 h-4 pointer"})}),r.jsxs(rn,{children:[r.jsx(nn,{onClick:a,children:"编辑"}),r.jsx(nn,{className:"text-destructive",onClick:s,children:"删除"})]})]})]})]})}function Qc({type:e,url:a,ext:s,className:n,onChange:o}){const[l,c]=i.useState(null),[d,h]=i.useState(null),m=i.useMemo((()=>l||a||""),[a,l]),p=i.useMemo((()=>d||s||""),[s,d]),u=i.useMemo((()=>Zn(e)),[e]),x=i.useRef(null);return i.useEffect((()=>()=>{l&&URL.revokeObjectURL(l)}),[l]),r.jsxs("div",{className:t("flex cursor-pointer group relative",n),onClick:()=>{x.current?.click()},children:[r.jsx("input",{type:"file",ref:x,onChange:e=>{l&&URL.revokeObjectURL(l);const t=e.target.files?.[0];c(URL.createObjectURL(t)),h(vi(t).ext),o(t)},className:"hidden",accept:u}),r.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[r.jsx(ri,{className:"size-4"}),r.jsx("div",{children:"选择文件"})]}),r.jsx(Ec,{url:m,type:e,ext:p})]})}const _c=na("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),$c=i.forwardRef((({className:e,variant:a,...s},i)=>r.jsx("div",{ref:i,role:"alert",className:t(_c({variant:a}),e),...s})));$c.displayName="Alert",i.forwardRef((({className:e,...a},s)=>r.jsx("h5",{ref:s,className:t("mb-1 font-medium leading-none tracking-tight",e),...a}))).displayName="AlertTitle";const qc=i.forwardRef((({className:e,...a},s)=>r.jsx("div",{ref:s,className:t("text-sm [&_p]:leading-relaxed",e),...a})));qc.displayName="AlertDescription";const ed=Us.object({id:Us.number().optional(),name:Us.string().min(1,{message:"名称必填"}),type:Us.string().min(1,{message:"类型必选"}),states:Us.array(Us.object({id:Us.number().optional(),name:Us.string().min(1,{message:"状态名称必填"}),ext:Us.string().optional(),file:Us.instanceof(File).optional()}).refine((e=>e.id||e.file),{message:"状态文件必选"})).min(1,{message:"至少需要一个状态"})});function td({asset:e,onSubmit:t,onCancel:a}){const s=i.useMemo((()=>vn[e.type]),[e.type]),n=pa({resolver:ua(ed),defaultValues:{name:"",type:"",states:[]}}),{fields:o,append:l,remove:c}=ni({control:n.control,name:"states",keyName:"_id"});return i.useEffect((()=>{n.reset({id:e.id,name:e.name,type:e.type,states:e.states})}),[e,n]),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-base font-bold mb-2",children:[e.id?"编辑":"新增",s,r.jsx($c,{className:"p-2 mt-1",children:r.jsxs(qc,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[r.jsx(_r.tip,{className:"size-4"}),[gn.Background,gn.Character,gn.Thing,gn.Dialog].includes(e.type)&&r.jsx("span",{children:"画布的尺寸为1920*1080"}),e.type===gn.Audio&&r.jsx("span",{children:"音频采样率建议>=44100Hz"}),e.type===gn.Font&&r.jsx("span",{children:"请使用woff/woff2/ttf字体格式"})]})})]}),r.jsx(so,{...n,children:r.jsxs("form",{onSubmit:n.handleSubmit((e=>{t(e)})),className:"space-y-4",children:[r.jsx(ro,{control:n.control,name:"name",render:({field:e})=>r.jsxs(lo,{children:[r.jsxs(co,{children:[s,"名"]}),r.jsx(ho,{children:r.jsx(uo,{placeholder:`请输入${s}名`,...e})}),r.jsx(po,{})]})}),r.jsxs(lo,{children:[r.jsxs(co,{className:"flex items-center",children:[s,"状态",r.jsxs(fo,{size:"sm",variant:"outline",onClick:()=>l({name:""}),className:"ml-2",children:[r.jsx(_r.squarePlus,{className:"size-4 mr-1"}),"新增状态"]})]}),r.jsx(ho,{children:r.jsx("div",{children:o.length>0&&r.jsxs(Ar,{className:"w-full whitespace-nowrap rounded-md border",children:[r.jsx("div",{className:"flex w-full gap-2 p-2",children:o.map(((t,a)=>r.jsx(Oc,{type:e.type,state:t,children:r.jsxs(r.Fragment,{children:[r.jsx(Er,{className:"p-2 flex justify-center",children:r.jsx(Qc,{className:"w-full h-full",type:e.type,ext:t.ext,url:t.id&&Sn(t),onChange:e=>((e,t)=>{n.setValue(`states.${t}.file`,e),n.getValues(`states.${t}.name`)||n.setValue(`states.${t}.name`,vi(e).name)})(e,a)})}),r.jsx(Or,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:r.jsxs("div",{className:"flex w-full justify-between",children:[r.jsx(ro,{control:n.control,name:`states.${a}.name`,render:({field:e})=>r.jsx(lo,{children:r.jsx(ho,{children:r.jsx(uo,{className:"h-6 text-sm",placeholder:"请输入状态名",...e})})})}),r.jsx(_r.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>c(a)})]})})]})},a)))}),r.jsx(Qr,{orientation:"horizontal"})]})})}),r.jsx(po,{})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(fo,{type:"submit",children:"确定"}),r.jsx(fo,{type:"button",className:"mr-2",variant:"outline",onClick:a,children:"取消"})]})]})})]})}function ad({asset:e,onEdit:t,onSelectState:a,onCancel:s}){return r.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[r.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["选择默认状态",r.jsx(fo,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>t(e),children:r.jsx(_r.edit,{className:"size-4"})}),r.jsx(fo,{variant:"outline",size:"sm",onClick:s,children:"返回列表"})]}),r.jsx(Ar,{className:"flex-1",children:r.jsx("div",{className:"flex gap-2 flex-wrap",children:e.states?.map((t=>r.jsx(Oc,{type:e.type,state:t,onSelect:()=>a(t)},t.id)))})})]})}function sd(){const e=gc("(min-width: 640px)"),a=Br((e=>e.isOpen)),s=Br((e=>e.confirm)),n=Br((e=>e.cancel)),o=Br((e=>e.disableSelect)),l=Br((e=>e.type)),[c,d]=i.useState(l),[h,m]=i.useState(null),[p,u]=i.useState(null),x=Ft((()=>c?yn.where("type").equals(c).reverse().toArray():[]),[c]),f=e=>{d(e)},g=()=>{m({name:"",type:c,states:[]})},b=e=>{m(e)},v=async e=>{if(e.id){if(await(async e=>{for(const t of e.states){if(t.file){t.id&&await jn.delete(t.id);const a=vi(t.file).ext,s=await jn.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,e.type===gn.Font&&fn(t.name,Sn(t))}delete t.file}await yn.update(e.id,e)})(e),p){const t=await yn.get(e.id);u(t)}}else await(async e=>{for(const t of e.states){const a=vi(t.file).ext,s=await jn.add({mime:t.file.type,blob:t.file,ext:a});t.id=s,t.ext=a,delete t.file,e.type===gn.Font&&fn(t.name,Sn(t))}await yn.add(e)})(e);m(null)},w=()=>{m(null)},y=e=>{o||(s({...p,stateId:e.id}),u(null))},j=()=>{u(null)};return i.useEffect((()=>{d(l||gn.Character)}),[l]),r.jsx(En,{open:a,onOpenChange:()=>{n(),m(null),u(null)},children:r.jsxs(Qn,{id:"asset-library",className:t("min-w-[90vw] h-[90vh] flex flex-col",!e&&"px-2"),children:[r.jsxs(_n,{children:[r.jsx(qn,{children:"素材库"}),r.jsx(eo,{})]}),h?r.jsx(td,{asset:h,onSubmit:v,onCancel:w}):p?r.jsx(ad,{asset:p,onEdit:e=>b(e),onSelectState:y,onCancel:j}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(Jo,{value:c,onValueChange:f,children:r.jsx(Eo,{children:bn.map((e=>r.jsx(Oo,{value:e.value,disabled:l&&l!==e.value,children:e.name},e.value)))})}),r.jsxs(fo,{size:"sm",onClick:g,children:[r.jsx(_r.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),e&&"新增"]})]}),r.jsx(Ar,{className:"flex-grow",children:r.jsx("div",{className:"flex gap-2 flex-wrap",children:x?.map((e=>r.jsx(Ac,{asset:e,onSelect:()=>u(e),onEdit:()=>b(e),onDelete:()=>(e=>{e.states.forEach((e=>{jn.delete(e.id)})),yn.delete(e.id)})(e)},e.id)))})})]})]})})}const id=pi,rd=i.forwardRef((({className:e,...a},s)=>r.jsx(oi,{ref:s,className:t("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...a})));rd.displayName=oi.displayName;const nd=na("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),od=i.forwardRef((({className:e,variant:a,...s},i)=>r.jsx(li,{ref:i,className:t(nd({variant:a}),e),...s})));od.displayName=li.displayName,i.forwardRef((({className:e,...a},s)=>r.jsx(ci,{ref:s,className:t("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...a}))).displayName=ci.displayName;const ld=i.forwardRef((({className:e,...a},s)=>r.jsx(di,{ref:s,className:t("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...a,children:r.jsx(ea,{className:"h-4 w-4"})})));ld.displayName=di.displayName;const cd=i.forwardRef((({className:e,...a},s)=>r.jsx(hi,{ref:s,className:t("text-sm font-semibold [&+div]:text-xs",e),...a})));cd.displayName=hi.displayName;const dd=i.forwardRef((({className:e,...a},s)=>r.jsx(mi,{ref:s,className:t("text-sm opacity-90",e),...a})));function hd(){const{toasts:e}=Vo();return r.jsxs(id,{children:[e.map((function({id:e,title:t,description:a,action:s,...i}){return r.jsxs(od,{...i,children:[r.jsxs("div",{className:"grid gap-1",children:[t&&r.jsx(cd,{children:t}),a&&r.jsx(dd,{children:a})]}),s,r.jsx(ld,{})]},e)})),r.jsx(rd,{})]})}dd.displayName=mi.displayName;const md=({className:e})=>r.jsx(ui,{className:t("h-6 w-6 text-primary/60 animate-spin",e)});function pd(){const e=Pr((e=>e.isOpen)),t=Pr((e=>e.loadingText));return r.jsx(En,{open:e,children:r.jsxs(Qn,{disableClose:!0,onPointerDownOutside:e=>e.preventDefault(),children:[r.jsxs(_n,{className:"hidden",children:[r.jsx(qn,{}),r.jsx(eo,{})]}),r.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[r.jsx("div",{className:"font-bold text-xl",children:t}),r.jsx(md,{})]})]})})}function ud(){const[e,t]=i.useState(!1),a=gc("(min-width: 768px)"),[s,n]=i.useState(null),{toast:o}=Vo();return i.useEffect((()=>{(async function(){let e=!1,t=!1;return"undefined"!=typeof VideoEncoder&&"undefined"!=typeof VideoFrame&&(await VideoEncoder.isConfigSupported(Wi)).supported&&(e=!0),"undefined"!=typeof OfflineAudioContext&&"undefined"!=typeof AudioEncoder&&"undefined"!=typeof AudioData&&(await AudioEncoder.isConfigSupported(Xi)).supported&&(t=!0),{video:e,audio:t}})().then((e=>{n(e.video),e.audio||(Fn=!0,o({title:"提示",description:"当前浏览器不支持音频合成，请使用最新桌面版的Chrome或Edge浏览器获取完整体验～",duration:1500}))}))}),[o]),s?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"h-screen flex flex-col",children:[r.jsx(Xl,{}),r.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[r.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:a&&r.jsx(Hc,{})}),r.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[r.jsx(el,{}),r.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[r.jsx(Wl,{}),r.jsx(Rn,{onOpenSceneDetailDialog:()=>{t(!0)}})]})]})]})]}),!a&&e&&r.jsx("div",{className:"fixed top-0 left-0 size-full z-50",children:r.jsx(Hc,{onClose:()=>t(!1)})}),r.jsx(sd,{}),r.jsx(hd,{}),r.jsx(pd,{})]}):r.jsx("div",{className:"flex h-screen items-center justify-center",children:!1===s?r.jsxs("div",{className:"text-center",children:[r.jsx("h1",{className:"text-2xl font-semibold",children:"您的浏览器不支持"}),r.jsx("p",{className:"text-sm",children:"请使用最新桌面版的Chrome或Edge浏览器～"})]}):r.jsx("div",{className:"text-center",children:"环境检测中..."})})}const xd=xi([{path:"/",element:r.jsx(ud,{})}]);function fd(){return r.jsx(fi,{router:xd})}window.onbeforeunload=function(){return"确认离开？"},async function(){try{if(localStorage.getItem(Xn))return;localStorage.setItem(Xn,"true"),0===await jn.count()&&await async function(){for(const e of Wn){const{type:t,assets:a}=e;for(const e of a){const{name:a,states:s}=e,i=await yn.add({name:a,type:t,states:[]});for(const e of s){const{name:t,url:a}=e,s=a.split(".").pop(),r=null,n="",o=await jn.add({mime:n,ext:s,blob:r,url:a});await yn.where("id").equals(i).modify((e=>{e.states.push({id:o,name:t,ext:s,url:a})}))}}}}()}catch(e){console.error("导入预设资源失败",e)}}().finally((()=>{!async function(){const e=await yn.where("type").equals("Font").toArray();for(const t of e)for(const e of t.states)await fn(e.name,Sn(e))}()}));const gd=document.getElementById("root");gi.createRoot(gd).render(r.jsx(fd,{}))}}}));
