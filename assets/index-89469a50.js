var gi=Object.defineProperty;var yi=(a,s,t)=>s in a?gi(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var b=(a,s,t)=>(yi(a,typeof s!="symbol"?s+"":s,t),t);import{t as vi,c as Si,r as d,j as e,n as ji,l as qe,C as Ni,B as Zi,N as wi,a as ta,T as Ci,G as Gi,b as ki,R as Vi,F as Wi,L as Ti,d as Ri,E as Us,e as Li,f as Xi,g as Ii,S as Fi,A as Ki,h as zi,i as St,k as B,m as M,P as sa,o as Yi,p as Hi,q as Di,s as Mi,u as Pi,v as aa,w as na,x as ia,V as Ui,y as Ai,z as oa,D as Bi,H as Oi,I as Ei,J as Ji,K as Qi,M as $i,O as _i,Q as qi,U as eo,W as to,X as so,Y as ao,Z as no,_ as As,$ as io,a0 as oo,a1 as lo,a2 as ro,a3 as co,a4 as mo,a5 as ho,a6 as uo,a7 as Bs,a8 as po,a9 as xo,aa as fo,ab as bo,ac as go,ad as yo,ae as vo,af as So,ag as jo,ah as No,ai as Zo,aj as wo,ak as Co,al as Go,am as ko,an as Vo,ao as Wo,ap as To,aq as Ro,ar as Lo,as as Xo,at as Io,au as Fo,av as Ko,aw as zo,ax as Yo,ay as Ho,az as Do,aA as Mo,aB as Po,aC as Uo,aD as Ao,aE as Bo,aF as Oo,aG as Eo,aH as Jo,aI as Qo,aJ as $o,aK as _o,aL as qo,aM as el,aN as tl,aO as sl,aP as al,aQ as nl,aR as il,aS as ol,aT as ll,aU as rl,aV as cl,aW as dl,aX as ml,aY as hl,aZ as ul,a_ as pl,a$ as xl,b0 as fl,b1 as os,b2 as la,b3 as ls,b4 as rs,b5 as cs,b6 as ds,b7 as ms,b8 as Tt,b9 as hs,ba as us,bb as ra,bc as ps,bd as xs,be as ca,bf as da,bg as bl,bh as gl,bi as rt,bj as ma,bk as ha,bl as ua,bm as pa,bn as yl,bo as xa,bp as fa,bq as ba,br as ga,bs as ya,bt as va,bu as Sa,bv as vl,bw as ja,bx as Na,by as Sl,bz as Za,bA as wa,bB as Ca,bC as jl,bD as Nl,bE as Ga,bF as se,bG as ka,bH as Zl,bI as wl,bJ as Cl,bK as Va,bL as Wa,bM as Ue,bN as Ae,bO as Ta,bP as Gl,bQ as kl,bR as Ra,bS as La,bT as Xa,bU as Ia,bV as Fa,bW as Ka,bX as Vl,bY as Wl,bZ as za,b_ as Tl,b$ as Rl,c0 as Ll,c1 as Ya,c2 as Xl,c3 as Il,c4 as Ha,c5 as Fl,c6 as Da,c7 as Kl,c8 as zl,c9 as Ma,ca as Yl,cb as Pa,cc as Ua,cd as Hl,ce as Dl,cf as Aa,cg as Ml,ch as Pl,ci as Ul,cj as Ba,ck as fs,cl as Al,cm as Bl,cn as Ol,co as Oa,cp as Ea,cq as Ja,cr as Qa,cs as $a,ct as _a,cu as El,cv as re,cw as qa,cx as D,cy as je,cz as Jl,cA as Rt,cB as bs,cC as Ql,cD as gs,cE as en,cF as tn,cG as sn,cH as $l,cI as _l,cJ as Xe,cK as ql,cL as er,cM as tr,cN as sr,cO as ar,cP as nr,cQ as ir,cR as or,cS as lr,cT as rr,cU as cr,cV as ys,cW as dr,cX as mr,cY as an,cZ as hr,c_ as ur,c$ as et,d0 as pr,d1 as xr,d2 as nn,d3 as on,d4 as fr,d5 as g,d6 as te,d7 as br,d8 as gr,d9 as ts,da as yr,db as vr,dc as Sr,dd as jr,de as Nr,df as Zr,dg as wr,dh as Cr,di as Gr,dj as kr,dk as Vr,dl as Wr,dm as Tr,dn as Rr,dp as ln,dq as rn,dr as cn,ds as dn,dt as mn,du as hn,dv as Lr,dw as Xr,dx as Ir,dy as Fr}from"./vendor-40980c71.js";function dh(){import.meta.url,import("_").catch(()=>1);async function*a(){}}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function x(...a){return vi(Si(a))}function Kr(a,s){const t=document.createElement("a");t.setAttribute("download","".concat(a,".mp4")),t.setAttribute("href",s),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function jt(a){const s=a.name.split(".").pop()||"";return{name:a.name.substring(0,a.name.lastIndexOf(".")),ext:s}}const Lt=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:x("w-full caption-bottom text-sm",a),...s})}));Lt.displayName="Table";const Xt=d.forwardRef(({className:a,...s},t)=>e.jsx("thead",{ref:t,className:x("[&_tr]:border-b",a),...s}));Xt.displayName="TableHeader";const It=d.forwardRef(({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:x("[&_tr:last-child]:border-0",a),...s}));It.displayName="TableBody";const zr=d.forwardRef(({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:x("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...s}));zr.displayName="TableFooter";const Ve=d.forwardRef(({className:a,...s},t)=>e.jsx("tr",{ref:t,className:x("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...s}));Ve.displayName="TableRow";const We=d.forwardRef(({className:a,...s},t)=>e.jsx("th",{ref:t,className:x("h-8 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));We.displayName="TableHead";const Te=d.forwardRef(({className:a,...s},t)=>e.jsx("td",{ref:t,className:x("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));Te.displayName="TableCell";const Yr=d.forwardRef(({className:a,...s},t)=>e.jsx("caption",{ref:t,className:x("mt-4 text-sm text-muted-foreground",a),...s}));Yr.displayName="TableCaption";async function Hr(a,s,t,n){const i=a.sampleRate,o=a.numberOfChannels,l=Math.floor(s*i),c=i*t,r=new OfflineAudioContext(o,c,i);let h=r.createBuffer(o,c,i);const m=new Float32Array(c);for(let u=0;u<a.numberOfChannels;u++)a.copyFromChannel(m,u,l),h.copyToChannel(m,u);if(typeof n<"u"){const u=r.createBufferSource();u.buffer=h;const p=r.createGain();p.gain.value=n,u.connect(p),p.connect(r.destination),u.start(),h=await r.startRendering()}return h}async function Dr(a,s=44100){return new Promise((t,n)=>{const i=new AudioContext({sampleRate:s});i.decodeAudioData(a,t,n).finally(()=>{i.close()})})}async function Mr(a){const s=await(await fetch(a)).arrayBuffer();return await Dr(s)}const un={codec:"avc1.42002A",width:1920,height:1080,bitrate:12e6},pn={codec:"mp4a.40.2",numberOfChannels:2,sampleRate:44100,bitrate:128e3};async function Pr(){let a=!1,s=!1;return typeof VideoEncoder<"u"&&typeof VideoFrame<"u"&&(await VideoEncoder.isConfigSupported(un)).supported&&(a=!0),typeof OfflineAudioContext<"u"&&typeof AudioEncoder<"u"&&typeof AudioData<"u"&&(await AudioEncoder.isConfigSupported(pn)).supported&&(s=!0),{video:a,audio:s}}function ce(){return ji(8)}qe.setLevel("ERROR");function Ur(a){return new Promise(s=>setTimeout(s,a))}function Ar(a,s,t){return Math.abs(a-s)<t}async function vs(a,s){if(!s)return[];const t=[];for(const n of s){const i=await Br(a,n);t.push(i)}return t}async function Br(a,s){return await a[s.__type].fromJSON(s)}function ct(a,s,t=!1){t&&(s.name=a.name),s.label=a.label}function dt(a){return{__type:a.constructor.name,label:a.label,name:a.name}}function mt(a,s){s.label=a.label,s.name=a.name}class at extends Ni{constructor(){super();b(this,"label","");b(this,"name",ce());this.blackAndWhite(!0),this.brightness(0,!0)}clone(t=!1){const n=new at;return ct(this,n,t),n}toJSON(){return dt(this)}static fromJSON(t){const n=new at;return mt(t,n),n}}class Nt extends Zi{constructor(){super(...arguments);b(this,"label","");b(this,"name",ce())}clone(t=!1){const n=new Nt;return ct(this,n,t),n}toJSON(){return dt(this)}static fromJSON(t){const n=new Nt;return mt(t,n),n}}class Zt extends wi{constructor(){super(...arguments);b(this,"label","");b(this,"name",ce())}clone(t=!1){const n=new Zt;return ct(this,n,t),n}toJSON(){return dt(this)}static fromJSON(t){const n=new Zt;return mt(t,n),n}}class wt extends ta{constructor(){super(...arguments);b(this,"label","");b(this,"name",ce())}clone(t=!1){const n=new wt;return ct(this,n,t),n}toJSON(){return dt(this)}static fromJSON(t){const n=new wt;return mt(t,n),n}}class Ct extends ta{constructor(){super();b(this,"label","");b(this,"name",ce());this.sepia=0,this.noise=0,this.vignetting=.5}clone(t=!1){const n=new Ct;return ct(this,n,t),n}toJSON(){return dt(this)}static fromJSON(t){const n=new Ct;return mt(t,n),n}}const xn={BlackMaskFilter:at,BlurFilter:Nt,NoiseFilter:Zt,OldFilmFilter:wt,VignetteFilter:Ct};function fn(a){return vs(xn,a)}function Ss(a,s,t=!1,n=!1){var i;t&&(s.name=a.name),s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,n||(s.width=a.width,s.height=a.height),s.setTransform(...bn(a)),s.filters=((i=a.filters)==null?void 0:i.map(o=>o.clone(t)))||null}function js(a,s=!1){var n;let t={__type:a.constructor.name,name:a.name,label:a.label,type:a.type,visible:a.visible,alpha:a.alpha,zIndex:a.zIndex,transform:bn(a),filters:((n=a.filters)==null?void 0:n.map(i=>i.toJSON()))||null};return s||(t={...t,width:a.width,height:a.height}),t}async function Ns(a,s,t=!1){s.name=a.name,s.label=a.label,s.type=a.type,s.visible=a.visible,s.alpha=a.alpha,s.zIndex=a.zIndex,t||(typeof a.width=="number"&&(s.width=a.width),typeof a.height=="number"&&(s.height=a.height)),s.setTransform(...a.transform),s.filters=await fn(a.filters)}function bn(a){return[a.x,a.y,a.scale.x,a.scale.y,a.rotation,a.skew.x,a.skew.y,a.pivot.x,a.pivot.y]}class me extends Ci{constructor(){super(...arguments);b(this,"name",ce());b(this,"label","");b(this,"type","Text");b(this,"disableTextEdit",!1)}async load(){}clone(t=!1){const n=new me(this.text,this.style.clone());return Ss(this,n,t,!0),n.disableTextEdit=this.disableTextEdit,n}toJSON(){return{...js(this,!0),text:this.text,disableTextEdit:this.disableTextEdit,style:{fontSize:this.style.fontSize,fontWeight:this.style.fontWeight,fontStyle:this.style.fontStyle,fontFamily:this.style.fontFamily,fill:this.style.fill,wordWrap:this.style.wordWrap,breakWords:this.style.breakWords,wordWrapWidth:this.style.wordWrapWidth,leading:this.style.leading}}}static async fromJSON(t){const n=new me(t.text,t.style);return await Ns(t,n,!0),n.disableTextEdit=t.disableTextEdit,n}}class Pe extends Gi{constructor(){super(...arguments);b(this,"name",ce());b(this,"label","");b(this,"type","Graphics");b(this,"fillColor","")}async load(){}clone(t=!1){const n=new Pe(super.clone().geometry);return Ss(this,n,t),n.fillColor=this.fillColor,n}toJSON(){return{...js(this),fillColor:this.fillColor,graphicsData:this.geometry.graphicsData.map(t=>[t.shape,{...t.fillStyle,texture:void 0},{...t.lineStyle,texture:void 0}])}}static async fromJSON(t){const n=new ki;n.graphicsData=t.graphicsData.map(o=>{const l=new Vi;l.x=o[0].x,l.y=o[0].y,l.width=o[0].width,l.height=o[0].height;const c=new Wi;c.alpha=o[1].alpha,c.color=o[1].color,c.visible=o[1].visible;const r=new Ti;return r.color=o[2].color,r.alpha=o[2].alpha,r.visible=o[2].visible,r.width=o[2].width,r.alignment=o[2].alignment,r.native=o[2].native,r.cap=o[2].cap,r.join=o[2].join,r.miterLimit=o[2].miterLimit,new Ri(l,c,r)});const i=new Pe(n);return await Ns(t,i),i.fillColor=t.fillColor,i}}const Or={extension:Us.Asset,detection:{test:async()=>!0,add:async a=>[...a],remove:async a=>a.filter(s=>a.includes(s))},loader:{extension:{type:[Us.LoadParser],priority:Li.High},test(a){return a.startsWith("blob:")},async load(a){return Xi.from(a)}}};Ii.add(Or);class nt extends Fi{constructor(t){super();b(this,"name");b(this,"label");b(this,"type");b(this,"source");b(this,"assetID");b(this,"assetType");this.name=ce(),this.label="",this.type="Sprite",this.source=t.source,this.assetID=0,this.assetType=""}changeSource(t){this.source=t}shouldUseCustomDimensions(){return this.texture.width===this.width&&this.texture.height===this.height}async load(){this.source&&(this.texture=await Ki.load(this.source))}clone(t=!1){const n=new nt({source:this.source});return n.assetID=this.assetID,n.assetType=this.assetType,Ss(this,n,t,this.shouldUseCustomDimensions()),n}toJSON(){return{...js(this,this.shouldUseCustomDimensions()),source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(t){const n=new nt({source:t.source});return n.assetID=t.assetID,n.assetType=t.assetType,await Ns(t,n),n}}const Er={Text:me,Graphics:Pe,Sprite:nt};function Jr(a){return vs(Er,a)}class it{constructor(s){b(this,"name");b(this,"label");b(this,"source");b(this,"assetID");b(this,"assetType");b(this,"buffer");this.name=ce(),this.label="",this.source=s.source,this.assetID=0,this.assetType=""}changeSource(s){this.source=s}async load(){this.buffer=await Mr(this.source)}clone(s=!1){const t=new it({source:this.source});return Qt(this,t,s),t}toJSON(){const s={};return Qt(this,s,!0),{__type:"Sound",...s,source:this.source,assetID:this.assetID,assetType:this.assetType}}static async fromJSON(s){const t=new it({source:s.source});return Qt(s,t,!0),t}destroy(){this.buffer=void 0}}function Qt(a,s,t=!1){t&&(s.name=a.name),s.label=a.label,s.assetID=a.assetID,s.assetType=a.assetType}function Qr(a){return vs({Sound:it},a)}class he extends zi{constructor(t){super();b(this,"name");b(this,"label");b(this,"config");b(this,"dialogues");b(this,"sounds");this.name=ce(),this.label=(t==null?void 0:t.label)||"",this.config={speak:{targetName:"",wordsPerMin:500,interval:.2,effect:"typewriter",speaker:{targetName:"",name:"",autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}}},autoShowBackground:!0},this.dialogues=[],this.sounds=[],this.children=[],this.sortableChildren=!0}getSoundByName(t){return this.sounds.find(n=>n.name===t)}addSound(t){this.sounds.push(t)}removeSound(t){this.sounds=this.sounds.filter(n=>n.name===t.name?(t.destroy(),!1):!0)}addFilter(t){this.filters?this.filters.push(t):this.filters=[t]}removeFilter(t){this.filters&&(this.filters=this.filters.filter(n=>n!==t))}addDialogue(t,n){typeof n<"u"?this.dialogues.splice(n,0,t):this.dialogues.push(t)}updateDialogue(t,n){this.dialogues[t]=n}removeDialogue(t){this.dialogues=this.dialogues.filter(n=>n!==t)}swapDialogue(t,n){[this.dialogues[t],this.dialogues[n]]=[this.dialogues[n],this.dialogues[t]]}clone(){var i;const t=new he;t.label=this.label,t.config=St(this.config),t.dialogues=St(this.dialogues);const n=this.children.map(o=>o.clone(!0));return n.length>0&&t.addChild(...n),t.sounds=this.sounds.map(o=>o.clone(!0)),t.filters=((i=this.filters)==null?void 0:i.map(o=>o.clone(!0)))||null,t}toJSON(){return{__type:"Scene",name:this.name,label:this.label,config:this.config,dialogues:this.dialogues,children:this.children,sounds:this.sounds,filters:this.filters}}static async fromJSON(t,n=!0){const i=new he;n&&(i.name=t.name),i.label=t.label,i.config=t.config,i.dialogues=t.dialogues;const o=await Jr(t.children);return o.length>0&&i.addChild(...o),i.sounds=await Qr(t.sounds),i.filters=await fn(t.filters),i}async load(){const t=async n=>{if(typeof n.load=="function"&&await n.load(),n.children&&n.children.length>0)for(const i of n.children)await t(i)};for(const n of this.children)await t(n);for(const n of this.sounds)await n.load()}}const $r={version:"3.12.2",name:"text",init(a,s,t){var i,o,l;typeof s!="object"&&(s={value:s});let n=s.value;this.startText=((l=(o=(i=t.vars)==null?void 0:i.startAt)==null?void 0:o.text)==null?void 0:l.value)||"",this.target=a,this.startText&&(n=n.replace(this.startText,"")),n=n.split(""),this.from=t._from,this.text=n,this._props.push("text")},render(a,s){a>1?a=1:a<0&&(a=0),s.from&&(a=1-a);const{text:t,target:n,startText:i}=s,o=t.length,l=a*o+.5|0;n.text=i+t.slice(0,l).join("")}};class Be{constructor(s,t){b(this,"options");b(this,"stage");b(this,"executeTime");b(this,"currentTime");this.options=s,this.stage=t,this.executeTime=0,this.currentTime=0}}class P extends Be{constructor(t,n){super(t,n);b(this,"target");this.options=t,this.target=this.stage.getChildByName(t.targetName,!0)}execute(){if(!this.target)return;const{fromVars:t,toVars:n}=this.options;this.target.visible=!0,t&&n?B.fromTo(this.target,t,n):n&&B.to(this.target,n)}getDuration(){var t,n;return this.options.sequential&&(n=(t=this.options.toVars)==null?void 0:t.duration)!=null?n:0}}class ht extends Be{constructor(t,n){super(t,n);b(this,"target");this.stage=n,this.target=this.stage.getSoundByName(t.targetName)}getDuration(){return 0}}class gn extends Be{constructor(s,t){super(s,t),this.options=s}execute(){const{fromVars:s,toVars:t}=this.options;s&&t?B.fromTo(this.stage,s,t):t&&B.to(this.stage,t)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.options.toVars)==null?void 0:s.duration)!=null?t:0}}class Zs extends Be{constructor(t,n){super(t,n);b(this,"target");this.options=t,this.stage=n,t.targetName&&(this.target=this.stage.getChildByName(t.targetName))}getDuration(){return 0}}class yn extends P{constructor(s,t){super(s,t),this.options=M({toVars:{pixi:{visible:!0},ease:"none",duration:0}},s)}}class vn extends P{constructor(s,t){var n;super(s,t),this.options=M({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:(n=this.target.alpha)!=null?n:1},ease:"power1.in",duration:.5}},s)}}const $t="AutoMaskFilter",_r={Show:yn,FadeIn:vn};class Sn extends P{constructor(t,n){super(t,n);b(this,"speakerTarget");this.options=M({autoShowSpeaker:{inEffect:"Show"},autoMaskOtherSpeakers:{alpha:.5}},t);const{speakerTargetName:i}=this.options;i&&(this.speakerTarget=this.stage.getChildByName(i))}execute(){const{name:t,autoShowSpeaker:n,autoMaskOtherSpeakers:i}=this.options;if(this.target&&(this.target.visible=!0,this.target.text=t),n&&this.speakerTarget&&!this.speakerTarget.visible){const{inEffect:o="Show"}=n,l=_r[o];new l({...n,targetName:this.speakerTarget.name},this.stage).execute()}if(i){const{alpha:o=.5}=i;this.speakerTarget&&this.checkMaskFilter(this.speakerTarget)&&this.removeMaskFilter(this.speakerTarget),this.stage.children.forEach(l=>{l!==this.speakerTarget&&l.assetType==="Character"&&(this.checkMaskFilter(l)||this.addMaskFilter(l,o))})}}checkMaskFilter(t){var n;return(n=t.filters)==null?void 0:n.some(i=>i.name===$t)}removeMaskFilter(t){var n;t.filters=((n=t.filters)==null?void 0:n.filter(i=>i.name!==$t))||[]}addMaskFilter(t,n){const i=new at;i.name=$t,i.alpha=n,t.filters?t.filters.push(i):t.filters=[i]}}class qr{constructor(){b(this,"sliceTaskList",[]);b(this,"soundRecordMap",new Map)}play(s,t){const n=this.soundRecordMap.get(s.name);if(n)Object.assign(n,{...t,paused:!1});else{const{start:i,volume:o,loop:l,untilEnd:c}=t;this.soundRecordMap.set(s.name,{sound:s,paused:!1,elapsedTime:0,start:i!=null?i:0,volume:o!=null?o:1,loop:l!=null?l:!1,untilEnd:c!=null?c:!1})}}pause(s){const t=this.soundRecordMap.get(s.name);t&&(t.paused=!0)}stop(s){this.soundRecordMap.delete(s.name)}update(s,t){for(const n of this.soundRecordMap.values()){const{sound:i,paused:o,elapsedTime:l,start:c,loop:r,volume:h}=n;if(!o){if(i.buffer){let m=l;const u=i.buffer.duration;r&&m>u-c&&(m=m%(u-c));const p=Hr(i.buffer,m+c,1/t,h);this.sliceTaskList.push(p)}n.elapsedTime=s}}}async getAudioBuffers(){const s=await Promise.all(this.sliceTaskList);return this.sliceTaskList=[],s}resetExceptUtilEnd(){for(const[s,t]of this.soundRecordMap)t.untilEnd||this.soundRecordMap.delete(s)}reset(){this.sliceTaskList=[],this.soundRecordMap.clear()}}const Se=new qr;class ec extends ht{constructor(s,t){super(s,t),this.options=s}execute(){Se.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}class tc extends ht{execute(){Se.pause(this.target)}}class sc extends ht{execute(){Se.stop(this.target)}}class jn extends ht{constructor(s,t){super(s,t),this.options=s}execute(){Se.play(this.target,this.options)}getDuration(){var s,t;return this.options.sequential&&(t=(s=this.target.buffer)==null?void 0:s.duration)!=null?t:0}}function Nn(a,s){return s.some(([t,n])=>t<=a&&a<=n)}function _t(a){const s=a.charCodeAt(0);return Nn(s,[[12352,12447],[19968,40959],[44032,55203],[131072,191456]])}function ac(a){return" \n\r	".includes(a)}function nc(a){const s=a.charCodeAt(0);return Nn(s,[[33,47],[58,64],[91,96],[123,126],[12288,12351],[65280,65519]])}function ic(a,s){let t=0,n=0,i=a.length-1;const{wordBound:o=ac}=s;for(;o(a[n]);)n++;for(;o(a[i]);)i--;const l="".concat(a,"\n");for(let c=n;c<=i;c++)if((_t(l[c])||!o(l[c])&&(o(l[c+1])||_t(l[c+1])))&&t++,_t(l[c]))for(;c<=i&&(nc(l[c+1])||o(l[c+1]));)c++;return{total:t}}function oc(a,s={}){const{wordsPerMin:t=500}=s,n=a.total/t;return{seconds:parseFloat((n*60).toFixed(1))}}function lc(a,s={}){const t=ic(a,s);return{...oc(t,s),words:t}}class rc extends P{constructor(t,n){super(t,n);b(this,"speakerDirective");b(this,"voiceDirective");this.options=M({interval:.2,sequential:!0,effect:"typewriter",alignWithVoice:!0},t);const{speaker:i,voice:o}=this.options;i!=null&&i.targetName&&(this.speakerDirective=new Sn(i,n)),o!=null&&o.targetName&&(this.voiceDirective=new jn({...o,sequential:!0},this.stage))}execute(){var c,r;if(!this.target)return;const{text:t,append:n,effect:i}=this.options;let o="",l=t;switch(this.target.visible=!0,n&&(o=this.target.text,l=this.target.text+t),i){case"typewriter":this.typewriter(o,l);break;case"fadeIn":this.fadeIn(o,l);break;case"none":this.none(o,l);break}(c=this.speakerDirective)==null||c.execute(),(r=this.voiceDirective)==null||r.execute()}typewriter(t,n){const{text:i,wordsPerMin:o}=this.options;B.fromTo(this.target,{text:{value:t}},{text:{value:n},duration:this.readingTime(i,o),ease:"none"})}fadeIn(t,n){B.fromTo(this.target,{pixi:{alpha:0},text:{value:t}},{pixi:{alpha:1},text:{value:n},duration:.5,ease:"none"})}none(t,n){this.target.text=n}getDuration(){const{sequential:t,text:n,wordsPerMin:i,interval:o}=this.options,l=this.readingTime(n,i)+(o!=null?o:0);return t?l:0}readingTime(t,n=500){const{customReadingTime:i}=this.options;return typeof i=="number"?i:t?lc(t,{wordsPerMin:n}).seconds:0}}class cc extends P{constructor(s,t){super(s,t),this.options=M({toVars:{pixi:{visible:!1},ease:"none",duration:0}},s)}}class dc extends P{constructor(s,t){super(s,t),this.options=M({toVars:{pixi:{alpha:0},ease:"power1.in",duration:.5}},s)}}class mc extends P{constructor(s,t){super(s,t),this.options={...s,immediate:!0}}async execute(){const{source:s,immediate:t}=this.options;this.target.changeSource(s),t?await this.target.load():B.to(this.target,{pixi:{alpha:0},duration:.3,onComplete:()=>{this.target.load().then(()=>{B.to(this.target,{pixi:{alpha:1},duration:.3})})}})}}class hc extends P{constructor(s,t){super(s,t);const n=this.target,i=n.width?n.width*.05:0,o=n.x,l=o-i,c=o+i;this.options=M({toVars:{keyframes:{"0%":{x:o},"15%":{x:l},"30%":{x:c},"45%":{x:l},"60%":{x:c},"75%":{x:l},"90%":{x:c},"100%":{x:o}},duration:.5,ease:"none"}},s)}}class uc extends P{constructor(s,t){super(s,t);const n=this.target,i=n.height?n.height*.05:0,o=n.y,l=o-i,c=o+i;this.options=M({toVars:{keyframes:{"0%":{y:o},"15%":{y:l},"30%":{y:c},"45%":{y:l},"60%":{y:c},"75%":{y:l},"90%":{y:c},"100%":{y:o}},duration:.5,ease:"none"}},s)}}class pc extends P{constructor(s,t){super(s,t);const n=this.target,i=n.x,o=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=o+n.height*n.anchor.y,this.options=M({toVars:{pixi:{scale:1.1},ease:"power1.in",duration:.5}},s)}}class xc extends P{constructor(s,t){super(s,t);const n=this.target,i=n.x,o=n.y;n.anchor.set(.5),n.x=i+n.width*n.anchor.x,n.y=o+n.height*n.anchor.y,this.options=M({toVars:{pixi:{scale:.9},ease:"power1.out",duration:.5}},s)}}class fc extends P{constructor(s,t){var i,o;super(s,t);const n=this.target;this.options=M({fromVars:{pixi:{x:n.x-n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(o=n.alpha)!=null?o:1},ease:"power1.in",duration:.5}},s)}}class bc extends P{constructor(s,t){super(s,t);const n=this.target;this.options=M({toVars:{pixi:{x:n.x-n.width,alpha:0},ease:"power1.in",duration:.5}},s)}}class gc extends P{constructor(s,t){var i,o;super(s,t);const n=this.target;this.options=M({fromVars:{pixi:{x:n.x+n.width,alpha:0}},toVars:{pixi:{x:(i=n.x)!=null?i:0,alpha:(o=n.alpha)!=null?o:1},ease:"power1.in",duration:.5}},s)}}class yc extends P{constructor(s,t){super(s,t);const n=this.target;this.options=M({toVars:{pixi:{x:n.x+n.width,alpha:0},ease:"power1.in",duration:.5}},s)}}class vc extends Be{constructor(s,t){super(s,t),this.options=M({sequential:!0},s)}execute(){}getDuration(){return this.options.duration}}class Sc extends gn{constructor(s,t){super(s,t),this.options=M({fromVars:{pixi:{alpha:0}},toVars:{pixi:{alpha:1},ease:"power1.in",duration:.3}},s)}}class jc extends Zs{constructor(s,t){super(s,t),this.options=s}execute(){const{targetName:s,filterName:t}=this.options;s?this.target&&this.addFilter(this.target,t):this.addFilter(this.stage,t)}addFilter(s,t){const n=new xn[t];s.filters?s.filters.push(n):s.filters=[n]}}class Nc extends Zs{execute(){const{targetName:s}=this.options;s?this.target&&(this.target.filters=[]):this.stage.filters=[]}}const Zc=Object.freeze(Object.defineProperty({__proto__:null,AddFilter:jc,AnimationDirective:P,ChangeSource:mc,Directive:Be,EnterFromLeft:fc,EnterFromRight:gc,FadeIn:vn,FadeInTransition:Sc,FadeOut:dc,FilterDirective:Zs,Hide:cc,LeaveFromLeft:bc,LeaveFromRight:yc,Pause:tc,Play:ec,RemoveFilter:Nc,ShakeX:hc,ShakeY:uc,Show:yn,SoundDirective:ht,Speak:rc,Speaker:Sn,Stop:sc,TransitionDirective:gn,Voice:jn,Wait:vc,ZoomIn:pc,ZoomOut:xc},Symbol.toStringTag,{value:"Module"}));B.registerPlugin(sa);B.registerPlugin($r);sa.registerPIXI(Yi);B.ticker.remove(B.updateRoot);var S=(a=>(a.ChangeSource="ChangeSource",a.Speak="Speak",a.Speaker="Speaker",a.Show="Show",a.Hide="Hide",a.FadeIn="FadeIn",a.FadeOut="FadeOut",a.ShakeX="ShakeX",a.ShakeY="ShakeY",a.ZoomIn="ZoomIn",a.ZoomOut="ZoomOut",a.EnterFromLeft="EnterFromLeft",a.LeaveFromLeft="LeaveFromLeft",a.EnterFromRight="EnterFromRight",a.LeaveFromRight="LeaveFromRight",a.Wait="Wait",a.Play="Play",a.Pause="Pause",a.Stop="Stop",a.FadeInTransition="FadeInTransition",a.AddFilter="AddFilter",a.RemoveFilter="RemoveFilter",a))(S||{});const Wt=class Wt{constructor(s){b(this,"ticker");b(this,"renderer");b(this,"rendererOptions");b(this,"started");b(this,"connecter");b(this,"cutResolver");var o;this.ticker=Hi.shared,this.ticker.ctx={},this.ticker.asyncHandlers=[],this.ticker.autoStart=!1,this.ticker.stop(),this.rendererOptions=Object.assign({},Wt.defaultRendererOptions,s),this.started=!1;const{width:t,height:n,background:i}=this.rendererOptions;this.renderer=(o=this.rendererOptions.renderer)!=null?o:Di({view:new OffscreenCanvas(t,n),width:t,height:n,background:i})}connect(s){this.connecter=s,this.connecter.connect()}disconnect(){var s;(s=this.connecter)==null||s.disconnect(),this.connecter=void 0}hasStarted(){return this.started}async action(s){if(this.started)return;const t=performance.now();B.updateRoot(0);try{const n=this.parseScreenplay(s);return this.registerUpdater(),await this.run(n)}finally{this.reset(),qe.info("action cost:",performance.now()-t),this.cutResolver&&this.cutResolver(!0)}}cut(){return new Promise(s=>{this.started=!1,this.cutResolver=s})}reset(){this.started=!1,Se.reset();let s=this.ticker._head.next;for(;s;)s=s.destroy(!0);this.ticker.time=0,this.ticker.lastTime=-1,this.ticker.ctx={},this.ticker.asyncHandlers=[]}parseScreenplay(s){let t=0;const{scenes:n}=s;for(const i of n)t=this.parseSceneScript(i,t);return t}parseSceneScript(s,t){const{scene:n}=s,{directives:i}=s;let o=t;n.children.forEach(l=>{l.visible=!1});for(const l of i){const{directive:c,params:r}=l,h=Zc[c];if(!h){qe.error("Directive ".concat(c," not found"));continue}const m=new h(r,n);m.executeTime=o,this.ticker.add(()=>{const u=this.ticker.time;m.currentTime=u,Ar(u,m.executeTime,1/(this.rendererOptions.fps*2))&&(qe.debug("execute directive:",m,u,m.executeTime),this.ticker.asyncHandlers.push(m.execute()))}),o+=m.getDuration()}return this.ticker.add(()=>{const l=this.ticker.time;l>=t&&l<=o&&this.ticker.ctx.scene!==n&&(this.ticker.ctx.scene&&Se.resetExceptUtilEnd(),this.ticker.ctx.scene=n)}),o}registerUpdater(){this.ticker.add(()=>{const s=this.ticker.time;Se.update(s,this.rendererOptions.fps);const t=async()=>{this.ticker.ctx.audioBuffers=await Se.getAudioBuffers()};this.ticker.asyncHandlers.push(t()),B.updateRoot(s),this.ticker.ctx.scene&&(this.renderer.render(this.ticker.ctx.scene),this.ticker.ctx.imageSource=this.renderer.view)})}async run(s){var o,l;const{fps:t}=this.rendererOptions,n=Math.ceil(s*t);this.started=!0;for(let c=0;c<=n;c++){const r=c/t*1e3;if(this.started)this.ticker.time=r/1e3,this.ticker.update(r),await Promise.all(this.ticker.asyncHandlers),(o=this.connecter)!=null&&o.connection&&await this.connecter.handle({timestamp:r,imageSource:this.ticker.ctx.imageSource,audioBuffers:this.ticker.ctx.audioBuffers}),this.rendererOptions.onProgress&&this.rendererOptions.onProgress(c/n*100,r/1e3,s);else break}let i;return this.started&&((l=this.connecter)!=null&&l.connection)&&(i=await this.connecter.finish()),this.started=!1,i}};b(Wt,"defaultRendererOptions",{fps:30,width:1920,height:1080,background:0});let ss=Wt;class Zn{constructor(s){b(this,"connection");b(this,"options");this.connection=!1,this.options=s}connect(){this.connection=!0}disconnect(){this.connection=!1}}const wn="dmFyIGhpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgdWk9KE4sVSx4KT0+VSBpbiBOP2hpKE4sVSx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6eH0pOk5bVV09eDt2YXIgRj0oTixVLHgpPT4odWkoTix0eXBlb2YgVSE9InN5bWJvbCI/VSsiIjpVLHgpLHgpOyhmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgTj1PYmplY3QuZGVmaW5lUHJvcGVydHksVT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLHg9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxqZT1PYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLHo9TWF0aC5wb3csemU9KGUsdCxpKT0+dCBpbiBlP04oZSx0LHtlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMCx2YWx1ZTppfSk6ZVt0XT1pLGV0PShlLHQpPT57Zm9yKHZhciBpIGluIHR8fCh0PXt9KSl4LmNhbGwodCxpKSYmemUoZSxpLHRbaV0pO2lmKFUpZm9yKHZhciBpIG9mIFUodCkpamUuY2FsbCh0LGkpJiZ6ZShlLGksdFtpXSk7cmV0dXJuIGV9LHZlPShlLHQsaSk9PntpZighdC5oYXMoZSkpdGhyb3cgVHlwZUVycm9yKCJDYW5ub3QgIitpKX0sbj0oZSx0LGkpPT4odmUoZSx0LCJyZWFkIGZyb20gcHJpdmF0ZSBmaWVsZCIpLGk/aS5jYWxsKGUpOnQuZ2V0KGUpKSxvPShlLHQsaSk9PntpZih0LmhhcyhlKSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCBhZGQgdGhlIHNhbWUgcHJpdmF0ZSBtZW1iZXIgbW9yZSB0aGFuIG9uY2UiKTt0IGluc3RhbmNlb2YgV2Vha1NldD90LmFkZChlKTp0LnNldChlLGkpfSxFPShlLHQsaSxzKT0+KHZlKGUsdCwid3JpdGUgdG8gcHJpdmF0ZSBmaWVsZCIpLHM/cy5jYWxsKGUsaSk6dC5zZXQoZSxpKSxpKSx3PShlLHQsaSk9Pih2ZShlLHQsImFjY2VzcyBwcml2YXRlIG1ldGhvZCIpLGkpLGw9bmV3IFVpbnQ4QXJyYXkoOCksQj1uZXcgRGF0YVZpZXcobC5idWZmZXIpLEE9ZT0+WyhlJTI1NisyNTYpJTI1Nl0sdT1lPT4oQi5zZXRVaW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksdHQ9ZT0+KEIuc2V0SW50MTYoMCxlLCExKSxbbFswXSxsWzFdXSksQmU9ZT0+KEIuc2V0VWludDMyKDAsZSwhMSksW2xbMV0sbFsyXSxsWzNdXSksYT1lPT4oQi5zZXRVaW50MzIoMCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXV0pLGl0PWU9PihCLnNldFVpbnQzMigwLE1hdGguZmxvb3IoZS96KDIsMzIpKSwhMSksQi5zZXRVaW50MzIoNCxlLCExKSxbbFswXSxsWzFdLGxbMl0sbFszXSxsWzRdLGxbNV0sbFs2XSxsWzddXSksd2U9ZT0+KEIuc2V0SW50MTYoMCx6KDIsOCkqZSwhMSksW2xbMF0sbFsxXV0pLEQ9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMTYpKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksZ2U9ZT0+KEIuc2V0SW50MzIoMCx6KDIsMzApKmUsITEpLFtsWzBdLGxbMV0sbFsyXSxsWzNdXSksUD0oZSx0PSExKT0+e2xldCBpPUFycmF5KGUubGVuZ3RoKS5maWxsKG51bGwpLm1hcCgocyxyKT0+ZS5jaGFyQ29kZUF0KHIpKTtyZXR1cm4gdCYmaS5wdXNoKDApLGl9LEg9ZT0+ZSYmZVtlLmxlbmd0aC0xXSxKPShlLHQsaT0hMCk9PntsZXQgcz1lKnQ7cmV0dXJuIGk/TWF0aC5yb3VuZChzKTpzfSxrZT1lPT57bGV0IHQ9ZSooTWF0aC5QSS8xODApLGk9TWF0aC5jb3ModCkscz1NYXRoLnNpbih0KTtyZXR1cm5baSxzLDAsLXMsaSwwLDAsMCwxXX0sbnQ9a2UoMCksRmU9ZT0+W0QoZVswXSksRChlWzFdKSxnZShlWzJdKSxEKGVbM10pLEQoZVs0XSksZ2UoZVs1XSksRChlWzZdKSxEKGVbN10pLGdlKGVbOF0pXSxDPShlLHQsaSk9Pih7dHlwZTplLGNvbnRlbnRzOnQmJm5ldyBVaW50OEFycmF5KHQuZmxhdCgxMCkpLGNoaWxkcmVuOml9KSxfPShlLHQsaSxzLHIpPT5DKGUsW0EodCksQmUoaSkscyE9bnVsbD9zOltdXSxyKSxzdD1lPT5lP0MoImZ0eXAiLFtQKCJpc29tIiksYSgwKSxQKCJpc280IiksUCgiaHZjMSIpXSk6QygiZnR5cCIsW1AoImlzb20iKSxhKDApLFAoImlzb20iKSxQKCJhdmMxIiksUCgibXA0MSIpXSkscnQ9KCk9Pih7dHlwZToibWRhdCIsbGFyZ2VTaXplOiEwfSksYXQ9KGUsdCk9PkMoIm1vb3YiLG51bGwsW290KHQsZSksLi4uZS5tYXAoaT0+bHQoaSx0KSldKSxvdD0oZSx0KT0+e2xldCBpPUooTWF0aC5tYXgoMCwuLi50LmZpbHRlcihyPT5yLnNhbXBsZXMubGVuZ3RoPjApLm1hcChyPT5IKHIuc2FtcGxlcykudGltZXN0YW1wK0goci5zYW1wbGVzKS5kdXJhdGlvbikpLFNlKSxzPU1hdGgubWF4KC4uLnQubWFwKHI9PnIuaWQpKSsxO3JldHVybiBfKCJtdmhkIiwwLDAsW2EoZSksYShlKSxhKFNlKSxhKGkpLEQoMSksd2UoMSksQXJyYXkoMTApLmZpbGwoMCksRmUobnQpLEFycmF5KDI0KS5maWxsKDApLGEocyldKX0sbHQ9KGUsdCk9PkMoInRyYWsiLG51bGwsW2h0KGUsdCksdXQoZSx0KV0pLGh0PShlLHQpPT57bGV0IGk9SChlLnNhbXBsZXMpLHM9SihpP2kudGltZXN0YW1wK2kuZHVyYXRpb246MCxTZSk7cmV0dXJuIF8oInRraGQiLDAsMyxbYSh0KSxhKHQpLGEoZS5pZCksYSgwKSxhKHMpLEFycmF5KDgpLmZpbGwoMCksdSgwKSx1KDApLHdlKGUuaW5mby50eXBlPT09ImF1ZGlvIj8xOjApLHUoMCksRmUoa2UoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5yb3RhdGlvbjowKSksRChlLmluZm8udHlwZT09PSJ2aWRlbyI/ZS5pbmZvLndpZHRoOjApLEQoZS5pbmZvLnR5cGU9PT0idmlkZW8iP2UuaW5mby5oZWlnaHQ6MCldKX0sdXQ9KGUsdCk9PkMoIm1kaWEiLG51bGwsW2R0KGUsdCksZnQoZS5pbmZvLnR5cGU9PT0idmlkZW8iPyJ2aWRlIjoic291biIpLGN0KGUpXSksZHQ9KGUsdCk9PntsZXQgaT1IKGUuc2FtcGxlcykscz1KKGk/aS50aW1lc3RhbXAraS5kdXJhdGlvbjowLGUudGltZXNjYWxlKTtyZXR1cm4gXygibWRoZCIsMCwwLFthKHQpLGEodCksYShlLnRpbWVzY2FsZSksYShzKSx1KDIxOTU2KSx1KDApXSl9LGZ0PWU9Pl8oImhkbHIiLDAsMCxbUCgibWhsciIpLFAoZSksYSgwKSxhKDApLGEoMCksUCgibXA0LW11eGVyLWhkbHIiKV0pLGN0PWU9PkMoIm1pbmYiLG51bGwsW2UuaW5mby50eXBlPT09InZpZGVvIj9wdCgpOnZ0KCksd3QoKSx5dChlKV0pLHB0PSgpPT5fKCJ2bWhkIiwwLDEsW3UoMCksdSgwKSx1KDApLHUoMCldKSx2dD0oKT0+Xygic21oZCIsMCwwLFt1KDApLHUoMCldKSx3dD0oKT0+QygiZGluZiIsbnVsbCxbZ3QoKV0pLGd0PSgpPT5fKCJkcmVmIiwwLDAsW2EoMSldLFttdCgpXSksbXQ9KCk9Pl8oInVybCAiLDAsMSkseXQ9ZT0+Qygic3RibCIsbnVsbCxbQ3QoZSksT3QoZSksTHQoZSksVXQoZSksRHQoZSksUHQoZSldKSxDdD1lPT5fKCJzdHNkIiwwLDAsW2EoMSldLFtlLmluZm8udHlwZT09PSJ2aWRlbyI/X3QoV3RbZS5pbmZvLmNvZGVjXSxlKTpJdChCdFtlLmluZm8uY29kZWNdLGUpXSksX3Q9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxBcnJheSgxMikuZmlsbCgwKSx1KHQuaW5mby53aWR0aCksdSh0LmluZm8uaGVpZ2h0KSxhKDQ3MTg1OTIpLGEoNDcxODU5MiksYSgwKSx1KDEpLEFycmF5KDMyKS5maWxsKDApLHUoMjQpLHR0KDY1NTM1KV0sW3p0W3QuaW5mby5jb2RlY10odCldKSxUdD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXZjQyIsWy4uLmUuY29kZWNQcml2YXRlXSksU3Q9ZT0+ZS5jb2RlY1ByaXZhdGUmJkMoImh2Y0MiLFsuLi5lLmNvZGVjUHJpdmF0ZV0pLEV0PWU9PmUuY29kZWNQcml2YXRlJiZDKCJ2cGNDIixbLi4uZS5jb2RlY1ByaXZhdGVdKSxidD1lPT5lLmNvZGVjUHJpdmF0ZSYmQygiYXYxQyIsWy4uLmUuY29kZWNQcml2YXRlXSksSXQ9KGUsdCk9PkMoZSxbQXJyYXkoNikuZmlsbCgwKSx1KDEpLHUoMCksdSgwKSxhKDApLHUodC5pbmZvLm51bWJlck9mQ2hhbm5lbHMpLHUoMTYpLHUoMCksdSgwKSxEKHQuaW5mby5zYW1wbGVSYXRlKV0sW2t0W3QuaW5mby5jb2RlY10odCldKSxBdD1lPT5fKCJlc2RzIiwwLDAsW2EoNTg3NTMxNTIpLEEoMzIrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksdSgxKSxBKDApLGEoNzU1MzAzNjgpLEEoMTgrZS5jb2RlY1ByaXZhdGUuYnl0ZUxlbmd0aCksQSg2NCksQSgyMSksQmUoMCksYSgxMzAwNzEpLGEoMTMwMDcxKSxhKDkyMzA3NTg0KSxBKGUuY29kZWNQcml2YXRlLmJ5dGVMZW5ndGgpLC4uLmUuY29kZWNQcml2YXRlLGEoMTA5MDg0ODAwKSxBKDEpLEEoMildKSxNdD1lPT5DKCJkT3BzIixbQSgwKSxBKGUuaW5mby5udW1iZXJPZkNoYW5uZWxzKSx1KDM4NDApLGEoZS5pbmZvLnNhbXBsZVJhdGUpLHdlKDApLEEoMCldKSxPdD1lPT5fKCJzdHRzIiwwLDAsW2EoZS50aW1lVG9TYW1wbGVUYWJsZS5sZW5ndGgpLGUudGltZVRvU2FtcGxlVGFibGUubWFwKHQ9PlthKHQuc2FtcGxlQ291bnQpLGEodC5zYW1wbGVEZWx0YSldKV0pLEx0PWU9PntpZihlLnNhbXBsZXMuZXZlcnkoaT0+aS50eXBlPT09ImtleSIpKXJldHVybiBudWxsO2xldCB0PVsuLi5lLnNhbXBsZXMuZW50cmllcygpXS5maWx0ZXIoKFssaV0pPT5pLnR5cGU9PT0ia2V5Iik7cmV0dXJuIF8oInN0c3MiLDAsMCxbYSh0Lmxlbmd0aCksdC5tYXAoKFtpXSk9PmEoaSsxKSldKX0sVXQ9ZT0+Xygic3RzYyIsMCwwLFthKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLmxlbmd0aCksZS5jb21wYWN0bHlDb2RlZENodW5rVGFibGUubWFwKHQ9PlthKHQuZmlyc3RDaHVuayksYSh0LnNhbXBsZXNQZXJDaHVuayksYSgxKV0pXSksRHQ9ZT0+Xygic3RzeiIsMCwwLFthKDApLGEoZS5zYW1wbGVzLmxlbmd0aCksZS5zYW1wbGVzLm1hcCh0PT5hKHQuc2l6ZSkpXSksUHQ9ZT0+ZS53cml0dGVuQ2h1bmtzLmxlbmd0aD4wJiZIKGUud3JpdHRlbkNodW5rcykub2Zmc2V0Pj16KDIsMzIpP18oImNvNjQiLDAsMCxbYShlLndyaXR0ZW5DaHVua3MubGVuZ3RoKSxlLndyaXR0ZW5DaHVua3MubWFwKHQ9Pml0KHQub2Zmc2V0KSldKTpfKCJzdGNvIiwwLDAsW2EoZS53cml0dGVuQ2h1bmtzLmxlbmd0aCksZS53cml0dGVuQ2h1bmtzLm1hcCh0PT5hKHQub2Zmc2V0KSldKSxXdD17YXZjOiJhdmMxIixoZXZjOiJodmMxIix2cDk6InZwMDkiLGF2MToiYXYwMSJ9LHp0PXthdmM6VHQsaGV2YzpTdCx2cDk6RXQsYXYxOmJ0fSxCdD17YWFjOiJtcDRhIixvcHVzOiJvcHVzIn0sa3Q9e2FhYzpBdCxvcHVzOk10fSxSZT1jbGFzc3tjb25zdHJ1Y3Rvcigpe3RoaXMuYnVmZmVyPW51bGx9fSxOZT1jbGFzc3tjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5vbkRhdGE9ZSx0aGlzLm9uRG9uZT10LHRoaXMub3B0aW9ucz1pfX0sRnQ9Y2xhc3N7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnN0cmVhbT1lLHRoaXMub3B0aW9ucz10fX0sVixZLG1lPWNsYXNze2NvbnN0cnVjdG9yKCl7dGhpcy5wb3M9MCxvKHRoaXMsVixuZXcgVWludDhBcnJheSg4KSksbyh0aGlzLFksbmV3IERhdGFWaWV3KG4odGhpcyxWKS5idWZmZXIpKSx0aGlzLm9mZnNldHM9bmV3IFdlYWtNYXB9c2VlayhlKXt0aGlzLnBvcz1lfXdyaXRlVTMyKGUpe24odGhpcyxZKS5zZXRVaW50MzIoMCxlLCExKSx0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLDQpKX13cml0ZVU2NChlKXtuKHRoaXMsWSkuc2V0VWludDMyKDAsTWF0aC5mbG9vcihlL3ooMiwzMikpLCExKSxuKHRoaXMsWSkuc2V0VWludDMyKDQsZSwhMSksdGhpcy53cml0ZShuKHRoaXMsVikuc3ViYXJyYXkoMCw4KSl9d3JpdGVBc2NpaShlKXtmb3IobGV0IHQ9MDt0PGUubGVuZ3RoO3QrKyluKHRoaXMsWSkuc2V0VWludDgodCU4LGUuY2hhckNvZGVBdCh0KSksdCU4PT09NyYmdGhpcy53cml0ZShuKHRoaXMsVikpO2UubGVuZ3RoJTghPT0wJiZ0aGlzLndyaXRlKG4odGhpcyxWKS5zdWJhcnJheSgwLGUubGVuZ3RoJTgpKX13cml0ZUJveChlKXt2YXIgdCxpO2lmKHRoaXMub2Zmc2V0cy5zZXQoZSx0aGlzLnBvcyksZS5jb250ZW50cyYmIWUuY2hpbGRyZW4pdGhpcy53cml0ZUJveEhlYWRlcihlLCh0PWUuc2l6ZSkhPW51bGw/dDplLmNvbnRlbnRzLmJ5dGVMZW5ndGgrOCksdGhpcy53cml0ZShlLmNvbnRlbnRzKTtlbHNle2xldCBzPXRoaXMucG9zO2lmKHRoaXMud3JpdGVCb3hIZWFkZXIoZSwwKSxlLmNvbnRlbnRzJiZ0aGlzLndyaXRlKGUuY29udGVudHMpLGUuY2hpbGRyZW4pZm9yKGxldCBmIG9mIGUuY2hpbGRyZW4pZiYmdGhpcy53cml0ZUJveChmKTtsZXQgcj10aGlzLnBvcyxkPShpPWUuc2l6ZSkhPW51bGw/aTpyLXM7dGhpcy5zZWVrKHMpLHRoaXMud3JpdGVCb3hIZWFkZXIoZSxkKSx0aGlzLnNlZWsocil9fXdyaXRlQm94SGVhZGVyKGUsdCl7dGhpcy53cml0ZVUzMihlLmxhcmdlU2l6ZT8xOnQpLHRoaXMud3JpdGVBc2NpaShlLnR5cGUpLGUubGFyZ2VTaXplJiZ0aGlzLndyaXRlVTY0KHQpfXBhdGNoQm94KGUpe2xldCB0PXRoaXMucG9zO3RoaXMuc2Vlayh0aGlzLm9mZnNldHMuZ2V0KGUpKSx0aGlzLndyaXRlQm94KGUpLHRoaXMuc2Vlayh0KX19O1Y9bmV3IFdlYWtNYXAsWT1uZXcgV2Vha01hcDt2YXIgc2UsJCxaLHJlLHllLFJ0PWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7c3VwZXIoKSxvKHRoaXMscmUpLG8odGhpcyxzZSx2b2lkIDApLG8odGhpcywkLG5ldyBBcnJheUJ1ZmZlcih6KDIsMTYpKSksbyh0aGlzLFosbmV3IFVpbnQ4QXJyYXkobih0aGlzLCQpKSksRSh0aGlzLHNlLGUpfXdyaXRlKGUpe3codGhpcyxyZSx5ZSkuY2FsbCh0aGlzLHRoaXMucG9zK2UuYnl0ZUxlbmd0aCksbih0aGlzLFopLnNldChlLHRoaXMucG9zKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dyh0aGlzLHJlLHllKS5jYWxsKHRoaXMsdGhpcy5wb3MpLG4odGhpcyxzZSkuYnVmZmVyPW4odGhpcywkKS5zbGljZSgwLHRoaXMucG9zKX19O3NlPW5ldyBXZWFrTWFwLCQ9bmV3IFdlYWtNYXAsWj1uZXcgV2Vha01hcCxyZT1uZXcgV2Vha1NldCx5ZT1mdW5jdGlvbihlKXtsZXQgdD1uKHRoaXMsJCkuYnl0ZUxlbmd0aDtmb3IoO3Q8ZTspdCo9MjtpZih0PT09bih0aGlzLCQpLmJ5dGVMZW5ndGgpcmV0dXJuO2xldCBpPW5ldyBBcnJheUJ1ZmZlcih0KSxzPW5ldyBVaW50OEFycmF5KGkpO3Muc2V0KG4odGhpcyxaKSwwKSxFKHRoaXMsJCxpKSxFKHRoaXMsWixzKX07dmFyIGosRyx4ZT1jbGFzcyBleHRlbmRzIG1le2NvbnN0cnVjdG9yKGUpe3N1cGVyKCksbyh0aGlzLGosdm9pZCAwKSxvKHRoaXMsRyxbXSksRSh0aGlzLGosZSl9d3JpdGUoZSl7bih0aGlzLEcpLnB1c2goe2RhdGE6ZS5zbGljZSgpLHN0YXJ0OnRoaXMucG9zfSksdGhpcy5wb3MrPWUuYnl0ZUxlbmd0aH1mbHVzaCgpe2lmKG4odGhpcyxHKS5sZW5ndGg9PT0wKXJldHVybjtsZXQgZT1bXSx0PVsuLi5uKHRoaXMsRyldLnNvcnQoKGkscyk9Pmkuc3RhcnQtcy5zdGFydCk7ZS5wdXNoKHtzdGFydDp0WzBdLnN0YXJ0LHNpemU6dFswXS5kYXRhLmJ5dGVMZW5ndGh9KTtmb3IobGV0IGk9MTtpPHQubGVuZ3RoO2krKyl7bGV0IHM9ZVtlLmxlbmd0aC0xXSxyPXRbaV07ci5zdGFydDw9cy5zdGFydCtzLnNpemU/cy5zaXplPU1hdGgubWF4KHMuc2l6ZSxyLnN0YXJ0K3IuZGF0YS5ieXRlTGVuZ3RoLXMuc3RhcnQpOmUucHVzaCh7c3RhcnQ6ci5zdGFydCxzaXplOnIuZGF0YS5ieXRlTGVuZ3RofSl9Zm9yKGxldCBpIG9mIGUpe2kuZGF0YT1uZXcgVWludDhBcnJheShpLnNpemUpO2ZvcihsZXQgcyBvZiBuKHRoaXMsRykpaS5zdGFydDw9cy5zdGFydCYmcy5zdGFydDxpLnN0YXJ0K2kuc2l6ZSYmaS5kYXRhLnNldChzLmRhdGEscy5zdGFydC1pLnN0YXJ0KTtuKHRoaXMsaikub25EYXRhKGkuZGF0YSxpLnN0YXJ0KX1uKHRoaXMsRykubGVuZ3RoPTB9ZmluYWxpemUoKXt2YXIgZSx0Oyh0PShlPW4odGhpcyxqKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07aj1uZXcgV2Vha01hcCxHPW5ldyBXZWFrTWFwO3ZhciBOdD16KDIsMjQpLHh0PTIsZWUsTyxJLGFlLENlLF9lLEhlLFRlLFZlLHRlLG9lLCRlPWNsYXNzIGV4dGVuZHMgbWV7Y29uc3RydWN0b3IoZSl7dmFyIHQsaTtpZihzdXBlcigpLG8odGhpcyxhZSksbyh0aGlzLF9lKSxvKHRoaXMsVGUpLG8odGhpcyx0ZSksbyh0aGlzLGVlLHZvaWQgMCksbyh0aGlzLE8sdm9pZCAwKSxvKHRoaXMsSSxbXSksRSh0aGlzLGVlLGUpLEUodGhpcyxPLChpPSh0PWUub3B0aW9ucyk9PW51bGw/dm9pZCAwOnQuY2h1bmtTaXplKSE9bnVsbD9pOk50KSwhTnVtYmVyLmlzSW50ZWdlcihuKHRoaXMsTykpfHxuKHRoaXMsTyk8eigyLDEwKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgU3RyZWFtVGFyZ2V0IG9wdGlvbnM6IGNodW5rU2l6ZSBtdXN0IGJlIGFuIGludGVnZXIgbm90IHNtYWxsZXIgdGhhbiAxMDI0LiIpfXdyaXRlKGUpe3codGhpcyxhZSxDZSkuY2FsbCh0aGlzLGUsdGhpcy5wb3MpLHcodGhpcyx0ZSxvZSkuY2FsbCh0aGlzKSx0aGlzLnBvcys9ZS5ieXRlTGVuZ3RofWZpbmFsaXplKCl7dmFyIGUsdDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcywhMCksKHQ9KGU9bih0aGlzLGVlKSkub25Eb25lKT09bnVsbHx8dC5jYWxsKGUpfX07ZWU9bmV3IFdlYWtNYXAsTz1uZXcgV2Vha01hcCxJPW5ldyBXZWFrTWFwLGFlPW5ldyBXZWFrU2V0LENlPWZ1bmN0aW9uKGUsdCl7bGV0IGk9bih0aGlzLEkpLmZpbmRJbmRleChwPT5wLnN0YXJ0PD10JiZ0PHAuc3RhcnQrbih0aGlzLE8pKTtpPT09LTEmJihpPXcodGhpcyxUZSxWZSkuY2FsbCh0aGlzLHQpKTtsZXQgcz1uKHRoaXMsSSlbaV0scj10LXMuc3RhcnQsZD1lLnN1YmFycmF5KDAsTWF0aC5taW4obih0aGlzLE8pLXIsZS5ieXRlTGVuZ3RoKSk7cy5kYXRhLnNldChkLHIpO2xldCBmPXtzdGFydDpyLGVuZDpyK2QuYnl0ZUxlbmd0aH07aWYodyh0aGlzLF9lLEhlKS5jYWxsKHRoaXMscyxmKSxzLndyaXR0ZW5bMF0uc3RhcnQ9PT0wJiZzLndyaXR0ZW5bMF0uZW5kPT09bih0aGlzLE8pJiYocy5zaG91bGRGbHVzaD0hMCksbih0aGlzLEkpLmxlbmd0aD54dCl7Zm9yKGxldCBwPTA7cDxuKHRoaXMsSSkubGVuZ3RoLTE7cCsrKW4odGhpcyxJKVtwXS5zaG91bGRGbHVzaD0hMDt3KHRoaXMsdGUsb2UpLmNhbGwodGhpcyl9ZC5ieXRlTGVuZ3RoPGUuYnl0ZUxlbmd0aCYmdyh0aGlzLGFlLENlKS5jYWxsKHRoaXMsZS5zdWJhcnJheShkLmJ5dGVMZW5ndGgpLHQrZC5ieXRlTGVuZ3RoKX0sX2U9bmV3IFdlYWtTZXQsSGU9ZnVuY3Rpb24oZSx0KXtsZXQgaT0wLHM9ZS53cml0dGVuLmxlbmd0aC0xLHI9LTE7Zm9yKDtpPD1zOyl7bGV0IGQ9TWF0aC5mbG9vcihpKyhzLWkrMSkvMik7ZS53cml0dGVuW2RdLnN0YXJ0PD10LnN0YXJ0PyhpPWQrMSxyPWQpOnM9ZC0xfWZvcihlLndyaXR0ZW4uc3BsaWNlKHIrMSwwLHQpLChyPT09LTF8fGUud3JpdHRlbltyXS5lbmQ8dC5zdGFydCkmJnIrKztyPGUud3JpdHRlbi5sZW5ndGgtMSYmZS53cml0dGVuW3JdLmVuZD49ZS53cml0dGVuW3IrMV0uc3RhcnQ7KWUud3JpdHRlbltyXS5lbmQ9TWF0aC5tYXgoZS53cml0dGVuW3JdLmVuZCxlLndyaXR0ZW5bcisxXS5lbmQpLGUud3JpdHRlbi5zcGxpY2UocisxLDEpfSxUZT1uZXcgV2Vha1NldCxWZT1mdW5jdGlvbihlKXtsZXQgaT17c3RhcnQ6TWF0aC5mbG9vcihlL24odGhpcyxPKSkqbih0aGlzLE8pLGRhdGE6bmV3IFVpbnQ4QXJyYXkobih0aGlzLE8pKSx3cml0dGVuOltdLHNob3VsZEZsdXNoOiExfTtyZXR1cm4gbih0aGlzLEkpLnB1c2goaSksbih0aGlzLEkpLnNvcnQoKHMscik9PnMuc3RhcnQtci5zdGFydCksbih0aGlzLEkpLmluZGV4T2YoaSl9LHRlPW5ldyBXZWFrU2V0LG9lPWZ1bmN0aW9uKGU9ITEpe2ZvcihsZXQgdD0wO3Q8bih0aGlzLEkpLmxlbmd0aDt0Kyspe2xldCBpPW4odGhpcyxJKVt0XTtpZighKCFpLnNob3VsZEZsdXNoJiYhZSkpe2ZvcihsZXQgcyBvZiBpLndyaXR0ZW4pbih0aGlzLGVlKS5vbkRhdGEoaS5kYXRhLnN1YmFycmF5KHMuc3RhcnQscy5lbmQpLGkuc3RhcnQrcy5zdGFydCk7bih0aGlzLEkpLnNwbGljZSh0LS0sMSl9fX07dmFyIEh0PWNsYXNzIGV4dGVuZHMgJGV7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIobmV3IE5lKChpLHMpPT5lLnN0cmVhbS53cml0ZSh7dHlwZToid3JpdGUiLGRhdGE6aSxwb3NpdGlvbjpzfSksdm9pZCAwLHtjaHVua1NpemU6KHQ9ZS5vcHRpb25zKT09bnVsbD92b2lkIDA6dC5jaHVua1NpemV9KSl9fSxTZT0xZTMsVnQ9WyJhdmMiLCJoZXZjIiwidnA5IiwiYXYxIl0sJHQ9WyJhYWMiLCJvcHVzIl0sR3Q9MjA4Mjg0NDgwMCxYdD0uNSxxdD1bInN0cmljdCIsIm9mZnNldCJdLGcsVCxYLHEsSyxFZSxsZSxiZSxHZSxJZSxYZSxBZSxxZSxNZSxLZSxoZSxPZSxMZSxRZSxpZSx1ZSxuZSxkZSxmZSxVZSxLdD1jbGFzc3tjb25zdHJ1Y3RvcihlKXtvKHRoaXMsYmUpLG8odGhpcyxJZSksbyh0aGlzLEFlKSxvKHRoaXMsTWUpLG8odGhpcyxoZSksbyh0aGlzLExlKSxvKHRoaXMsaWUpLG8odGhpcyxuZSksbyh0aGlzLGZlKSxvKHRoaXMsZyx2b2lkIDApLG8odGhpcyxULHZvaWQgMCksbyh0aGlzLFgsdm9pZCAwKSxvKHRoaXMscSxudWxsKSxvKHRoaXMsSyxudWxsKSxvKHRoaXMsRWUsTWF0aC5mbG9vcihEYXRlLm5vdygpLzFlMykrR3QpLG8odGhpcyxsZSwhMSk7dmFyIHQ7aWYodyh0aGlzLGJlLEdlKS5jYWxsKHRoaXMsZSksdGhpcy50YXJnZXQ9ZS50YXJnZXQsRSh0aGlzLGcsZXQoe2ZpcnN0VGltZXN0YW1wQmVoYXZpb3I6InN0cmljdCJ9LGUpKSxlLnRhcmdldCBpbnN0YW5jZW9mIFJlKUUodGhpcyxULG5ldyBSdChlLnRhcmdldCkpO2Vsc2UgaWYoZS50YXJnZXQgaW5zdGFuY2VvZiBOZSlFKHRoaXMsVCwodD1lLnRhcmdldC5vcHRpb25zKSE9bnVsbCYmdC5jaHVua2VkP25ldyAkZShlLnRhcmdldCk6bmV3IHhlKGUudGFyZ2V0KSk7ZWxzZSBpZihlLnRhcmdldCBpbnN0YW5jZW9mIEZ0KUUodGhpcyxULG5ldyBIdChlLnRhcmdldCkpO2Vsc2UgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHRhcmdldDogIi5jb25jYXQoZS50YXJnZXQpKTt3KHRoaXMsSWUsWGUpLmNhbGwodGhpcyksdyh0aGlzLEFlLHFlKS5jYWxsKHRoaXMpfWFkZFZpZGVvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRWaWRlb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZFZpZGVvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS52aWRlbyl0aHJvdyBuZXcgRXJyb3IoIk5vIHZpZGVvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxxKSxlLHQsaSxzLHIpfWFkZEF1ZGlvQ2h1bmsoZSx0LGkpe2xldCBzPW5ldyBVaW50OEFycmF5KGUuYnl0ZUxlbmd0aCk7ZS5jb3B5VG8ocyksdGhpcy5hZGRBdWRpb0NodW5rUmF3KHMsZS50eXBlLGkhPW51bGw/aTplLnRpbWVzdGFtcCxlLmR1cmF0aW9uLHQpfWFkZEF1ZGlvQ2h1bmtSYXcoZSx0LGkscyxyKXtpZih3KHRoaXMsZmUsVWUpLmNhbGwodGhpcyksIW4odGhpcyxnKS5hdWRpbyl0aHJvdyBuZXcgRXJyb3IoIk5vIGF1ZGlvIHRyYWNrIGRlY2xhcmVkLiIpO3codGhpcyxoZSxPZSkuY2FsbCh0aGlzLG4odGhpcyxLKSxlLHQsaSxzLHIpfWZpbmFsaXplKCl7bih0aGlzLHEpJiZ3KHRoaXMsaWUsdWUpLmNhbGwodGhpcyxuKHRoaXMscSkpLG4odGhpcyxLKSYmdyh0aGlzLGllLHVlKS5jYWxsKHRoaXMsbih0aGlzLEspKTtsZXQgZT1uKHRoaXMsVCkub2Zmc2V0cy5nZXQobih0aGlzLFgpKSx0PW4odGhpcyxUKS5wb3MtZTtuKHRoaXMsWCkuc2l6ZT10LG4odGhpcyxUKS5wYXRjaEJveChuKHRoaXMsWCkpO2xldCBpPWF0KFtuKHRoaXMscSksbih0aGlzLEspXS5maWx0ZXIoQm9vbGVhbiksbih0aGlzLEVlKSk7bih0aGlzLFQpLndyaXRlQm94KGkpLHcodGhpcyxuZSxkZSkuY2FsbCh0aGlzKSxuKHRoaXMsVCkuZmluYWxpemUoKSxFKHRoaXMsbGUsITApfX07Zz1uZXcgV2Vha01hcCxUPW5ldyBXZWFrTWFwLFg9bmV3IFdlYWtNYXAscT1uZXcgV2Vha01hcCxLPW5ldyBXZWFrTWFwLEVlPW5ldyBXZWFrTWFwLGxlPW5ldyBXZWFrTWFwLGJlPW5ldyBXZWFrU2V0LEdlPWZ1bmN0aW9uKGUpe2lmKGUudmlkZW8pe2lmKCFWdC5pbmNsdWRlcyhlLnZpZGVvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIHZpZGVvIGNvZGVjOiAiLmNvbmNhdChlLnZpZGVvLmNvZGVjKSk7aWYoZS52aWRlby5yb3RhdGlvbiE9PXZvaWQgMCYmIVswLDkwLDE4MCwyNzBdLmluY2x1ZGVzKGUudmlkZW8ucm90YXRpb24pKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCB2aWRlbyByb3RhdGlvbjogIi5jb25jYXQoZS52aWRlby5yb3RhdGlvbiwiLiBIYXMgdG8gYmUgMCwgOTAsIDE4MCBvciAyNzAuIikpfWlmKGUuYXVkaW8mJiEkdC5pbmNsdWRlcyhlLmF1ZGlvLmNvZGVjKSl0aHJvdyBuZXcgRXJyb3IoIlVuc3VwcG9ydGVkIGF1ZGlvIGNvZGVjOiAiLmNvbmNhdChlLmF1ZGlvLmNvZGVjKSk7aWYoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yJiYhcXQuaW5jbHVkZXMoZS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yKSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgZmlyc3QgdGltZXN0YW1wIGJlaGF2aW9yOiAiLmNvbmNhdChlLmZpcnN0VGltZXN0YW1wQmVoYXZpb3IpKX0sSWU9bmV3IFdlYWtTZXQsWGU9ZnVuY3Rpb24oKXt2YXIgZTtsZXQgdD0oKGU9bih0aGlzLGcpLnZpZGVvKT09bnVsbD92b2lkIDA6ZS5jb2RlYyk9PT0iaGV2YyI7bih0aGlzLFQpLndyaXRlQm94KHN0KHQpKSxFKHRoaXMsWCxydCgpKSxuKHRoaXMsVCkud3JpdGVCb3gobih0aGlzLFgpKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9LEFlPW5ldyBXZWFrU2V0LHFlPWZ1bmN0aW9uKCl7dmFyIGU7aWYobih0aGlzLGcpLnZpZGVvJiZFKHRoaXMscSx7aWQ6MSxpbmZvOnt0eXBlOiJ2aWRlbyIsY29kZWM6bih0aGlzLGcpLnZpZGVvLmNvZGVjLHdpZHRoOm4odGhpcyxnKS52aWRlby53aWR0aCxoZWlnaHQ6bih0aGlzLGcpLnZpZGVvLmhlaWdodCxyb3RhdGlvbjooZT1uKHRoaXMsZykudmlkZW8ucm90YXRpb24pIT1udWxsP2U6MH0sdGltZXNjYWxlOjcyMCxjb2RlY1ByaXZhdGU6bmV3IFVpbnQ4QXJyYXkoMCksc2FtcGxlczpbXSx3cml0dGVuQ2h1bmtzOltdLGN1cnJlbnRDaHVuazpudWxsLGZpcnN0VGltZXN0YW1wOnZvaWQgMCxsYXN0VGltZXN0YW1wOi0xLHRpbWVUb1NhbXBsZVRhYmxlOltdLGxhc3RUaW1lc2NhbGVVbml0czpudWxsLGNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZTpbXX0pLG4odGhpcyxnKS5hdWRpbyl7bGV0IHQ9dyh0aGlzLE1lLEtlKS5jYWxsKHRoaXMsMixuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxuKHRoaXMsZykuYXVkaW8ubnVtYmVyT2ZDaGFubmVscyk7RSh0aGlzLEsse2lkOm4odGhpcyxnKS52aWRlbz8yOjEsaW5mbzp7dHlwZToiYXVkaW8iLGNvZGVjOm4odGhpcyxnKS5hdWRpby5jb2RlYyxudW1iZXJPZkNoYW5uZWxzOm4odGhpcyxnKS5hdWRpby5udW1iZXJPZkNoYW5uZWxzLHNhbXBsZVJhdGU6bih0aGlzLGcpLmF1ZGlvLnNhbXBsZVJhdGV9LHRpbWVzY2FsZTpuKHRoaXMsZykuYXVkaW8uc2FtcGxlUmF0ZSxjb2RlY1ByaXZhdGU6dCxzYW1wbGVzOltdLHdyaXR0ZW5DaHVua3M6W10sY3VycmVudENodW5rOm51bGwsZmlyc3RUaW1lc3RhbXA6dm9pZCAwLGxhc3RUaW1lc3RhbXA6LTEsdGltZVRvU2FtcGxlVGFibGU6W10sbGFzdFRpbWVzY2FsZVVuaXRzOm51bGwsY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlOltdfSl9fSxNZT1uZXcgV2Vha1NldCxLZT1mdW5jdGlvbihlLHQsaSl7bGV0IHI9Wzk2ZTMsODgyMDAsNjRlMyw0OGUzLDQ0MTAwLDMyZTMsMjRlMywyMjA1MCwxNmUzLDEyZTMsMTEwMjUsOGUzLDczNTBdLmluZGV4T2YodCksZD1pLGY9IiI7Zis9ZS50b1N0cmluZygyKS5wYWRTdGFydCg1LCIwIiksZis9ci50b1N0cmluZygyKS5wYWRTdGFydCg0LCIwIikscj09PTE1JiYoZis9dC50b1N0cmluZygyKS5wYWRTdGFydCgyNCwiMCIpKSxmKz1kLnRvU3RyaW5nKDIpLnBhZFN0YXJ0KDQsIjAiKTtsZXQgcD1NYXRoLmNlaWwoZi5sZW5ndGgvOCkqODtmPWYucGFkRW5kKHAsIjAiKTtsZXQgYj1uZXcgVWludDhBcnJheShmLmxlbmd0aC84KTtmb3IobGV0IFM9MDtTPGYubGVuZ3RoO1MrPTgpYltTLzhdPXBhcnNlSW50KGYuc2xpY2UoUyxTKzgpLDIpO3JldHVybiBifSxoZT1uZXcgV2Vha1NldCxPZT1mdW5jdGlvbihlLHQsaSxzLHIsZCl7dmFyIGY7bGV0IHA9cy8xZTYsYj1yLzFlNjtpZihlLmZpcnN0VGltZXN0YW1wPT09dm9pZCAwJiYoZS5maXJzdFRpbWVzdGFtcD1wKSxwPXcodGhpcyxMZSxRZSkuY2FsbCh0aGlzLHAsZSksZS5sYXN0VGltZXN0YW1wPXAsKCFlLmN1cnJlbnRDaHVua3x8cC1lLmN1cnJlbnRDaHVuay5zdGFydFRpbWVzdGFtcD49WHQpJiYoZS5jdXJyZW50Q2h1bmsmJncodGhpcyxpZSx1ZSkuY2FsbCh0aGlzLGUpLGUuY3VycmVudENodW5rPXtzdGFydFRpbWVzdGFtcDpwLHNhbXBsZURhdGE6W10sc2FtcGxlQ291bnQ6MH0pLGUuY3VycmVudENodW5rLnNhbXBsZURhdGEucHVzaCh0KSxlLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCsrLChmPWQ9PW51bGw/dm9pZCAwOmQuZGVjb2RlckNvbmZpZykhPW51bGwmJmYuZGVzY3JpcHRpb24mJihlLmNvZGVjUHJpdmF0ZT1uZXcgVWludDhBcnJheShkLmRlY29kZXJDb25maWcuZGVzY3JpcHRpb24pKSxlLnNhbXBsZXMucHVzaCh7dGltZXN0YW1wOnAsZHVyYXRpb246YixzaXplOnQuYnl0ZUxlbmd0aCx0eXBlOml9KSxlLmxhc3RUaW1lc2NhbGVVbml0cyE9PW51bGwpe2xldCBTPUoocCxlLnRpbWVzY2FsZSwhMSksaz1NYXRoLnJvdW5kKFMtZS5sYXN0VGltZXNjYWxlVW5pdHMpO2UubGFzdFRpbWVzY2FsZVVuaXRzKz1rO2xldCBNPUgoZS50aW1lVG9TYW1wbGVUYWJsZSk7TS5zYW1wbGVDb3VudD09PTE/KE0uc2FtcGxlRGVsdGE9ayxNLnNhbXBsZUNvdW50KyspOk0uc2FtcGxlRGVsdGE9PT1rP00uc2FtcGxlQ291bnQrKzooTS5zYW1wbGVDb3VudC0tLGUudGltZVRvU2FtcGxlVGFibGUucHVzaCh7c2FtcGxlQ291bnQ6MixzYW1wbGVEZWx0YTprfSkpfWVsc2UgZS5sYXN0VGltZXNjYWxlVW5pdHM9MCxlLnRpbWVUb1NhbXBsZVRhYmxlLnB1c2goe3NhbXBsZUNvdW50OjEsc2FtcGxlRGVsdGE6SihiLGUudGltZXNjYWxlKX0pfSxMZT1uZXcgV2Vha1NldCxRZT1mdW5jdGlvbihlLHQpe2lmKG4odGhpcyxnKS5maXJzdFRpbWVzdGFtcEJlaGF2aW9yPT09InN0cmljdCImJnQubGFzdFRpbWVzdGFtcD09PS0xJiZlIT09MCl0aHJvdyBuZXcgRXJyb3IoIlRoZSBmaXJzdCBjaHVuayBmb3IgeW91ciBtZWRpYSB0cmFjayBtdXN0IGhhdmUgYSB0aW1lc3RhbXAgb2YgMCAocmVjZWl2ZWQgIi5jb25jYXQoZSwiKS4gTm9uLXplcm8gZmlyc3QgdGltZXN0YW1wcyBhcmUgb2Z0ZW4gY2F1c2VkIGJ5IGRpcmVjdGx5IHBpcGluZyBmcmFtZXMgb3IgYXVkaW8gZGF0YSBmcm9tIGEgTWVkaWFTdHJlYW1UcmFjayBpbnRvIHRoZSBlbmNvZGVyLiBUaGVpciB0aW1lc3RhbXBzIGFyZSB0eXBpY2FsbHkgcmVsYXRpdmUgdG8gdGhlIGFnZSBvZiB0aGUgZG9jdW1lbnQsIHdoaWNoIGlzIHByb2JhYmx5IHdoYXQgeW91IHdhbnQuXG5cbklmIHlvdSB3YW50IHRvIG9mZnNldCBhbGwgdGltZXN0YW1wcyBvZiBhIHRyYWNrIHN1Y2ggdGhhdCB0aGUgZmlyc3Qgb25lIGlzIHplcm8sIHNldCBmaXJzdFRpbWVzdGFtcEJlaGF2aW9yOiAnb2Zmc2V0JyBpbiB0aGUgb3B0aW9ucy5cbiIpKTtpZihuKHRoaXMsZykuZmlyc3RUaW1lc3RhbXBCZWhhdmlvcj09PSJvZmZzZXQiJiYoZS09dC5maXJzdFRpbWVzdGFtcCksZTx0Lmxhc3RUaW1lc3RhbXApdGhyb3cgbmV3IEVycm9yKCJUaW1lc3RhbXBzIG11c3QgYmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nICh3ZW50IGZyb20gIi5jb25jYXQodC5sYXN0VGltZXN0YW1wKjFlNiwiIHRvICIpLmNvbmNhdChlKjFlNiwiKS4iKSk7cmV0dXJuIGV9LGllPW5ldyBXZWFrU2V0LHVlPWZ1bmN0aW9uKGUpe2lmKGUuY3VycmVudENodW5rKXtlLmN1cnJlbnRDaHVuay5vZmZzZXQ9bih0aGlzLFQpLnBvcztmb3IobGV0IHQgb2YgZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YSluKHRoaXMsVCkud3JpdGUodCk7ZS5jdXJyZW50Q2h1bmsuc2FtcGxlRGF0YT1udWxsLChlLmNvbXBhY3RseUNvZGVkQ2h1bmtUYWJsZS5sZW5ndGg9PT0wfHxIKGUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlKS5zYW1wbGVzUGVyQ2h1bmshPT1lLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudCkmJmUuY29tcGFjdGx5Q29kZWRDaHVua1RhYmxlLnB1c2goe2ZpcnN0Q2h1bms6ZS53cml0dGVuQ2h1bmtzLmxlbmd0aCsxLHNhbXBsZXNQZXJDaHVuazplLmN1cnJlbnRDaHVuay5zYW1wbGVDb3VudH0pLGUud3JpdHRlbkNodW5rcy5wdXNoKGUuY3VycmVudENodW5rKSx3KHRoaXMsbmUsZGUpLmNhbGwodGhpcyl9fSxuZT1uZXcgV2Vha1NldCxkZT1mdW5jdGlvbigpe24odGhpcyxUKWluc3RhbmNlb2YgeGUmJm4odGhpcyxUKS5mbHVzaCgpfSxmZT1uZXcgV2Vha1NldCxVZT1mdW5jdGlvbigpe2lmKG4odGhpcyxsZSkpdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIG5ldyB2aWRlbyBvciBhdWRpbyBjaHVua3MgYWZ0ZXIgdGhlIGZpbGUgaGFzIGJlZW4gZmluYWxpemVkLiIpfTt2YXIgUXQ9dHlwZW9mIGdsb2JhbFRoaXM8InUiP2dsb2JhbFRoaXM6dHlwZW9mIHdpbmRvdzwidSI/d2luZG93OnR5cGVvZiBnbG9iYWw8InUiP2dsb2JhbDp0eXBlb2Ygc2VsZjwidSI/c2VsZjp7fTtmdW5jdGlvbiBZdChlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlJiZPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwiZGVmYXVsdCIpP2UuZGVmYXVsdDplfXZhciBZZT17ZXhwb3J0czp7fX07KGZ1bmN0aW9uKGUpeyhmdW5jdGlvbih0LGkpe2UuZXhwb3J0cz9lLmV4cG9ydHM9aSgpOnQubG9nPWkoKX0pKFF0LGZ1bmN0aW9uKCl7dmFyIHQ9ZnVuY3Rpb24oKXt9LGk9InVuZGVmaW5lZCIscz10eXBlb2Ygd2luZG93IT09aSYmdHlwZW9mIHdpbmRvdy5uYXZpZ2F0b3IhPT1pJiYvVHJpZGVudFwvfE1TSUUgLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSxyPVsidHJhY2UiLCJkZWJ1ZyIsImluZm8iLCJ3YXJuIiwiZXJyb3IiXTtmdW5jdGlvbiBkKHYsbSl7dmFyIHk9dlttXTtpZih0eXBlb2YgeS5iaW5kPT0iZnVuY3Rpb24iKXJldHVybiB5LmJpbmQodik7dHJ5e3JldHVybiBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKHksdil9Y2F0Y2goYyl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIEZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseSh5LFt2LGFyZ3VtZW50c10pfX19ZnVuY3Rpb24gZigpe2NvbnNvbGUubG9nJiYoY29uc29sZS5sb2cuYXBwbHk/Y29uc29sZS5sb2cuYXBwbHkoY29uc29sZSxhcmd1bWVudHMpOkZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseS5hcHBseShjb25zb2xlLmxvZyxbY29uc29sZSxhcmd1bWVudHNdKSksY29uc29sZS50cmFjZSYmY29uc29sZS50cmFjZSgpfWZ1bmN0aW9uIHAodil7cmV0dXJuIHY9PT0iZGVidWciJiYodj0ibG9nIiksdHlwZW9mIGNvbnNvbGU9PT1pPyExOnY9PT0idHJhY2UiJiZzP2Y6Y29uc29sZVt2XSE9PXZvaWQgMD9kKGNvbnNvbGUsdik6Y29uc29sZS5sb2chPT12b2lkIDA/ZChjb25zb2xlLCJsb2ciKTp0fWZ1bmN0aW9uIGIodixtKXtmb3IodmFyIHk9MDt5PHIubGVuZ3RoO3krKyl7dmFyIGM9clt5XTt0aGlzW2NdPXk8dj90OnRoaXMubWV0aG9kRmFjdG9yeShjLHYsbSl9dGhpcy5sb2c9dGhpcy5kZWJ1Z31mdW5jdGlvbiBTKHYsbSx5KXtyZXR1cm4gZnVuY3Rpb24oKXt0eXBlb2YgY29uc29sZSE9PWkmJihiLmNhbGwodGhpcyxtLHkpLHRoaXNbdl0uYXBwbHkodGhpcyxhcmd1bWVudHMpKX19ZnVuY3Rpb24gayh2LG0seSl7cmV0dXJuIHAodil8fFMuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIE0odixtLHkpe3ZhciBjPXRoaXMsSmU7bT1tPT1udWxsPyJXQVJOIjptO3ZhciBMPSJsb2dsZXZlbCI7dHlwZW9mIHY9PSJzdHJpbmciP0wrPSI6Iit2OnR5cGVvZiB2PT0ic3ltYm9sIiYmKEw9dm9pZCAwKTtmdW5jdGlvbiBhaShoKXt2YXIgUT0ocltoXXx8InNpbGVudCIpLnRvVXBwZXJDYXNlKCk7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IUwpKXt0cnl7d2luZG93LmxvY2FsU3RvcmFnZVtMXT1RO3JldHVybn1jYXRjaChwZSl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChMKSsiPSIrUSsiOyJ9Y2F0Y2gocGUpe319fWZ1bmN0aW9uIFplKCl7dmFyIGg7aWYoISh0eXBlb2Ygd2luZG93PT09aXx8IUwpKXt0cnl7aD13aW5kb3cubG9jYWxTdG9yYWdlW0xdfWNhdGNoKGxpKXt9aWYodHlwZW9mIGg9PT1pKXRyeXt2YXIgUT13aW5kb3cuZG9jdW1lbnQuY29va2llLHBlPVEuaW5kZXhPZihlbmNvZGVVUklDb21wb25lbnQoTCkrIj0iKTtwZSE9PS0xJiYoaD0vXihbXjtdKykvLmV4ZWMoUS5zbGljZShwZSkpWzFdKX1jYXRjaChsaSl7fXJldHVybiBjLmxldmVsc1toXT09PXZvaWQgMCYmKGg9dm9pZCAwKSxofX1mdW5jdGlvbiBvaSgpe2lmKCEodHlwZW9mIHdpbmRvdz09PWl8fCFMKSl7dHJ5e3dpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShMKTtyZXR1cm59Y2F0Y2goaCl7fXRyeXt3aW5kb3cuZG9jdW1lbnQuY29va2llPWVuY29kZVVSSUNvbXBvbmVudChMKSsiPTsgZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQyJ9Y2F0Y2goaCl7fX19Yy5uYW1lPXYsYy5sZXZlbHM9e1RSQUNFOjAsREVCVUc6MSxJTkZPOjIsV0FSTjozLEVSUk9SOjQsU0lMRU5UOjV9LGMubWV0aG9kRmFjdG9yeT15fHxrLGMuZ2V0TGV2ZWw9ZnVuY3Rpb24oKXtyZXR1cm4gSmV9LGMuc2V0TGV2ZWw9ZnVuY3Rpb24oaCxRKXtpZih0eXBlb2YgaD09InN0cmluZyImJmMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0hPT12b2lkIDAmJihoPWMubGV2ZWxzW2gudG9VcHBlckNhc2UoKV0pLHR5cGVvZiBoPT0ibnVtYmVyIiYmaD49MCYmaDw9Yy5sZXZlbHMuU0lMRU5UKXtpZihKZT1oLFEhPT0hMSYmYWkoaCksYi5jYWxsKGMsaCx2KSx0eXBlb2YgY29uc29sZT09PWkmJmg8Yy5sZXZlbHMuU0lMRU5UKXJldHVybiJObyBjb25zb2xlIGF2YWlsYWJsZSBmb3IgbG9nZ2luZyJ9ZWxzZSB0aHJvdyJsb2cuc2V0TGV2ZWwoKSBjYWxsZWQgd2l0aCBpbnZhbGlkIGxldmVsOiAiK2h9LGMuc2V0RGVmYXVsdExldmVsPWZ1bmN0aW9uKGgpe209aCxaZSgpfHxjLnNldExldmVsKGgsITEpfSxjLnJlc2V0TGV2ZWw9ZnVuY3Rpb24oKXtjLnNldExldmVsKG0sITEpLG9pKCl9LGMuZW5hYmxlQWxsPWZ1bmN0aW9uKGgpe2Muc2V0TGV2ZWwoYy5sZXZlbHMuVFJBQ0UsaCl9LGMuZGlzYWJsZUFsbD1mdW5jdGlvbihoKXtjLnNldExldmVsKGMubGV2ZWxzLlNJTEVOVCxoKX07dmFyIFdlPVplKCk7V2U9PW51bGwmJihXZT1tKSxjLnNldExldmVsKFdlLCExKX12YXIgVz1uZXcgTSxQZT17fTtXLmdldExvZ2dlcj1mdW5jdGlvbihtKXtpZih0eXBlb2YgbSE9InN5bWJvbCImJnR5cGVvZiBtIT0ic3RyaW5nInx8bT09PSIiKXRocm93IG5ldyBUeXBlRXJyb3IoIllvdSBtdXN0IHN1cHBseSBhIG5hbWUgd2hlbiBjcmVhdGluZyBhIGxvZ2dlci4iKTt2YXIgeT1QZVttXTtyZXR1cm4geXx8KHk9UGVbbV09bmV3IE0obSxXLmdldExldmVsKCksVy5tZXRob2RGYWN0b3J5KSkseX07dmFyIHJpPXR5cGVvZiB3aW5kb3chPT1pP3dpbmRvdy5sb2c6dm9pZCAwO3JldHVybiBXLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oKXtyZXR1cm4gdHlwZW9mIHdpbmRvdyE9PWkmJndpbmRvdy5sb2c9PT1XJiYod2luZG93LmxvZz1yaSksV30sVy5nZXRMb2dnZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIFBlfSxXLmRlZmF1bHQ9VyxXfSl9KShZZSk7dmFyIEp0PVllLmV4cG9ydHMsY2U9WXQoSnQpO2NlLnNldExldmVsKCJFUlJPUiIpO2Z1bmN0aW9uIFp0KGUpe3JldHVybiBuZXcgUHJvbWlzZSh0PT57Y29uc3QgaT0oKT0+e2UoKT90KCk6cmVxdWVzdEFuaW1hdGlvbkZyYW1lKGkpfTtpKCl9KX1jbGFzcyBqdHtjb25zdHJ1Y3Rvcih0KXtGKHRoaXMsImNvbm5lY3Rpb24iKTtGKHRoaXMsIm9wdGlvbnMiKTt0aGlzLmNvbm5lY3Rpb249ITEsdGhpcy5vcHRpb25zPXR9Y29ubmVjdCgpe3RoaXMuY29ubmVjdGlvbj0hMH1kaXNjb25uZWN0KCl7dGhpcy5jb25uZWN0aW9uPSExfX12YXIgUj0oZT0+KGUuTE9BREVEPSJsb2FkZWQiLGUuSU5JVD0iaW5pdCIsZS5TRU5EPSJzZW5kIixlLkZJTklTSD0iZmluaXNoIixlKSkoUnx8e30pO2Z1bmN0aW9uIGVpKGUpe2NlLmVycm9yKCJub29wIGVycm9yIixlKX1jbGFzcyB0aSBleHRlbmRzIGp0e2NvbnN0cnVjdG9yKGkpe3N1cGVyKGkpO0YodGhpcywidmlkZW9Db25maWciKTtGKHRoaXMsImF1ZGlvQ29uZmlnIik7Rih0aGlzLCJtdXhlciIpO0YodGhpcywidmlkZW9FbmNvZGVyIik7Rih0aGlzLCJhdWRpb0VuY29kZXIiKTtGKHRoaXMsImVycm9yUmVqZWN0IixlaSk7dGhpcy52aWRlb0NvbmZpZz1pLnZpZGVvQ29uZmlnLHRoaXMuYXVkaW9Db25maWc9aS5hdWRpb0NvbmZpZyx0aGlzLmNyZWF0ZU11eGVyQW5kRW5jb2RlcigpfWFzeW5jIGhhbmRsZShpKXt2YXIgZixwLGIsUztjb25zdHt2aWRlb0ZyYW1lOnMsYXVkaW9EYXRhOnIsdGltZXN0YW1wOmR9PWk7cyYmKChmPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmZi5lbmNvZGVRdWV1ZVNpemUmJigocD10aGlzLnZpZGVvRW5jb2Rlcik9PW51bGw/dm9pZCAwOnAuZW5jb2RlUXVldWVTaXplKT4yMCYmYXdhaXQgWnQoKCk9Pnt2YXIgayxNO3JldHVybihrPXRoaXMudmlkZW9FbmNvZGVyKSE9bnVsbCYmay5lbmNvZGVRdWV1ZVNpemU/KChNPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbD92b2lkIDA6TS5lbmNvZGVRdWV1ZVNpemUpPDEwOiEwfSksKGI9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsfHxiLmVuY29kZShzLHtrZXlGcmFtZTpkLygxZTMvdGhpcy5vcHRpb25zLmZwcyklMTUwPT09MH0pLHMuY2xvc2UoKSksciYmKChTPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbHx8Uy5lbmNvZGUociksci5jbG9zZSgpKX1jcmVhdGVNdXhlckFuZEVuY29kZXIoKXt0aGlzLm11eGVyPW5ldyBLdCh7dGFyZ2V0Om5ldyBSZSx2aWRlbzp7Y29kZWM6ImF2YyIsd2lkdGg6dGhpcy52aWRlb0NvbmZpZy53aWR0aCxoZWlnaHQ6dGhpcy52aWRlb0NvbmZpZy5oZWlnaHR9LGF1ZGlvOntjb2RlYzoiYWFjIixudW1iZXJPZkNoYW5uZWxzOnRoaXMuYXVkaW9Db25maWcubnVtYmVyT2ZDaGFubmVscyxzYW1wbGVSYXRlOnRoaXMuYXVkaW9Db25maWcuc2FtcGxlUmF0ZX19KSx0aGlzLnZpZGVvRW5jb2Rlcj1uZXcgVmlkZW9FbmNvZGVyKHtvdXRwdXQ6KGkscyk9Pnt2YXIgcjtyZXR1cm4ocj10aGlzLm11eGVyKT09bnVsbD92b2lkIDA6ci5hZGRWaWRlb0NodW5rKGkscyl9LGVycm9yOmk9PntjZS5lcnJvcigidmlkZW8gZW5jb2RlciBlcnJvciIsaSksdGhpcy5lcnJvclJlamVjdChpKX19KSx0aGlzLnZpZGVvRW5jb2Rlci5jb25maWd1cmUodGhpcy52aWRlb0NvbmZpZyksdGhpcy5vcHRpb25zLmRpc2FibGVBdWRpb3x8KHRoaXMuYXVkaW9FbmNvZGVyPW5ldyBBdWRpb0VuY29kZXIoe291dHB1dDooaSxzKT0+e3ZhciByO3JldHVybihyPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpyLmFkZEF1ZGlvQ2h1bmsoaSxzKX0sZXJyb3I6aT0+e2NlLmVycm9yKCJhdWRpbyBlbmNvZGVyIGVycm9yIixpKSx0aGlzLmVycm9yUmVqZWN0KGkpfX0pLHRoaXMuYXVkaW9FbmNvZGVyLmNvbmZpZ3VyZSh0aGlzLmF1ZGlvQ29uZmlnKSl9YXN5bmMgZW5kRW5jb2RpbmcoKXt2YXIgcyxyLGQsZixwLGIsUztyZXR1cm4gYXdhaXQoKHM9dGhpcy52aWRlb0VuY29kZXIpPT1udWxsP3ZvaWQgMDpzLmZsdXNoKCkpLChyPXRoaXMudmlkZW9FbmNvZGVyKT09bnVsbHx8ci5jbG9zZSgpLGF3YWl0KChkPXRoaXMuYXVkaW9FbmNvZGVyKT09bnVsbD92b2lkIDA6ZC5mbHVzaCgpKSwoZj10aGlzLmF1ZGlvRW5jb2Rlcik9PW51bGx8fGYuY2xvc2UoKSwocD10aGlzLm11eGVyKT09bnVsbHx8cC5maW5hbGl6ZSgpLChTPShiPXRoaXMubXV4ZXIpPT1udWxsP3ZvaWQgMDpiLnRhcmdldCk9PW51bGw/dm9pZCAwOlMuYnVmZmVyfWFzeW5jIGZpbmlzaCgpe3JldHVybiBhd2FpdCB0aGlzLmVuZEVuY29kaW5nKCl9fWxldCBEZTtzZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGFzeW5jIGU9Pntjb25zdHt0eXBlOnQsZGF0YTppfT1lLmRhdGE7dHJ5e3N3aXRjaCh0KXtjYXNlIFIuSU5JVDpyZXR1cm4gaWkoaSk7Y2FzZSBSLlNFTkQ6cmV0dXJuIGF3YWl0IG5pKGkpO2Nhc2UgUi5GSU5JU0g6cmV0dXJuIGF3YWl0IHNpKCk7ZGVmYXVsdDpyZXR1cm59fWNhdGNoKHMpe3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6dCxlcnJNc2c6cyBpbnN0YW5jZW9mIEVycm9yP3MubWVzc2FnZToiVW5rbm93biBFcnJvciJ9KX19KSxzZWxmLnBvc3RNZXNzYWdlKHt0eXBlOlIuTE9BREVEfSk7ZnVuY3Rpb24gaWkoZSl7RGU9bmV3IHRpKGUpLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5JTklUfSl9YXN5bmMgZnVuY3Rpb24gbmkoZSl7YXdhaXQgRGUuaGFuZGxlKGUpLHNlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5TRU5EfSl9YXN5bmMgZnVuY3Rpb24gc2koKXtjb25zdCBlPWF3YWl0IERlLmZpbmlzaCgpO3NlbGYucG9zdE1lc3NhZ2Uoe3R5cGU6Ui5GSU5JU0gscmVzdWx0OmV9LGU/W2VdOltdKX19KSgpOwo=",Os=typeof window<"u"&&window.Blob&&new Blob([atob(wn)],{type:"text/javascript;charset=utf-8"});function wc(){let a;try{if(a=Os&&(window.URL||window.webkitURL).createObjectURL(Os),!a)throw"";return new Worker(a)}catch(s){return new Worker("data:application/javascript;base64,"+wn)}finally{a&&(window.URL||window.webkitURL).revokeObjectURL(a)}}var Je=(a=>(a.LOADED="loaded",a.INIT="init",a.SEND="send",a.FINISH="finish",a))(Je||{});class Cc extends Zn{constructor(t){var n,i;super(t);b(this,"compositorWorker");b(this,"initialized");b(this,"videoConfig");b(this,"audioConfig");this.videoConfig=(n=t.videoConfig)!=null?n:un,this.audioConfig=(i=t.audioConfig)!=null?i:pn,this.compositorWorker=new wc,this.initialized=new Promise((o,l)=>{this.compositorWorker.addEventListener("message",c=>{const{type:r}=c.data;r===Je.LOADED&&this.getFromWorker(Je.INIT,{videoConfig:this.videoConfig,audioConfig:this.audioConfig,...t}).then(()=>{o()}).catch(h=>{l(h)})})})}getFromWorker(t,n,i){return new Promise((o,l)=>{const c=({data:r})=>{r.type===t&&(r.errMsg?l(r.errMsg):o(r.result),this.compositorWorker.removeEventListener("message",c))};this.compositorWorker.addEventListener("message",c),this.compositorWorker.postMessage({type:t,data:n},i||[])})}async genAudioData(t,n){const i=this.audioConfig.sampleRate,o=this.audioConfig.numberOfChannels,l=this.audioConfig.sampleRate*(1/this.options.fps),r=new OfflineAudioContext(o,l,i).createBuffer(o,l,i);let h;if(n){n.forEach((m,u)=>{for(let p=0;p<o;p++){const f=p<m.numberOfChannels?m.getChannelData(p):new Float32Array(l).fill(0),v=r.getChannelData(p);if(u===0)v.set(f);else for(let T=0;T<v.length;T++)v[T]+=f[T]}}),h=new Float32Array(l*o);for(let m=0;m<r.numberOfChannels;m++)h.set(r.getChannelData(m),m*r.length)}else h=new Float32Array(l*o).fill(0);return new AudioData({timestamp:t,sampleRate:i,numberOfChannels:o,numberOfFrames:l,data:h,format:"f32-planar"})}async handle(t){await this.initialized;const{timestamp:n,imageSource:i,audioBuffers:o}=t,l=new VideoFrame(i,{timestamp:n*1e3}),c=[l];let r;return this.options.disableAudio||(r=await this.genAudioData(n,o),c.push(r)),this.getFromWorker(Je.SEND,{timestamp:n,videoFrame:l,audioData:r},c)}async finish(){await this.initialized;const t=await this.getFromWorker(Je.FINISH);if(t)return new Blob([t],{type:"video/mp4"})}}class Gc extends Zn{constructor(t){super(t);b(this,"context");b(this,"audioContext");b(this,"audioPlayTime");b(this,"lastHandleTime");this.options=t,this.audioContext=t.disableAudio?null:new AudioContext,this.audioPlayTime=0,this.lastHandleTime=0;const{canvas:n,width:i,height:o}=this.options;n.width=i,n.height=o,this.context=n.getContext("2d")}async handle(t){const{imageSource:n,audioBuffers:i}=t,o=performance.now(),l=this.lastHandleTime>0?o-this.lastHandleTime:0;this.options.disableAudio||this.playAudioBuffers(i),this.context&&n&&this.playVideoFrame(n),await Ur(1e3/this.options.fps-l-4),this.lastHandleTime=performance.now()}playVideoFrame(t){const{width:n,height:i}=this.options;this.context.drawImage(t,0,0,n,i)}playAudioBuffers(t){if(t.length===0||!this.audioContext)return;let n=0;this.audioContext.currentTime>this.audioPlayTime&&(this.audioPlayTime=this.audioContext.currentTime);for(const i of t){const o=this.audioContext.createBufferSource();o.buffer=i,o.connect(this.audioContext.destination),o.onended=()=>{o.disconnect()},o.start(this.audioPlayTime),n=Math.max(n,i.duration)}this.audioPlayTime+=n}async finish(){var t;(t=this.audioContext)==null||t.close()}}var E=(a=>(a[a.Background=0]="Background",a[a.Character=10]="Character",a[a.Dialog=20]="Dialog",a[a.Text=30]="Text",a))(E||{}),Me;let kc=(Me=class{constructor(s){b(this,"options");b(this,"app");b(this,"scenes");b(this,"activeScene");b(this,"activeChild");b(this,"activeTransformer");this.options=Object.assign({},Me.defaultEditorOptions,s);const{view:t,width:n,height:i,background:o}=this.options;this.app=new Mi({view:t,width:n,height:i,background:o}),this.scenes=[]}addTransformer(){var s;this.activeTransformer=new Pi({wireframeStyle:{thickness:4,color:3394764}}).on("pointertap",()=>{this.activeTransformer&&(this.activeTransformer.__isTapped?(this.activeChild=void 0,this.activeTransformer.group=[],this.options.onChangeActiveChild(void 0),this.activeTransformer.__doubleTapTimer&&clearTimeout(this.activeTransformer.__doubleTapTimer),this.activeTransformer.__isTapped=!1):(this.activeTransformer.__isTapped=!0,this.activeTransformer.__doubleTapTimer=setTimeout(()=>{this.activeTransformer&&(this.activeTransformer.__isTapped=!1)},600)))}),(s=this.activeScene)==null||s.addChild(this.activeTransformer)}removeTransformer(){var s;this.activeTransformer&&((s=this.activeScene)==null||s.removeChild(this.activeTransformer),this.activeTransformer.destroy(),this.activeTransformer=void 0)}addChildTransformListener(s){s.interactive=!0,s.on("pointerdown",()=>{this.setActiveChild(s)})}setActiveChild(s){this.activeChild=s,s&&(this.activeTransformer||this.addTransformer(),this.activeTransformer&&(this.activeTransformer.group=[s],this.moveChildToTop(this.activeTransformer))),this.options.onChangeActiveChild(s)}setActiveChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.setActiveChild(n)}}updateActiveChild(s){this.activeChild&&(s(this.activeChild),this.options.onChangeActiveChild(this.activeChild))}removeChildTransformListener(s){s.removeAllListeners("pointerdown")}addScene(s,t){typeof t>"u"?this.scenes.push(s):this.scenes.splice(t,0,s);const n=i=>{if(i.children&&i.children.length>0)for(const o of i.children)n(o);else this.addChildTransformListener(i)};for(const i of s.children)n(i);this.options.onChangeScenes(this.scenes)}loadScenes(s){s.forEach(t=>{this.addScene(t)}),this.options.onChangeScenes(this.scenes)}removeScene(s){this.scenes.splice(this.scenes.indexOf(s),1),this.activeScene===s&&(this.stageRemoveChild(this.activeScene),this.activeScene.destroy(),this.activeScene=void 0),this.options.onChangeScenes(this.scenes)}removeSceneByIndex(s){this.removeScene(this.scenes[s])}removeSceneByName(s){const t=this.getSceneByName(s);t&&this.removeScene(t)}getSceneByName(s){return this.scenes.find(t=>t.name===s)}cloneScene(s){this.removeTransformer();const t=s!=null?s:this.activeScene;if(t)return t.clone()}cloneSceneByIndex(s){return this.cloneScene(this.scenes[s])}cloneSceneByName(s){const t=this.getSceneByName(s);if(t)return this.cloneScene(t)}swapScene(s,t){[this.scenes[s],this.scenes[t]]=[this.scenes[t],this.scenes[s]],this.options.onChangeScenes(this.scenes)}setActiveScene(s){this.activeScene&&(this.stageRemoveChild(this.activeScene),this.removeTransformer()),this.activeScene=s,s&&(this.activeScene.load(),this.addTransformer(),this.stageAddChild(s)),this.options.onChangeActiveScene(s)}setActiveSceneByName(s){const t=this.scenes.find(n=>n.name===s);t&&this.setActiveScene(t)}setActiveSceneByIndex(s){this.setActiveScene(this.scenes[s])}getActiveSceneIndex(){return this.activeScene?this.scenes.indexOf(this.activeScene):-1}updateActiveScene(s){this.activeScene&&(s(this.activeScene),this.options.onChangeActiveScene(this.activeScene))}addChild(s){const t=this.activeScene;t&&(this.addChildTransformListener(s),t.addChild(s),this.options.onChangeActiveScene(t))}removeChild(s){var n;const t=this.activeScene;t&&(((n=this.activeChild)==null?void 0:n.name)===s.name&&(this.setActiveChild(void 0),this.removeTransformer()),this.removeChildTransformListener(s),t.removeChild(s),s.destroy(),this.options.onChangeActiveScene(t))}removeChildByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&this.removeChild(n)}}toggleChildVisibleByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.visible=!n.visible),this.options.onChangeActiveScene(t)}}toggleChildInteractiveByName(s){const t=this.activeScene;if(t){const n=t.children.find(i=>i.name===s);n&&(n.interactive=!n.interactive),this.options.onChangeActiveScene(t)}}cloneChild(s){const t=s!=null?s:this.activeChild;if(t)return t.clone()}addSound(s){const t=this.activeScene;t&&(t.addSound(s),this.options.onChangeActiveScene(t))}removeSound(s){const t=this.activeScene;t&&(t.removeSound(s),this.options.onChangeActiveScene(t))}removeSoundByName(s){const t=this.activeScene;if(t){const n=t.sounds.find(i=>i.name===s);n&&this.removeSound(n)}}cloneDialogue(s){return St(s)}cloneDialogueSpeak(s){return St(s)}addDialogue(s,t){const n=this.activeScene;n&&(n.addDialogue(s,t),this.options.onChangeActiveScene(n))}updateDialogue(s,t){const n=this.activeScene;n&&(n.updateDialogue(s,t),this.options.onChangeActiveScene(n))}removeDialogue(s){const t=this.activeScene;t&&(t.removeDialogue(s),this.options.onChangeActiveScene(t))}swapDialogue(s,t){const n=this.activeScene;n&&(n.swapDialogue(s,t),this.options.onChangeActiveScene(n))}swapChildren(s,t){var n;(n=this.activeScene)==null||n.swapChildren(s,t)}moveChildTo(s,t){const n=t!=null?t:this.activeChild;n&&(n.zIndex=s)}moveChildToTop(s){const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=E.Text,this.activeScene.setChildIndex(t,this.activeScene.children.length-1))}moveChildToBottom(s){var n;const t=s!=null?s:this.activeChild;this.activeScene&&t&&(t.zIndex=E.Background,(n=this.activeScene)==null||n.setChildIndex(t,0))}moveUpChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n<this.activeScene.children.length-1){const i=this.activeScene.children[n+1];i.zIndex>t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}moveDownChild(s){const t=s!=null?s:this.activeChild;if(this.activeScene&&t){const n=this.activeScene.children.indexOf(t);if(n>0){const i=this.activeScene.children[n-1];i.zIndex<t.zIndex&&(t.zIndex=i.zIndex),this.swapChildren(t,i)}}}stageAddChild(s){this.app.stage.addChild(s)}stageRemoveChild(s){const t=this.app.stage.children.find(n=>n.name===s.name);t&&this.app.stage.removeChild(t)}setChildPosition(s,t){const n=t!=null?t:this.activeChild,{width:i,height:o}=this.options;if(n)switch(s){case"top":n.y=0;break;case"middle":n.y=o/2-n.height/2;break;case"bottom":n.y=o-n.height;break;case"left":n.x=0;break;case"near-left":n.x=i/3-n.width/2;break;case"center":n.x=i/2-n.width/2;break;case"near-right":n.x=i/3*2-n.width/2;break;case"right":n.x=i-n.width;break}}genSceneScript(s){var c,r,h;const{dialogues:t,config:n}=s,i=n.speak,o=[],l=s.children.find(m=>m.assetType==="Background");l&&n.autoShowBackground&&o.push({directive:S.Show,params:{targetName:l.name}});for(const m of t){const{speak:u,lines:p}=m;i!=null&&i.dialogTargetName&&o.push({directive:S.Show,params:{targetName:i.dialogTargetName}});const f=[];p.forEach(y=>{if(y.type==="p")for(let V=0;V<y.children.length;V++){const A=y.children[V];if(A.type==="directive")f.push({type:"directive",value:A.value});else if(A.text&&(i!=null&&i.targetName)){let Y=A.text;V===y.children.length-1&&(Y+="\n"),f.push({type:"speak",value:Y})}}});let v=!1,T,U="";(c=u.voice)!=null&&c.targetName&&(U=f.filter(y=>y.type==="speak").map(y=>y.value).join(""),T=(h=(r=s.sounds.find(y=>{var V;return y.name===((V=u.voice)==null?void 0:V.targetName)}))==null?void 0:r.buffer)==null?void 0:h.duration);const G=y=>{var Y,ae,J,j,W;const V=y.join("");let A;U&&T&&(A=V.length/U.length*T),o.push({directive:S.Speak,params:{targetName:i.targetName,text:V,append:v,customReadingTime:A,wordsPerMin:u.wordsPerMin,interval:u.interval,effect:u.effect,speaker:i.speaker.targetName?{targetName:i.speaker.targetName,name:((Y=u.speaker)==null?void 0:Y.name)||"",speakerTargetName:(ae=u.speaker)==null?void 0:ae.speakerTargetName,autoShowSpeaker:(J=u.speaker)==null?void 0:J.autoShowSpeaker,autoMaskOtherSpeakers:(j=u.speaker)==null?void 0:j.autoMaskOtherSpeakers}:void 0,voice:v?void 0:(W=u.voice)!=null&&W.targetName?u.voice:void 0}}),v=!0};f.forEach(y=>{if(y.type==="directive"){const V=y.value;o.push(V)}else G([y.value])})}return{scene:s,config:n,directives:o}}async exportScreenplay(s=0,t){const n=this.exportScenes(s,t);for(const o of n)await o.load();const i=n.map(this.genSceneScript);return{config:{},scenes:i}}exportScenes(s=0,t){this.removeTransformer();const n=performance.now(),i=this.scenes.slice(s,t).map(o=>o.clone());return qe.info("editor export cost:",performance.now()-n,i),i}saveAsJSON(){return this.removeTransformer(),JSON.stringify({version:"2.0",config:{},scenes:this.scenes})}async loadFromJSON(s){const t=JSON.parse(s),n=[];for(const i of t.scenes){const o=await he.fromJSON(i);n.push(o)}this.loadScenes(n)}clear(){this.scenes.forEach(s=>{this.removeScene(s)}),this.setActiveScene(void 0),this.setActiveChild(void 0),this.removeTransformer()}},b(Me,"defaultEditorOptions",{width:1920,height:1080,background:0,onChangeActiveChild:()=>{},onChangeActiveScene:()=>{},onChangeScenes:()=>{}}),Me);function Vc(){const a=new he,s=new Pe;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,400),s.endFill(),s.x=0,s.y=680,s.zIndex=E.Dialog,s.label="对话框",s.fillColor="#000000";const t=new me("角色名",{fill:16777215,fontSize:44,fontWeight:"bold"});t.x=160,t.y=700,t.zIndex=E.Text,t.label="角色名",t.disableTextEdit=!0;const n=new me("角色台词",{fill:16777215,wordWrap:!0,breakWords:!0,wordWrapWidth:1600,fontSize:38,leading:15});return n.x=160,n.y=770,n.zIndex=E.Text,n.label="角色台词",n.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.addChild(n),a.config.speak.targetName=n.name,a.config.speak.dialogTargetName=s.name,a.config.speak.speaker.targetName=t.name,a.config.speak.speaker.name=t.text,a}function Wc(){const a=new he,s=new Pe;s.alpha=.7,s.beginFill(0),s.drawRect(0,0,1920,1080),s.endFill(),s.x=0,s.y=0,s.zIndex=E.Dialog,s.label="独白遮罩";const t=new me("独白台词",{fill:16777215,breakWords:!0,wordWrap:!0,wordWrapWidth:1600,fontSize:45,leading:15});return t.x=160,t.y=160,t.zIndex=E.Text,t.label="独白台词",t.disableTextEdit=!0,a.addChild(s),a.addChild(t),a.config.speak.targetName=t.name,a.config.speak.dialogTargetName=s.name,a}function Tc(){const a=new he,s=new me("主标题",{fill:16777215,breakWords:!0,fontSize:100,fontWeight:"bold"});s.x=1920/2-s.width/2,s.y=1080/2-200,s.zIndex=E.Text,s.label="主标题";const t=new me("副标题",{fill:16777215,breakWords:!0,fontSize:60});return t.x=1920/2-t.width/2,t.y=1080/2-40,t.zIndex=E.Text,t.label="副标题",a.addChild(s),a.addChild(t),a}const k=aa()(na(a=>{let s;return{project:null,editor:null,activeChild:null,activeScene:null,scenes:[],setProject(t){a(n=>{n.project={id:t.id,name:t.name}})},initEditor(t){s=new kc({view:t,onChangeActiveChild(n){a(i=>{if(!n){i.activeChild=null;return}let o={...n,width:n.width,height:n.height,x:n.x,y:n.y};if(n.type==="Text"){const l=n;o={...o,text:l.text,style:l.style&&{...l.style,fontFamily:l.style.fontFamily,fontWeight:l.style.fontWeight,fontStyle:l.style.fontStyle,fontSize:l.style.fontSize,fill:l.style.fill}}}i.activeChild=o})},onChangeActiveScene(n){a(i=>{n?i.activeScene={...n}:i.activeScene=null})},onChangeScenes(n){a(i=>{i.scenes=[...n]})}}),a(n=>{n.editor=s})}}})),q=aa()(na(a=>({isOpen:!1,type:null,disableSelect:!1,confirm:null,cancel:null,setConfirm(s){a(t=>{t.confirm=s})},setCancel(s){a(t=>{t.cancel=s})},setOpen(s){a(t=>{t.isOpen=s})},setType(s){a(t=>{t.type=s})},setDisableSelect(s){a(t=>{t.disableSelect=s})}}))),Ie=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("rounded-xl border bg-card text-card-foreground shadow",a),...s}));Ie.displayName="Card";const Rc=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("flex flex-col space-y-1.5 p-6",a),...s}));Rc.displayName="CardHeader";const Lc=d.forwardRef(({className:a,...s},t)=>e.jsx("h3",{ref:t,className:x("font-semibold leading-none tracking-tight",a),...s}));Lc.displayName="CardTitle";const Xc=d.forwardRef(({className:a,...s},t)=>e.jsx("p",{ref:t,className:x("text-sm text-muted-foreground",a),...s}));Xc.displayName="CardDescription";const Ze=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("p-6 pt-0",a),...s}));Ze.displayName="CardContent";const Ft=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("flex items-center p-6 pt-0",a),...s}));Ft.displayName="CardFooter";const xe=d.forwardRef(({className:a,children:s,...t},n)=>{const i=d.useRef(null);return d.useImperativeHandle(n,()=>({scrollToBottom:()=>{i.current&&i.current.scrollTo({top:i.current.scrollHeight,behavior:"smooth"})}})),e.jsxs(ia,{className:x("relative overflow-hidden",a),...t,children:[e.jsx(Ui,{ref:i,className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(ws,{}),e.jsx(Ai,{})]})});xe.displayName=ia.displayName;const ws=d.forwardRef(({className:a,orientation:s="vertical",...t},n)=>e.jsx(oa,{ref:n,orientation:s,className:x("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...t,children:e.jsx(Bi,{className:"relative flex-1 rounded-full bg-border"})}));ws.displayName=oa.displayName;const Ic=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6zm10 13h5a1 1 0 0 0 1-1v-5h-6v6zm-2-6H5v5a1 1 0 0 0 1 1h5v-6zm2-2h6V6a1 1 0 0 0-1-1h-5v6zm-2-6H6a1 1 0 0 0-1 1v5h6V5z"})}),Fc=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm-2 7a1 1 0 1 1 2 0 1 1 0 0 0 1 1h12a1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3H6a3 3 0 0 1-3-3zm17-8a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3z"})}),Kc=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M6 21a1 1 0 1 0 0-2 1 1 0 0 1-1-1V6a1 1 0 0 1 1-1 1 1 0 0 0 0-2 3 3 0 0 0-3 3v12a3 3 0 0 0 3 3zm7-16a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm6 6a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm4-17a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zm-1 17a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),zc=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M14 4a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-9 7a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-6 10a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zM7 4a1 1 0 0 0-1-1 3 3 0 0 0-3 3 1 1 0 0 0 2 0 1 1 0 0 1 1-1 1 1 0 0 0 1-1zm11-1a1 1 0 1 0 0 2 1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3zM7 20a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1 1 1 0 1 1 2 0 3 3 0 0 1-3 3z"})}),Yc=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M13 5a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2h2zm-8 6a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm9 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zM6 3a1 1 0 0 1 0 2 1 1 0 0 0-1 1 1 1 0 0 1-2 0 3 3 0 0 1 3-3zm1 17a1 1 0 0 1-1 1 3 3 0 0 1-3-3 1 1 0 1 1 2 0 1 1 0 0 0 1 1 1 1 0 0 1 1 1zm11 1a1 1 0 1 1 0-2 1 1 0 0 0 1-1V6a1 1 0 0 0-1-1 1 1 0 1 1 0-2 3 3 0 0 1 3 3v12a3 3 0 0 1-3 3z"})}),Hc=a=>e.jsx("svg",{viewBox:"0 0 24 24",height:"48",width:"48",focusable:"false",role:"img",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",...a,children:e.jsx("path",{d:"M3 6a1 1 0 0 0 2 0 1 1 0 0 1 1-1h12a1 1 0 0 1 1 1 1 1 0 1 0 2 0 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3zm2 5a1 1 0 1 0-2 0v2a1 1 0 1 0 2 0v-2zm14 0a1 1 0 1 1 2 0v2a1 1 0 1 1-2 0v-2zm-5 9a1 1 0 0 1-1 1h-2a1 1 0 1 1 0-2h2a1 1 0 0 1 1 1zm-8 1a1 1 0 1 0 0-2 1 1 0 0 1-1-1 1 1 0 1 0-2 0 3 3 0 0 0 3 3zm11-1a1 1 0 0 0 1 1 3 3 0 0 0 3-3 1 1 0 1 0-2 0 1 1 0 0 1-1 1 1 1 0 0 0-1 1z"})}),N={add:Oi,alignCenter:Ei,alignJustify:Ji,alignLeft:Qi,alignRight:$i,arrowDown:_i,bg:qi,blockquote:eo,bold:to,borderAll:Ic,borderBottom:Fc,borderLeft:Kc,borderNone:zc,borderRight:Yc,borderTop:Hc,check:so,chevronRight:ao,chevronsUpDown:no,clear:As,close:As,code:io,codeblock:oo,color:lo,column:ro,combine:co,ungroup:mo,comment:ho,commentAdd:uo,delete:Bs,dragHandle:po,editing:xo,emoji:fo,externalLink:bo,h1:go,h2:yo,h3:vo,h4:So,h5:jo,h6:No,image:Zo,indent:wo,italic:Co,kbd:Go,lineHeight:ko,link:Vo,minus:Wo,more:To,ol:Ro,outdent:Lo,paragraph:Xo,refresh:Io,row:Fo,search:Ko,settings:zo,strikethrough:Yo,subscript:Ho,superscript:Do,table:Mo,text:Po,trash:Uo,trash2:Bs,ul:Ao,underline:Bo,unlink:Oo,viewing:Eo,viewingOff:Jo,lock:Qo,lockOpen:$o,type:_o,fontSize:qo,bookOpenText:el,copy:tl,moveUp:sl,moveDown:al,squarePlus:nl,folder:il,bookmark:ol,mic:ll,download:rl,edit:cl,library:dl,scene:ml,images:hl,preview:ul,tip:pl,gitHub:a=>e.jsx("svg",{viewBox:"0 0 438.549 438.549",...a,children:e.jsx("path",{fill:"currentColor",d:"M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z"})}),logo:a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",...a,children:e.jsx("path",{fill:"currentColor",d:"M11.572 0c-.176 0-.31.001-.358.007a19.76 19.76 0 0 1-.364.033C7.443.346 4.25 2.185 2.228 5.012a11.875 11.875 0 0 0-2.119 5.243c-.096.659-.108.854-.108 1.747s.012 1.089.108 1.748c.652 4.506 3.86 8.292 8.209 9.695.779.25 1.6.422 2.534.525.363.04 1.935.04 2.299 0 1.611-.178 2.977-.577 4.323-1.264.207-.106.247-.134.219-.158-.02-.013-.9-1.193-1.955-2.62l-1.919-2.592-2.404-3.558a338.739 338.739 0 0 0-2.422-3.556c-.009-.002-.018 1.579-.023 3.51-.007 3.38-.01 3.515-.052 3.595a.426.426 0 0 1-.206.214c-.075.037-.14.044-.495.044H7.81l-.108-.068a.438.438 0 0 1-.157-.171l-.05-.106.006-4.703.007-4.705.072-.092a.645.645 0 0 1 .174-.143c.096-.047.134-.051.54-.051.478 0 .558.018.682.154.035.038 1.337 1.999 2.895 4.361a10760.433 10760.433 0 0 0 4.735 7.17l1.9 2.879.096-.063a12.317 12.317 0 0 0 2.466-2.163 11.944 11.944 0 0 0 2.824-6.134c.096-.66.108-.854.108-1.748 0-.893-.012-1.088-.108-1.747-.652-4.506-3.859-8.292-8.208-9.695a12.597 12.597 0 0 0-2.499-.523A33.119 33.119 0 0 0 11.573 0zm4.069 7.217c.347 0 .408.005.486.047a.473.473 0 0 1 .237.277c.018.06.023 1.365.018 4.304l-.006 4.218-.744-1.14-.746-1.14v-3.066c0-1.982.01-3.097.023-3.15a.478.478 0 0 1 .233-.296c.096-.05.13-.054.5-.054z"})}),moon:xl,sun:fl},Cs=ca,Gs=da,Dc=rs,Mc=bl,Cn=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(os,{ref:i,className:x("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",a),...n,children:[t,e.jsx(la,{className:"ml-auto h-4 w-4"})]}));Cn.displayName=os.displayName;const Gn=d.forwardRef(({className:a,...s},t)=>e.jsx(ls,{ref:t,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));Gn.displayName=ls.displayName;const Kt=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(rs,{children:e.jsx(cs,{ref:n,sideOffset:s,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t})}));Kt.displayName=cs.displayName;const O=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(ds,{ref:n,className:x("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",a),...t}));O.displayName=ds.displayName;const Pc=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(ms,{ref:i,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Tt,{children:e.jsx(hs,{className:"h-4 w-4"})})}),s]}));Pc.displayName=ms.displayName;const Uc=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(us,{ref:n,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Tt,{children:e.jsx(ra,{className:"h-4 w-4 fill-current"})})}),s]}));Uc.displayName=us.displayName;const Ac=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(ps,{ref:n,className:x("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));Ac.displayName=ps.displayName;const ks=d.forwardRef(({className:a,...s},t)=>e.jsx(xs,{ref:t,className:x("-mx-1 my-1 h-px bg-muted",a),...s}));ks.displayName=xs.displayName;const Bc=function(){const a=["monospace","sans-serif","serif"],s="mmmmmmmmmmlli",t="72px",n=document.getElementsByTagName("body")[0],i=document.createElement("span");i.style.fontSize=t,i.innerHTML=s;const o={},l={};for(const r in a)i.style.fontFamily=a[r],n.appendChild(i),o[a[r]]=i.offsetWidth,l[a[r]]=i.offsetHeight,n.removeChild(i);function c(r){let h=!1;for(const m in a){i.style.fontFamily=r+","+a[m],n.appendChild(i);const u=i.offsetWidth!=o[a[m]]||i.offsetHeight!=l[a[m]];n.removeChild(i),h=h||u}return h}this.detect=c},ft={windows:[{ch:"宋体",en:"SimSun"},{ch:"黑体",en:"SimHei"},{ch:"微软雅黑",en:"Microsoft Yahei"},{ch:"微软正黑体",en:"Microsoft JhengHei"},{ch:"楷体",en:"KaiTi"},{ch:"新宋体",en:"NSimSun"},{ch:"仿宋",en:"FangSong"}],"OS X":[{ch:"苹方",en:"PingFang SC"},{ch:"冬青黑体简",en:"Hiragino Sans GB"},{ch:"兰亭黑-简",en:"Lantinghei SC"},{ch:"翩翩体-简",en:"Hanzipen SC"},{ch:"手札体-简",en:"Hannotate SC"},{ch:"宋体-简",en:"Songti SC"},{ch:"娃娃体-简",en:"Wawati SC"},{ch:"魏碑-简",en:"Weibei SC"},{ch:"行楷-简",en:"Xingkai SC"},{ch:"雅痞-简",en:"Yapi SC"},{ch:"圆体-简",en:"Yuanti SC"}],office:[{ch:"幼圆",en:"YouYuan"},{ch:"隶书",en:"LiSu"},{ch:"华文细黑",en:"STXihei"},{ch:"华文黑体",en:"STHeiti"},{ch:"华文楷体",en:"STKaiti"},{ch:"华文宋体",en:"STSong"},{ch:"华文仿宋",en:"STFangsong"},{ch:"华文中宋",en:"STZhongsong"},{ch:"华文彩云",en:"STCaiyun"},{ch:"华文琥珀",en:"STHupo"},{ch:"华文新魏",en:"STXinwei"},{ch:"华文隶书",en:"STLiti"},{ch:"华文行楷",en:"STXingkai"},{ch:"方正舒体",en:"FZShuTi"},{ch:"方正姚体",en:"FZYaoti"}],open:[{ch:"思源黑体",en:"Source Han Sans CN"},{ch:"思源宋体",en:"Source Han Serif SC"},{ch:"文泉驿微米黑",en:"WenQuanYi Micro Hei"},{ch:"霞鹜文楷",en:"LXGW WenKai"},{ch:"方舟像素",en:"Ark Pixel 12px Monospaced zh_cn"},{ch:"DW Pica Roman V",en:"DW Pica Roman V"}]},Oc=new Bc,Ec=[{ch:"Arial",en:"Arial"}].concat([...ft["OS X"],...ft.windows,...ft.open,...ft.office].filter(a=>Oc.detect(a.en)));var Qe=(a=>(a.NORMAL="normal",a.BOLD="bold",a))(Qe||{}),$e=(a=>(a.NORMAL="normal",a.ITALIC="italic",a))($e||{});async function as(a,s){const t=new FontFace(a,typeof s=="string"?"url(".concat(s,")"):s);document.fonts.add(t),await t.load()}var Z=(a=>(a.Character="Character",a.Background="Background",a.Thing="Thing",a.Dialog="Dialog",a.Audio="Audio",a.Font="Font",a))(Z||{});const Vs=[{name:"角色",value:"Character"},{name:"背景",value:"Background"},{name:"物品",value:"Thing"},{name:"对话框",value:"Dialog"},{name:"音频",value:"Audio"},{name:"字体",value:"Font"}],Jc=Vs.reduce((a,{name:s,value:t})=>(a[t]=s,a),{});class Qc extends gl{constructor(){super("vnve2");b(this,"asset");b(this,"assetSource");b(this,"template");b(this,"project");this.version(2).stores({asset:"++id, name, type, states",assetSource:"++id, mime, blob, ext",template:"++id, name, type, content",draft:"++id, name, time, content",project:"++id, name, time, content"})}}const zt=new Qc,ee=zt.asset,Ye=zt.assetSource,Gt=zt.template,ke=zt.project;function Ne(a){return"https://s/".concat(a.id,".").concat(a.ext)}async function $c(){const a=await window.showDirectoryPicker();for(const s of Vs){const t=await a.getDirectoryHandle(s.name).catch(()=>{});if(t){for await(const[n,i]of t.entries())if(i.kind==="directory"){const o=await ee.add({name:n,type:s.value,states:[]});for await(const[,l]of i.entries())if(l.kind==="file"){const c=await l.getFile(),{name:r,ext:h}=jt(c),m=await Ye.add({mime:c.type,blob:c,ext:h});await ee.where("id").equals(o).modify(u=>{u.states.push({id:m,name:r,ext:h})})}}}}}async function _c(){await Ye.clear(),await ee.clear()}async function qc(){const a=await ee.where("type").equals("Font").toArray();for(const s of a)for(const t of s.states)await as(t.name,Ne(t))}Z.Background;const ed=[{name:"对话",content:Vc},{name:"独白",content:Wc},{name:"标题",content:Tc},{name:"空白",content:()=>new he}];function kn(){const a=k(i=>i.editor),s=rt(()=>Gt.reverse().toArray());return{defaultTemplates:ed,customTemplates:s||[],handleAddDefaultTemplate:(i,o)=>()=>{const l=i();a.addScene(l,o),a.setActiveSceneByName(l.name)},handleAddCustomTemplate:async(i,o)=>{const l=await he.fromJSON(JSON.parse(i),!1);a.addScene(l,o),a.setActiveSceneByName(l.name)}}}function td({onOpenSceneDetailDialog:a}){const s=k(p=>p.editor),t=k(p=>p.activeScene),n=k(p=>p.scenes),{defaultTemplates:i,customTemplates:o,handleAddDefaultTemplate:l,handleAddCustomTemplate:c}=kn(),r=d.useRef(null);d.useEffect(()=>{r.current&&r.current.scrollIntoView({behavior:"smooth"})},[n.length]);const h=p=>{p.name===(t==null?void 0:t.name)&&s.setActiveScene(void 0),s.removeSceneByName(p.name)},m=(p,f)=>{const v=s.cloneSceneByName(p.name);s.addScene(v,f),s.setActiveSceneByName(v.name)},u=(p,f)=>{s.swapScene(p,f)};return e.jsx(Ie,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(Ze,{className:"h-full p-1",children:e.jsx(xe,{className:"h-full p-2",children:e.jsxs(Lt,{children:[e.jsx(Xt,{children:e.jsxs(Ve,{children:[e.jsx(We,{children:"场景"}),e.jsx(We,{className:"w-[3rem] text-right",children:"操作"})]})}),e.jsx(It,{children:n.map((p,f)=>e.jsxs(Ve,{ref:(t==null?void 0:t.name)===p.name?r:null,className:"".concat((t==null?void 0:t.name)===p.name?"bg-muted":""," cursor-pointer"),children:[e.jsxs(Te,{onClick:()=>{s.setActiveSceneByName(p.name)},children:[e.jsxs("span",{className:"font-medium mr-1",children:[f+1,"."]}),p.label]}),e.jsxs(Te,{className:"flex gap-1 justify-end",children:[f>0&&e.jsx(N.moveUp,{className:"size-4 cursor-pointer",onClick:()=>u(f,f-1)}),f<n.length-1&&e.jsx(N.moveDown,{className:"size-4 cursor-pointer",onClick:()=>u(f,f+1),children:"下移"}),e.jsxs(Cs,{modal:!1,children:[e.jsx(Gs,{children:e.jsx(N.more,{className:"size-4 cursor-pointer"})}),e.jsxs(Kt,{children:[e.jsx(O,{className:"flex md:hidden",onClick:a,children:"编辑"}),e.jsxs(Mc,{children:[e.jsx(Cn,{children:"插入"}),e.jsx(Dc,{children:e.jsxs(Gn,{children:[i.map(v=>e.jsx(O,{onClick:l(v.content,f+1),children:v.name},v.name)),o.length>0&&e.jsx(ks,{}),o.map(v=>e.jsx(O,{onClick:()=>c(v.content,f+1),children:v.name},v.id))]})})]}),e.jsx(O,{onClick:()=>m(p,f+1),children:"复制"}),e.jsx(O,{className:"text-destructive",onClick:()=>h(p),children:"删除"})]})]})]})]},p.name))})]})})})})}function Yt(){const a=q(l=>l.setConfirm),s=q(l=>l.setCancel),t=q(l=>l.setOpen),n=q(l=>l.setType),i=q(l=>l.setDisableSelect);return{selectAsset:(l,c)=>new Promise(r=>{a(h=>{r(h),t(!1)}),s(()=>{r(void 0),t(!1)}),t(!0),n(l),i(c)})}}async function Vn(a,s){var o;const t=a.states,n=(o=t.find(l=>l.id===a.stateId))!=null?o:t[0],i=new nt({source:Ne(n)});return i.label=a.name,i.assetID=a.id,i.assetType=a.type,await i.load(),a.type===Z.Character?(i.zIndex=E.Character,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height):a.type===Z.Background?(i.zIndex=E.Background,i.width=s.options.width,i.height=s.options.height):a.type===Z.Dialog&&(i.zIndex=E.Dialog,i.x=s.options.width/2-i.width/2,i.y=s.options.height-i.height),i}function Wn(a){var i;const s=a.states,t=(i=s.find(o=>o.id===a.stateId))!=null?i:s[0],n=new it({source:Ne(t)});return n.label=t.name,n.assetID=a.id,n.assetType=a.type,n}let Tn=!1;function sd(a){Tn=a}function Es(){return Tn}const Ee=vl,Rn=d.forwardRef(({className:a,...s},t)=>e.jsx(ma,{ref:t,className:x("flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm",a),...s}));Rn.displayName=ma.displayName;const Ke=d.forwardRef(({className:a,...s},t)=>e.jsx(ha,{ref:t,className:x("flex cursor-default select-none items-center rounded-sm px-2 sm:px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",a),...s}));Ke.displayName=ha.displayName;const ad=d.forwardRef(({className:a,inset:s,children:t,...n},i)=>e.jsxs(ua,{ref:i,className:x("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",s&&"pl-8",a),...n,children:[t,e.jsx(la,{className:"ml-auto h-4 w-4"})]}));ad.displayName=ua.displayName;const nd=d.forwardRef(({className:a,...s},t)=>e.jsx(pa,{ref:t,className:x("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s}));nd.displayName=pa.displayName;const ze=d.forwardRef(({className:a,align:s="start",alignOffset:t=-4,sideOffset:n=8,...i},o)=>e.jsx(yl,{children:e.jsx(xa,{ref:o,align:s,alignOffset:t,sideOffset:n,className:x("z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...i})}));ze.displayName=xa.displayName;const K=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(fa,{ref:n,className:x("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",a),...t}));K.displayName=fa.displayName;const id=d.forwardRef(({className:a,children:s,checked:t,...n},i)=>e.jsxs(ba,{ref:i,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:t,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ga,{children:e.jsx(hs,{className:"h-4 w-4"})})}),s]}));id.displayName=ba.displayName;const od=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(ya,{ref:n,className:x("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(ga,{children:e.jsx(ra,{className:"h-4 w-4 fill-current"})})}),s]}));od.displayName=ya.displayName;const ld=d.forwardRef(({className:a,inset:s,...t},n)=>e.jsx(va,{ref:n,className:x("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",a),...t}));ld.displayName=va.displayName;const bt=d.forwardRef(({className:a,...s},t)=>e.jsx(Sa,{ref:t,className:x("-mx-1 my-1 h-px bg-muted",a),...s}));bt.displayName=Sa.displayName;const we=jl,rd=Nl,Ln=d.forwardRef(({className:a,...s},t)=>e.jsx(ja,{ref:t,className:x("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s}));Ln.displayName=ja.displayName;const fe=d.forwardRef(({className:a,children:s,disableClose:t,...n},i)=>e.jsxs(rd,{children:[e.jsx(Ln,{}),e.jsxs(Na,{ref:i,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...n,children:[s,!t&&e.jsxs(Sl,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Za,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));fe.displayName=Na.displayName;const be=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col space-y-1.5 text-center sm:text-left",a),...s});be.displayName="DialogHeader";const Ws=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Ws.displayName="DialogFooter";const ge=d.forwardRef(({className:a,...s},t)=>e.jsx(wa,{ref:t,className:x("text-lg font-semibold leading-none tracking-tight",a),...s}));ge.displayName=wa.displayName;const ye=d.forwardRef(({className:a,...s},t)=>e.jsx(Ca,{ref:t,className:x("text-sm text-muted-foreground",a),...s}));ye.displayName=Ca.displayName;const cd=se("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ie=d.forwardRef(({className:a,...s},t)=>e.jsx(Ga,{ref:t,className:x(cd(),a),...s}));ie.displayName=Ga.displayName;const Oe=Cl,Xn=d.createContext({}),I=({...a})=>e.jsx(Xn.Provider,{value:{name:a.name},children:e.jsx(Zl,{...a})}),Ht=()=>{const a=d.useContext(Xn),s=d.useContext(In),{getFieldState:t,formState:n}=wl(),i=t(a.name,n);if(!a)throw new Error("useFormField should be used within <FormField>");const{id:o}=s;return{id:o,name:a.name,formItemId:"".concat(o,"-form-item"),formDescriptionId:"".concat(o,"-form-item-description"),formMessageId:"".concat(o,"-form-item-message"),...i}},In=d.createContext({}),R=d.forwardRef(({className:a,...s},t)=>{const n=d.useId();return e.jsx(In.Provider,{value:{id:n},children:e.jsx("div",{ref:t,className:x("space-y-2",a),...s})})});R.displayName="FormItem";const X=d.forwardRef(({className:a,...s},t)=>{const{error:n,formItemId:i}=Ht();return e.jsx(ie,{ref:t,className:x(n&&"text-destructive",a),htmlFor:i,...s})});X.displayName="FormLabel";const L=d.forwardRef(({...a},s)=>{const{error:t,formItemId:n,formDescriptionId:i,formMessageId:o}=Ht();return e.jsx(ka,{ref:s,id:n,"aria-describedby":t?"".concat(i," ").concat(o):"".concat(i),"aria-invalid":!!t,...a})});L.displayName="FormControl";const _e=d.forwardRef(({className:a,...s},t)=>{const{formDescriptionId:n}=Ht();return e.jsx("p",{ref:t,id:n,className:x("text-[0.8rem] text-muted-foreground",a),...s})});_e.displayName="FormDescription";const F=d.forwardRef(({className:a,children:s,...t},n)=>{const{error:i,formMessageId:o}=Ht(),l=i?String(i==null?void 0:i.message):s;return l?e.jsx("p",{ref:n,id:o,className:x("text-[0.8rem] font-medium text-destructive",a),...t,children:l}):null});F.displayName="FormMessage";const z=d.forwardRef(({className:a,type:s,...t},n)=>e.jsx("input",{type:s,className:x("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:n,...t}));z.displayName="Input";const Ts=se("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),C=d.forwardRef(({className:a,variant:s,size:t,asChild:n=!1,...i},o)=>{const l=n?ka:"button";return e.jsx(l,{className:x(Ts({variant:s,size:t,className:a})),ref:o,...i})});C.displayName="Button";const dd=Va({templateName:Wa().min(1,"模板名称不能为空")});function md({isOpen:a,sceneName:s,onClose:t}){const n=k(c=>c.editor),i=Ue({resolver:Ae(dd),defaultValues:{templateName:""}}),o=c=>{c||t()},l=async c=>{await Gt.add({name:c.templateName,type:"",content:JSON.stringify(n.cloneSceneByName(s))}),t(),i.reset()};return e.jsx(we,{open:a,onOpenChange:o,children:e.jsxs(fe,{children:[e.jsxs(be,{children:[e.jsx(ge,{children:"保存为模板"}),e.jsx(ye,{})]}),e.jsx(Oe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(l),className:"space-y-8",children:[e.jsx(I,{control:i.control,name:"templateName",render:({field:c})=>e.jsxs(R,{children:[e.jsx(X,{children:"模板名称"}),e.jsx(L,{children:e.jsx(z,{placeholder:"输入模板名称",...c})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:t,children:"取消"}),e.jsx(C,{type:"submit",children:"保存"})]})]})})]})})}function hd({isOpen:a,onClose:s}){const t=rt(()=>Gt.reverse().toArray()),n=async o=>{await Gt.delete(o)},i=o=>{o||s()};return e.jsx(we,{open:a,onOpenChange:i,children:e.jsxs(fe,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(be,{children:[e.jsx(ge,{children:"模板列表"}),e.jsx(ye,{})]}),e.jsxs(Lt,{children:[e.jsx(Xt,{children:e.jsxs(Ve,{children:[e.jsx(We,{children:"模板名称"}),e.jsx(We,{className:"w-[100px]",children:"操作"})]})}),e.jsx(It,{children:t==null?void 0:t.map(o=>e.jsxs(Ve,{children:[e.jsx(Te,{children:o.name}),e.jsx(Te,{children:e.jsxs(C,{variant:"ghost",size:"icon",onClick:()=>n(o.id),children:[e.jsx(N.delete,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"删除"})]})})]},o.id))})]})]})})}const Rs=d.forwardRef(({className:a,value:s,...t},n)=>e.jsx(Ta,{ref:n,className:x("relative h-2 w-full overflow-hidden rounded-full bg-primary/20",a),...t,children:e.jsx(Gl,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})}));Rs.displayName=Ta.displayName;function ud({progress:a,url:s,isOpen:t,onClose:n}){const i=k(c=>c.project),o=c=>{c||n()},l=()=>{Kr(i.name,s)};return e.jsx(we,{open:t,onOpenChange:o,children:e.jsxs(fe,{className:"min-w-[80vw]",onPointerDownOutside:c=>c.preventDefault(),children:[e.jsxs(be,{children:[e.jsx(ge,{children:"导出"}),e.jsx(ye,{})]}),!s&&e.jsx(Rs,{value:a.value}),s&&e.jsx("video",{src:s,className:"w-full aspect-[16/9]",controls:!0}),e.jsx(Ws,{children:s&&e.jsxs(C,{onClick:l,children:[e.jsx(N.download,{className:"size-4 mr-1"}),"保存视频"]})})]})})}const pd=d.forwardRef(({progress:a,isOpen:s,onReplay:t,onClose:n,onExport:i},o)=>{const l=d.useRef(null);d.useImperativeHandle(o,()=>({getPreviewCanvas:()=>l.current}));const c=r=>{r||n()};return e.jsx(we,{open:s,onOpenChange:c,children:e.jsxs(fe,{className:"min-w-[80vw]",onPointerDownOutside:r=>r.preventDefault(),children:[e.jsxs(be,{children:[e.jsx(ge,{children:"预览"}),e.jsx(ye,{}),e.jsx("canvas",{ref:l,className:"w-full aspect-[16/9]"}),e.jsx(Rs,{value:a.value,className:"mt-2"})]}),e.jsxs(Ws,{children:[e.jsx(C,{variant:"ghost",onClick:t,children:e.jsx(N.refresh,{className:"size-5"})}),e.jsxs(C,{onClick:i,children:[e.jsx(N.download,{className:"size-4 mr-1"}),"导出视频"]})]})]})})}),xd=1,fd=1e6;let qt=0;function bd(){return qt=(qt+1)%Number.MAX_SAFE_INTEGER,qt.toString()}const es=new Map,Js=a=>{if(es.has(a))return;const s=setTimeout(()=>{es.delete(a),tt({type:"REMOVE_TOAST",toastId:a})},fd);es.set(a,s)},gd=(a,s)=>{switch(s.type){case"ADD_TOAST":return{...a,toasts:[s.toast,...a.toasts].slice(0,xd)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=s;return t?Js(t):a.toasts.forEach(n=>{Js(n.id)}),{...a,toasts:a.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return s.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(t=>t.id!==s.toastId)}}},gt=[];let yt={toasts:[]};function tt(a){yt=gd(yt,a),gt.forEach(s=>{s(yt)})}function yd({...a}){const s=bd(),t=i=>tt({type:"UPDATE_TOAST",toast:{...i,id:s}}),n=()=>tt({type:"DISMISS_TOAST",toastId:s});return tt({type:"ADD_TOAST",toast:{...a,id:s,open:!0,onOpenChange:i=>{i||n()}}}),{id:s,dismiss:n,update:t}}function Dt(){const[a,s]=d.useState(yt);return d.useEffect(()=>(gt.push(s),()=>{const t=gt.indexOf(s);t>-1&&gt.splice(t,1)}),[a]),{...a,toast:yd,dismiss:t=>tt({type:"DISMISS_TOAST",toastId:t})}}const vd=Va({projectName:Wa().min(1,"作品名称不能为空")});function Sd({isOpen:a,onClose:s}){const t=k(r=>r.editor),n=k(r=>r.setProject),{toast:i}=Dt(),o=Ue({resolver:Ae(vd),defaultValues:{projectName:""}}),l=r=>{r||s()},c=async r=>{const h={name:r.projectName,content:"",time:Date.now()},m=await ke.add(h);t.clear(),n({id:m,...h}),s(),o.reset(),i({title:"新作品创建成功!",description:"可以开始添加场景了～",duration:1500})};return e.jsx(we,{open:a,onOpenChange:l,children:e.jsxs(fe,{children:[e.jsxs(be,{children:[e.jsx(ge,{children:"创建新作品"}),e.jsx(ye,{})]}),e.jsx(Oe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(c),className:"space-y-8",children:[e.jsx(I,{control:o.control,name:"projectName",render:({field:r})=>e.jsxs(R,{children:[e.jsx(X,{children:"作品名称"}),e.jsx(L,{children:e.jsx(z,{placeholder:"输入作品名称",...r})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:s,children:"取消"}),e.jsx(C,{type:"submit",children:"创建"})]})]})})]})})}function jd({isOpen:a,onClose:s}){const t=k(m=>m.editor),n=k(m=>m.setProject),i=rt(()=>ke.reverse().toArray()),o=d.useRef(!1),l=m=>{m||s()},c=async m=>{if(o.current)return;o.current=!0;const u=await ke.get(m);t.clear(),u.content&&(await t.loadFromJSON(u.content),t.setActiveSceneByIndex(0)),n(u),s(),setTimeout(()=>{o.current=!1},100)},r=async m=>{await ke.delete(m)},h=async m=>{const u=await ke.get(m);await ke.add({name:"".concat(u.name," - 副本"),content:u.content,time:Date.now()})};return e.jsx(we,{open:a,onOpenChange:l,children:e.jsxs(fe,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs(be,{children:[e.jsx(ge,{children:"作品列表"}),e.jsx(ye,{})]}),e.jsxs(Lt,{children:[e.jsx(Xt,{children:e.jsxs(Ve,{children:[e.jsx(We,{children:"作品名称"}),e.jsx(We,{className:"w-[80px]",children:"操作"})]})}),e.jsx(It,{children:i==null?void 0:i.map(m=>e.jsxs(Ve,{children:[e.jsx(Te,{onClick:()=>c(m.id),children:e.jsx("span",{className:"cursor-pointer",children:m.name})}),e.jsxs(Te,{className:"flex gap-2",children:[e.jsx(N.copy,{className:"h-4 w-4 cursor-pointer",onClick:()=>h(m.id)}),e.jsx(N.delete,{className:"h-4 w-4 cursor-pointer",onClick:()=>r(m.id)})]})]},m.id))})]})]})})}const Nd=({className:a})=>e.jsx(kl,{className:x("h-6 w-6 text-primary/60 animate-spin",a)});function Zd({isOpen:a}){const s=()=>{};return e.jsx(we,{open:a,onOpenChange:s,children:e.jsxs(fe,{disableClose:!0,onPointerDownOutside:t=>t.preventDefault(),children:[e.jsxs(be,{className:"hidden",children:[e.jsx(ge,{}),e.jsx(ye,{})]}),e.jsxs("div",{className:"w-full flex gap-2 justify-center items-center",children:[e.jsx("div",{className:"font-bold text-xl",children:"导入中"}),e.jsx(Nd,{})]})]})})}const wd=Wl,Cd=Vl,Fn=d.forwardRef(({className:a,...s},t)=>e.jsx(Ra,{className:x("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s,ref:t}));Fn.displayName=Ra.displayName;const Kn=d.forwardRef(({className:a,...s},t)=>e.jsxs(Cd,{children:[e.jsx(Fn,{}),e.jsx(La,{ref:t,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...s})]}));Kn.displayName=La.displayName;const zn=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col space-y-2 text-center sm:text-left",a),...s});zn.displayName="AlertDialogHeader";const Yn=({className:a,...s})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s});Yn.displayName="AlertDialogFooter";const Hn=d.forwardRef(({className:a,...s},t)=>e.jsx(Xa,{ref:t,className:x("text-lg font-semibold",a),...s}));Hn.displayName=Xa.displayName;const Dn=d.forwardRef(({className:a,...s},t)=>e.jsx(Ia,{ref:t,className:x("text-sm text-muted-foreground",a),...s}));Dn.displayName=Ia.displayName;const Mn=d.forwardRef(({className:a,...s},t)=>e.jsx(Fa,{ref:t,className:x(Ts(),a),...s}));Mn.displayName=Fa.displayName;const Pn=d.forwardRef(({className:a,...s},t)=>e.jsx(Ka,{ref:t,className:x(Ts({variant:"outline"}),"mt-2 sm:mt-0",a),...s}));Pn.displayName=Ka.displayName;function Gd({isOpen:a,onConfirm:s,onClose:t}){const n=o=>{o||t()},i=()=>{s(),t()};return e.jsx(wd,{open:a,onOpenChange:n,children:e.jsxs(Kn,{children:[e.jsxs(zn,{children:[e.jsx(Hn,{children:"确认清空素材库？"}),e.jsx(Dn,{})]}),e.jsxs(Yn,{children:[e.jsx(Pn,{children:"取消"}),e.jsx(Mn,{onClick:i,children:"确认"})]})]})})}function kd(){const a=k(w=>w.initEditor),s=k(w=>w.project),t=k(w=>w.editor),n=k(w=>w.activeScene),i=k(w=>w.scenes),{selectAsset:o}=Yt(),l=d.useRef(null),c=d.useRef(null),{defaultTemplates:r,customTemplates:h,handleAddDefaultTemplate:m,handleAddCustomTemplate:u}=kn(),[p,f]=d.useState(!1),[v,T]=d.useState(!1),[U,G]=d.useState(!1),[y,V]=d.useState(!1),[A,Y]=d.useState(!1),[ae,J]=d.useState(!1),[j,W]=d.useState(!1),$=d.useRef(null),[Fe,di]=d.useState([]),[Ut,At]=d.useState(null),_=d.useRef(null),[Hs,Ds]=d.useState({value:0,currentTime:0,duration:0}),[Ms,mi]=d.useState(""),{toast:Ce}=Dt(),Ps=()=>{Ds({value:0,currentTime:0,duration:0})},Bt=()=>{const w=l.current,H=c.current;if(w&&H){const ne=w.clientWidth,Ge=w.clientHeight,ve=16/9;let xt=ne,Jt=ne/ve;Jt>Ge&&(Jt=Ge,xt=Ge*ve),H.style.width="".concat(xt,"px"),H.style.height="".concat(Jt,"px")}},Ot=d.useCallback(async w=>{try{const H=new Date;await ke.update(s.id,{content:t.saveAsJSON(),time:H.getTime()}),mi(H.toLocaleString()),w||Ce({title:"保存成功！",duration:1500})}catch(H){Ce({title:"保存失败！",description:H.message,variant:"destructive"})}},[Ce,t,s]),Et=w=>async()=>{const H=await o(w);if(H){const ne=await Vn(H,t);t.addChild(ne)}},ut=async(w=0,H)=>{Ps(),di([w,H]),Y(!0);const ne=await t.exportScreenplay(w,H),Ge=new Gc({canvas:$.current.getPreviewCanvas(),width:1920,height:1080,fps:30,disableAudio:Es()});_.current.connect(Ge),_.current.action(ne).then(()=>{console.log("预览完成")}).catch(ve=>{Y(!1),Ce({title:"预览失败！",description:ve.message,variant:"destructive"})})},hi=async()=>{_.current.hasStarted()&&await _.current.cut(),ut(...Fe)},pt=async(w=0,H)=>{Ps(),V(!0),At(null);const ne=await t.exportScreenplay(w,H),Ge=new Cc({width:1920,height:1080,fps:30,disableAudio:Es()});_.current.connect(Ge),_.current.action(ne).then(ve=>{const xt=URL.createObjectURL(ve);At(xt)}).catch(ve=>{V(!1),Ce({title:"导出失败！",description:ve.message,variant:"destructive"})})},ui=()=>{V(!1),_.current.hasStarted()&&_.current.cut(),Ut&&URL.revokeObjectURL(Ut),At(null)},pi=()=>{Y(!1),_.current.hasStarted()&&_.current.cut()},xi=()=>{Y(!1),pt(...Fe)},fi=async()=>{J(!0);try{await $c()}catch(w){Ce({title:"导入失败！",description:w.message,variant:"destructive"})}finally{J(!1)}},bi=async()=>{await _c(),Ce({title:"清空成功！",duration:1500})};return d.useEffect(()=>{if(s){const w=setInterval(async()=>{Ot(!0)},6e4);return()=>{clearInterval(w)}}},[s,Ot]),d.useEffect(()=>(window.addEventListener("resize",Bt),Bt(),a(c.current),_.current=new ss({onProgress(w,H,ne){Ds({value:w,currentTime:H,duration:ne})}}),c.current.onselectstart=function(){return!1},()=>{window.removeEventListener("resize",Bt)}),[a]),e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs(Rn,{children:[e.jsxs(Ee,{children:[e.jsxs(Ke,{className:"data-[disabled]:text-gray-400",children:[e.jsx(N.library,{className:"size-4 mr-0.5"}),"作品"]}),e.jsxs(ze,{children:[e.jsx(K,{onClick:()=>f(!0),children:"创建新作品"}),e.jsx(K,{onClick:()=>T(!0),children:"打开..."}),e.jsx(K,{disabled:!s,onClick:()=>Ot(),children:"保存"}),Ms&&e.jsxs(K,{className:"text-muted-foreground",children:["自动保存于",Ms]})]})]}),e.jsxs(Ee,{children:[e.jsxs(Ke,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[e.jsx(N.scene,{className:"size-4 mr-0.5"}),"场景"]}),e.jsxs(ze,{children:[r.map(w=>e.jsxs(K,{onClick:m(w.content),children:["新建",w.name]},w.name)),h.length>0&&e.jsx(bt,{}),h.map(w=>e.jsxs(K,{onClick:()=>u(w.content),children:["新建",w.name]},w.id)),e.jsx(bt,{}),e.jsx(K,{onClick:()=>G(!0),children:"管理模版..."})]})]}),e.jsxs(Ee,{children:[e.jsxs(Ke,{className:"data-[disabled]:text-gray-400",disabled:!s,children:[e.jsx(N.images,{className:"size-4 mr-0.5"}),"素材"]}),e.jsxs(ze,{children:[e.jsx(K,{disabled:!n,onClick:Et(Z.Character),children:"添加角色"}),e.jsx(K,{disabled:!n,onClick:Et(Z.Background),children:"添加背景"}),e.jsx(K,{disabled:!n,onClick:Et(Z.Thing),children:"添加物品"}),e.jsx(bt,{}),e.jsx(K,{onClick:fi,children:"导入素材库..."}),e.jsx(K,{onClick:()=>o(void 0,!0),children:"管理素材库..."}),e.jsx(K,{className:"text-destructive",onClick:()=>W(!0),children:"清空素材库"})]})]}),e.jsxs(Ee,{children:[e.jsxs(Ke,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[e.jsx(N.preview,{className:"size-4 mr-0.5"}),"预览"]}),e.jsxs(ze,{children:[e.jsx(K,{disabled:!n,onClick:()=>{const w=t.getActiveSceneIndex();ut(w,w+1)},children:"仅预览当前场景"}),e.jsx(K,{disabled:!n,onClick:()=>ut(t.getActiveSceneIndex()),children:"从当前场景开始预览"}),e.jsx(K,{onClick:()=>ut(),children:"预览全部场景"})]})]}),e.jsxs(Ee,{children:[e.jsxs(Ke,{disabled:i.length===0,className:"data-[disabled]:text-gray-400",children:[e.jsx(N.download,{className:"size-4 mr-0.5"}),"导出"]}),e.jsxs(ze,{children:[e.jsx(K,{disabled:!n,onClick:()=>{const w=t.getActiveSceneIndex();pt(w,w+1)},children:"仅导出当前场景"}),e.jsx(K,{disabled:!n,onClick:()=>pt(t.getActiveSceneIndex()),children:"从当前场景开始导出"}),e.jsx(K,{onClick:()=>pt(),children:"导出全部场景"})]})]})]}),e.jsx(Ie,{className:"flex-1 rounded-md relative",children:e.jsx(Ze,{className:"relative h-full p-2",children:e.jsx("div",{className:"w-full h-full flex justify-center items-center",ref:l,children:e.jsx("canvas",{className:"shadow border border-b",ref:c})})})}),e.jsx(jd,{isOpen:v,onClose:()=>T(!1)}),e.jsx(hd,{isOpen:U,onClose:()=>G(!1)}),e.jsx(ud,{progress:Hs,url:Ut,isOpen:y,onClose:ui}),e.jsx(pd,{progress:Hs,ref:$,isOpen:A,onReplay:hi,onClose:pi,onExport:xi}),e.jsx(Sd,{isOpen:p,onClose:()=>f(!1)}),e.jsx(Zd,{isOpen:ae}),e.jsx(Gd,{isOpen:j,onConfirm:bi,onClose:()=>W(!1)})]})}function Vd(){const a=k(r=>r.editor),s=k(r=>r.activeChild),t=k(r=>r.activeScene),n=d.useMemo(()=>{if(!t)return[];const r=[],h=[],m=[],u=[],p=t.sounds;for(const f of t.children)f.assetType===Z.Character?r.push(f):f.assetType===Z.Background?m.push(f):f.assetType===Z.Thing?h.push(f):f.name&&u.push(f);return[{label:"角色",children:r},{label:"物品",children:h},{label:"背景",children:m},{label:"其他",children:u},{label:"音频",children:p}]},[t]),i=r=>{r.assetType!==Z.Audio&&a.setActiveChildByName(r.name)},o=r=>{if(r.assetType===Z.Audio){a.removeSoundByName(r.name);return}a.removeChildByName(r.name),(s==null?void 0:s.name)===r.name&&a.setActiveChild(void 0)},l=r=>{a.toggleChildVisibleByName(r.name)},c=r=>{a.toggleChildInteractiveByName(r.name)};return e.jsx(xe,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-4",children:n.map(r=>r.children.length>0&&e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:r.label}),e.jsx("div",{className:"flex flex-col gap-1",children:r.children.map(h=>e.jsx("div",{className:"text-sm p-1 px-2 border rounded ".concat((s==null?void 0:s.name)===h.name?"bg-muted":""),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{onClick:()=>i(h),className:"cursor-pointer flex-1",children:h.label}),e.jsxs("div",{className:"flex space-x-2 items-center",children:[h.assetType!==Z.Audio&&e.jsxs(e.Fragment,{children:[h.visible?e.jsx(N.viewing,{onClick:()=>l(h),className:"size-4 cursor-pointer"}):e.jsx(N.viewingOff,{onClick:()=>l(h),className:"size-4 cursor-pointer"}),h.interactive?e.jsx(N.lockOpen,{onClick:()=>c(h),className:"size-4 cursor-pointer"}):e.jsx(N.lock,{onClick:()=>c(h),className:"size-4 cursor-pointer"})]}),e.jsx(N.trash2,{onClick:()=>o(h),className:"size-4 cursor-pointer hover:text-destructive"})]})]})},h.name))})]},r.label))})})}const Mt=d.forwardRef(({className:a,...s},t)=>e.jsxs(za,{ref:t,className:x("relative flex w-full touch-none select-none items-center",a),...s,children:[e.jsx(Tl,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(Rl,{className:"absolute h-full bg-primary"})}),e.jsx(Ll,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]}));Mt.displayName=za.displayName;function Wd(){const a=k(i=>i.editor),s=k(i=>i.activeChild),t=(i,o)=>l=>{a.updateActiveChild(c=>{o==="number"?c[i]=Number(l.target.value):c[i]=l.target.value})},n=i=>o=>{a.updateActiveChild(l=>{l[i]=o})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"w-5",children:"宽"}),e.jsx(z,{value:s.width,onChange:t("width","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"w-5",children:"高"}),e.jsx(z,{value:s.height,onChange:t("height","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"w-5",children:"X"}),e.jsx(z,{value:s.x.toFixed(0),onChange:t("x","number"),type:"number",min:0,step:10,className:"h-6"})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"w-5",children:"Y"}),e.jsx(z,{value:s.y.toFixed(0),onChange:t("y","number"),type:"number",min:0,step:10,className:"h-6"})]})]}),e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"flex-shrink-0 mr-2",children:"透明度"}),e.jsx(Mt,{min:0,max:1,step:.1,value:[s.alpha],onValueChange:i=>n("alpha")(i[0])})]})]})}const ue=Ml,Ls=Pl,pe=Ul,oe=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Ya,{ref:n,className:x("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),"data-disable-click-outside":!0,...t,children:[s,e.jsx(Xl,{asChild:!0,children:e.jsx(Il,{"data-disable-click-outside":!0,className:"h-4 w-4 opacity-50"})})]}));oe.displayName=Ya.displayName;const Un=d.forwardRef(({className:a,...s},t)=>e.jsx(Ha,{ref:t,className:x("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(Fl,{})}));Un.displayName=Ha.displayName;const An=d.forwardRef(({className:a,...s},t)=>e.jsx(Da,{ref:t,className:x("flex cursor-default items-center justify-center py-1",a),"data-disable-click-outside":!0,...s,children:e.jsx(Kl,{})}));An.displayName=Da.displayName;const le=d.forwardRef(({className:a,children:s,position:t="popper",...n},i)=>e.jsx(zl,{children:e.jsxs(Ma,{ref:i,className:x("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:t,"data-disable-click-outside":!0,...n,children:[e.jsx(Un,{}),e.jsx(Yl,{className:x("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),"data-disable-click-outside":!0,children:s}),e.jsx(An,{})]})}));le.displayName=Ma.displayName;const Pt=d.forwardRef(({className:a,...s},t)=>e.jsx(Pa,{ref:t,className:x("px-2 py-1.5 text-sm font-semibold",a),...s,"data-disable-click-outside":!0}));Pt.displayName=Pa.displayName;const Q=d.forwardRef(({className:a,children:s,...t},n)=>e.jsxs(Ua,{ref:n,className:x("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),"data-disable-click-outside":!0,...t,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center","data-disable-click-outside":!0,children:e.jsx(Hl,{children:e.jsx(hs,{className:"h-4 w-4"})})}),e.jsx(Dl,{"data-disable-click-outside":!0,children:s})]}));Q.displayName=Ua.displayName;const Td=d.forwardRef(({className:a,...s},t)=>e.jsx(Aa,{ref:t,className:x("-mx-1 my-1 h-px bg-muted",a),"data-disable-click-outside":!0,...s}));Td.displayName=Aa.displayName;const kt=Al,Vt=Bl,ot=d.forwardRef(({className:a,align:s="center",sideOffset:t=4,...n},i)=>e.jsx(Ba,{children:e.jsx(fs,{ref:i,align:s,sideOffset:t,className:x("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}));ot.displayName=fs.displayName;function Rd(a){const s=d.useRef(null);return d.useEffect(()=>{a&&(typeof a=="function"?a(s.current):a.current=s.current)}),s}const Xs=d.forwardRef(({disabled:a,value:s,onChange:t,onBlur:n,name:i,className:o,...l},c)=>{const r=Rd(c),[h,m]=d.useState(!1),u=d.useMemo(()=>s||"#FFFFFF",[s]);return e.jsxs(kt,{onOpenChange:m,open:h,children:[e.jsx(Vt,{asChild:!0,disabled:a,onBlur:n,children:e.jsx(C,{...l,className:x("block",o),name:i,onClick:()=>{m(!0)},size:"icon",style:{backgroundColor:u},variant:"outline",children:e.jsx("div",{})})}),e.jsxs(ot,{className:"w-full",children:[e.jsx(Ol,{color:u,onChange:t}),e.jsx(z,{className:"mt-2",maxLength:7,onChange:p=>{var f;t((f=p==null?void 0:p.currentTarget)==null?void 0:f.value)},ref:r,value:u})]})]})});Xs.displayName="ColorPicker";const Bn=se("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-3",sm:"h-8 px-2",lg:"h-10 px-3"}},defaultVariants:{variant:"default",size:"default"}}),Ld=d.forwardRef(({className:a,variant:s,size:t,...n},i)=>e.jsx(Oa,{ref:i,className:x(Bn({variant:s,size:t,className:a})),...n}));Ld.displayName=Oa.displayName;const On=d.createContext({size:"default",variant:"default"}),En=d.forwardRef(({className:a,variant:s,size:t,children:n,...i},o)=>e.jsx(Ea,{ref:o,className:x("flex items-center justify-center gap-1",a),...i,children:e.jsx(On.Provider,{value:{variant:s,size:t},children:n})}));En.displayName=Ea.displayName;const ns=d.forwardRef(({className:a,children:s,variant:t,size:n,...i},o)=>{const l=d.useContext(On);return e.jsx(Ja,{ref:o,className:x(Bn({variant:l.variant||t,size:l.size||n}),a),...i,children:s})});ns.displayName=Ja.displayName;function Xd(){const a=k(r=>r.editor),s=k(r=>r.activeChild),t=rt(()=>ee.where("type").equals(Z.Font).reverse().toArray()),n=d.useMemo(()=>{const r=[];if(!t)return r;for(const h of t)for(const m of h.states)r.push({ch:m.name,en:m.name});return r},[t]),i=(r,h)=>m=>{a.updateActiveChild(u=>{h==="number"?u[r]=Number(m.target.value):u[r]=m.target.value})},o=(r,h)=>m=>{a.updateActiveChild(u=>{h==="number"?u.style[r]=Number(m.target.value):u.style[r]=m.target.value})},l=r=>h=>{a.updateActiveChild(m=>{m.style[r]=h})},c=r=>{a.updateActiveChild(h=>{h.style.fontWeight=r.includes(Qe.BOLD)?Qe.BOLD:Qe.NORMAL,h.style.fontStyle=r.includes($e.ITALIC)?$e.ITALIC:$e.NORMAL})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[!s.disableTextEdit&&e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(N.bookOpenText,{className:"w-5 h-5"}),e.jsx(z,{value:s.text,onChange:i("text")})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(N.color,{className:"w-5 h-5"}),e.jsx(Xs,{value:s.style.fill,onChange:l("fill"),className:"w-6 h-6"})]}),e.jsx("div",{className:"flex-1 flex gap-1 items-center",children:e.jsxs(En,{type:"multiple",value:[s.style.fontWeight,s.style.fontStyle],onValueChange:c,children:[e.jsx(ns,{value:Qe.BOLD,className:"p-2",children:e.jsx(N.bold,{className:"size-4"})}),e.jsx(ns,{value:$e.ITALIC,className:"p-2",children:e.jsx(N.italic,{className:"size-4"})})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(N.type,{className:"w-5 h-5"}),e.jsxs(ue,{onValueChange:l("fontFamily"),value:s.style.fontFamily,children:[e.jsx(oe,{className:"h-6 max-w-[150px]",children:e.jsx(pe,{placeholder:"---"})}),e.jsx(le,{children:[...n,...Ec].map(r=>e.jsx(Q,{value:r.en,children:r.ch},r.en))})]})]}),e.jsxs("div",{className:"flex-1 shrink-0 flex gap-1 items-center",children:[e.jsx(N.fontSize,{className:"w-5 h-5"}),e.jsx(z,{value:s.style.fontSize,onChange:o("fontSize","number"),type:"number",min:1,step:10,className:"h-6"})]})]})]})}function Id(){const a=k(o=>o.editor);k(o=>o.activeScene);const s=k(o=>o.activeChild),{selectAsset:t}=Yt(),n=o=>{a.updateActiveChild(l=>{const c=l.width,r=l.height;l.fillColor=o,l.clear().beginFill(o).drawRect(0,0,c,r).endFill()})},i=async()=>{const o=await t(Z.Dialog),l=await Vn(o,a);a.addChild(l),a.updateActiveScene(c=>{c.config.speak.dialogTargetName=l.name}),a.setActiveChildByName(l.name),a.removeChildByName(s.name)};return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 flex gap-1 items-center",children:[e.jsx(ie,{className:"flex-shrink-0 mr-2",children:"填充色"}),e.jsx(Xs,{value:s.fillColor,onChange:n,className:"w-6 h-6"})]}),e.jsx(C,{size:"sm",onClick:i,children:"自定义对话框"})]})}function Fd(){const a=k(s=>s.activeChild);return e.jsx(xe,{className:"h-full pr-2",children:a&&e.jsxs(e.Fragment,{children:[e.jsxs("fieldset",{className:"rounded-md border p-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"基础属性"}),e.jsx(Wd,{})]}),a.type==="Text"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"文字属性"}),e.jsx(Xd,{})]}),a.type==="Graphics"&&e.jsxs("fieldset",{className:"rounded-md border p-2 mt-2",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"对话框属性"}),e.jsx(Id,{})]})]})})}function Kd(){const a=k(l=>l.editor),s=k(l=>l.activeChild),t=async()=>{const l=a.cloneChild();l.type==="Sprite"&&await l.load(),l.x+=l.width*.1,l.y+=l.height*.1,a.addChild(l),a.setActiveChildByName(l.name)},n=()=>{a.activeChild&&a.removeChildByName(a.activeChild.name),a.setActiveChild(void 0)},i=l=>()=>{switch(l){case"top":a.moveChildToTop();break;case"bottom":a.moveChildToBottom();break;case"up":a.moveUpChild();break;case"down":a.moveDownChild();break}},o=l=>()=>{a.setChildPosition(l)};return e.jsx(xe,{className:"h-full pr-2",children:s&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("fieldset",{className:"rounded-md border p-1",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"层级"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(C,{size:"sm",variant:"ghost",onClick:i("top"),children:"置顶"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:i("up"),children:"上移"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:i("down"),children:"下移"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:i("bottom"),children:"置底"})]}),e.jsxs("div",{children:[e.jsx(C,{size:"sm",variant:"ghost",onClick:t,children:e.jsx(N.copy,{className:"size-4"})}),e.jsx(C,{size:"sm",variant:"ghost",onClick:n,children:e.jsx(N.delete,{className:"size-4"})})]})]})]}),e.jsxs("fieldset",{className:"rounded-md border p-1",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"水平位置"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("left"),children:"左"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("near-left"),children:"1/3"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("center"),children:"中"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("near-right"),children:"2/3"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("right"),children:"右"})]}),e.jsxs("fieldset",{className:"rounded-md border p-1",children:[e.jsx("legend",{className:"-ml-1 px-1 text-sm font-medium",children:"垂直位置"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("top"),children:"上"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("middle"),children:"中"}),e.jsx(C,{size:"sm",variant:"ghost",onClick:o("bottom"),children:"下"})]})]})})}const Jn=El,Is=d.forwardRef(({className:a,...s},t)=>e.jsx(Qa,{ref:t,className:x("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",a),...s}));Is.displayName=Qa.displayName;const st=d.forwardRef(({className:a,...s},t)=>e.jsx($a,{ref:t,className:x("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",a),...s}));st.displayName=$a.displayName;const vt=d.forwardRef(({className:a,...s},t)=>e.jsx(_a,{ref:t,className:x("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...s}));vt.displayName=_a.displayName;function zd(){return e.jsx(Ie,{className:"flex-1 shrink-0 max-h-[50%] sm:max-h-full rounded-md",children:e.jsx(Ze,{className:"h-full p-2",children:e.jsxs(Jn,{defaultValue:"position",className:"h-full flex flex-col",children:[e.jsxs(Is,{className:"self-center",children:[e.jsx(st,{value:"position",children:"位置"}),e.jsx(st,{value:"style",children:"样式"}),e.jsx(st,{value:"list",children:"列表"})]}),e.jsx(vt,{className:"h-[calc(100%-2.5rem)]",value:"position",children:e.jsx(Kd,{})}),e.jsx(vt,{className:"h-[calc(100%-2.5rem)]",value:"style",children:e.jsx(Fd,{})}),e.jsx(vt,{className:"h-[calc(100%-2.5rem)]",value:"list",children:e.jsx(Vd,{})})]})})})}function Yd(){const a=k(s=>s.project);return e.jsxs("header",{className:"sticky top-0 z-10 flex h-[53px] items-center justify-between gap-1 border-b bg-background px-4",children:[e.jsxs("h1",{className:"text-xl font-bold",children:["V N V E",a&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["【",a.name,"】"]})]}),e.jsx(N.gitHub,{className:"size-5 cursor-pointer",onClick:()=>{window.location.href="https://github.com/vnve/vnve"}})]})}const Hd=re(qa,"m-0 px-0 py-1"),Dd=se(D("relative overflow-x-auto whitespace-pre-wrap break-words","min-h-[80px] w-full rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none","[&_[data-slate-placeholder]]:text-muted-foreground [&_[data-slate-placeholder]]:!opacity-100","[&_[data-slate-placeholder]]:top-[auto_!important]","[&_strong]:font-bold"),{defaultVariants:{focusRing:!0,size:"sm",variant:"outline"},variants:{disabled:{true:"cursor-not-allowed opacity-50"},focusRing:{false:"",true:"focus-visible:ring-1 focus-visible:ring-ring"},focused:{true:"ring-1 ring-ring"},size:{md:"text-base",sm:"text-sm"},variant:{ghost:"",outline:"border border-input"}}}),Qn=je.forwardRef(({className:a,disabled:s,focusRing:t,focused:n,readOnly:i,size:o,variant:l,...c},r)=>e.jsx("div",{className:"relative w-full",ref:r,children:e.jsx(Jl,{"aria-disabled":s,className:D(Dd({disabled:s,focusRing:t,focused:n,size:o,variant:l}),a),"data-plate-selectable":!0,disableDefaultStyles:!0,readOnly:s!=null?s:i,...c})}));Qn.displayName="Editor";const Md=se("shrink-0 bg-border",{defaultVariants:{orientation:"horizontal"},variants:{orientation:{horizontal:"h-px w-full",vertical:"h-full w-px"}}}),Pd=Rt(bs(Ql,{decorative:!0,orientation:"horizontal"}),Md),Ud=en,Ad=tn,Bd=sn,Od=$l,Ed=re(bs(gs,{sideOffset:4}),"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md");function Jd(a){return je.forwardRef(function({tooltip:t,tooltipContentProps:n,tooltipProps:i,...o},l){const[c,r]=je.useState(!1);je.useEffect(()=>{r(!0)},[]);const h=e.jsx(a,{ref:l,...o});return t&&c?e.jsx(Ud,{children:e.jsxs(Ad,{...i,children:[e.jsx(Bd,{asChild:!0,children:h}),e.jsx(Od,{children:e.jsx(Ed,{...n,children:t})})]})}):h})}const Qd=re(ql,"relative flex select-none items-center gap-1 bg-background"),$d=re(er,"flex items-center");re(tr,"font-medium underline underline-offset-4");re(sr,"my-1 w-px shrink-0 bg-border");const is=se(D("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50","[&_svg:not([data-icon])]:size-5"),{defaultVariants:{size:"sm",variant:"default"},variants:{size:{default:"h-10 px-3",lg:"h-11 px-5",sm:"h-9 px-2"},variant:{default:"bg-transparent hover:bg-muted hover:text-muted-foreground aria-checked:bg-accent aria-checked:text-accent-foreground",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"}}}),He=Jd(d.forwardRef(({children:a,className:s,isDropdown:t,pressed:n,size:i,variant:o,...l},c)=>typeof n=="boolean"?e.jsx($d,{disabled:l.disabled,type:"single",value:"single",children:e.jsx(_d,{className:D(is({size:i,variant:o}),t&&"my-1 justify-between pr-1",s),ref:c,value:n?"single":"",...l,children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-1",children:a}),e.jsx("div",{children:e.jsx(N.arrowDown,{className:"ml-0.5 size-4","data-icon":!0})})]}):a})}):e.jsx(_l,{className:D(is({size:i,variant:o}),t&&"pr-1",s),ref:c,...l,children:a})));He.displayName="ToolbarButton";const _d=Rt(ar,is,["variant","size"]),Qs=Xe(({children:a,className:s,noSeparator:t},n)=>{const i=d.Children.map(a,o=>o);return!i||i.length===0?null:e.jsxs("div",{className:D("flex",s),ref:n,children:[!t&&e.jsx("div",{className:"h-full py-2",children:e.jsx(Pd,{orientation:"vertical"})}),e.jsx("div",{className:"mx-1 flex items-center gap-1",children:a})]})}),qd=re(Qd,"supports-backdrop-blur:bg-background/60 z-40 w-full justify-between overflow-x-auto rounded-t-lg border-b border-b-border bg-background/95 backdrop-blur"),em=ca,tm=da;Xe(({children:a,className:s,inset:t,...n},i)=>e.jsxs(os,{className:D("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent","data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",s),ref:i,...n,children:[a,e.jsx(N.chevronRight,{className:"ml-auto size-4"})]}));re(ls,"z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2");const sm=bs(cs,{className:D("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2"),sideOffset:4}),am=Xe(({...a},s)=>e.jsx(rs,{children:e.jsx(sm,{ref:s,...a})})),nm=se(D("relative flex h-9 cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors","focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50"),{variants:{inset:{true:"pl-8"}}}),im=Rt(ds,nm,["inset"]);Xe(({children:a,className:s,...t},n)=>e.jsxs(ms,{className:D("relative flex select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","cursor-pointer",s),ref:n,...t,children:[e.jsx("span",{className:"absolute left-2 flex size-3.5 items-center justify-center",children:e.jsx(Tt,{children:e.jsx(N.check,{className:"size-4"})})}),a]}));Xe(({children:a,className:s,hideIcon:t,...n},i)=>e.jsxs(us,{className:D("relative flex select-none items-center rounded-sm pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50","h-9 cursor-pointer px-2 data-[state=checked]:bg-accent data-[state=checked]:text-accent-foreground",s),ref:i,...n,children:[!t&&e.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:e.jsx(Tt,{children:e.jsx(N.check,{className:"size-4"})})}),a]}));const om=se(D("select-none px-2 py-1.5 text-sm font-semibold"),{variants:{inset:{true:"pl-8"}}}),lm=Rt(ps,om,["inset"]),rm=re(xs,"-mx-1 my-1 h-px bg-muted");re(nr("span"),"ml-auto text-xs tracking-widest opacity-60");const cm=()=>{const[a,s]=d.useState(!1);return{onOpenChange:d.useCallback((n=!a)=>{s(n)},[a]),open:a}},Re=ir(or({key:"directive",node:{isElement:!0,isInline:!0,isMarkableVoid:!0,isVoid:!0},options:{openEditorId:null,mode:"",editingDirective:null,directiveType:null}}).extendOptions(({getOptions:a})=>({isOpen:s=>a().openEditorId===s})).extendEditorApi(({setOptions:a})=>({floatingDirective:{hide:()=>{a({mode:"",openEditorId:null,editingDirective:null,directiveType:null})},show:(s,t,n,i)=>{a({mode:s,openEditorId:t,editingDirective:n,directiveType:i})}}})).extendEditorTransforms(({editor:a,type:s})=>({insert:{directive:({value:t})=>{lr(a,{children:[{text:""}],type:s,value:t})}},edit:{directive:({value:t,at:n})=>{rr(a,{children:[{text:""}],type:s,value:t},{at:n})}}})));var De=(a=>(a.Animation="Animation",a.Sound="Sound",a.Util="Util",a.Filter="Filter",a.Transition="Transition",a))(De||{});const de={[S.Speak]:"发言",[S.Speaker]:"发言角色",[S.ChangeSource]:"变更",[S.Show]:"显示",[S.Hide]:"隐藏",[S.FadeIn]:"渐入",[S.FadeOut]:"渐出",[S.ShakeX]:"左右晃动",[S.ShakeY]:"上下晃动",[S.ZoomIn]:"放大",[S.ZoomOut]:"缩小",[S.EnterFromLeft]:"从左进入",[S.LeaveFromLeft]:"向左离开",[S.EnterFromRight]:"从右进入",[S.LeaveFromRight]:"向右离开",[S.Play]:"播放",[S.Pause]:"暂停",[S.Stop]:"停止",[S.Wait]:"停顿",[S.FadeInTransition]:"渐入转场",[S.AddFilter]:"添加滤镜",[S.RemoveFilter]:"移除滤镜"},lt=[S.ChangeSource,S.Show,S.Hide,S.FadeIn,S.FadeOut,S.ShakeX,S.ShakeY,S.ZoomIn,S.ZoomOut,S.EnterFromLeft,S.LeaveFromLeft,S.EnterFromRight,S.LeaveFromRight],dm=lt.map(a=>({name:de[a],value:a})),Fs=[S.Play,S.Pause,S.Stop],mm=Fs.map(a=>({name:de[a],value:a})),Ks=[S.Wait],zs=[S.AddFilter,S.RemoveFilter],$n=[S.FadeInTransition],hm=Ks.map(a=>({name:de[a],value:a})),um=zs.map(a=>({name:de[a],value:a})),pm=$n.map(a=>({name:de[a],value:a})),xm=[{name:"动画指令",type:"Animation",options:dm},{name:"音频指令",type:"Sound",options:mm},{name:"工具指令",type:"Util",options:hm},{name:"滤镜指令",type:"Filter",options:um},{name:"转场指令",type:"Transition",options:pm}];function fm(a){if(lt.includes(a))return"Animation";if(Fs.includes(a))return"Sound";if(Ks.includes(a))return"Util";if(zs.includes(a))return"Filter";if($n.includes(a))return"Transition"}const $s=[{name:"纯黑",value:"BlackMaskFilter"},{name:"模糊",value:"BlurFilter"},{name:"噪点",value:"NoiseFilter"},{name:"老电影",value:"OldFilmFilter"},{name:"暗角",value:"VignetteFilter"}],Ys=(a,{directiveElement:s,directiveType:t}={})=>{const{api:n}=cr(a,Re);if(s){const i=s.value.directive,o=fm(i);n.floatingDirective.show("edit",a.id,s,o)}else n.floatingDirective.show("insert",a.id,null,t)};function bm({triggerFloatingLinkHotkeys:a,floatingOptions:s}){const{editor:t,api:n,tf:i,useOption:o,setOption:l,getOptions:c}=ys(Re),r=o("mode"),h=o("isOpen",t.id),m=o("editingDirective"),u=dr({onOpenChange:y=>l("openEditorId",y?t.id:null),getBoundingClientRect:mr,open:h&&["insert","edit"].includes(r),...s});an();const p=q(y=>y.isOpen),f=hr(y=>{const V=y.target;V&&V.dataset.disableClickOutside||V!==document.documentElement&&(p||(console.log("outside click",V),["insert","edit"].includes(c().mode)&&(n.floatingDirective.hide(),et(t,t.selection))))},{disabled:!h});je.useEffect(()=>{h&&u.update()},[h,u.update]);const v=y=>{i.insert.directive({value:y}),pr(t,{unit:"offset"}),n.floatingDirective.hide(),setTimeout(()=>{et(t,t.selection)},0)},T=y=>{const V=t.selection,[,A]=xr(t,{at:V,match:{type:t.getType(Re)}});i.edit.directive({value:y,at:A}),n.floatingDirective.hide()},U=y=>{m?T(y):v(y)},G=()=>{n.floatingDirective.hide(),setTimeout(()=>{et(t,t.selection)},0)};return{props:{style:{...u.style,zIndex:50}},ref:ur(u.refs.setFloating,f),onSubmit:U,onCancel:G}}const gm=[{items:[{description:"工具指令",icon:N.squarePlus,label:"工具指令",value:De.Util},{description:"转场指令",icon:N.squarePlus,label:"转场指令",value:De.Transition},{description:"滤镜指令",icon:N.squarePlus,label:"滤镜指令",value:De.Filter}],label:"更多指令"}];function ym(a){const s=nn(),t=cm();function n(i){Ys(s,{directiveType:i}),et(s)}return e.jsxs(em,{modal:!1,...t,...a,children:[e.jsx(tm,{asChild:!0,children:e.jsx(He,{isDropdown:!0,pressed:t.open,tooltip:"更多指令",children:e.jsx(N.add,{className:"size-4"})})}),e.jsx(am,{align:"start",className:"flex max-h-[500px] min-w-0 flex-col gap-0.5 overflow-y-auto",children:gm.map(({items:i,label:o},l)=>e.jsxs(je.Fragment,{children:[l!==0&&e.jsx(rm,{}),e.jsx(lm,{children:o}),i.map(({icon:c,label:r,value:h})=>e.jsxs(im,{className:"min-w-[180px]",onSelect:()=>n(h),children:[e.jsx(c,{className:"mr-2 size-4"}),r]},h))]},o))})]})}const Le=d.forwardRef(({className:a,...s},t)=>e.jsx(on,{className:x("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...s,ref:t,children:e.jsx(fr,{className:x("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));Le.displayName=on.displayName;const vm=g.object({wordsPerMin:g.number().optional(),interval:g.number().optional(),effect:g.string().optional(),speaker:g.object({name:g.string().optional(),autoShowSpeaker:g.object({inEffect:g.string()}).optional(),autoMaskOtherSpeakers:g.object({alpha:g.number()}).optional()})});function _n({speak:a,onChangeSpeak:s,disableCustomName:t=!1}){const n=Ue({resolver:Ae(vm),defaultValues:a}),i=te({control:n.control});return d.useEffect(()=>{n.formState.isDirty&&s({...a,...i,speaker:{...a.speaker,...i.speaker}})},[n.formState.isDirty,i]),e.jsx(Oe,{...n,children:e.jsxs("form",{className:"space-y-2",children:[!t&&e.jsx(I,{control:n.control,name:"speaker.name",render:({field:o})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"自定义角色名"}),e.jsx(_e,{children:"用于自定义对话中显示的角色名"}),e.jsx(L,{children:e.jsx(z,{className:"h-8",placeholder:"请输入自定义角色名",...o})}),e.jsx(F,{})]})}),e.jsx(I,{control:n.control,name:"wordsPerMin",render:({field:o})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"语速（字/分钟）"}),e.jsx(_e,{children:"角色发言的速度，默认值参考平均阅读速度"}),e.jsx(L,{children:e.jsx(z,{className:"h-8",type:"number",min:0,step:100,placeholder:"请输入语速",value:o.value,onChange:l=>{const c=Number(l.target.value);o.onChange(c)}})}),e.jsx(F,{})]})}),e.jsx(I,{control:n.control,name:"interval",render:({field:o})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"停顿时长（秒）"}),e.jsx(_e,{children:"角色发言后的停顿时长"}),e.jsx(L,{children:e.jsx(z,{className:"h-8",type:"number",min:0,step:.1,placeholder:"请输入停顿时长",value:o.value,onChange:l=>{const c=Number(l.target.value);o.onChange(c)}})}),e.jsx(F,{})]})}),e.jsx(I,{control:n.control,name:"effect",render:({field:o})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"台词效果"}),e.jsx(_e,{children:"台词的输出效果"}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:o.onChange,value:o.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择台词效果"})}),e.jsxs(le,{children:[e.jsx(Q,{value:"typewriter",children:"打字机"}),e.jsx(Q,{value:"fadeIn",children:"渐入"}),e.jsx(Q,{value:"none",children:"无"})]})]})}),e.jsx(F,{})]})}),e.jsx(I,{control:n.control,name:"speaker.autoShowSpeaker",render:({field:o})=>e.jsxs(R,{className:"flex flex-row items-center space-y-0",children:[e.jsx(X,{className:"w-[8rem]",children:"自动显示发言角色"}),e.jsx(L,{children:e.jsx(Le,{checked:!!o.value,onCheckedChange:o.onChange})}),e.jsx(F,{})]})}),e.jsx(I,{control:n.control,name:"speaker.autoMaskOtherSpeakers",render:({field:o})=>e.jsxs(R,{className:"flex flex-row items-center space-y-0",children:[e.jsx(X,{className:"w-[8rem]",children:"自动阴影其他角色"}),e.jsx(L,{children:e.jsx(Le,{checked:!!o.value,onCheckedChange:o.onChange})}),e.jsx(F,{})]})})]})})}const Sm=g.object({voice:g.object({label:g.string(),targetName:g.string(),volume:g.number().optional()})});function jm({speak:a,onChangeSpeak:s}){const{selectAsset:t}=Yt(),n=k(r=>r.editor),i=Ue({resolver:Ae(Sm),defaultValues:a}),o=te({control:i.control}),l=async r=>{const h=await t(Z.Audio);if(h){const m=Wn(h);n.addSound(m),i.setValue("voice.label",m.label),r(m.name)}},c=r=>{n.removeSoundByName(o.voice.targetName),i.setValue("voice.label",""),r("")};return d.useEffect(()=>{i.formState.isDirty&&s({...a,...o})},[i.formState.isDirty,o]),e.jsx(Oe,{...i,children:e.jsxs("form",{className:"space-y-2",children:[e.jsx(I,{control:i.control,name:"voice.targetName",render:({field:r})=>{var h;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"配音文件"}),e.jsx(L,{children:e.jsx("div",{className:"flex gap-1 items-center",children:r.value&&((h=o.voice)!=null&&h.label)?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:o.voice.label}),e.jsx(C,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:e.jsx(N.edit,{className:"size-4 cursor-pointer",onClick:()=>l(r.onChange)})}),e.jsx(C,{type:"button",size:"sm",variant:"ghost",className:"px-1",children:e.jsx(N.delete,{className:"size-4 cursor-pointer",onClick:()=>c(r.onChange)})})]}):e.jsx(C,{type:"button",size:"sm",onClick:()=>l(r.onChange),children:"选择素材"})})}),e.jsx(F,{})]})}}),e.jsx(I,{control:i.control,name:"voice.volume",render:({field:r})=>{var h;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"音量"}),e.jsx(L,{children:e.jsx(Mt,{min:0,max:1,step:.1,value:[(h=r.value)!=null?h:1],onValueChange:m=>r.onChange(m[0])})}),e.jsx(F,{})]})}})]})})}const _s={name:"Narrator",label:"旁白"};function Nm({speak:a,onChangeSpeak:s,children:t}){const n=k(r=>r.activeScene),i=d.useMemo(()=>{const r=[_s];return n?[...r,...n.children.filter(h=>h.assetType===Z.Character)]:r},[n]),o=nn(),l=r=>{const h=i.find(m=>m.name===r);s({...a,speaker:{...a.speaker,speakerTargetName:h==null?void 0:h.name,name:(h==null?void 0:h.name)===_s.name?"":(h==null?void 0:h.label)||""}})},c=r=>{Ys(o,{directiveType:r}),et(o)};return e.jsxs("div",{className:"w-full flex flex-wrap",children:[e.jsxs(Qs,{noSeparator:!0,children:[e.jsxs(ue,{value:a.speaker.speakerTargetName||"",onValueChange:l,children:[e.jsx(oe,{className:"w-[100px] md:w-[130px] h-8",children:e.jsx(pe,{placeholder:"选择发言角色"})}),e.jsxs(le,{children:[i.map(r=>e.jsx(Q,{value:r.name,children:r.label},r.name)),i.length===1&&e.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:"请先在画布中添加角色"})]})]}),e.jsxs(kt,{children:[e.jsx(Vt,{asChild:!0,children:e.jsx(He,{className:"px-1",tooltip:"发言设置",children:e.jsx(N.settings,{className:"!size-4 cursor-pointer mx-1"})})}),e.jsx(ot,{children:e.jsx(_n,{speak:a,onChangeSpeak:s})})]}),e.jsxs(kt,{children:[e.jsx(Vt,{asChild:!0,children:e.jsx(He,{className:"px-1",tooltip:"配音设置",children:e.jsx(N.mic,{className:"!size-4 cursor-pointer mx-1"})})}),e.jsx(ot,{onFocusOutside:r=>r.preventDefault(),children:e.jsx(jm,{speak:a,onChangeSpeak:s})})]}),e.jsxs(He,{className:"px-1 text-xs",onClick:()=>c(De.Animation),tooltip:"插入动画",children:[e.jsx(N.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"动画"]}),e.jsxs(He,{className:"px-1 text-xs",onClick:()=>c(De.Sound),tooltip:"插入音频",children:[e.jsx(N.squarePlus,{className:"!size-4 md:mr-0.5 hidden md:flex"}),"音频"]}),e.jsx(ym,{})]}),e.jsx(Qs,{className:"ml-auto",children:t})]})}const Zm=a=>{const{children:s,nodeProps:t,placeholder:n}=a,{enabled:i}=gr(a);return je.Children.map(s,o=>je.cloneElement(o,{className:o.props.className,nodeProps:{...t,className:D(i&&"before:absolute before:cursor-text before:opacity-30 before:content-[attr(placeholder)]"),placeholder:n}}))},wm=br(Zm),Cm=a=>wm(a,[{hideOnBlur:!0,key:ts.key,placeholder:"请输入对白",query:{maxLevel:1}},{hideOnBlur:!1,key:yr.h1,placeholder:"Untitled"}]),Gm=Xe(({children:a,className:s,prefix:t,...n},i)=>{const o=vr(),l=Sr(),c=an(),{editor:r}=ys(Re),h=()=>{Ys(r,{directiveElement:o})};return e.jsxs(qa,{className:D("inline-block cursor-pointer rounded-md bg-muted px-1.5 py-0.5 align-baseline text-sm font-medium select-none mx-0.5",l&&c&&"ring-2 ring-ring",o.children[0].bold===!0&&"font-bold",o.children[0].italic===!0&&"italic",o.children[0].underline===!0&&"underline",s),contentEditable:!1,onClick:h,ref:i,...n,children:[t,o.value.label||"",a]})}),qn=se("w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 print:hidden");Xe(({align:a="center",className:s,sideOffset:t=4,style:n,...i},o)=>e.jsx(Ba,{children:e.jsx(fs,{align:a,className:D(qn(),s),ref:o,sideOffset:t,style:{zIndex:1e3,...n},...i})}));const km=d.forwardRef(({form:a},s)=>{const t=k(m=>m.activeScene),[n,i]=d.useState([]),[o,l]=d.useState([]),c=te({control:a.control,name:"directive"}),r=te({control:a.control,name:"params.targetName"}),h=te({control:a.control,name:"params.source"});return d.useEffect(()=>{if(t){const m=[],u=[],p=[];let f=[];for(const v of t.children){const T={value:v.name,label:v.label};v.assetType===Z.Character?m.push(T):v.assetType===Z.Background?p.push(T):v.assetType===Z.Thing?u.push(T):v.name&&f.push(T)}c===S.ChangeSource&&(f=f.filter(v=>v.assetID)),i([{label:"角色",options:m},{label:"背景",options:p},{label:"物品",options:u},{label:"其他",options:f}])}},[t,c]),d.useEffect(()=>{if(t&&c===S.ChangeSource&&r){const m=t.children.find(u=>u.name===r);m!=null&&m.assetID?ee.get(m.assetID).then(u=>{const p=u.states.map(f=>({value:Ne(f),label:f.name}));l(p)}):l([])}},[t,c,r,a]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var m,u;if(t&&c&&r){const p=de[c],f=((m=t.children.find(T=>T.name===r))==null?void 0:m.label)||"",v=[p,f];if(c===S.ChangeSource&&h){const T=((u=o.find(U=>U.value===h))==null?void 0:u.label)||"";v.push(T)}return v.join(":")}return""}}),[t,c,r,h,o]),e.jsxs(e.Fragment,{children:[e.jsx(I,{control:a.control,name:"params.targetName",render:({field:m})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"动画对象"}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:u=>{m.onChange(u),a.setValue("params.source","")},value:m.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择动画对象"})}),e.jsxs(le,{children:[n.map(u=>u.options.length>0&&e.jsxs(Ls,{children:[e.jsx(Pt,{children:u.label}),u.options.map(p=>e.jsx(Q,{value:p.value,children:p.label},p.value))]},u.label)),n.every(u=>u.options.length===0)&&e.jsx("div",{className:"select-none py-1.5 pl-2 pr-8 text-sm opacity-50",children:"请先在画布中添加角色、背景等素材"})]})]})}),e.jsx(F,{})]})}),c===S.ChangeSource&&o.length>0&&e.jsx(I,{control:a.control,name:"params.source",render:({field:m})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"目标状态"}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:m.onChange,value:m.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择目标状态"})}),e.jsx(le,{children:o.map(u=>e.jsx(Q,{value:u.value,children:u.label},u.value))})]})}),e.jsx(F,{})]})}),c!==S.ChangeSource&&e.jsx(I,{control:a.control,name:"params.duration",render:({field:m})=>{var u;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"动画时长(秒)"}),e.jsx(L,{children:e.jsx(z,{type:"number",min:0,step:.1,placeholder:"自定义动画时长",value:(u=m.value)!=null?u:"",onChange:p=>{const f=Number(p.target.value);m.onChange(f)},className:"h-8"})}),e.jsx(F,{})]})}})]})}),Vm=d.forwardRef(({form:a},s)=>{const t=te({control:a.control,name:"directive"}),n=te({control:a.control,name:"params.duration"});return d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>"".concat(de[t],":").concat(n!=null?n:0,"秒")}),[n,t]),e.jsx(I,{control:a.control,name:"params.duration",render:({field:i})=>{var o;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"停顿时间(秒)"}),e.jsx(L,{children:e.jsx(z,{type:"number",min:0,step:.1,placeholder:"请输入停顿时间",value:(o=i.value)!=null?o:0,onChange:l=>{const c=Number(l.target.value);i.onChange(c)},className:"h-8"})}),e.jsx(F,{})]})}})}),Wm=d.forwardRef(({form:a},s)=>{const t=k(p=>p.activeScene),n=k(p=>p.editor),[i,o]=d.useState([]),l=te({control:a.control,name:"directive"}),c=te({control:a.control,name:"params.targetName"}),{selectAsset:r}=Yt(),[h,m]=d.useState(!1),u=async p=>{m(!1);const f=await r(Z.Audio);if(f){const v=Wn(f);n.addSound(v),setTimeout(()=>{p(v.name)},150)}};return d.useEffect(()=>{if(t){const p=t.sounds.map(f=>({label:f.label,value:f.name}));o([{label:"音频",options:p}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{var p;if(t&&l&&c){const f=de[l],v=((p=t.sounds.find(U=>U.name===c))==null?void 0:p.label)||"";return[f,v].join(":")}return""}}),[t,l,c]),e.jsxs(e.Fragment,{children:[e.jsx(I,{control:a.control,name:"params.targetName",render:({field:p})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"目标音频"}),e.jsx(L,{children:e.jsxs(ue,{open:h,onOpenChange:m,onValueChange:p.onChange,value:p.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择目标音频"})}),e.jsxs(le,{children:[i.map(f=>f.options.length>0&&e.jsxs(Ls,{children:[e.jsx(Pt,{children:f.label}),f.options.map(v=>e.jsx(Q,{value:v.value,children:v.label},v.value))]},f.label)),e.jsx("div",{onClick:()=>u(p.onChange),className:"cursor-pointer select-none py-1.5 pl-2 pr-8 text-sm hover:bg-slate-100 rounded-sm","data-disable-click-outside":!0,children:"+从素材库中选择并添加到当前场景"})]})]})}),e.jsx(F,{})]})}),l===S.Play&&e.jsxs(e.Fragment,{children:[e.jsx(I,{control:a.control,name:"params.start",render:({field:p})=>{var f;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"开始时间(秒)"}),e.jsx(L,{children:e.jsx(z,{type:"number",min:0,step:1,placeholder:"请输入开始时间",value:(f=p.value)!=null?f:0,onChange:v=>{const T=Number(v.target.value);p.onChange(T)},className:"h-8"})}),e.jsx(F,{})]})}}),e.jsx(I,{control:a.control,name:"params.volume",render:({field:p})=>{var f;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"音量"}),e.jsx(L,{children:e.jsx(Mt,{min:0,max:1,step:.1,value:[(f=p.value)!=null?f:1],onValueChange:v=>p.onChange(v[0])})}),e.jsx(F,{})]})}}),e.jsx(I,{control:a.control,name:"params.loop",render:({field:p})=>e.jsxs(R,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(X,{className:"flex flex-col w-[4rem]",children:"循环"}),e.jsx(L,{children:e.jsx(Le,{checked:p.value,onCheckedChange:p.onChange})}),e.jsx(F,{})]})}),e.jsx(I,{control:a.control,name:"params.untilEnd",render:({field:p})=>e.jsxs(R,{className:"space-y-0 flex flex-row items-center",children:[e.jsx(X,{className:"flex flex-col w-[4rem]",children:"跨场景"}),e.jsx(L,{children:e.jsx(Le,{checked:p.value,onCheckedChange:p.onChange})}),e.jsx(F,{})]})})]})]})}),Tm=d.forwardRef(({form:a},s)=>{const t=k(l=>l.activeScene),[n,i]=d.useState([]),o=te({control:a.control,name:"directive"});return d.useEffect(()=>{if(t){const l=[],c=[],r=[],h=[];for(const m of t.children){const u={value:m.name,label:m.label};m.assetType===Z.Character?l.push(u):m.assetType===Z.Background?r.push(u):m.assetType===Z.Thing?c.push(u):m.name&&h.push(u)}i([{label:"角色",options:l},{label:"背景",options:r},{label:"物品",options:c},{label:"其他",options:h}])}},[t]),d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const l=[de[o]],c=a.getValues("params.targetName"),r=n.flatMap(u=>u.options).find(u=>u.value===c),h=r?r.label:"全场景";l.push(h);const m=a.getValues("params.filterName");if(m){const u=$s.find(f=>f.value===m),p=u?u.name:"";l.push(p)}return l.join(":")}}),[a,o,n]),e.jsxs(e.Fragment,{children:[e.jsx(I,{control:a.control,name:"params.targetName",render:({field:l})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"滤镜对象"}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:l.onChange,value:l.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"为空则默认全场景滤镜"})}),e.jsx(le,{children:n.map(c=>c.options.length>0&&e.jsxs(Ls,{children:[e.jsx(Pt,{children:c.label}),c.options.map(r=>e.jsx(Q,{value:r.value,children:r.label},r.value))]},c.label))})]})}),e.jsx(F,{})]})}),o===S.AddFilter&&e.jsx(I,{control:a.control,name:"params.filterName",render:({field:l})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"滤镜效果"}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:l.onChange,value:l.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择滤镜效果"})}),e.jsx(le,{children:$s.map(c=>e.jsx(Q,{value:c.value,children:c.name},c.value))})]})}),e.jsx(F,{})]})})]})}),Rm=d.forwardRef(({form:a},s)=>(d.useImperativeHandle(s,()=>({getDirectiveLabel:()=>{const t=a.getValues("directive");return de[t]}})),e.jsx(e.Fragment,{children:e.jsx(I,{control:a.control,name:"params.duration",render:({field:t})=>{var n;return e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:"转场时长"}),e.jsx(L,{children:e.jsx(z,{type:"number",min:0,step:.1,placeholder:"自定义转场时长",value:(n=t.value)!=null?n:"",onChange:i=>{const o=Number(i.target.value);t.onChange(o)},className:"h-8"})}),e.jsx(F,{})]})}})}))),Lm=g.discriminatedUnion("directive",[g.object({directive:g.literal(lt[0]),params:g.object({targetName:g.string({message:"请选择动画对象"}),source:g.string().min(1,{message:"请输入目标状态"}),duration:g.number().optional(),sequential:g.boolean().optional()})}),...lt.slice(1).map(a=>g.object({directive:g.literal(a),params:g.object({targetName:g.string({message:"请选择动画对象"}),duration:g.number().optional(),sequential:g.boolean().optional()})})),g.object({directive:g.literal(S.Wait),params:g.object({duration:g.number().optional(),sequential:g.boolean().optional()})}),g.object({directive:g.literal(S.Play),params:g.object({targetName:g.string({message:"请选择音频对象"}),start:g.number().optional(),volume:g.number().optional(),loop:g.boolean().optional(),untilEnd:g.boolean().optional(),sequential:g.boolean().optional()})}),...[S.Pause,S.Stop].map(a=>g.object({directive:g.literal(a),params:g.object({targetName:g.string({message:"请选择音频对象"}),sequential:g.boolean().optional()})})),g.object({directive:g.literal(S.AddFilter),params:g.object({targetName:g.string({message:"请选择滤镜对象"}),filterName:g.string({message:"请选择滤镜"}),sequential:g.boolean().optional()})}),g.object({directive:g.literal(S.RemoveFilter),params:g.object({targetName:g.string({message:"请选择滤镜对象"}),sequential:g.boolean().optional()})}),g.object({directive:g.literal(S.FadeInTransition),params:g.object({duration:g.number().optional(),sequential:g.boolean().optional()})})]);function Xm({editingDirective:a,directiveType:s,onSubmitDirective:t,onCancel:n}){const i=Ue({resolver:Ae(Lm),defaultValues:{directive:void 0,params:{}}}),o=te({control:i.control,name:"directive"}),l=d.useRef(null),c=d.useRef(null),r=d.useRef(null),h=d.useRef(null),m=d.useRef(null),u=d.useMemo(()=>xm.find(f=>f.type===s),[s]);d.useEffect(()=>{a?i.reset(a.value,{keepDefaultValues:!0}):i.reset()},[a,i.reset,i]);function p(f){let v="";l.current?v=l.current.getDirectiveLabel():c.current?v=c.current.getDirectiveLabel():r.current?v=r.current.getDirectiveLabel():h.current?v=h.current.getDirectiveLabel():m.current&&(v=m.current.getDirectiveLabel()),t({...f,label:v})}return e.jsx(Oe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(p),className:"space-y-2 flex flex-col h-full",children:[e.jsx(I,{control:i.control,name:"directive",render:({field:f})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(X,{children:u==null?void 0:u.name}),e.jsx(L,{children:e.jsxs(ue,{onValueChange:f.onChange,value:f.value,children:[e.jsx(oe,{className:"h-8",children:e.jsx(pe,{placeholder:"请选择指令"})}),e.jsx(le,{children:u==null?void 0:u.options.map(v=>e.jsx(Q,{value:v.value,children:v.name},v.value))})]})})]})}),lt.includes(o)&&e.jsx(km,{form:i,ref:l}),Ks.includes(o)&&e.jsx(Vm,{form:i,ref:c}),Fs.includes(o)&&e.jsx(Wm,{form:i,ref:r}),zs.includes(o)&&e.jsx(Tm,{form:i,ref:h}),o===S.FadeInTransition&&e.jsx(Rm,{form:i,ref:m}),o&&o!==S.Wait&&e.jsx(I,{control:i.control,name:"params.sequential",render:({field:f})=>e.jsxs(R,{className:"space-y-0 flex flex-row items-center !mb-4",children:[e.jsx(X,{className:"flex flex-col w-[4rem]",children:"串行执行"}),e.jsx(L,{children:e.jsx(Le,{checked:f.value,onCheckedChange:f.onChange})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"pt-2 !mt-auto sticky left-0 bottom-0 bg-white w-full flex justify-center border-t border-t-border gap-2",children:[e.jsx(C,{size:"sm",type:"submit",children:"确定"}),e.jsx(C,{size:"sm",type:"button",onClick:n,variant:"outline",children:"取消"})]})]})})}const Im={middleware:[jr(12),Nr({fallbackPlacements:["bottom-end","top-start","top-end"],padding:12})],placement:"bottom-start"};function Fm(){const a=wr({preventDefaultOnEnterKeydown:!0}),{useOption:s}=ys(Re),t=s("editingDirective"),n=s("directiveType"),{ref:i,props:o,onSubmit:l,onCancel:c}=bm({floatingOptions:Im,triggerFloatingLinkHotkeys:"mod+k"});return e.jsx(Zr,{children:e.jsx("div",{className:D(qn(),"w-auto p-1"),...o,ref:i,children:e.jsx("div",{className:"flex w-[200px] h-[400px] overflow-auto flex-col p-2",...a,children:n&&e.jsx(Xm,{editingDirective:t,directiveType:n,onSubmitDirective:l,onCancel:c})})})})}function Km({value:a,onChange:s,onFocus:t,children:n}){const i=Cr({plugins:[ts,Re.extend({render:{afterEditable:()=>e.jsx(Fm,{})}}),Gr],override:{components:Cm({[Re.key]:Gm,[ts.key]:Hd})},value:a.lines}),o=d.useRef(!1),l=({value:h})=>{if(o.current){o.current=!1;return}s({...a,lines:h})},c=h=>{s({...a,speak:h})},r=()=>{t(a)};return d.useEffect(()=>{i.children!==a.lines&&(o.current=!0,i.tf.setValue(a.lines))},[a.lines,i]),e.jsx(kr,{editor:i,onValueChange:l,children:e.jsxs("div",{className:"relative rounded-md border bg-background border-border",onFocus:r,children:[e.jsx(qd,{children:e.jsx(Nm,{speak:a.speak,onChangeSpeak:c,children:n})}),e.jsx(Qn,{focusRing:!1,variant:"ghost",size:"sm"})]})})}const zm=en,Ym=tn,Hm=sn,ei=d.forwardRef(({className:a,sideOffset:s=4,...t},n)=>e.jsx(gs,{ref:n,sideOffset:s,className:x("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...t}));ei.displayName=gs.displayName;function qs({onClose:a}){const s=k(G=>G.editor),t=k(G=>G.project),n=k(G=>G.activeScene),[i,o]=d.useState(!1),l=d.useRef(null),c=G=>{s.updateActiveScene(y=>{y.config.speak=G})},r=G=>{s.updateActiveScene(y=>{y.config.autoShowBackground=G})},h=G=>{const{config:y}=n;s.addDialogue({speak:s.cloneDialogueSpeak(y.speak),lines:[]},G),U()},m=(G,y)=>{s.addDialogue({speak:s.cloneDialogueSpeak(y.speak),lines:[]},G)},u=G=>{s.updateActiveScene(y=>{y.label=G})},p=(G,y)=>{if(s.activeScene){const{speaker:V,targetName:A}=s.activeScene.config.speak||{};if(V){const Y=s.activeScene.getChildByName(V.targetName);Y&&(Y.text=y.speak.speaker.name)}if(y.lines.length>0){const Y=s.activeScene.getChildByName(A);let ae="";y.lines.forEach(J=>{if(J.type==="p")for(let j=0;j<J.children.length;j++){const W=J.children[j];if(!W.type){let $=W.text;j===J.children.length-1&&($+="\n"),ae+=$}}}),ae&&Y&&(Y.text=ae)}}},f=(G,y)=>{s.updateDialogue(G,y),p(G,y)},v=(G,y)=>{const V=s.cloneDialogue(G);s.addDialogue(V,y)},T=(G,y)=>{s.swapDialogue(G,y)},U=()=>{setTimeout(()=>{l.current&&l.current.scrollToBottom()},100)};return e.jsx(Ie,{className:"w-full flex-1 h-full border-0 md:border shadow-none md:shadow rounded-md",children:e.jsx(Ze,{className:"h-full p-1 md:p-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-full h-full pr-2",ref:l,children:e.jsxs("div",{className:"flex flex-col m-1 mr-0 pr-1",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(ie,{htmlFor:"sceneName",className:"flex justify-between items-center",children:[e.jsx("span",{children:"场景名称"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs(kt,{children:[e.jsx(Vt,{asChild:!0,children:e.jsx(C,{size:"sm",variant:"ghost",children:e.jsx(N.settings,{className:"size-4"})})}),e.jsx(ot,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-base font-bold",children:"场景设置"}),e.jsx(_n,{speak:n.config.speak,onChangeSpeak:c,disableCustomName:!0}),e.jsxs("div",{className:"flex mt-2",children:[e.jsx("span",{className:"text-sm font-medium w-[8rem]",children:"自动展示背景"}),e.jsx(Le,{checked:n.config.autoShowBackground,onCheckedChange:r})]})]})})]}),e.jsx(zm,{children:e.jsxs(Ym,{children:[e.jsx(Hm,{asChild:!0,children:e.jsx(C,{size:"sm",variant:"ghost",onClick:()=>o(!0),children:e.jsx(N.bookmark,{className:"size-4"})})}),e.jsx(ei,{children:e.jsx("p",{children:"保存为模版"})})]})}),a&&e.jsx(C,{className:"-mr-3",size:"sm",variant:"ghost",onClick:a,children:e.jsx(N.close,{className:"size-4"})})]})]}),e.jsx(z,{type:"text",id:"sceneName",placeholder:"请输入场景名称",value:n.label,onChange:G=>u(G.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[e.jsx(ie,{children:"场景对白"}),n.dialogues.map((G,y)=>e.jsx("div",{children:e.jsx(Km,{value:G,onChange:V=>f(y,V),onFocus:V=>p(y,V),children:e.jsxs(Cs,{children:[e.jsx(Gs,{children:e.jsx(N.more,{className:"size-4 cursor-pointer mx-1"})}),e.jsxs(Kt,{children:[e.jsx(O,{onClick:()=>m(y+1,G),children:"插入"}),e.jsx(O,{onClick:()=>v(G,y+1),children:"复制"}),e.jsx(O,{className:"text-destructive",onClick:()=>{s.removeDialogue(G)},children:"删除"}),e.jsx(ks,{}),y>0&&e.jsx(O,{onClick:()=>T(y,y-1),children:"上移"}),y<n.dialogues.length-1&&e.jsx(O,{onClick:()=>T(y,y+1),children:"下移"})]})]})})},y))]}),e.jsx(C,{className:"mt-2",onClick:()=>h(),children:"新增对白"})]})}),e.jsx(md,{isOpen:i,onClose:()=>o(!1),sceneName:n.name})]}):e.jsx("div",{className:"h-full text-lg flex items-center justify-center text-muted-foreground/50",children:t?"请先创建场景":"请先创建或打开作品"})})})}function Dm({url:a,className:s}){const[t,n]=d.useState(!1),i=d.useRef(null),o=l=>{l.stopPropagation(),i.current&&(t?i.current.pause():i.current.play(),n(!t))};return e.jsxs("div",{className:x("w-full aspect-[1/1] flex justify-center items-center cursor-pointer relative",s),children:[e.jsx("audio",{ref:i,src:a,className:"hidden"}),e.jsx(C,{onClick:o,variant:"outline",size:"icon",className:"w-12 h-12",children:t?e.jsx(Vr,{className:"h-6 w-6"}):e.jsx(Wr,{className:"h-6 w-6"})})]})}function Mm({url:a,className:s}){return e.jsx("div",{className:x("w-full h-full cursor-pointer flex justify-center items-center relative",s),style:{backgroundImage:'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><rect width="10" height="10" fill="%23ccc"/><rect x="10" y="10" width="10" height="10" fill="%23ccc"/></svg>\')'},children:a&&e.jsx("img",{src:a,className:"absolute left-0 top-0 h-full w-full object-contain"})})}function Pm(){return"font-".concat(Date.now())}function Um({fontName:a,fontUrl:s,className:t}){const n=d.useMemo(()=>{if(a)return a;if(s)return Pm()},[a,s]);return d.useEffect(()=>{if(a)return;const i=document.createElement("style");return i.innerHTML="\n      @font-face {\n        font-family: '".concat(n,"';\n        src: url('").concat(s,"');\n      }\n    "),document.head.appendChild(i),()=>{a||document.head.removeChild(i)}},[n,a,s]),e.jsxs("div",{className:x("w-full aspect-[1/1] flex flex-col justify-center items-center relative",t),style:{fontFamily:n},children:[e.jsx("span",{children:"示例文字"}),e.jsx("span",{children:"Sample Text"}),e.jsx("span",{children:"0123456789"})]})}const Am={[Z.Background]:"240px",[Z.Character]:"135px",[Z.Thing]:"200px",[Z.Dialog]:"240px",[Z.Audio]:"150px",[Z.Font]:"150px"},ea={[Z.Background]:"aspect-[16/9]",[Z.Character]:"aspect-[9/16]",[Z.Thing]:"aspect-[1/1]",[Z.Dialog]:"aspect-[16/3]"};function ti({type:a,url:s,state:t}){const n=d.useMemo(()=>s||(t?Ne(t):""),[s,t]);return Object.keys(ea).includes(a)?e.jsx(Mm,{url:n,className:ea[a]}):a===Z.Audio?e.jsx(Dm,{url:n}):a===Z.Font?e.jsx(Um,{fontName:t==null?void 0:t.name,fontUrl:n}):null}function si({type:a,state:s,children:t,onSelect:n}){return e.jsx(Ie,{className:"rounded-md cursor-pointer",style:{width:Am[a]},onClick:n,children:t||e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"p-2 flex justify-center",children:e.jsx(ti,{type:a,state:s})}),e.jsx(Ft,{className:"font-medium p-2 pt-0 flex justify-center text-sm",children:s.name})]})})}function Bm({asset:a,onSelect:s,onEdit:t,onDelete:n}){return e.jsxs(Ie,{className:"rounded-md",children:[e.jsx(Ze,{className:"p-0 flex justify-center cursor-pointer",onClick:s,children:e.jsx(N.folder,{className:"w-[120px] h-[120px] text-neutral-600 p-2"})}),e.jsxs(Ft,{className:"w-[120px] font-medium p-2 pt-0 flex justify-between text-sm",children:[e.jsx("div",{className:"max-w-[100px] overflow-hidden text-ellipsis cursor-pointer",onClick:s,children:a.name}),e.jsxs(Cs,{children:[e.jsx(Gs,{children:e.jsx(N.more,{className:"w-4 h-4 pointer"})}),e.jsxs(Kt,{children:[e.jsx(O,{onClick:t,children:"编辑"}),e.jsx(O,{className:"text-destructive",onClick:n,children:"删除"})]})]})]})]})}function Om({type:a,url:s,className:t,onChange:n}){const[i,o]=d.useState(null),l=d.useMemo(()=>i||s||"",[s,i]),c=d.useMemo(()=>{switch(a){case Z.Background:case Z.Character:case Z.Thing:case Z.Dialog:return".webp, .png, .jpg";case Z.Audio:return".mp3, .wav, .m4a, .aac";default:return""}},[a]),r=d.useRef(null),h=u=>{var f;i&&URL.revokeObjectURL(i);const p=((f=u.target.files)==null?void 0:f[0])||null;o(URL.createObjectURL(p)),n(p)},m=()=>{var u;(u=r.current)==null||u.click()};return d.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]),e.jsxs("div",{className:x("flex cursor-pointer group relative",t),onClick:m,children:[e.jsx("input",{type:"file",ref:r,onChange:h,className:"hidden",accept:c}),e.jsxs("div",{className:"size-full flex justify-center items-center text-sm invisible group-hover:visible bg-muted/80 absolute left-0 right-0 z-20",children:[e.jsx(Tr,{className:"size-4"}),e.jsx("div",{children:"选择文件"})]}),e.jsx(ti,{url:l,type:a})]})}const Em=se("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ai=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx("div",{ref:n,role:"alert",className:x(Em({variant:s}),a),...t}));ai.displayName="Alert";const Jm=d.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:x("mb-1 font-medium leading-none tracking-tight",a),...s}));Jm.displayName="AlertTitle";const ni=d.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:x("text-sm [&_p]:leading-relaxed",a),...s}));ni.displayName="AlertDescription";const Qm=g.object({id:g.number().optional(),name:g.string().min(1,{message:"名称必填"}),type:g.string().min(1,{message:"类型必选"}),states:g.array(g.object({id:g.number().optional(),name:g.string().min(1,{message:"状态名称必填"}),ext:g.string().optional(),file:g.instanceof(File).optional()}).refine(a=>a.id||a.file,{message:"状态文件必选"})).min(1,{message:"至少需要一个状态"})});function $m({asset:a,onSubmit:s,onCancel:t}){const n=d.useMemo(()=>Jc[a.type],[a.type]),i=Ue({resolver:Ae(Qm),defaultValues:{name:"",type:"",states:[]}}),{fields:o,append:l,remove:c}=Rr({control:i.control,name:"states",keyName:"_id"}),r=m=>{s(m)},h=(m,u)=>{i.setValue("states.".concat(u,".file"),m),i.getValues("states.".concat(u,".name"))||i.setValue("states.".concat(u,".name"),jt(m).name)};return d.useEffect(()=>{i.reset({id:a.id,name:a.name,type:a.type,states:a.states})},[a,i]),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-bold mb-2",children:[a.id?"编辑":"新增",n,e.jsx(ai,{className:"p-2 mt-1",children:e.jsxs(ni,{className:"text-muted-foreground font-normal flex gap-1 items-center",children:[e.jsx(N.tip,{className:"size-4"}),[Z.Background,Z.Character,Z.Thing,Z.Dialog].includes(a.type)&&e.jsx("span",{children:"画布的尺寸为1920*1080"}),a.type===Z.Audio&&e.jsx("span",{children:"音频采样率建议>=44100Hz"}),a.type===Z.Font&&e.jsx("span",{children:"请使用woff/woff2/ttf字体格式"})]})})]}),e.jsx(Oe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(r),className:"space-y-4",children:[e.jsx(I,{control:i.control,name:"name",render:({field:m})=>e.jsxs(R,{children:[e.jsxs(X,{children:[n,"名"]}),e.jsx(L,{children:e.jsx(z,{placeholder:"请输入".concat(n,"名"),...m})}),e.jsx(F,{})]})}),e.jsxs(R,{children:[e.jsxs(X,{className:"flex items-center",children:[n,"状态",e.jsxs(C,{size:"sm",variant:"outline",onClick:()=>l({name:""}),className:"ml-2",children:[e.jsx(N.squarePlus,{className:"size-4 mr-1"}),"新增状态"]})]}),e.jsx(L,{children:e.jsx("div",{children:o.length>0&&e.jsxs(xe,{className:"w-full whitespace-nowrap rounded-md border",children:[e.jsx("div",{className:"flex w-full gap-2 p-2",children:o.map((m,u)=>e.jsx(si,{type:a.type,state:m,children:e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"p-2 flex justify-center",children:e.jsx(Om,{className:"w-full h-full",type:a.type,url:m.id&&Ne(m),onChange:p=>h(p,u)})}),e.jsx(Ft,{className:"font-medium p-2 pt-0 flex flex-col gap-1",children:e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx(I,{control:i.control,name:"states.".concat(u,".name"),render:({field:p})=>e.jsx(R,{children:e.jsx(L,{children:e.jsx(z,{className:"h-6 text-sm",placeholder:"请输入状态名",...p})})})}),e.jsx(N.delete,{className:"size-4 ml-1 mt-1 flex-shrink-0 cursor-pointer hover:text-destructive",onClick:()=>c(u)})]})})]})},u))}),e.jsx(ws,{orientation:"horizontal"})]})})}),e.jsx(F,{})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"submit",children:"确定"}),e.jsx(C,{type:"button",className:"mr-2",variant:"outline",onClick:t,children:"取消"})]})]})})]})}function _m({asset:a,onEdit:s,onSelectState:t,onCancel:n}){var i;return e.jsxs("div",{className:"h-[calc(100%-2.5rem)] flex flex-col",children:[e.jsxs("h3",{className:"text-base font-bold mb-4 flex justify-between items-center",children:["选择默认状态",e.jsx(C,{className:"ml-1 mr-auto",variant:"ghost",size:"sm",onClick:()=>s(a),children:e.jsx(N.edit,{className:"size-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:n,children:"返回列表"})]}),e.jsx(xe,{className:"flex-1",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:(i=a.states)==null?void 0:i.map(o=>e.jsx(si,{type:a.type,state:o,onSelect:()=>t(o)},o.id))})})]})}function qm(){const a=q(j=>j.isOpen),s=q(j=>j.confirm),t=q(j=>j.cancel),n=q(j=>j.disableSelect),i=q(j=>j.type),[o,l]=d.useState(i),[c,r]=d.useState(null),[h,m]=d.useState(null),u=rt(()=>o?ee.where("type").equals(o).reverse().toArray():[],[o]),p=j=>{l(j)},f=()=>{r({name:"",type:o,states:[]})},v=j=>{r(j)},T=j=>{j.states.forEach(W=>{Ye.delete(W.id)}),ee.delete(j.id)},U=()=>{t(),r(null),m(null)},G=async j=>{for(const W of j.states){const $=jt(W.file).ext,Fe=await Ye.add({mime:W.file.type,blob:W.file,ext:$});W.id=Fe,W.ext=$,delete W.file,j.type===Z.Font&&as(W.name,Ne(W))}await ee.add(j)},y=async j=>{for(const W of j.states){if(W.file){W.id&&await Ye.delete(W.id);const $=jt(W.file).ext,Fe=await Ye.add({mime:W.file.type,blob:W.file,ext:$});W.id=Fe,W.ext=$,j.type===Z.Font&&as(W.name,Ne(W))}delete W.file}await ee.update(j.id,j)},V=async j=>{if(j.id){if(await y(j),h){const W=await ee.get(j.id);m(W)}}else await G(j);r(null)},A=()=>{r(null)},Y=j=>{n||(s({...h,stateId:j.id}),m(null))},ae=()=>{m(null)};d.useEffect(()=>{l(i||Z.Character)},[i]);const J=()=>c?e.jsx($m,{asset:c,onSubmit:V,onCancel:A}):h?e.jsx(_m,{asset:h,onEdit:j=>v(j),onSelectState:Y,onCancel:ae}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Jn,{value:o,onValueChange:p,children:e.jsx(Is,{children:Vs.map(j=>e.jsx(st,{value:j.value,disabled:i&&i!==j.value,children:j.name},j.value))})}),e.jsxs(C,{size:"sm",onClick:f,children:[e.jsx(N.squarePlus,{className:"w-3.5 h-3.5 mr-0.5"}),"新增"]})]}),e.jsx(xe,{className:"flex-grow",children:e.jsx("div",{className:"flex gap-2 flex-wrap",children:u==null?void 0:u.map(j=>e.jsx(Bm,{asset:j,onSelect:()=>m(j),onEdit:()=>v(j),onDelete:()=>T(j)},j.id))})})]});return e.jsx(we,{open:a,onOpenChange:U,children:e.jsxs(fe,{className:"min-w-[90vw] h-[90vh] flex flex-col",children:[e.jsxs(be,{children:[e.jsx(ge,{children:"素材库"}),e.jsx(ye,{})]}),J()]})})}const eh=Lr,ii=d.forwardRef(({className:a,...s},t)=>e.jsx(ln,{ref:t,className:x("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...s}));ii.displayName=ln.displayName;const th=se("group pointer-events-auto relative flex w-full items-center justify-between space-x-2 overflow-hidden rounded-md border p-4 pr-6 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),oi=d.forwardRef(({className:a,variant:s,...t},n)=>e.jsx(rn,{ref:n,className:x(th({variant:s}),a),...t}));oi.displayName=rn.displayName;const sh=d.forwardRef(({className:a,...s},t)=>e.jsx(cn,{ref:t,className:x("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium transition-colors hover:bg-secondary focus:outline-none focus:ring-1 focus:ring-ring disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...s}));sh.displayName=cn.displayName;const li=d.forwardRef(({className:a,...s},t)=>e.jsx(dn,{ref:t,className:x("absolute right-1 top-1 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-1 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...s,children:e.jsx(Za,{className:"h-4 w-4"})}));li.displayName=dn.displayName;const ri=d.forwardRef(({className:a,...s},t)=>e.jsx(mn,{ref:t,className:x("text-sm font-semibold [&+div]:text-xs",a),...s}));ri.displayName=mn.displayName;const ci=d.forwardRef(({className:a,...s},t)=>e.jsx(hn,{ref:t,className:x("text-sm opacity-90",a),...s}));ci.displayName=hn.displayName;function ah(){const{toasts:a}=Dt();return e.jsxs(eh,{children:[a.map(function({id:s,title:t,description:n,action:i,...o}){return e.jsxs(oi,{...o,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(ri,{children:t}),n&&e.jsx(ci,{children:n})]}),i,e.jsx(li,{})]},s)}),e.jsx(ii,{})]})}function nh(a){const[s,t]=d.useState(window.matchMedia(a).matches);return d.useEffect(()=>{const n=window.matchMedia(a);n.matches!==s&&t(n.matches);const i=()=>t(n.matches);return n.addEventListener("change",i),()=>n.removeEventListener("change",i)},[s,a]),s}function ih(){const[a,s]=d.useState(!1),t=nh("(min-width: 768px)"),[n,i]=d.useState(null),{toast:o}=Dt(),l=()=>{s(!0)};return d.useEffect(()=>{Pr().then(c=>{i(c.video),c.audio||(sd(!0),o({title:"提示",description:"当前浏览器不支持音频合成，请使用最新桌面版的Chrome或Edge浏览器获取完整体验～",duration:1500}))})},[o]),n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"h-screen flex flex-col",children:[e.jsx(Yd,{}),e.jsxs("main",{className:"grid flex-1 gap-2 overflow-auto p-2 grid-cols-1 md:grid-cols-[minmax(450px,1fr)_2fr] bg-muted/50",children:[e.jsx("div",{className:"relative hidden md:flex h-[calc(100vh-53px-1rem)]",children:t&&e.jsx(qs,{})}),e.jsxs("div",{className:"relative flex h-full flex-col gap-2",children:[e.jsx(kd,{}),e.jsxs("div",{className:"flex gap-2 h-[50vh] md:h-[30vh] flex-col sm:flex-row",children:[e.jsx(zd,{}),e.jsx(td,{onOpenSceneDetailDialog:l})]})]})]})]}),!t&&a&&e.jsx("div",{className:"fixed top-0 left-0 size-full z-50",children:e.jsx(qs,{onClose:()=>s(!1)})}),e.jsx(qm,{}),e.jsx(ah,{})]}):e.jsx("div",{className:"flex h-screen items-center justify-center",children:n===!1?e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"您的浏览器不支持"}),e.jsx("p",{className:"text-sm",children:"请使用最新桌面版的Chrome或Edge浏览器～"})]}):e.jsx("div",{className:"text-center",children:"环境检测中..."})})}const oh=Xr([{path:"/",element:e.jsx(ih,{})}]);function lh(){return e.jsx(Ir,{router:oh})}window.onbeforeunload=function(){return"确认离开？"};qc();const rh=document.getElementById("root");Fr.createRoot(rh).render(e.jsx(lh,{}));export{dh as __vite_legacy_guard};
